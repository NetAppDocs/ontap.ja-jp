---
sidebar: sidebar 
permalink: authentication/oauth2-prepare.html 
keywords: oauth 2.0, oauth2, prepare, plan, deployment plan 
summary: ONTAP環境でOAuth 2.0を設定する前に、導入の準備をする必要があります。 
---
= ONTAPでのOAuth 2.0の導入準備
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAP環境でOAuth 2.0を設定する前に、導入の準備をする必要があります。ここでは、主なタスクと決定が必要な事項の概要を説明します。セクションは、一般に望ましいと考えられる順序で並んでいます。大半の環境にはこれで対応できますが、必要があれば環境に応じて調整してご利用ください。このほか、正式な導入計画の作成も検討してください。


TIP: 環境に応じて、ONTAPに定義された認可サーバーの設定を選択できます。これには、導入タイプごとに指定する必要があるパラメータ値が含まれます。詳細については、link:../authentication/oauth2-deployment-scenarios.html["OAuth 2.0の導入シナリオ"]を参照してください。



== 保護されたリソースとクライアント アプリケーション

OAuth 2.0は、保護されたリソースへのアクセスを制御するための許可フレームワークです。そこで、導入に際してまずは使用可能なリソースと、それらにアクセスする必要があるクライアントを特定することが、重要な最初の手順になります。

.クライアント アプリケーションの特定
REST API呼び出しを発行する際にOAuth 2.0を使用するクライアントと、それらのクライアントのアクセス先になるAPIエンドポイントを決定する必要があります。

.既存のONTAP RESTロールとローカル ユーザの確認
RESTロールやローカル ユーザなど、既存のONTAP IDの定義を確認する必要があります。OAuth 2.0の設定方法によっては、これらの定義を使用してアクセスを制御できます。

.OAuth 2.0へのグローバルな移行
OAuth 2.0許可は段階的に導入することもできますが、各許可サーバにグローバル フラグを設定することで、すべてのREST APIクライアントを一気にOAuth 2.0に移行することもできます。これにより、自己完結型スコープを作成しなくても、ONTAPの既存の設定に基づいてアクセスを制御できます。



== 許可サーバ

許可サーバは、OAuth 2.0環境において、アクセス トークンを発行し、管理ポリシーを適用するという重要な役割を果たします。

.許可サーバの選択とインストール
1つ以上の許可サーバを選択し、インストールする必要があります。スコープの定義方法など、アイデンティティ プロバイダの設定オプションと手順を理解しておくことが重要です。Microsoft Entra IDなど、一部の許可サーバは、名前ではなく、UUIDを使用してグループを表します。

.許可ルートCA証明書をインストールする必要性の判断
ONTAPは、許可サーバの証明書を使用して、クライアントから提示された署名済みアクセス トークンを検証します。そのためにONTAPに必要なのが、ルートCA証明書と中間証明書です。これらの証明書は、事前にONTAPにインストールされている可能性があります。インストールされていない場合には、インストールする必要があります。

.ネットワークの位置の評価と設定
許可サーバがファイアウォールの内側にある場合は、プロキシ サーバを使用するようにONTAPを設定する必要があります。



== クライアント認証と許可

クライアントの認証と許可には、考慮すべき側面がいくつかあります。

.自己完結型スコープかローカルONTAP ID定義か
大きく分けて、許可サーバで自己完結型スコープを定義する方法と、ロールやユーザを含む既存のローカルONTAP ID定義を使用する方法があります

.ローカルONTAP処理に関するオプション
ONTAP ID定義を使用する場合は、次のどれを適用するのかを決定する必要があります。

* 指定RESTロール
* ローカル ユーザの照合
* Active DirectoryグループまたはLDAPグループ


.ローカル検証とリモート イントロスペクション
アクセス トークンがONTAPによってローカルで検証されるか、イントロスペクションによって許可サーバで検証されるかを決定する必要があります。また、更新間隔など、いくつかの関連する値についても検討する必要があります。

.送信者限定アクセス トークン
高度なセキュリティが必要な環境には、mTLSベースの送信者限定アクセス トークンを使用できます。この場合、クライアントごとに証明書が必要です。

.UUIDとしてのグループおよびIDマッピング
UUIDを使用してグループを表す許可サーバを使用している場合は、これらをグループ名に、場合によっては関連付けられているロールにもマッピングする方法を計画する必要があります。

.管理インターフェイス
OAuth 2.0は、次のいずれかのONTAPインターフェイスを通じて管理できます。

* コマンドライン インターフェイス
* System Manager
* REST API


.クライアントによるアクセス トークン要求の方法
クライアント アプリケーションは、許可サーバに直接アクセス トークンを要求しなければなりません。グラント タイプを含めて、これをどのように行うかを決定する必要があります。



== ONTAPの設定

ONTAPで、いくつかの設定タスクを実行する必要があります。

.RESTロールとローカル ユーザの定義
許可の設定に基づいて、ローカルのONTAP識別処理を使用できます。その場合は、RESTロールとユーザ定義を確認および定義する必要があります。また、許可サーバによっては、UUID値に基づいたグループの管理も含まれる場合があります。

.コア設定
ONTAPのコア設定を行うには、主に次の3つの手順が必要です。

* 必要に応じて、許可サーバの証明書に署名したCAのルート証明書を（ある場合は中間証明書も）インストールします。
* 許可サーバを定義します。
* クラスタのOAuth 2.0処理を有効にします。

