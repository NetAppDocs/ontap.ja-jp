---
sidebar: sidebar 
permalink: authentication/oauth2-prepare.html 
keywords: oauth 2.0, oauth2, prepare, plan, deployment plan 
summary: ONTAP環境でOAuth 2.0を構成する前に、展開の準備をする必要があります。 
---
= ONTAPを使用したOAuth 2.0の導入準備
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ONTAP環境でOAuth 2.0を構成する前に、展開の準備をする必要があります。主なタスクと決定事項の概要を以下に示します。セクションの配置は、通常、従うべき順序に沿って配置されます。ただし、ほとんどの環境に適用できますが、必要に応じて環境に適応する必要があります。また、正式な導入計画の作成も検討する必要があります。


TIP: 環境に応じて、ONTAPに定義されている認証サーバの設定を選択できます。これには、導入のタイプごとに指定する必要があるパラメータ値も含まれます。詳細については、を参照してください link:../authentication/oauth2-deployment-scenarios.html["OAuth 2.0の導入シナリオ"] 。



== リソースとクライアントアプリケーションを保護

OAuth 2.0は、保護されたリソースへのアクセスを制御するための承認フレームワークです。このため、導入の最初の重要なステップは、使用可能なリソースと、それらにアクセスする必要があるクライアントを特定することです。

.クライアントアプリケーションを特定する
REST API呼び出しを発行するときにOAuth 2.0を使用するクライアントと、アクセスが必要なAPIエンドポイントを決定する必要があります。

.既存のONTAP RESTロールとローカルユーザの確認
RESTロールやローカルユーザなど、既存のONTAP IDの定義を確認する必要があります。OAuth 2.0の設定方法によっては、これらの定義を使用してアクセスを決定できます。

.OAuth 2.0へのグローバルな移行
OAuth 2.0認証を段階的に実装することもできますが、各認証サーバーにグローバルフラグを設定することで、すべてのREST APIクライアントをOAuth 2.0にすぐに移動することもできます。これにより、自己完結型スコープを作成することなく、既存のONTAP構成に基づいてアクセスを決定できます。



== 認証サーバ

認証サーバーは、アクセストークンを発行し、管理ポリシーを適用することで、OAuth 2.0の展開において重要な役割を果たします。

.認可サーバーを選択してインストールします。
1つ以上の認可サーバーを選択してインストールする必要があります。スコープの定義方法など、アイデンティティプロバイダの設定オプションと手順を理解することが重要です。Microsoft Entra IDを含む一部の承認サーバーは、名前ではなくUUIDを使用してグループを表します。

.認証ルートCA証明書をインストールする必要があるかどうかを判断する
ONTAPでは、認証サーバの証明書を使用して、クライアントから提示された署名済みアクセストークンを検証します。これを行うには、ONTAPにルートCA証明書と中間証明書が必要です。ONTAPがプリインストールされている場合があります。そうでない場合は、インストールする必要があります。

.ネットワークの場所と構成の評価
認証サーバがファイアウォールの背後にある場合は、プロキシサーバを使用するようにONTAPを設定する必要があります。



== クライアント認証と許可

クライアントの認証と許可には、いくつかの側面を考慮する必要があります。

.自己完結型スコープまたはローカルONTAP ID定義
大まかに言えば、認可サーバーで定義された自己完結型スコープを定義することも、役割やユーザーを含む既存のローカルONTAP ID定義に依存することもできます。

.ローカルONTAP処理を使用するオプション
ONTAP ID定義を使用する場合は、適用するものを次のように決定する必要があります。

* ネームドRESTロール
* ローカルユーザの一致
* Active DirectoryまたはLDAPグループ


.ローカル検証またはリモートイントロスペクション
アクセストークンがONTAPによってローカルで検証されるか、イントロスペクションによって認可サーバーで検証されるかを決定する必要があります。また、更新間隔など、いくつかの関連する値も考慮する必要があります。

.送信者に制約されたアクセストークン
高度なセキュリティが必要な環境では、MTLSに基づいて送信制限付きアクセストークンを使用できます。これには、クライアントごとに証明書が必要です。

.UUIDおよびIDマッピングとしてのグループ
UUIDを使用するグループを表す認証サーバを使用している場合は、これらをグループ名および場合によっては関連するロールにマッピングする方法を計画する必要があります。

.管理インターフェイス
OAuth 2.0の管理は、次のいずれかのONTAPインターフェイスを使用して実行できます。

* コマンドラインインターフェイス
* System Manager
* REST API


.クライアントニヨルアクセストークンノヨウキュウホウホウ
クライアントアプリケーションは、許可サーバからアクセストークンを直接要求する必要があります。許可の種類を含め、これをどのように行うかを決定する必要があります。



== ONTAPの設定

ONTAPのいくつかの設定タスクを実行する必要があります。

.RESTロールとローカルユーザを定義する
認証設定に基づいて、ローカルのONTAP識別処理を使用できます。この場合は、RESTロールとユーザ定義を確認して定義する必要があります。また、認証サーバによっては、UUID値に基づいたグループの管理も含まれる場合があります。

.コア構成
コアONTAP構成の実行には、主に次の3つの手順が必要です。

* 必要に応じて、認証サーバの証明書に署名したCAのルート証明書（および中間証明書）をインストールします。
* 認可サーバを定義します。
* クラスタに対してOAuth 2.0の処理を有効にします。

