---
sidebar: sidebar 
permalink: authentication/oauth2-rest-api.html 
keywords: acquire token, curl, rest api call, keycloak 
summary: ONTAPに導入したOAuth 2.0では、REST APIクライアント アプリケーションがサポートされます。curlを使用して簡単なREST API呼び出しを発行し、OAuth 2.0の使用を開始できます。 
---
= OAuth 2.0を使用してONTAP REST API呼び出しを発行する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAPに導入したOAuth 2.0では、REST APIクライアント アプリケーションがサポートされます。curlを使用して簡単なREST API呼び出しを発行し、OAuth 2.0の使用を開始できます。ここでは、ONTAPクラスタのバージョンを取得する例を紹介します。



== 開始する前に

ONTAPクラスタにOAuth 2.0の機能を設定して有効にする必要があります。これには、許可サーバの定義が含まれます。



== ステップ1：アクセストークンを取得する

REST API呼び出しで使用するアクセス トークンを取得する必要があります。トークンの要求はONTAPの外部で実行され、正確な手順は許可サーバとその設定によって異なります。Webブラウザ、curlコマンド、またはプログラミング言語を通じてトークンを要求できます。

参考までに、curlを使用してKeycloakからアクセス トークンを要求する方法を掲載します。

.Keycloakの例
[source, curl]
----
curl --request POST \
--location 'https://superzap.dev.netapp.com:8443/realms/peterson/protocol/openid-connect/token' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'client_id=dp-client-1' \
--data-urlencode 'grant_type=client_credentials' \
--data-urlencode 'client_secret=5iTUf9QKLGxAoYa1iR33vlD5A2xq09V7'
----
返されたトークンは、コピーして保存する必要があります。



== ステップ2：REST API呼び出しを発行する

有効なアクセス トークンを取得したら、curlコマンドとアクセス トークンを使用してREST API呼び出しを発行できます。

.パラメータと変数
次の表は、curlの例にある2つの変数についての解説です。

[cols="25,75"]
|===
| 変数 | 概要 


| $FQDN_IP | ONTAP管理LIFの完全修飾ドメイン名またはIPアドレスです。 


| $ACCESS_TOKEN | 許可サーバによって発行されたOAuth 2.0アクセス トークンです。 
|===
curlの例を実行する前に、Bashシェル環境でこれらの変数を設定する必要があります。たとえば、Linux CLIで次のコマンドを入力して、FQDN変数を設定および表示します。

[listing]
----
FQDN_IP=172.14.31.224
echo $FQDN_IP
172.14.31.224
----
ローカルのBashシェルで両方の変数を定義したら、curlコマンドをコピーしてCLIに貼り付けます。*Enter*キーを押して変数を置き換え、コマンドを実行します。

.Curlの例
[source, curl]
----
curl --request GET \
--location "https://$FQDN_IP/api/cluster?fields=version" \
--include \
--header "Accept: */*" \
--header "Authorization: Bearer $ACCESS_TOKEN"
----