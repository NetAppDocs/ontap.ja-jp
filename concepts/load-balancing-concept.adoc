---
permalink: concepts/load-balancing-concept.html 
sidebar: sidebar 
keywords: 'load balance, workload, latency, overload, reduce load, ceiling, limits, iops, "mb/s", qos, min, max, policy group, throughput, headroom, floor, adaptive qos' 
summary: ノードでの作業量が使用可能なリソースを超えると、ワークロードのパフォーマンスがレイテンシの影響を受け始めます。ノードが過負荷になった場合は、使用可能なリソースを増やす（ディスクまたはCPUをアップグレードする）か、負荷を軽減する（必要に応じてボリュームまたはLUNを別のノードに移動する）ことで対処できます。 
---
= ONTAPテノロオトハランシンク
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ノードでの作業量が使用可能なリソースを超えると、ワークロードのパフォーマンスがレイテンシの影響を受け始めます。ノードが過負荷になった場合は、使用可能なリソースを増やす（ディスクまたはCPUをアップグレードする）か、負荷を軽減する（必要に応じてボリュームまたはLUNを別のノードに移動する）ことで対処できます。

また、ONTAP _ storage Quality of Service（QoS）_を使用して、重要なワークロードのパフォーマンスが競合するワークロードによって低下しないようにすることもできます。

* 競合するワークロードに対して QoS スループットの上限を設定すると、そのワークロードによるシステムリソースへの影響を制限できます（最大 QoS ）。
* 重要なワークロードに対して QoS スループットの下限を設定すると、競合するワークロードによる要求に関係なく、必要な最小スループットを確保できます（最小 QoS ）。
* 同じワークロードに対してQoSの上限と下限を設定できます。




== スループットの上限

スループットの上限は、ワークロードのスループットを最大IOPSまたはMB/秒に制限します。次の図では、ワークロード 2 のスループットの上限により、ワークロード 1 および 3 の「負荷」が発生しないようにしています。

a_policy group_ は、 1 つ以上のワークロードに対するスループットの上限を定義します。ワークロードとは、 a_storage オブジェクト： _a ボリューム、ファイル、 LUN 、または SVM 内のすべてのボリューム、ファイル、 LUN の I/O 処理のことです。上限はポリシーグループの作成時に指定することも、ワークロードを監視してから指定することもできます。

[NOTE]
====
ワークロードのスループットは、特にスループットが急激に変化した場合、指定された上限を10%までは超えることができます。バーストに対処するために、上限を50%まで超過することがあります。

====
image:qos-ceiling-concepts.gif["スループットの上限"]



== スループットの下限

スループットの下限は、ワークロードのスループットが最小IOPSを下回らないことを保証します。次の図では、ワークロード1とワークロード3のスループットの下限が設定されているため、ワークロード2からの要求に関係なく、必要な最小スループットが確保されています。

[TIP]
====
これらの例からわかるように、スループットの上限はスループットを直接調整するのに対し、スループットの下限は下限が設定されたワークロードを優先することでスループットを間接的に調整します。

====
ワークロードは、ボリューム、LUN、またはONTAP 9 .3以降のfileのI/O処理を表します。スループットの下限が定義されたポリシーグループは、SVMには適用できません。下限はポリシーグループの作成時に指定できます。また、ワークロードを監視したあとで指定することもできます。

[NOTE]
====
ノードやアグリゲートに十分なパフォーマンス容量（ヘッドルーム）がない場合やなどの重要な処理の実行中は、ワークロードのスループットが指定された下限を下回ることがあります `volume move trigger-cutover`。利用可能な容量が十分にあり、重要な処理を実行していない場合でも、ワークロードのスループットが指定された下限を最大5%下回ることがあります。

====
image:qos-floor-concepts.gif["スループットの下限"]



== アダプティブQoS

通常、ストレージオブジェクトに割り当てるポリシーグループの値は固定値です。ストレージオブジェクトのサイズが変わった場合は、値を手動で変更する必要があります。たとえば、ボリュームの使用スペースが増えた場合、通常は指定されているスループットの上限も増やす必要があります。

アダプティブ QoS _ ワークロードのサイズの変更に合わせてポリシーグループの値が自動的に調整され、 TB または GB あたりの IOPS が一定に維持されます。これは、何百何千という数のワークロードを管理する大規模な環境では大きなメリットです。

アダプティブQoSは、主にスループットの上限の調整に使用しますが、下限の管理（ワークロードサイズが増加した場合）にも使用できます。ワークロードのサイズは、ストレージオブジェクトに割り当てられたスペースまたはストレージオブジェクトで使用されているスペースのいずれかで表されます。


NOTE: ONTAP 9.5以降では、使用済みスペースをスループットの下限に使用できます。ONTAP 9.4以前のスループットの下限ではサポートされません。

+ ONTAP 9.13.1以降では、アダプティブQoSを使用して、SVMレベルでスループットの下限と上限を設定できます。

* 割り当て済みスペースのポリシーでは、ストレージオブジェクトの公称サイズを基準に IOPS と TB / GB の比率が維持されます。比率が100 IOPS/GBの場合、150GBのボリュームのスループットの上限は、ボリュームのサイズが変わらないかぎり15、000 IOPSです。ボリュームのサイズが300GBに変更されると、アダプティブQoSによってスループットの上限が30、000 IOPSに調整されます。
* a_used space-policy （デフォルト）は、ストレージ効率化前に格納されている実際のデータの量に基づいて、 IOPS/TB|GB の比率を維持します。比率が100 IOPS/GBの場合、100GBのデータが格納されている150GBのボリュームのスループットの上限は10、000 IOPSです。使用済みスペースの量が変わると、アダプティブQoSによって比率に応じてスループットの上限が調整されます。

