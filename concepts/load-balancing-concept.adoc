---
permalink: concepts/load-balancing-concept.html 
sidebar: sidebar 
keywords: 'load balance, workload, latency, overload, reduce load, ceiling, limits, iops, "mb/s", qos, min, max, policy group, throughput, headroom, floor, adaptive qos' 
summary: ノードでの作業量が利用可能なリソースを超えると、ワークロードのパフォーマンスにレイテンシが発生し始めます。ノードの負荷が許容量を超えた場合は、利用可能なリソースを増やす（ディスクやCPUをアップグレードする）か、負荷を減らす（ボリュームやLUNを必要に応じて別のノードに移動する）ことで対処します。 
---
= ONTAPのロード バランシング
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ノードでの作業量が利用可能なリソースを超えると、ワークロードのパフォーマンスにレイテンシが発生し始めます。ノードの負荷が許容量を超えた場合は、利用可能なリソースを増やす（ディスクやCPUをアップグレードする）か、負荷を減らす（ボリュームやLUNを必要に応じて別のノードに移動する）ことで対処します。

また、ONTAP _ストレージ サービス品質（QoS）_ を使用して、競合するワークロードによって重要なワークロードのパフォーマンスが低下しないようにすることもできます：

* 競合するワークロードに QoS スループットの上限を設定して、システム リソースへの影響を制限できます（QoS Max）。
* 重要なワークロードに対して QoS スループットの下限を設定し、競合するワークロードの需要に関係なく、最小スループット目標を満たすようにすることができます（QoS Min）。
* 同じワークロードに対してQoSの上限と下限を設定することができます。




== スループットの上限

スループット上限は、ワークロードのスループットを最大IOPS数またはMB/秒に制限します。下の図では、ワークロード2のスループット上限によって、ワークロード1と3が「`圧迫`」されることがないようにしています。

_ポリシー グループ_は、1つ以上のワークロードのスループット上限を定義します。ワークロードは、_ストレージ オブジェクト_（ボリューム、ファイル、LUN、またはSVM内のすべてのボリューム、ファイル、LUN）に対するI/O処理を表します。上限は、ポリシー グループの作成時に指定することも、ワークロードを監視してから指定することもできます。

[NOTE]
====
ワークロードのスループットは、特にスループットが急激に変化した場合、指定された上限を10%までは超過することができます。バースト時には、上限を50%まで超過することができます。

====
image:qos-ceiling-concepts.gif["スループットの上限"]



== スループットの下限

スループットの下限はワークロードのスループットが最小IOPSを下回らないことを保証します。次の図では、ワークロード1とワークロード3にスループットの下限が設定され、ワークロード2からの要求量に関係なく、最小スループットが確保されています。

[TIP]
====
これらの例からわかるように、スループットの上限はスループットを直接調整するのに対し、スループットの下限は下限が設定されたワークロードを優先することでスループットを間接的に調整します。

====
ワークロードは、ボリューム、LUN、またはファイル（ONTAP 9.3以降）のI/O処理を表します。スループットの下限を定義するポリシー グループは、SVMには適用できません。下限はポリシー グループの作成時に指定できるほか、ワークロードをしばらく監視したあとで指定することもできます。

[NOTE]
====
ノードまたはアグリゲートに十分なパフォーマンス容量（ヘッドルーム）がない場合、または `volume move trigger-cutover`などの重要な操作が実行されている場合、ワークロードへのスループットが指定された下限値を下回ることがあります。十分な容量があり、重要な操作が実行されていない場合でも、ワークロードへのスループットは指定された下限値を最大5%下回ることがあります。

====
image:qos-floor-concepts.gif["スループットの下限"]



== アダプティブQoS

通常、ストレージ オブジェクトに割り当てたポリシー グループの値は固定値です。ストレージ オブジェクトのサイズが変わったときは、値を手動で変更する必要があります。たとえば、ボリュームの使用スペースが増えた場合、通常は指定されているスループットの上限も増やす必要があります。

_Adaptive QoS_ は、ワークロードのサイズが変化しても IOPS と TB/GB の比率を維持しながら、ポリシー グループの値を自動的にワークロードのサイズに合わせて調整します。これは、大規模な導入環境で数百、数千のワークロードを管理する際に大きなメリットとなります。

アダプティブQoSは、主にスループットの上限の調整に使用しますが、下限の管理（ワークロード サイズが増えた場合）に使用することもできます。ワークロードのサイズは、ストレージ オブジェクトに割り当てられたスペースまたはストレージ オブジェクトで使用されているスペースのいずれかで表されます。


NOTE: 使用済みスペースは ONTAP 9.5 以降ではスループット フロアに使用できます。ONTAP 9.4 以前では、スループット フロアにはサポートされていません。

+ ONTAP 9.13.1 以降では、アダプティブ QoS を使用して、SVM レベルでスループットの下限と上限を設定できます。

* _割り当て領域_ポリシーは、ストレージ オブジェクトの公称サイズに応じてIOPS/TB|GB比を維持します。比が100 IOPS/GBの場合、150GBのボリュームのスループット上限は、ボリュームがそのサイズを維持する限り15,000 IOPSになります。ボリュームのサイズが300GBに変更されると、アダプティブQoSによってスループット上限が30,000 IOPSに調整されます。
* _使用済みスペース_ ポリシー（デフォルト）は、ストレージ効率化前の実際のデータ保存量に応じてIOPS/TB|GB比率を維持します。比率が100 IOPS/GBの場合、150 GBのボリュームに100 GBのデータを保存した場合、スループット上限は10,000 IOPSになります。使用済みスペースの量が変化すると、アダプティブQoSは比率に応じてスループット上限を調整します。

