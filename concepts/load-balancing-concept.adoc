---
permalink: concepts/load-balancing-concept.html 
sidebar: sidebar 
keywords: 'load balance, workload, latency, overload, reduce load, ceiling, limits, iops, "mb/s", qos, min, max, policy group, throughput, headroom, floor, adaptive qos' 
summary: ノードでの作業量が使用可能なリソースを超えると、ワークロードのパフォーマンスにレイテンシが発生し始めます。ノードの負荷が許容量を超えた場合は、利用可能なリソースを増やす（ディスクや CPU をアップグレードする）か、負荷を減らす（ボリュームや LUN を必要に応じて別のノードに移動する）ことで対処できます。 
---
= 負荷分散
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ノードでの作業量が使用可能なリソースを超えると、ワークロードのパフォーマンスにレイテンシが発生し始めます。ノードの負荷が許容量を超えた場合は、利用可能なリソースを増やす（ディスクや CPU をアップグレードする）か、負荷を減らす（ボリュームや LUN を必要に応じて別のノードに移動する）ことで対処できます。

また、 ONTAP ストレージのサービス品質（ QoS ） _ を使用して、重要なワークロードのパフォーマンスが競合するワークロードの影響を受けて低下しないようにすることもできます。

* 競合するワークロードに対して QoS スループットの上限を設定すると、そのワークロードによるシステムリソースへの影響を制限できます（最大 QoS ）。
* 重要なワークロードに対して QoS スループットの下限を設定すると、競合するワークロードによる要求に関係なく、必要な最小スループットを確保できます（最小 QoS ）。
* 同じワークロードに対して QoS の上限と下限を設定することができます。




== スループットの上限

スループットの上限は、ワークロードのスループットを最大 IOPS または MB/ 秒に制限します次の図では、ワークロード 2 のスループットの上限により、ワークロード 1 および 3 の「負荷」が発生しないようにしています。

a_policy group_ は、 1 つ以上のワークロードに対するスループットの上限を定義します。ワークロードとは、 a_storage オブジェクト： _a ボリューム、ファイル、 LUN 、または SVM 内のすべてのボリューム、ファイル、 LUN の I/O 処理のことです。上限はポリシーグループの作成時に指定できるほか、ワークロードをしばらく監視したあとで指定することもできます。

[NOTE]
====
ワークロードのスループットは、特にスループットが急激に変化した場合、指定された上限を 10% までは超過することができます。バースト時には、上限を 50% まで超過することができます。

====
image::../media/qos-ceiling-concepts.gif[QoS 上限の概念]



== スループットの下限

スループットの下限はワークロードのスループットが最小 IOPS を下回らないことを保証します。次の図では、ワークロード 1 とワークロード 3 のスループットの下限により、ワークロード 2 からの要求に関係なく、最小スループットが確保されています。

[TIP]
====
これらの例からわかるように、スループットの上限はスループットを直接調整するのに対し、スループットの下限は下限が設定されたワークロードを優先することでスループットを間接的に調整します。

====
ワークロードとは、ボリューム、 LUN 、または ONTAP 9.3 以降のファイルの I/O 処理のことです。スループットの下限を定義するポリシーグループは、 SVM には適用できません。下限はポリシーグループの作成時に指定できるほか、ワークロードをしばらく監視したあとで指定することもできます。

[NOTE]
====
ノードやアグリゲートに十分なパフォーマンス容量（ヘッドルーム）がない場合やなどの重要な処理の実行中は、ワークロードのスループットが指定された下限を下回ることがあります `volume move trigger-cutover`。利用可能な容量が十分にあるときや重要な処理を実行していないときでも、ワークロードのスループットは指定された下限を 5% まで下回ることができます。

====
image::../media/qos-floor-concepts.gif[QoS の下限の概念]



== アダプティブ QoS

通常、ストレージオブジェクトに割り当てたポリシーグループの値は固定値です。ストレージオブジェクトのサイズが変わったときは、値を手動で変更する必要があります。たとえば、ボリュームの使用スペースが増えた場合、通常は指定されているスループットの上限も増やす必要があります。

アダプティブ QoS _ ワークロードのサイズの変更に合わせてポリシーグループの値が自動的に調整され、 TB または GB あたりの IOPS が一定に維持されます。これは、何百何千という数のワークロードを管理する大規模な環境では大きなメリットです。

アダプティブ QoS は、主にスループットの上限の調整に使用しますが、下限の管理（ワークロードサイズが増えた場合）に使用することもできます。ワークロードのサイズは、ストレージオブジェクトに割り当てられたスペースまたはストレージオブジェクトで使用されているスペースのいずれかで表されます。

[NOTE]
====
ONTAP 9.5 以降では、使用済みスペースをスループットの下限に使用できます。ONTAP 9.4 以前では使用できません。

====
* 割り当て済みスペースのポリシーでは、ストレージオブジェクトの公称サイズを基準に IOPS と TB / GB の比率が維持されます。比率が 100 IOPS/GB の場合、 150GB のボリュームのスループットの上限はボリュームのサイズが変更されないかぎり 15 、 000 IOPS です。ボリュームのサイズが 300GB に変更されると、アダプティブ QoS によってスループットの上限が 30 、 000 IOPS に調整されます。
* a_used space-policy （デフォルト）は、ストレージ効率化前に格納されている実際のデータの量に基づいて、 IOPS/TB|GB の比率を維持します。比率が 100 IOPS/GB の場合、 100GB のデータが格納された 150GB のボリュームのスループットの上限は 10 、 000 IOPS です。使用済みスペースの量が変わると、アダプティブ QoS によって比率が一定になるようにスループットの上限が調整されます。

