---
permalink: concepts/mirrored-unmirrored-aggregates-concept.html 
sidebar: sidebar 
keywords: mirrored, unmirrored, aggregate, local tier, plex, syncmirror, dparity, raid group 
summary: ONTAPには_SyncMirror_と呼ばれるオプション機能があり、これを使用すると、異なるRAIDグループに保存されたコピー（_プレックス_）内のローカル階層データを同期的にミラーリングできます。プレックスは、RAIDタイプで保護できる以上のディスク障害が発生した場合、またはRAIDグループのディスクへの接続が失われた場合でも、データ損失を防ぎます。 
---
= ミラーリングされたローカル層とミラーリングされていないローカル層
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAPの_SyncMirror_を使用すると、異なるRAIDグループに保存されたコピー、または_plex_としてローカル階層データを同期的にミラーリングできます。plexは、RAIDタイプで保護されている以上のディスク障害が発生した場合や、RAIDグループディスクへの接続が失われた場合でも、データ損失を防ぎます。

ローカル層を作成するときに、ローカル層をミラーリングするかミラーされていないアグリゲートにするかを指定できます。


NOTE: ONTAP 9.7より前のバージョンでは、System Managerは_ローカル階層_を説明するために_aggregate_という用語を使用しています。ONTAPバージョンに関係なく、ONTAP CLIでは_aggregate_という用語が使用されます。ローカル階層の詳細については、link:../disks-aggregates/index.html["ディスクとローカル階層"]を参照してください。



== ミラーされていないローカル階層の仕組み

ローカル階層をミラーリングするように指定しない場合、ミラーされていない状態で作成されます。ミラーされていないローカル階層には、そのローカル階層に属するすべてのRAIDグループを含む_plex_（データのコピー）が1つだけ存在します。

次の図は、複数のディスクが1つのプレックスにグループ化された、ミラーされていないローカル層を示しています。ローカル層には、rg0、rg1、rg2、rg3の4つのRAIDグループがあります。各RAIDグループには、6つのデータ ディスク、1つのパリティ ディスク、1つのdparity（ダブル パリティ）ディスクがあります。ローカル層で使用されるすべてのディスクは、同じプール「`pool0`」から取得されます。

image:drw-plexum-scrn-en-noscale.gif["1つのプレックスを持つディスクで構成されたミラーされていないローカル層"]

次の図は、アレイLUNが1つのプレックスにグループ化された、ミラーされていないローカル層を示しています。この層には2つのRAIDグループ（rg0とrg1）があります。ローカル層で使用されるすべてのアレイLUNは、同じプール「`pool0`」から取得されます。

image:unmirrored-aggregate-with-array-luns.gif["1つのプレックスを持つアレイLUNで構成されたミラーされていないローカル層"]



== ミラーリングされたローカル層の仕組み

ミラーリングされたローカル層には 2 つの _プレックス_ （データのコピー）があり、SyncMirror 機能を使用してデータを複製し、冗長性を提供します。

ローカル階層を作成する際に、ミラーリングするように指定できます。また、既存のミラーリングされていないローカル階層に2つ目のプレックスを追加して、ミラーリングされた階層にすることもできます。SyncMirrorを使用すると、ONTAPは元のプレックス（plex0）のデータを新しいプレックス（plex1）にコピーします。プレックスは物理的に分離されており（各プレックスには独自のRAIDグループとプールがあります）、プレックスは同時に更新されます。

この構成では、ローカル層のRAIDレベルで保護できる以上のディスク障害が発生した場合、または接続が失われた場合でも、障害の原因を修復する間、影響を受けていないプレックスが引き続きデータを提供するため、データ損失に対する保護が強化されます。問題が発生したプレックスが修復されると、2つのプレックスは再同期され、ミラー関係が再確立されます。

システム上のディスクとアレイ LUN は、 `pool0`と `pool1`の 2 つのプールに分割されます。Plex0 は pool0 からストレージを取得し、plex1 は pool1 からストレージを取得します。

次の図は、SyncMirrorが有効化され実装されたディスクで構成されたローカル層を示しています。ローカル層には2つ目のプレックスが作成されています `plex1`。プレックス1のデータはプレックス0のデータのコピーであり、RAIDグループも同一です。32本のスペアディスクは、プール0またはプール1に割り当てられ、各プールに16本のディスクが割り当てられています。

image:drw-plexm-scrn-en-noscale.gif["SyncMirror機能を備えたディスクで構成されたローカル層"]

次の図は、SyncMirror機能が有効化され実装されたアレイLUNで構成されたローカル層を示しています。ローカル層には2つ目のプレックスが作成されています `plex1`。プレックス1はプレックス0のコピーであり、RAIDグループも同一です。

image:mirrored-aggregate-with-array-luns.gif["SyncMirror機能を備えたアレイLUNで構成されるローカル層"]


NOTE: ストレージのパフォーマンスと可用性を最適化するために、ミラーリングされたアグリゲートには少なくとも20%の空きスペースを確保することをお勧めします。ミラーリングされていないアグリゲートの場合は10%が推奨されていますが、追加の10%のスペースはファイルシステムによって増分変更の吸収に使用される可能性があります。ONTAPのリダイレクトオンライトスナップショットベースのアーキテクチャにより、増分変更はミラーリングされたアグリゲートのスペース使用率を増加させます。これらのベストプラクティスを遵守しないと、パフォーマンスに悪影響を与える可能性があります。
