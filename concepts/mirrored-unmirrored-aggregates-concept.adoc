---
permalink: concepts/mirrored-unmirrored-aggregates-concept.html 
sidebar: sidebar 
keywords: mirrored, unmirrored, aggregate, local tier, plex, syncmirror, dparity, raid group 
summary: ONTAP には、SyncMirror というオプション機能があります。この機能を使用すると、コピー内のローカル階層（アグリゲート）データまたはプレックスを同期的にミラーリングし、別々のRAIDグループに格納することができます。プレックスを使用すると、RAIDタイプで保護されるディスク数よりも多くのディスクで障害が発生した場合や、RAIDグループのディスクへの接続が失われた場合でも、データ損失を防ぐことができます。 
---
= ミラーされたローカル階層とミラーされていないローカル階層（アグリゲート）
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP には、SyncMirror というオプション機能があります。この機能を使用すると、コピー内のローカル階層（アグリゲート）データまたはプレックスを同期的にミラーリングし、別々のRAIDグループに格納することができます。プレックスを使用すると、RAIDタイプで保護されるディスク数よりも多くのディスクで障害が発生した場合や、RAIDグループのディスクへの接続が失われた場合でも、データ損失を防ぐことができます。

System ManagerまたはCLIを使用してローカル階層を作成するときに、ローカル階層をミラーするかどうかを指定できます。



== ミラーされていないローカル階層（アグリゲート）の仕組み

ローカル階層をミラーするように指定しない場合、ミラーされていないローカル階層（アグリゲート）として作成されます。ミラーされていないローカル階層には、プレックス_（データのコピー）が1つだけ含まれ、このローカル階層に属するすべてのRAIDグループが含まれます。

次の図は、1つのプレックスを含む、ディスクで構成されるミラーされていないローカル階層を示しています。ローカル階層には、rg0、rg1、rg2、rg3の4つのRAIDグループがあります。各RAIDグループには、6本のデータディスク、1本のパリティディスク、および1本のdparity（ダブルパリティ）ディスクがあります。ローカル階層で使用されるすべてのディスクは'同じプールであるpool0から提供されます

image:drw-plexum-scrn-en-noscale.gif["1つのプレックスを含むディスクで構成されるミラーされていないローカル階層"]

次の図は、1つのプレックスを含む、アレイLUNで構成されるミラーされていないローカル階層を示しています。このノードには、rg0とrg1の2つのRAIDグループがあります。ローカル階層で使用されるすべてのアレイLUNは'同じプールであるpool0から提供されます

image:unmirrored-aggregate-with-array-luns.gif["アレイLUNと1つのプレックスで構成されるミラーされていないローカル階層"]



== ミラーされたローカル階層（アグリゲート）の機能

ミラーされたアグリゲートには、 2_bプレックス _ （データコピー）があります。これらのアグリゲートでは、 SyncMirror 機能を使用してデータを複製し、冗長性を確保します。

ローカル階層を作成するときに、ミラーされたローカル階層として指定できます。また、ミラーされていない既存のローカル階層に2つ目のプレックスを追加して、ミラーされた階層にすることもできます。SyncMirror機能を使用すると、ONTAPは元のプレックス（plex0）のデータを新しいプレックス（plex1）にコピーします。プレックスは物理的に分離されており（各プレックスには独自のRAIDグループと独自のプールがあります）、同時に更新されます。

この構成では、アグリゲートのRAIDレベルで保護されるディスク数よりも多くのディスクで障害が発生した場合や接続が切断された場合に、障害の原因を修正しながら影響を受けないプレックスがデータの提供を継続するため、データ損失に対する保護が強化されます。問題のあるプレックスが修正されると、2つのプレックスが再同期され、ミラー関係が再確立されます。

システム上のディスクとアレイLUNは'pool0とpool1という2つのプールに分かれていますplex0はpool0からストレージを取得し、plex1はpool1からストレージを取得します。

次の図は、SyncMirror機能を有効にして実装したディスクで構成されるローカル階層を示しています。ローカル階層「plex1」用に2つ目のプレックスが作成されました。plex1のデータはplex0のデータのコピーであり、RAIDグループも同じです。各プールに16本のディスクを使用して、32本のスペアディスクがpool0またはpool1に割り当てられます。

image:drw-plexm-scrn-en-noscale.gif["SyncMirror機能を備えたディスクで構成されるローカル階層"]

次の図は、SyncMirror機能を有効にして実装したアレイLUNで構成されるローカル階層を示しています。ローカル階層「plex1」用に2つ目のプレックスが作成されました。plex1はplex0のコピーであり、RAIDグループも同じです。

image:mirrored-aggregate-with-array-luns.gif["SyncMirror機能を備えたアレイLUNで構成されるローカル階層"]


NOTE: ストレージのパフォーマンスと可用性を最適化するために、ミラーアグリゲートでは少なくとも20%の空きスペースを確保することを推奨します。ミラーされていないアグリゲートでは10%が推奨されますが、追加の10%のスペースはファイルシステムで増分変更に対応するために使用できます。増分変更を行うと、ONTAPのcopy-on-write Snapshotベースのアーキテクチャにより、ミラーされたアグリゲートのスペース使用率が向上します。これらのベストプラクティスに従わないと、パフォーマンスに悪影響を及ぼす可能性があります。
