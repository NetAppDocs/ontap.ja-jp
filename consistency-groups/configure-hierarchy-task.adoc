---
permalink: consistency-groups/configure-hierarchy-task.html 
sidebar: sidebar 
keywords: consistency groups, application protection, parent, child, hierarchy 
summary: 大規模なアプリケーション ワークロード管理とデータ保護のために、階層型の整合性グループを作成します。 
---
= 階層型ONTAPコンシステンシグループを構成する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
階層型整合性グループを使えば、子整合性グループの統括を担う親整合性グループを作成し、複数のボリュームにわたる大規模なワークロードを管理できます。

階層型整合性グループには親があり、親には最大5つの個別の整合性グループを含めることができます。階層型整合性グループは、整合性グループ全体または個々のボリュームごとに異なるローカルスナップショットポリシーをサポートできます。リモート保護ポリシーを使用する場合、そのポリシーは階層型整合性グループ全体（親と子）に適用されます。

ONTAP 9.13.1以降では、xref:modify-geometry-task.html[整合性グループのジオメトリを変更する]およびxref:modify-task.html[子整合性グループ間でボリュームを移動する]が可能になります。

整合性グループのオブジェクト制限については、xref:limits.html[整合性グループのオブジェクト制限]を参照してください。



== 新しいLUNまたはボリュームを使用した階層型整合性グループの作成

階層型整合性グループを作成する際、そのグループに新しいLUNを設定できます。ONTAP 9.13.1以降では、新しいNVMeネームスペースとNASボリュームを使用することもできます。

[role="tabbed-block"]
====
.System Manager
--
.手順
. *Storage > Consistency groups*を選択します。
. *+追加*を選択し、ストレージ オブジェクトのプロトコルを選択します。
+
ONTAP 9.10.1～9.12.1では、新しいストレージオブジェクトのオプションは**新しいLUNを使用する**のみです。ONTAP 9.13.1以降、System Managerは新しいNVMeネームスペースと新しいNASボリュームを使用したコンシステンシグループの作成をサポートします。

. 整合性グループに名前を付けます。ボリュームまたはLUNの数とボリュームまたはLUNあたりの容量を指定します。
+
.. **アプリケーションタイプ**：ONTAP 9.12.1以降をご使用の場合は、アプリケーションタイプを選択してください。値が選択されていない場合、整合性グループにはデフォルトで**その他**のタイプが割り当てられます。xref:modify-tags-task.html[アプリケーション タグとコンポーネント タグ]で整合性のタグ付けの詳細をご確認ください。リモート保護ポリシーを使用する場合は、*その他*を選択する必要があります。


. ホスト オペレーティング システムとLUN形式を選択します。ホスト イニシエータの情報を入力します。
+
.. **新しいLUN**の場合：ホストのオペレーティングシステムとLUNフォーマットを選択します。ホストイニシエータ情報を入力します。
.. **新しい NAS ボリューム**の場合：SVM の NAS 構成に基づいて適切なエクスポート オプション（NFS または SMB/CIFS）を選択します。
.. **新しい NVMe 名前空間**の場合：ホスト オペレーティング システムと NVMe サブシステムを選択します。


. 子整合性グループを追加するには、[*その他のオプション*] を選択し、[*+ 子整合性グループの追加*] を選択します。
. パフォーマンス レベル、LUNまたはボリュームの数、LUNまたはボリュームあたりの容量を選択します。使用しているプロトコルに基づいて、適切なエクスポート設定またはオペレーティング システム情報を指定します。
. 必要に応じて、ローカルSnapshotポリシーを選択し、アクセス権限を設定します。
. 最大5つの子整合性グループについて、同じ手順を繰り返します。
. *保存*を選択します。
. メインの整合性グループのメニューに戻り、整合性グループが作成されたことを確認します。保護ポリシーを設定した場合は、該当するリモートまたはローカルのポリシーにチェックマーク付きの緑色の盾アイコンが表示されることを確認します。


--
.CLI
--
.開始する前に
* このタスクを実行するには、admin権限レベルが必要です。
* ONTAP 9.15.1以降では、admin権限レベルのすべてのユーザがこのタスクを実行できます。ONTAP 9.14.1では、このタスクを実行するには、クラスタ管理者またはSVMの管理者である必要があります。


CLIで新しいボリュームを含む階層型整合性グループを作成する場合は、子整合性グループをそれぞれ個別に作成する必要があります。

.手順
.  `consistency-group create`コマンドを使用して新しい整合性グループを作成します。
+
`consistency-group create -vserver <SVM_name> -consistency-group <consistency_group_name> -parent-consistency-group <parent_consistency_group_name> -volume-prefix <volume_prefix> -volume-count <number_of_volumes> -size <size>`

. CLI のプロンプトが表示されたら、新しい親コンシステンシー グループを作成することを確認します。 `y`と入力します。
. 必要に応じて、手順1を繰り返して子整合性グループをさらに作成します。
+
link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=consistency-group+create["ONTAPコマンド リファレンス"^]の `consistency-group create`の詳細をご覧ください。



--
====


== 既存のボリュームを使用した階層型整合性グループの作成

既存のボリュームを階層型整合性グループにまとめることができます。

[role="tabbed-block"]
====
.System Manager
--
.手順
. *Storage > Consistency groups*を選択します。
. *+追加*を選択し、次に*既存のボリュームを使用*を選択します。
. Storage VMを選択します。
. グループに追加する既存のボリュームを選択します。選択できるのは、整合性グループに含まれていないボリュームのみです。
. 子整合性グループを追加するには、*+子整合性グループの追加*を選択します。必要な整合性グループを作成します。名前は自動的に付けられます。
+
.. **コンポーネントタイプ**：ONTAP 9.12.1以降を使用している場合は、「data」、「logs」、または「other」のコンポーネントタイプを選択します。値が選択されていない場合、整合性グループにはデフォルトで**Other**のタイプが割り当てられます。整合性のタグ付けの詳細については、xref:modify-tags-task.html[アプリケーション タグとコンポーネント タグ]を参照してください。リモート保護ポリシーを使用する場合は、*Other*を使用する必要があります。


. 各整合性グループに既存のボリュームを割り当てます。
. 必要に応じて、ローカル スナップショット ポリシーを選択します。
. 最大5つの子整合性グループについて、同じ手順を繰り返します。
. *保存*を選択します。
. メインの整合性グループのメニューに戻り、整合性グループが作成されたことを確認します。保護ポリシーを選択した場合は、ポリシーが適切に設定されていることを確認します。作成した整合性グループをメニューから選択すると、該当するポリシーポリシー タイプに、チェックマークが付いた緑色の盾アイコンが表示されます。


--
.CLI
--
ONTAP 9.14.1以降では、CLIを使用して階層型整合性グループを作成できます。

.開始する前に
* このタスクを実行するには、admin権限レベルが必要です。
* ONTAP 9.15.1以降では、admin権限レベルのすべてのユーザがこのタスクを実行できます。ONTAP 9.14.1では、このタスクを実行するには、クラスタ管理者またはSVMの管理者である必要があります。


.手順
. 新しい親整合性グループをプロビジョニングし、新しい子整合性グループにボリュームを割り当てます。
+
`consistency-group create -vserver <svm_name> -consistency-group <child_consistency_group_name> -parent-consistency-group <parent_consistency_group_name> -volumes <volume_names>`

.  `y`を入力して、新しい親と子の整合性グループを作成することを確認します。
+
link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=consistency-group+create["ONTAPコマンド リファレンス"^]の `consistency-group create`の詳細をご覧ください。



--
====
.次の手順
* xref:xref:modify-geometry-task.html[整合性グループのジオメトリの変更]
* xref:modify-task.html[整合性グループの変更]
* xref:protect-task.html[整合性グループの保護]

