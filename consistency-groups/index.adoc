---
permalink: consistency-groups/index.html 
sidebar: sidebar 
keywords: consistency groups, consistency group protection, application protection 
summary: 階層型および単一の整合グループ、保護ポリシー、アップグレードに関する考慮事項など、 ONTAP で整合グループを使用できます。 
---
= 整合グループの概要
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
整合グループは、複数のボリュームにまたがるアプリケーションワークロードに対して書き込み順序の整合性保証を提供するボリュームの集まりです。

整合グループを使用すると、アプリケーションのワークロードを簡単に管理でき、ローカルとリモートの保護ポリシーを簡単に管理できます。また、一度に複数のボリュームについて、 crash-consistent Snapshot コピーとアプリケーションと整合性のある Snapshot コピーを同時に提供できます。整合グループ内の Snapshot を使用すると、アプリケーションのワークロード全体をリストアできます。

整合グループは、プロトコル（NAS、SAN、NVMe）に関係なく任意のFlexVol をサポートし、ONTAP REST APIまたは* Storage > Consistency Groups *メニュー項目でSystem Managerから管理できます。

整合グループは、個別のエンティティとして、または階層関係に存在できます。個々の整合グループは、ボリュームの集まりです。ボリュームには、そのボリューム単位のSnapshotポリシーを設定できます。また、ボリュームが関連付けられている整合性グループに独自のSnapshotポリシーを割り当てることもできます。整合グループに適用できる SM-BC 関係は 1 つだけで、 SM-BC ポリシーを共有することもできます。このポリシーを使用して整合グループ全体をリカバリすることもできます。

image:../media/consistency-group-single-diagram.gif["コンスティチュエントボリュームおよびローカル Snapshot ポリシーを含む単一の整合グループの図"]

アプリケーションワークロードが大きいほど、複数の整合グループが必要になる場合がありますこのような状況では、複数の整合グループを 1 つの階層関係にまとめることができます。この構成では、単一の整合グループが親整合グループの子コンポーネントになります。親整合グループには、最大 5 つの子整合グループを含めることができます。個々の整合グループと同様に、リモートの SM-BC 保護ポリシーを整合グループの設定全体（親と子）に適用して、アプリケーションワークロードをリカバリすることができます。

image:../media/consistency-group-nested-diagram.gif["ネストされた整合グループとそのボリュームを含む図"]

ONTAP 9.12.1以降では、整合グループがサポートされます xref:clone-task.html[クローニング] 整合性のメンバーを変更するには、を使用します xref:modify-task.html[ボリュームを追加または削除する] System ManagerとONTAP REST APIの両方で使用できます。ONTAP 9.12.1以降では、ONTAP REST APIは次の機能もサポートします。

* 新しいNFSまたはSMBボリュームまたはNVMeネームスペースで整合グループを作成する。
* 新規または既存のNFS / SMBボリュームまたはNVMeネームスペースを既存の整合グループに追加する。


ONTAP REST APIの詳細については、を参照してください https://docs.netapp.com/us-en/ontap-automation/reference/api_reference.html#access-a-copy-of-the-ontap-rest-api-reference-documentation["ONTAP REST APIのリファレンスドキュメント"]。



== 保護

整合グループは、Snapshotポリシーによるローカル保護と、SnapMirror Business Continuity（SM-BC）によるリモート保護を提供します。整合性グループを作成しても、保護は自動的に有効になりません。ローカルまたはリモートの保護ポリシーは、整合グループの作成時または作成後に設定できます。

整合グループを使用してローカル保護を設定する方法については、を参照してください link:protect-task.html["整合グループを保護する"]。ONTAP 9.11.1以降では、整合グループによって提供されています link:protect-task.html#two-phase-CG-snapshot-creation["2フェーズの整合性グループSnapshotの作成"]。

リモート保護を利用するには、の要件を満たす必要があります xref:../smbc/smbc_plan_prerequisites.html#licensing[SnapMirror によるビジネス継続性の導入]。


NOTE: NAS アクセス用にマウントされたボリュームでは、 SM-BC 関係を確立できません。



== アプリケーションタグとコンポーネントタグ

ONTAP 9.12.1以降では、コンシステンシグループはコンポーネントおよびアプリケーションのタグ付けをサポートします。アプリケーションとコンポーネントのタグは管理ツールであり、整合グループ内のさまざまなワークロードをフィルタリングして識別できます。

アプリケーションタグは、個々の整合グループと親整合グループに適用されます。アプリケーションタグは、MongoDB、Oracle、SQL Serverなどのワークロードにラベルを付けます。整合グループのデフォルトのアプリケーションタグはOtherです。階層整合グループの子には、アプリケーションタグの代わりにコンポーネントタグがあります。コンポーネントタグのオプションは、「data」、「logs」、または「other」です。デフォルト値はOtherです。

タグは、整合グループの作成時、または整合グループの作成後に適用できます。整合グループにSM-BC関係がある場合は、アプリケーションタグまたはコンポーネントタグに* other*を使用する必要があります。



== MetroCluster 構成の整合グループ

ONTAP 9.11.1以降では、MetroCluster 構成内のクラスタに新しいボリュームを含む整合グループをプロビジョニングできます。ミラーアグリゲートにプロビジョニングされています。

プロビジョニングが完了したら、整合グループに関連付けられているボリュームを、ミラーされたアグリゲートとミラーされていないアグリゲートの間で移動できます。そのため、ミラーされたアグリゲート、ミラーされていないアグリゲート、またはその両方に配置できます。整合性グループに関連付けられているボリュームを含むミラーアグリゲートを変更して、ミラーされない状態にすることができます。同様に、整合グループに関連付けられたボリュームを含むミラーされていないアグリゲートを変更することで、ミラーリングを有効にすることができ

ミラーアグリゲートに配置された整合グループに関連付けられたボリュームと、整合グループSnapshotを含むそれらのSnapshotがリモートサイト（サイトB）にレプリケートされます。サイトBのボリュームの内容は整合グループのセマンティクスに準拠しています。レプリケートされた整合グループSnapshotには、ONTAP 9.11.1以降を実行しているクラスタで、整合グループSnapshot REST APIおよびSystem Managerを使用してアクセスできます。

整合グループに関連付けられている一部またはすべてのボリュームがミラーされていないアグリゲートに配置されていて、現在アクセスできない場合、整合グループに対するGETまたはDELETE処理はローカルボリュームまたはホストアグリゲートがオフラインかのように動作します。



=== 整合性グループの設定レプリケーション

サイトBでONTAP 9.10.1以前が実行されている場合、ミラーされたアグリゲートにある整合グループに関連付けられているボリュームだけがサイトBにレプリケートされます整合グループの設定は、両方のサイトでONTAP 9.11.1以降が実行されている場合にのみサイトBにレプリケートされます。サイトBをONTAP 9.11.1にアップグレードしたあと、サイトAの整合グループのデータのうち、関連付けられているすべてのボリュームがミラーされたアグリゲートに配置されているものがサイトBにレプリケートされます



== アップグレード時の考慮事項

ONTAP 9.8 および 9.9.1 の SM-BC で作成された整合グループは、 ONTAP 9.10.1 にアップグレードすると、 System Manager の * Storage > Consistency Groups * または ONTAP REST API で自動的にアップグレードされ、管理可能になります。アップグレードの詳細については、を参照してください link:../smbc/smbc_admin_upgrade_and_revert_considerations.html["SM-BC アップグレードおよびリバートに関する考慮事項"]。

ONTAP REST API で作成されたコンシステンシグループスナップショットは、 System Manager のコンシステンシグループインタフェースおよびコンシステンシグループ API エンドポイントを通じて管理できます。

ONTAPIコマンド「cg-start」および「cg-commit」で作成されたSnapshotは、整合グループSnapshotとして認識されないため、System Managerの整合グループインターフェイスまたはONTAP APIの整合グループエンドポイントで管理することはできません。



== 整合グループに関する詳細情報

video::j0jfXDcdyzE[youtube,width=848,height=480]