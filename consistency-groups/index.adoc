---
permalink: consistency-groups/index.html 
sidebar: sidebar 
keywords: consistency group protection, application protection, metrocluster, write-order, application management, workload 
summary: 整合グループとはボリュームの集まりで、1つのユニットとして構成されており、複数のボリュームまたはLUNにまたがるワークロードの管理と保護を容易にします。 
---
= 整合グループの概要
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
整合グループは、単一のユニットとして管理されるボリュームの集まりです。ONTAP では、整合グループによって、複数のボリュームにまたがるアプリケーションワークロードの管理と保護が容易になります。

整合グループを使用すると、ストレージ管理を簡易化できます。20個のLUNにまたがる重要なデータベースがあるとします。LUNは個別に管理することも、単一の整合グループにまとめて単一のデータセットとして扱うこともできます。

整合グループを使用すると、アプリケーションのワークロードを簡単に管理でき、ローカルとリモートの保護ポリシーを簡単に管理できます。また、一度に複数のボリュームについて、 crash-consistent Snapshot コピーとアプリケーションと整合性のある Snapshot コピーを同時に提供できます。整合グループ内の Snapshot を使用すると、アプリケーションのワークロード全体をリストアできます。



== の機能

整合グループは、プロトコル（NAS、SAN、NVMe）に関係なく任意のFlexVol をサポートし、ONTAP REST APIまたは* Storage > Consistency Groups *メニュー項目でSystem Managerから管理できます。

整合グループは、個別のエンティティとして、または階層関係に存在できます。個々の整合グループは、ボリュームの集まりです。ボリュームには、そのボリューム単位のSnapshotポリシーを設定できます。また、ボリュームが関連付けられている整合性グループに独自のSnapshotポリシーを割り当てることもできます。整合グループには、SnapMirror Business Continuity（SM-BC）関係と共有のSM-BCポリシーを1つだけ含めることができます。このポリシーを使用して整合グループ全体をリカバリできます。

次の図は、個 々 の整合グループを使用する方法を示しています。でホストされているアプリケーションのデータ `SVM1` 2つのボリュームにまたがっている： `vol1` および `vol2`。整合グループのSnapshotポリシーには、15分ごとにデータのSnapshotがキャプチャされます。

image:../media/consistency-group-single-diagram.gif["コンスティチュエントボリュームおよびローカル Snapshot ポリシーを含む単一の整合グループの図"]

アプリケーションワークロードが大きいほど、複数の整合グループが必要になる場合がありますこのような状況では、階層型整合グループを作成できます。この場合、1つの整合グループが親整合グループの子コンポーネントになります。親整合グループには、最大 5 つの子整合グループを含めることができます。個々の整合グループと同様に、リモートの SM-BC 保護ポリシーを整合グループの設定全体（親と子）に適用して、アプリケーションワークロードをリカバリすることができます。

次の例では、アプリケーションがでホストされています `SVM1`。管理者が親整合グループを作成し、 `SVM1_app`を使用します。このグループには次の2つの子整合グループ `SVM1appDataCG` データおよび `SVM1app_logCG` をクリックします。子整合性グループには、それぞれ独自のSnapshotポリシーがあります。のボリュームのSnapshot `SVM1appDataCG` 15分ごとに服用してください。のSnapshot `SVM1app_logCG` 1時間ごとに作成されます。親整合グループ `SVM1_app` データを複製し、災害発生時にサービスを継続できるようにするSM-BCポリシーが用意されています。

image:../media/consistency-group-nested-diagram.gif["ネストされた整合グループとそのボリュームを含む図"]

ONTAP 9.12.1以降では、整合グループがサポートされます xref:clone-task.html[クローニング] 整合性のメンバーを変更するには、を使用します xref:modify-task.html[ボリュームを追加または削除する] System ManagerとONTAP REST APIの両方で使用できます。ONTAP 9.12.1以降では、ONTAP REST APIは次の機能もサポートします。

* 新しいNFSまたはSMBボリュームまたはNVMeネームスペースで整合グループを作成する。
* 新規または既存のNFS / SMBボリュームまたはNVMeネームスペースを既存の整合グループに追加する。


ONTAP REST APIの詳細については、を参照してください https://docs.netapp.com/us-en/ontap-automation/reference/api_reference.html#access-a-copy-of-the-ontap-rest-api-reference-documentation["ONTAP REST APIのリファレンスドキュメント"]。



== 保護

整合グループには次のようなメリット

* Snapshotポリシーによるローカル保護
* を使用したリモート保護 xref:../smbc/index.html[SnapMirror のビジネス継続性（ SM-BC ）] または <<mcc>>


整合性グループを作成しても、保護は自動的に有効になりません。ローカルまたはリモートの保護ポリシーは、整合グループの作成時または作成後に設定できます。

整合グループにローカル保護を設定する方法については、を参照してください link:protect-task.html["整合グループを保護する"]。

リモート保護を利用するには、の要件を満たす必要があります xref:../smbc/smbc_plan_prerequisites.html#licensing[SnapMirror によるビジネス継続性の導入]。


NOTE: NAS アクセス用にマウントされたボリュームでは、 SM-BC 関係を確立できません。

ONTAP 9.11.1以降では、整合グループもサポートされます link:protect-task.html#two-phase["2フェーズの整合性グループSnapshotの作成"]。



== アプリケーションタグとコンポーネントタグ

ONTAP 9.12.1以降では、コンシステンシグループはコンポーネントおよびアプリケーションのタグ付けをサポートします。アプリケーションとコンポーネントのタグは管理ツールであり、整合グループ内のさまざまなワークロードをフィルタリングして識別できます。

タグには次の2種類があります。

* **アプリケーションタグ**:個 々 のコンシステンシグループと親コンシステンシグループに適用されます。アプリケーションタグは、MongoDB、Oracle、SQL Serverなどのワークロードにラベルを付けます。整合グループのデフォルトのアプリケーションタグはOtherです。
* **コンポーネントタグ**:階層整合グループの子には、アプリケーションタグではなくコンポーネントタグがあります。コンポーネントタグのオプションは、「data」、「logs」、または「other」です。デフォルト値はOtherです。


タグは、整合グループの作成時、または整合グループの作成後に適用できます。整合グループにSM-BC関係がある場合は、アプリケーションタグまたはコンポーネントタグに* other*を使用する必要があります。



== MetroCluster 構成の整合グループ

ONTAP 9.11.1以降では、MetroCluster 構成内のクラスタに新しいボリュームを含む整合グループをプロビジョニングできます。ミラーアグリゲートにプロビジョニングされています。

プロビジョニングが完了したら、整合グループに関連付けられているボリュームを、ミラーされたアグリゲートとミラーされていないアグリゲートの間で移動できます。したがって、整合グループに関連付けられたボリュームは、ミラーされたアグリゲート、ミラーされていないアグリゲート、またはその両方に配置できます。整合性グループに関連付けられているボリュームを含むミラーアグリゲートを変更して、ミラーされない状態にすることができます。同様に、整合グループに関連付けられたボリュームを含むミラーされていないアグリゲートを変更することで、ミラーリングを有効にすることができ

ミラーアグリゲートに配置された整合グループに関連付けられたボリュームと、整合グループSnapshotを含むそれらのSnapshotがリモートサイト（サイトB）にレプリケートされます。サイトBのボリュームの内容は整合グループのセマンティクスに準拠しています。レプリケートされた整合グループSnapshotには、ONTAP 9.11.1以降を実行しているクラスタで、整合グループSnapshot REST APIおよびSystem Managerを使用してアクセスできます。

整合グループに関連付けられている一部またはすべてのボリュームがミラーされていないアグリゲートに配置されていて、現在アクセスできない場合、整合グループに対するGET処理またはDELETE処理は、ローカルボリュームまたはホストアグリゲートがオフラインかのように動作します。



=== 整合性グループの設定レプリケーション

サイトBでONTAP 9.10.1以前が実行されている場合、ミラーされたアグリゲートにある整合グループに関連付けられているボリュームだけがサイトBにレプリケートされます整合グループの設定は、両方のサイトでONTAP 9.11.1以降が実行されている場合にのみサイトBにレプリケートされます。サイトBをONTAP 9.11.1にアップグレードしたあと、サイトAの整合グループのデータのうち、関連付けられているすべてのボリュームがミラーされたアグリゲートに配置されているものはサイトBにレプリケートされます



== アップグレード時の考慮事項

ONTAP 9.8 および 9.9.1 の SM-BC で作成された整合グループは、 ONTAP 9.10.1 にアップグレードすると、 System Manager の * Storage > Consistency Groups * または ONTAP REST API で自動的にアップグレードされ、管理可能になります。アップグレードの詳細については、を参照してください link:../smbc/smbc_admin_upgrade_and_revert_considerations.html["SM-BC アップグレードおよびリバートに関する考慮事項"]。

ONTAP REST APIで作成された整合グループSnapshotは、System Managerの整合グループインターフェイスおよび整合グループAPIエンドポイントを使用して管理できます。


NOTE: ONTAPIコマンドを使用して作成されたSnapshot `cg-start` および `cg-commit` は整合グループSnapshotとして認識されないため、System Managerの整合グループインターフェイスやONTAP APIの整合グループエンドポイントから管理できません。



== 整合グループに関する詳細情報

video::j0jfXDcdyzE[youtube,width=848,height=480]
.詳細情報
* link:https://docs.netapp.com/us-en/ontap-automation/["ONTAP 自動化に関するドキュメント"^]

