---
permalink: consistency-groups/index.html 
sidebar: sidebar 
keywords: consistency group protection, application protection, metrocluster, write-order, application management, workload 
summary: 整合性グループは、単一のユニットとして編成されたボリュームのコレクションであり、複数のボリュームまたはLUNにまたがるアプリケーション ワークロードの管理と保護を容易にします。 
---
= ONTAPコンシステンシーグループについて学ぶ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
整合性グループは、1つの単位として管理されるボリュームの集まりです。ONTAPでは、複数のボリュームにまたがるアプリケーション ワークロードに対し、容易な管理と保護を提供します。

整合性グループを使用すると、シンプルなストレージ管理を実現することができます。20個のLUNにまたがる重要なデータベースが1つあるとします。これらのLUNは、個別に管理することも、独立した整合性グループにまとめて1つのデータセットとして扱うともできます。

整合性グループはアプリケーション ワークロード管理を容易にし、ローカルおよびリモートの保護ポリシーを容易に設定できるほか、ある時点におけるボリュームの集合体の「crash consistent state（障害など予期しないシャットダウン時と同様）」の状態またはアプリケーション整合性のスナップショットを同時に取得できます。整合性グループのスナップショットにより、アプリケーション ワークロード全体を復元できます。



== 整合性グループについて

整合性グループは、プロトコル（NAS、SAN、NVMe）を問わずあらゆるFlexVolボリュームをサポートし、ONTAP REST APIまたはSystem Managerの*ストレージ > 整合性グループ*メニュー項目から管理できます。ONTAP 9.14.1以降では、整合性グループはONTAP CLIで管理できます。

整合性グループは、個別のエンティティ（ボリュームの集まり）として使用することも、他の整合性グループで構成される階層型グループとして設定することもできます。個々のボリュームには、そのボリューム独自のSnapshotポリシーを設定できます。また、整合性グループ全体のSnapshotポリシーを設定することもできます。整合性グループは1つのSnapMirrorアクティブ同期関係とSnapMirrorポリシーをすべてのボリュームで共有し、これらを使用して整合性グループ全体をリカバリします。

次の図は、個々の整合性グループの使用方法を示しています。 `SVM1`にホストされているアプリケーションのデータは `vol1`と `vol2`の2つのボリュームにまたがっています。整合性グループのスナップショットポリシーは、15分ごとにデータのスナップショットを取得します。

image:consistency-group-single-diagram.gif["構成ボリュームとローカル スナップショット ポリシーを持つ単一の整合性グループ"]

より大規模なアプリケーション ワークロードでは、複数の整合性グループが必要になることがあります。その場合、階層型整合性グループを作成し、整合性グループを親整合性グループの子コンポーネントにすることができます。親整合性グループには、最大5つの子整合性グループを含めることができます。個々の整合性グループと同様に、リモートのSnapMirrorアクティブ同期保護ポリシーを整合性グループ全体（親と子）に適用してアプリケーション ワークロードをリカバリできます。

次の例では、アプリケーションが `SVM1`でホストされています。管理者は親整合性グループ `SVM1_app`を作成しました。このグループには、データ用の `SVM1appDataCG`とログ用の `SVM1app_logCG`の2つの子整合性グループが含まれています。各子整合性グループには独自のスナップショットポリシーがあります。 `SVM1appDataCG`のボリュームのスナップショットは15分ごとに作成されます。 `SVM1app_logCG`のスナップショットは1時間ごとに作成されます。親整合性グループ `SVM1_app`にはSnapMirrorアクティブ同期ポリシーがあり、災害発生時にもサービスが継続されるようにデータを複製します。

image:consistency-group-nested-diagram.gif["ネストされた整合性グループとそれに関連付けられたボリューム"]

ONTAP 9.12.1以降、整合性グループはxref:clone-task.html[クローニング]をサポートし、System ManagerとONTAP REST APIの両方でxref:modify-task.html[ボリュームの追加または削除]によって整合性グループのメンバーを変更できます。ONTAP 9.12.1以降、ONTAP REST APIは次の機能もサポートします：

* 新規のNFS / SMBボリュームまたはNVMeネームスペースで整合性グループを作成する。
* 新規または既存のNFS / SMBボリュームまたはNVMeネームスペースを既存の整合性グループに追加する。


ONTAP REST APIの詳細については、 https://docs.netapp.com/us-en/ontap-automation/reference/api_reference.html#access-a-copy-of-the-ontap-rest-api-reference-documentation["ONTAP REST APIリファレンスドキュメント"]を参照してください。



== 整合性グループの監視

ONTAP 9.13.1以降の整合性グループは、リアルタイムおよび過去の容量とパフォーマンスを監視し、アプリケーションや個々の整合性グループのパフォーマンスに関する分析情報を提供します。

監視データは5分ごとに更新され、最長1年間にわたって保持されます。追跡可能な指標は次のとおりです。

* パフォーマンス：IOPS、レイテンシ、スループット
* 容量：サイズ、論理使用済み、使用可能


監視データは、System Managerのコンシステンシ・グループ・メニューの**概要**タブ、またはREST APIで要求することで表示できます。ONTAP 9.14.1以降では、 `consistency-group metrics show`コマンドを使用してCLIでコンシステンシ・グループのメトリックを表示できます。 `consistency-group metrics show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/vserver-consistency-group-metrics-show.html["ONTAPコマンド リファレンス"^]を参照してください。


NOTE: ONTAP 9.13.1では、REST APIを使用した場合にのみ履歴メトリックを取得できます。ONTAP 9.14.1以降では、System Managerでも履歴メトリックを取得できます。



== 整合性グループの保護

整合性グループは、アプリケーション整合性のある保護を提供し、複数のボリュームまたはLIFにわたるデータの整合性を保証します。整合性グループのスナップショットを作成すると、整合性グループに「フェンス」が確立されます。フェンスは、スナップショット処理が完了するまでI/Oのキューを開始し、整合性グループ内のすべてのエンティティ間でデータのポイントインタイム整合性を保証します。ただし、スケジュールされたスナップショットポリシーやSystem Managerを使用したスナップショットの作成など、スナップショット作成処理中に、フェンスによって一時的なレイテンシの急増が発生する可能性があります。REST APIとCLIの詳細については、link:https://kb.netapp.com/on-prem/ontap/DM/REST-API["ONTAP REST APIドキュメント"^]およびlink:https://docs.netapp.com/us-en/ontap-cli/["ONTAPコマンド リファレンス"^]をご覧ください。

整合性グループは、次の方法で保護できます。

* Snapshotポリシー
* xref:../snapmirror-active-sync/index.html[SnapMirrorアクティブ同期]
* <<mcc>>（ONTAP 9.11.1以降）
* xref:../data-protection/snapmirror-disaster-recovery-concept.html[SnapMirror非同期]（ONTAP 9.13.1以降）
* link:../data-protection/snapmirror-svm-replication-concept.html["SVMディザスタ リカバリ"]（ONTAP 9.14.1以降）


整合性グループを作成しても、保護が自動的に有効になるわけではありません。ローカル保護ポリシーとリモート保護ポリシーは、整合性グループの作成時または作成後に設定できます。

整合性グループの保護を構成するには、link:protect-task.html["整合性グループの保護"]を参照してください。

リモート保護を使用するには、xref:../snapmirror-active-sync/prerequisites-reference.html[SnapMirrorアクティブ同期]の要件を満たしている必要があります。


NOTE: NASアクセス用にマウントされたボリュームではSnapMirrorアクティブ同期関係を確立できません。



== 整合性グループでのマルチ管理者認証のサポート

ONTAP 9.16.1以降では、整合性グループでマルチ管理者認証（MAV）を使用して、整合性グループの作成、変更、削除などの特定の処理を、指定した管理者からの承認がないと実行できないようにすることができます。これにより、侵害を受けた管理者、悪意のある管理者、または経験の浅い管理者が、既存の設定に望ましくない変更を行えないようにすることができます。

link:../multi-admin-verify/index.html["詳細情報"]



== MetroCluster構成の整合性グループ

ONTAP 9.11.1以降では、MetroCluster構成内のクラスタにある新しいボリュームで整合性グループをプロビジョニングできます。これらのボリュームはミラーされたアグリゲートにプロビジョニングされます。

プロビジョニングが完了したら、整合性グループに関連付けられているボリュームを、ミラーされたアグリゲートとミラーされていないアグリゲートの間で移動できます。つまり、ミラーされたアグリゲート、ミラーされていないアグリゲート、またはその両方に、整合性グループに関連付けられているボリュームを配置できます。整合性グループに関連付けられているボリュームを含む、ミラーされたアグリゲートを、ミラーされていないアグリゲートに変更することができます。同様に、整合性グループに関連付けられているボリュームを含む、ミラーされていないアグリゲートを変更して、ミラーリングを有効にすることもできます。

ミラーリングされたアグリゲートに配置されたコンシステンシ・グループに関連付けられたボリュームとスナップショットは、リモートサイト（サイトB）に複製されます。サイトBのボリュームの内容は、コンシステンシ・グループの書き込み順序を保証するため、災害発生時にはサイトBからリカバリできます。ONTAP 9.11.1以降を実行しているクラスタでは、REST APIとSystem Managerを使用してコンシステンシ・グループのスナップショットにアクセスできます。ONTAP 9.14.1以降では、ONTAP CLIを使用してスナップショットにアクセスすることもできます。

整合性グループに関連付けられているボリュームの一部またはすべてがミラーされていないアグリゲートに配置されていて、そのアグリゲートに現在アクセスできない場合、整合性グループに対するGETまたはDELETE処理はローカル ボリュームまたはホスティング アグリゲートがオフラインであるかのように動作します。



=== レプリケーション用の整合性グループ設定

サイトBでONTAP 9.10.1以前が実行されている場合は、整合性グループに関連付けられているボリュームのうち、ミラーされたアグリゲートにあるボリュームだけがサイトBにレプリケートされます。整合性グループの設定がレプリケートされるのは、両方のサイトでONTAP 9.11.1以降が実行されている場合のみです。サイトBをONTAP 9.11.1にアップグレードすると、サイトAの整合性グループのうち、関連付けられているボリュームがすべてミラーされたアグリゲートに配置されている整合性グループのデータが、サイトBにレプリケートされます。


NOTE: ストレージのパフォーマンスと可用性を最適化するために、ミラーリングされたアグリゲートには少なくとも20%の空きスペースを確保することをお勧めします。ミラーリングされていないアグリゲートの場合は10%が推奨されていますが、追加の10%のスペースはファイルシステムによって増分変更の吸収に使用される可能性があります。ONTAPのリダイレクトオンライトスナップショットベースのアーキテクチャにより、増分変更はミラーリングされたアグリゲートのスペース使用率を増加させます。これらのベストプラクティスを遵守しないと、パフォーマンスに悪影響を与える可能性があります。



== アップグレード時の考慮事項

ONTAP 9.10.1以降にアップグレードすると、ONTAP 9.8および9.9.1でSnapMirror Active Sync（旧称SnapMirror Business Continuity）を使用して作成されたコンシステンシグループは自動的にアップグレードされ、System ManagerまたはONTAP REST APIの*Storage > Consistency Groups*で管理できるようになります。ONTAP 9.8または9.9.1からのアップグレードの詳細については、link:../snapmirror-active-sync/upgrade-revert-task.html["SnapMirror Active Sync のアップグレードと復元に関する考慮事項"]を参照してください。

REST APIで作成された整合性グループSnapshotは、System Managerの整合性グループインターフェイスおよび整合性グループREST APIエンドポイントを通じて管理できます。ONTAP 9.14.1以降では、整合性グループSnapshotはONTAP CLIでも管理できます。


NOTE: ONTAPIコマンド `cg-start`および `cg-commit`で作成されたスナップショットは、コンシステンシグループスナップショットとして認識されないため、System ManagerのコンシステンシグループインターフェイスまたはONTAP REST APIのコンシステンシグループエンドポイントでは管理できません。ONTAP 9.14.1以降では、SnapMirror非同期ポリシーを使用している場合、これらのスナップショットをデスティネーションボリュームにミラーリングできます。詳細については、xref:protect-task.html#configure-snapmirror-asynchronous[SnapMirror非同期の設定]を参照してください。



== リリース別のサポートされる機能

[cols="3,1,1,1,1,1,1,1"]
|===
|  | ONTAP 9.16.1 | ONTAP 9.15.1 | ONTAP 9.14.1 | ONTAP 9.13.1 | ONTAP 9.12.1 | ONTAP 9.11.1 | ONTAP 9.10.1 


| 階層型整合性グループ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ 


| スナップショットによるローカル保護 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ 


| SnapMirrorアクティブ同期 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ 


| MetroClusterのサポート | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |  


| 2フェーズ コミット（REST APIのみ） | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |  


| アプリケーション タグとコンポーネント タグ | ✓ | ✓ | ✓ | ✓ | ✓ |  |  


| 整合性グループのクローニング | ✓ | ✓ | ✓ | ✓ | ✓ |  |  


| ボリュームの追加と削除 | ✓ | ✓ | ✓ | ✓ | ✓ |  |  


| 新しいNASボリュームを使用した整合性グループの作成 | ✓ | ✓ | ✓ | ✓ | REST APIのみ |  |  


| 新しいNVMeネームスペースを使用した整合性グループの作成 | ✓ | ✓ | ✓ | ✓ | REST APIのみ |  |  


| 子整合性グループ間でのボリュームの移動 | ✓ | ✓ | ✓ | ✓ |  |  |  


| 整合性グループのジオメトリの変更 | ✓ | ✓ | ✓ | ✓ |  |  |  


| 監視 | ✓ | ✓ | ✓ | ✓ |  |  |  


| マルチ管理者認証 | ✓ |  |  |  |  |  |  


| SnapMirror非同期（独立した整合性グループのみ） | ✓ | ✓ | ✓ | ✓ |  |  |  


| SVMディザスタ リカバリ（独立した整合性グループのみ） | ✓ | ✓ | ✓ |  |  |  |  


| CLIのサポート | ✓ | ✓ | ✓ |  |  |  |  
|===


== 整合性グループに関する詳細情報

video::j0jfXDcdyzE[youtube,width=848,height=480]
.関連情報
* link:https://docs.netapp.com/us-en/ontap-automation/["ONTAP自動化ドキュメント"^]
* xref:../snapmirror-active-sync/index.html[SnapMirrorアクティブ同期]
* xref:../data-protection/snapmirror-disaster-recovery-concept.html[SnapMirror非同期のディザスタ リカバリの基本]
* link:https://docs.netapp.com/us-en/ontap-metrocluster/["MetroClusterのドキュメント"]
* link:../multi-admin-verify/index.html["マルチ管理者認証"]
* link:https://docs.netapp.com/us-en/ontap-cli/["ONTAPコマンド リファレンス"^]

