---
sidebar: sidebar 
permalink: consistency-groups/modify-geometry-task.html 
keywords: consistency group geometry, promote consistency group, demote, add consistency group 
summary: ONTAP 9.13.1 以降では、IO 操作を中断することなくコンシステンシー グループのジオメトリを変更できます。 
---
= ONTAPコンシステンシグループのジオメトリを変更する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.13.1以降では、整合性グループのジオメトリを変更できます。整合性グループのジオメトリを変更すると、進行中のI/O処理を停止することなく、子または親整合性グループの構成を変更できます。

整合性グループのジオメトリを変更すると、整合性グループの既存のスナップショットに影響があります。詳細については、実行するジオメトリの変更内容を参照してください。


NOTE: リモート保護ポリシーが設定されている整合性グループのジオメトリは変更できません。最初に保護関係を解除し、ジオメトリを変更してから、リモート保護をリストアする必要があります。



== 新しい子整合性グループの追加

ONTAP 9.13.1以降では、既存の親整合性グループに新しい子整合性グループを追加できます。

.タスク概要
* 親コンシステンシグループには最大5つの子コンシステンシグループを含めることができます。その他の制限についてはxref:limits.html[整合性グループの制限]を参照してください。
* 単一の整合性グループに子整合性グループを追加することはできません。まず整合性グループを<<promote>>してから、子整合性グループを追加する必要があります。
* 拡張操作前に取得された整合性グループの既存のスナップショットは部分的なものとみなされます。そのスナップショットに基づく復元操作は、スナップショットのポイントインタイムにおける整合性グループを反映します。


.手順
[role="tabbed-block"]
====
.System Manager
--
ONTAP 9.13.1以降では、System Managerでこの処理を実行できます。

.新しい子整合性グループの追加
. *Storage > Consistency groups*を選択します。
. 子整合性グループを追加する親整合性グループを選択します。
. 親整合性グループの名前の横にある［**詳細**］を選択し、［**新しい子整合性グループの追加**］を選択します。
. 整合性グループの名前を入力します。
. 新しいボリュームと既存のボリュームのどちらを追加するかを選択します。
+
.. 既存のボリュームを追加する場合は、**既存のボリューム**を選択し、ドロップダウン メニューからボリュームを選択します。
.. 新しいボリュームを追加する場合は、**新しいボリューム**を選択し、ボリュームの数とサイズを指定します。


. **追加**を選択します。


--
.CLI
--
ONTAP 9.14.1以降では、ONTAP CLIを使用して子整合性グループを追加できます。

.開始する前に
* このタスクを実行するには、admin権限レベルが必要です。
* ONTAP 9.15.1以降では、admin権限レベルのすべてのユーザがこのタスクを実行できます。ONTAP 9.14.1では、このタスクを実行するには、クラスタ管理者またはSVMの管理者である必要があります。


.新しいボリュームを使用した子整合性グループの追加
. 新しい整合性グループを作成します。整合性グループ名、ボリュームのプレフィックス、ボリューム数、ボリューム サイズ、ストレージ サービス、およびエクスポート ポリシー名の値を指定します。
+
`consistency-group create -vserver _SVM_name_ -consistency-group _consistency_group_ -parent-consistency-group _parent_consistency_group_ -volume-prefix _prefix_ -volume-count _number_ -size _size_ -storage-service _service_ -export-policy _policy_name_`



.既存のボリュームを使用した子整合性グループの追加
. 新しいコンシステンシグループを作成します。 `volumes`パラメータには、ボリューム名のコンマ区切りリストを指定できます。
+
`consistency-group create -vserver _SVM_name_ -consistency-group _new_consistency_group_ -parent-consistency-group _parent_consistency_group_ -volumes _volume_`



--
====


== 子整合性グループの接続解除

ONTAP 9.13.1以降では、子整合性グループを親から削除して、個別の整合性グループに変換することができます。

.タスク概要
* 子整合性グループをデタッチすると、親整合性グループのスナップショットは無効になり、アクセスできなくなります。ボリュームの細分スナップショットは有効なままです。
* 個々の整合性グループの既存のスナップショットは有効なままです。
* 接続を解除する子整合性グループと同じ名前の独立した整合性グループがすでにある場合、この処理は失敗します。そのような場合は、接続を解除するときに整合性グループの名前を変更する必要があります。


.手順
[role="tabbed-block"]
====
.System Manager
--
ONTAP 9.13.1以降では、System Managerでこの処理を実行できます。

.子整合性グループの接続解除
. *Storage > Consistency groups*を選択します。
. 接続を解除する子を含む親整合性グループを選択します。
. デタッチする子整合性グループの横にある [**詳細**] を選択し、[**親からデタッチ**] を選択します。
. 必要に応じて、整合性グループの名前を変更し、アプリケーション タイプを選択します。
. **デタッチ**を選択します。


--
.CLI
--
ONTAP 9.14.1以降では、ONTAP CLIを使用して子整合性グループの接続を解除できます。

.開始する前に
* このタスクを実行するには、admin権限レベルが必要です。
* ONTAP 9.15.1以降では、admin権限レベルのすべてのユーザがこのタスクを実行できます。ONTAP 9.14.1では、このタスクを実行するには、クラスタ管理者またはSVMの管理者である必要があります。


.子整合性グループの接続解除
. 整合性グループをデタッチします。オプションで、 `-new-name` パラメータを使用してデタッチされた整合性グループの名前を変更します。
+
`consistency-group detach -vserver _SVM_name_ -consistency-group _child_consistency_group_ -parent-consistency-group _parent_consistency_group_ [-new-name _new_name_]`



--
====


== 親整合性グループへの既存の独立した整合性グループの移動

ONTAP 9.13.1以降では、既存の独立した整合性グループを子整合性グループに変換できます。変換した子整合性グループは、変換時に既存の親整合性グループまたは新しく作成した親整合性グループに移動できます。

.タスク概要
* 親コンシステンシグループには、4つ以下の子コンシステンシグループを含める必要があります。親コンシステンシグループには、最大5つの子コンシステンシグループを含めることができます。その他の制限については、xref:limits.html[整合性グループの制限]を参照してください。
* この操作の前に取得された_親_整合性グループの既存のスナップショットは部分的なものとみなされます。これらのスナップショットのいずれかに基づく復元操作は、スナップショットのポイントインタイムにおける整合性グループを反映します。
* 独立した整合性グループの既存のSnapshotは有効なままです。


.手順
[role="tabbed-block"]
====
.System Manager
--
ONTAP 9.13.1以降では、System Managerでこの処理を実行できます。

.親整合性グループへの既存の独立した整合性グループの移動
. *Storage > Consistency groups*を選択します。
. 変換する整合性グループを選択します。
. **詳細**を選択し、**別の整合性グループに移動**を選択します。
. 必要に応じて、整合性グループの新しい名前を入力し、コンポーネント タイプを選択します。デフォルトでは、コンポーネント タイプは「Other」です。
. 既存の親整合性グループに移行するか、新しい親整合性グループを作成するかを選択します。
+
.. 既存の親整合性グループに移行するには、**既存の整合性グループ**を選択し、ドロップダウン メニューから整合性グループを選択します。
.. 新しい親整合性グループを作成するには、**新しい整合性グループ**を選択し、新しい整合性グループの名前を入力します。


. **移動**を選択します。


--
.CLI
--
ONTAP 9.14.1以降では、ONTAP CLIを使用して、親整合性グループに独立した整合性グループを移動できます。

.開始する前に
* このタスクを実行するには、admin権限レベルが必要です。
* ONTAP 9.15.1以降では、admin権限レベルのすべてのユーザがこのタスクを実行できます。ONTAP 9.14.1では、このタスクを実行するには、クラスタ管理者またはSVMの管理者である必要があります。


.新しい親整合性グループへの整合性グループの移動
. 新しい親整合性グループを作成します。 `-consistency-groups`パラメータにより、既存の整合性グループが新しい親グループに移行されます。
+
`consistency-group attach -vserver _svm_name_ -consistency-group _parent_consistency_group_ -consistency-groups _child_consistency_group_`



.既存の整合性グループへの整合性グループの移動
. 整合性グループを移動します。
+
`consistency-group add -vserver _SVM_name_ -consistency-group _consistency_group_ -parent-consistency-group _parent_consistency_group_`



--
====


== 子整合性グループの昇格

ONTAP 9.13.1以降では、独立した整合性グループを親整合性グループに昇格できます。独立した整合性グループを親に昇格する際には、元の独立した整合性グループ内のボリュームをすべて継承する新しい子整合性グループも作成します。

.タスク概要
* 子整合性グループを親整合性グループに変換する場合は、まず子整合性グループを<<detach>>してから、この手順に従う必要があります。
* 整合性グループの既存のスナップショットは、整合性グループを昇格した後も有効なままになります。


[role="tabbed-block"]
====
.System Manager
--
ONTAP 9.13.1以降では、System Managerでこの処理を実行できます。

.子整合性グループの昇格
. *Storage > Consistency groups*を選択します。
. 昇格する整合性グループを選択します。
. **詳細**を選択し、**親整合性グループに昇格**を選択します。
. 子整合性グループの**名前**を入力し、**コンポーネント タイプ**を選択します。
. **昇格**を選択します。


--
.CLI
--
ONTAP 9.14.1以降では、ONTAP CLIを使用して、親整合性グループに独立した整合性グループを移動できます。

.開始する前に
* このタスクを実行するには、admin権限レベルが必要です。
* ONTAP 9.15.1以降では、admin権限レベルのすべてのユーザがこのタスクを実行できます。ONTAP 9.14.1では、このタスクを実行するには、クラスタ管理者またはSVMの管理者である必要があります。


.子整合性グループの昇格
. 整合性グループを昇格します。このコマンドは、1つの親整合性グループと1つの子整合性グループを作成します。
+
`consistency-group promote -vserver _SVM_name_ -consistency-group _existing_consistency_group_ -new-name _new_child_consistency_group_`



--
====


== 親整合性グループから独立した整合性グループへの降格

ONTAP 9.13.1以降では、親整合性グループを独立した整合性グループに降格できます。親を降格すると、整合性グループの階層がなくなり、関連付けられている子整合性グループはすべて削除されます。削除された整合性グループ内のボリュームは、新しい独立した整合性グループにすべて継承されます。

.タスク概要
* _親_整合性グループの既存のスナップショットは、単一整合性グループに降格した後も有効です。その親に関連付けられた_子_整合性グループの既存のスナップショットは、降格時に無効になります。子整合性グループ内の個々のボリュームスナップショットは、ボリューム単位のスナップショットとして引き続きアクセスできます。


.手順
[role="tabbed-block"]
====
.System Manager
--
ONTAP 9.13.1以降では、System Managerでこの処理を実行できます。

.整合性グループの降格
. *Storage > Consistency groups*を選択します。
. 降格する親整合性グループを選択します。
. **詳細** を選択し、**単一の整合性グループに降格** を選択します。
. 関連するすべての子コンシステンシグループが削除され、それらのボリュームが新しい単一のコンシステンシグループの下に移動されることを通知する警告が表示されます。影響を理解したことを確認するには、**Demote**を選択します。


--
.CLI
--
ONTAP 9.14.1以降では、ONTAP CLIを使用して整合性グループを降格できます。

.開始する前に
* このタスクを実行するには、admin権限レベルが必要です。
* ONTAP 9.15.1以降では、admin権限レベルのすべてのユーザがこのタスクを実行できます。ONTAP 9.14.1では、このタスクを実行するには、クラスタ管理者またはSVMの管理者である必要があります。


.整合性グループの降格
. 整合性グループを降格します。オプションの `-new-name`パラメータを使用して、整合性グループの名前を変更します。
+
`consistency-group demote -vserver _SVM_name_ -consistency-group _parent_consistency_group_ [-new-name _new_consistency_group_name_]`



--
====