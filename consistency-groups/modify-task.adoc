---
permalink: consistency-groups/modify-task.html 
sidebar: sidebar 
keywords: consistency groups, shrink, expand, add volumes, remove volumes, move volumes, smbc 
summary: ボリュームを追加または削除したり、子整合性グループ間でボリュームを移動したりすることで、整合性グループを変更できます。 
---
= ONTAPコンシステンシグループのメンバーボリュームを変更する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.12.1以降では、ボリュームを削除するか、ボリュームを追加（整合性グループを拡張）して整合性グループを変更できます。ONTAP 9.13.1以降では、同じ親に所属する子整合性グループ間でボリュームを移動できます。



== 整合性グループへのボリュームの追加

ONTAP 9.12.1以降では、整合性グループに無停止でボリュームを追加できます。

.タスク概要
* 別の整合性グループに関連付けられているボリュームを追加することはできません。
* 整合性グループでは、NAS、SAN、NVMeの各プロトコルがサポートされます。
* 調整が全体のxref:limits.html[整合性グループの制限]内であれば、一度に最大16個のボリュームを整合性グループに追加できます。
* ONTAP 9.13.1以降では、アクティブなSnapMirrorアクティブ同期ポリシーまたはSnapMirror非同期保護ポリシーを使用して、整合性グループに無停止でボリュームを追加できます。
* SnapMirror Active Syncで保護されているコンシステンシーグループにボリュームを追加すると、新しいボリュームのミラーリングと保護が構成されるまで、SnapMirror Active Sync関係のステータスは「拡張中」に変わります。このプロセスが完了する前にプライマリクラスタで災害が発生した場合、フェイルオーバー操作の一環として、コンシステンシーグループは元の構成に戻ります。
* ONTAP 9.12.1以前では、SnapMirror Active Sync関係にあるコンシステンシグループにボリュームを追加することはできません。まずSnapMirror Active Sync関係を削除し、コンシステンシグループを変更してから、SnapMirror Active Syncによる保護を復元する必要があります。
* ONTAP 9.12.1以降、ONTAP REST APIは、整合性グループへの_新規_または既存のボリュームの追加をサポートします。ONTAP REST APIの詳細については、link:https://docs.netapp.com/us-en/ontap-automation/reference/api_reference.html#access-a-copy-of-the-ontap-rest-api-reference-documentation["ONTAP REST APIリファレンスドキュメント"^]を参照してください。
+
ONTAP 9.13.1以降では、この機能がSystem Managerでサポートされます。

* 整合性グループを拡張する場合、変更前に取得された整合性グループのスナップショットは部分的なものとみなされます。そのスナップショットに基づく復元処理には、スナップショットのポイントインタイムの整合性グループが反映されます。
* ONTAP 9.10.1～9.11.1を使用している場合は、整合性グループを変更できません。ONTAP 9.10.1または9.11.1で整合性グループの設定を変更するには、整合性グループを削除し、希望するボリュームで新しく整合性グループを作成する必要があります。
* ONTAP 9.14.1以降では、SnapMirror非同期モードの使用時に、ボリューム単位のスナップショットをデスティネーション クラスタにレプリケートできます。SnapMirror非同期モードを使用してコンシステンシグループを拡張する場合、SnapMirrorポリシーがMirrorAllまたはMirrorAndVaultの場合にのみ、コンシステンシグループを拡張した後にボリューム単位のスナップショットがレプリケートされます。ベースラインコンシステンシグループスナップショットよりも新しいボリューム単位のスナップショットのみがレプリケートされます。
* SVMディザスタリカバリ関係（ONTAP 9.14.1以降でサポート）のコンシステンシグループにボリュームを追加する場合は、コンシステンシグループを拡張した後、デスティネーション クラスタからSVMディザスタリカバリ関係を更新する必要があります。詳細については、xref:../data-protection/update-replication-relationship-manual-task.html[レプリケーション関係の手動更新]を参照してください。
* ONTAP 9.17.1 で NVMe を使用している場合は、整合性グループを変更できません。


.手順
[role="tabbed-block"]
====
.System Manager
--
ONTAP 9.12.1以降では、System Managerでこの処理を実行できます。

. *Storage > Consistency groups*を選択します。
. 変更する整合性グループを選択します。
. 単一の整合性グループを変更する場合は、*ボリューム*メニューの上部にある*詳細*を選択し、*展開*を選択してボリュームを追加します。
+
子コンシステンシーグループを変更する場合は、変更する親コンシステンシーグループを特定します。*>*ボタンを選択して子コンシステンシーグループを表示し、変更する子コンシステンシーグループの名前の横にあるimage:../media/icon_kabob.gif["メニューオプションアイコン"]を選択します。表示されたメニューから*展開*を選択します。

. 整合性グループに追加するボリュームを最大16個選択します。
. *保存*を選択します。操作が完了したら、整合性グループの*ボリューム*メニューで新しく追加されたボリュームを表示します。


--
.CLI
--
ONTAP 9.14.1以降では、ONTAP CLIを使用して整合性グループにボリュームを追加できます。

.開始する前に
* このタスクを実行するには、admin権限レベルが必要です。
* ONTAP 9.15.1以降では、admin権限レベルのすべてのユーザがこのタスクを実行できます。ONTAP 9.14.1では、このタスクを実行するには、クラスタ管理者またはSVMの管理者である必要があります。


.既存のボリュームの追加
. 次のコマンドを実行します。 `-volumes`パラメータには、カンマ区切りのボリュームリストを指定できます。
+

NOTE: 整合性グループが階層関係にある場合にのみ、 `-parent-consistency-group`パラメータを含めます。

+
`consistency-group volume add -vserver _svm_name_ -consistency-group _consistency_group_name_ -parent-consistency-group _parent_consistency_group_ -volume _volumes_`



.新しいボリュームの追加
新しいボリュームを追加する手順は、使用するプロトコルによって異なります。


NOTE: 整合性グループが階層関係にある場合にのみ、 `-parent-consistency-group`パラメータを含めます。

* エクスポートせずに新しいボリュームを追加するには、次のコマンドを実行します。
+
`consistency-group volume create -vserver _SVM_name_ -consistency-group _child_consistency_group_ -parent-consistency-group existingParentCg -volume _volume_name_ -size _size_`

* 新しいNFSボリュームを追加するには、次のコマンドを実行します。
+
`consistency-group volume create -vserver _SVM_name_ -consistency-group _consistency-group-name_ -volume _volume-prefix_ -volume-count _number_ -size _size_ -export-policy _policy_name_`

* 新しいSANボリュームを追加するには、次のコマンドを実行します。
+
`consistency-group volume create -vserver _SVM_name_ -consistency-group _consistency-group-name_ -lun _lun_name_ -size _size_ -lun-count _number_ -igroup _igroup_name_`

* 新しいNVMeネームスペースを追加するには、次のコマンドを実行します。
+
`consistency-group volume create -vserver _SVM_name_ -consistency-group _consistency_group_name_ -namespace _namespace_name_ -volume-count _number_ -namespace-count _number_ -size _size_ -subsystem _subsystem_name_`



--
====


== 整合性グループからのボリュームの削除

整合性グループから削除しても、ボリューム自体は削除されません。クラスタ内でアクティブなままです。

.タスク概要
* SnapMirrorアクティブ同期またはSVMディザスタ リカバリ関係にある整合性グループからボリュームを削除することはできません。最初にSnapMirrorアクティブ同期関係を削除し、整合性グループを変更してから、関係を再確立する必要があります。
* 削除後にボリュームが1つもない整合性グループは削除されます。
* ボリュームが整合性グループから削除されると、整合性グループの既存のスナップショットは残りますが、無効とみなされます。既存のスナップショットを使用して整合性グループの内容を復元することはできません。ボリューム単位のスナップショットは有効なままです。
* クラスタからボリュームを削除すると、そのボリュームは整合性グループから自動的に削除されます。
* ONTAP 9.10.1または9.11.1で整合性グループの設定を変更するには、整合性グループを削除してから、必要なメンバー ボリュームで新しく整合性グループを作成する必要があります。
* クラスタからボリュームを削除すると、整合性グループからも自動的に削除されます。


[role="tabbed-block"]
====
.System Manager
--
ONTAP 9.12.1以降では、System Managerでこの処理を実行できます。

.手順
. *Storage > Consistency groups*を選択します。
. 変更する独立した整合性グループまたは子整合性グループを選択します。
. *ボリューム* メニューで、整合性グループから削除する個々のボリュームの横にあるチェックボックスを選択します。
. *整合性グループからボリュームを削除* を選択します。
. ボリュームを削除すると、コンシステンシー グループのすべてのスナップショットが無効になることを理解した上で、*削除* を選択します。


--
.CLI
--
ONTAP 9.14.1以降では、CLIを使用して整合性グループからボリュームを削除できます。

.開始する前に
* このタスクを実行するには、admin権限レベルが必要です。
* ONTAP 9.15.1以降では、admin権限レベルのすべてのユーザがこのタスクを実行できます。ONTAP 9.14.1では、このタスクを実行するには、クラスタ管理者またはSVMの管理者である必要があります。


.手順
. ボリュームを削除します。この `-volumes`パラメータには、カンマ区切りのボリュームのリストを指定できます。
+
整合性グループが階層関係にある場合にのみ、 `-parent-consistency-group`パラメータを含めます。

+
`consistency-group volume remove -vserver _SVM_name_ -consistency-group _consistency_group_name_ -parent-consistency-group _parent_consistency_group_name_ -volume _volumes_`



--
====


== 整合性グループ間でのボリュームの移動

ONTAP 9.13.1以降では、同じ親に所属する子整合性グループ間でボリュームを移動できます。

.タスク概要
* ボリュームは、同じ親整合性グループに含まれる整合性グループ間でのみ移動できます。
* 既存のコンシステンシグループスナップショットは無効になり、コンシステンシグループスナップショットとしてアクセスできなくなります。個々のボリュームスナップショットは有効なままです。
* 親整合性グループのスナップショットは有効なままです。
* 子整合性グループからすべてのボリュームを移動すると、その整合性グループは削除されます。
* 整合性グループへの変更はxref:limits.html[整合性グループの制限]に従う必要があります。


[role="tabbed-block"]
====
.System Manager
--
ONTAP 9.12.1以降では、System Managerでこの処理を実行できます。

.手順
. *Storage > Consistency groups*を選択します。
. 移動するボリュームを含む親コンシステンシグループを選択します。子コンシステンシグループを見つけて、**ボリューム**メニューを展開します。移動するボリュームを選択します。
. **移動**を選択します。
. ボリュームを新しい整合性グループと既存のグループのどちらに移動するかを選択します。
+
.. 既存の整合性グループに移動するには、**既存の子整合性グループ**を選択し、ドロップダウン メニューから整合性グループの名前を選択します。
.. 新しいコンシステンシグループに移動するには、**新しい子コンシステンシグループ**を選択します。新しい子コンシステンシグループの名前を入力し、コンポーネントタイプを選択します。


. **移動**を選択します。


--
.CLI
--
ONTAP 9.14.1以降では、ONTAP CLIを使用して整合性グループ間でボリュームを移動できます。

.開始する前に
* このタスクを実行するには、admin権限レベルが必要です。
* ONTAP 9.15.1以降では、admin権限レベルのすべてのユーザがこのタスクを実行できます。ONTAP 9.14.1では、このタスクを実行するには、クラスタ管理者またはSVMの管理者である必要があります。


.新しい子整合性グループへのボリュームの移動
. 次のコマンドは、指定したボリュームを含む新しい子整合性グループを作成します。
+
新しい整合性グループを作成するときに、新しいスナップショット、QoS、および階層化ポリシーを指定できます。

+
`consistency-group volume reassign -vserver _SVM_name_ -consistency-group _source_child_consistency_group_ -parent-consistency-group _parent_consistency_group_ -volume _volumes_ -new-consistency-group _consistency_group_name_ [-snapshot-policy _policy_ -qos-policy _policy_ -tiering-policy _policy_]`



.既存の子整合性グループへのボリュームの移動
. ボリュームを再割り当てします。この `-volumes`パラメータには、ボリューム名をカンマで区切って指定できます。
+
`consistency-group volume reassign -vserver _SVM_name_ -consistency-group _source_child_consistency_group_ -parent-consistency-group _parent_consistency_group_ -volume _volumes_ -to-consistency-group _target_consistency_group_`



--
====
.関連情報
* xref:limits.html[整合性グループの制限]
* xref:clone-task.html[整合性グループのクローニング]

