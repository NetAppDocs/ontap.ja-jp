---
permalink: data-protection/create-custom-replication-policy-concept.html 
sidebar: sidebar 
keywords: create, custom, replication, policy 
summary: 関係のデフォルト ポリシーが適切でない場合は、カスタム レプリケーション ポリシーを作成できます。たとえば、ネットワーク転送でデータを圧縮したり、SnapMirrorがSnapshotを転送する試行回数を変更したりできます。 
---
= カスタムONTAP SnapMirrorレプリケーションポリシーを作成する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
関係のデフォルト ポリシーが適切でない場合は、カスタム レプリケーション ポリシーを作成できます。たとえば、ネットワーク転送でデータを圧縮したり、SnapMirrorがSnapshotを転送する試行回数を変更したりできます。

レプリケーション関係を作成する際には、デフォルトポリシーまたはカスタムポリシーを使用できます。カスタムアーカイブ（旧称SnapVault）または統合レプリケーションポリシーの場合は、初期化時および更新時に転送するスナップショットを決定する1つ以上の_ルール_を定義する必要があります。また、デスティネーションにローカルスナップショットを作成するスケジュールを定義することもできます。

レプリケーション ポリシーの_ポリシー タイプ_によって、サポートされる関係のタイプが決まります。次の表に、使用可能なポリシー タイプを示します。

[cols="2*"]
|===


| ポリシー タイプ | 関係タイプ 


 a| 
async-mirror
 a| 
SnapMirror DR



 a| 
バックアップ
 a| 
SnapVault



 a| 
mirror-vault
 a| 
ユニファイド レプリケーション



 a| 
strict-sync-mirror
 a| 
StrictSyncモードのSnapMirror同期（ONTAP 9.5以降でサポート）



 a| 
sync-mirror
 a| 
SyncモードのSnapMirror同期（ONTAP 9.5以降でサポート）

|===
[TIP]
====
カスタム レプリケーション ポリシーを作成する場合は、デフォルト ポリシーをモデルとすることを推奨します。

====
.手順
カスタム データ保護ポリシーは、System ManagerまたはONTAP CLIを使用して作成できます。ONTAP 9.11.1以降では、System Managerを使用して、カスタムのミラー ポリシーとバックアップ ポリシーの作成、従来のポリシーの表示と選択を行うことができます。この機能は、ONTAP 9.8P12およびそれ以降のONTAP 9.8のパッチでも使用できます。

カスタムの保護ポリシーはソース クラスタとデスティネーション クラスタの両方で作成してください。

[role="tabbed-block"]
====
.System Manager
--
. *[保護] > [概要] > [ローカル ポリシー設定]*をクリックします。
. *保護ポリシー*で、image:icon_arrow.gif["矢印アイコン"]をクリックします。
. *保護ポリシー* ペインで、image:icon_add.gif["アイコンを追加"]をクリックします。
. 新しいポリシー名を入力し、ポリシーのスコープを選択します。
. ポリシーのタイプを選択します。vault-onlyまたはmirror-onlyポリシーを追加するには、*Asynchronous*を選択し、*Use a legacy policy type*をクリックします。
. 必須フィールドに入力します。
. *保存*をクリックします。
. もう一方のクラスタに対して同じ手順を繰り返します。


--
.CLI
--
. カスタム レプリケーション ポリシーを作成します。
+
[source, cli]
----
snapmirror policy create -vserver <SVM> -policy _policy_ -type <async-mirror|vault|mirror-vault|strict-sync-mirror|sync-mirror> -comment <comment> -tries <transfer_tries> -transfer-priority <low|normal> -is-network-compression-enabled <true|false>
----
+
ONTAP 9.5以降では、 `-common-snapshot-schedule`パラメータを使用して、SnapMirror同期関係の共通Snapshotスケジュールを作成するためのスケジュールを指定できます。デフォルトでは、SnapMirror同期関係の共通Snapshotスケジュールは1時間です。SnapMirror同期関係のSnapshotスケジュールには、30分から2時間までの値を指定できます。

+
次の例は、データ転送のためにネットワーク圧縮を有効にする、SnapMirror DR用のカスタム レプリケーション ポリシーを作成します。

+
[listing]
----
cluster_dst::> snapmirror policy create -vserver svm1 -policy DR_compressed -type async-mirror -comment "DR with network compression enabled" -is-network-compression-enabled true
----
+
次の例は、SnapVault用のカスタム レプリケーション ポリシーを作成します。

+
[listing]
----
cluster_dst::> snapmirror policy create -vserver svm1 -policy my_snapvault -type vault
----
+
次の例は、ユニファイド レプリケーション用のカスタム レプリケーション ポリシーを作成します。

+
[listing]
----
cluster_dst::> snapmirror policy create -vserver svm1 -policy my_unified -type mirror-vault
----
+
次の例は、StrictSyncモードのSnapMirror同期関係用のカスタム レプリケーション ポリシーを作成します。

+
[listing]
----
cluster_dst::> snapmirror policy create -vserver svm1 -policy my_strictsync -type strict-sync-mirror -common-snapshot-schedule my_sync_schedule
----
+
 `snapmirror policy create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-create.html["ONTAPコマンド リファレンス"^]を参照してください。



.終了後の操作
「`vault`」および「`mirror-vault`」ポリシー タイプの場合、初期化および更新中に転送される Snapshot を決定するルールを定義する必要があります。

 `snapmirror policy show`コマンドを使用して、SnapMirrorポリシーが作成されたことを確認します。

 `snapmirror policy show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-show.html["ONTAPコマンド リファレンス"^]を参照してください。

--
====