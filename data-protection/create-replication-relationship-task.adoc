---
permalink: data-protection/create-replication-relationship-task.html 
sidebar: sidebar 
keywords: create, replication, relationship 
summary: プライマリ ストレージのソース ボリュームとセカンダリ ストレージのデスティネーション ボリューム間の関係は、データ保護関係と呼ばれます。snapmirror createコマンドを使用して、SnapMirror DR、SnapVault、または統合レプリケーションのデータ保護関係を作成できます。 
---
= ONTAP SnapMirrorレプリケーション関係を作成する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
プライマリ ストレージのソース ボリュームとセカンダリ ストレージのデスティネーション ボリュームの関係は、_データ保護関係_ と呼ばれます。 `snapmirror create`コマンドを使用して、SnapMirror DR、SnapVault、または統合レプリケーション データ保護関係を作成できます。


NOTE: この手順はFAS、AFF、およびASAシステムに適用されます。ASA r2システム（ASA A1K、ASA A90、ASA A70、ASA A50、ASA A30、ASA A20、またはASA C30）をお持ちの場合は、link:https://docs.netapp.com/us-en/asa-r2/data-protection/snapshot-replication.html["これらの手順"^]に従ってレプリケーション関係を作成してください。ASA r2システムは、SANのみのお客様向けに簡素化されたONTAPエクスペリエンスを提供します。

ONTAP 9.11.1以降では、ボリュームとStorage VMを保護する際、System Managerを使用して、事前作成済みおよびカスタムのミラー ポリシーとバックアップ ポリシーの選択、従来のポリシーの表示と選択、保護ポリシーに定義された転送スケジュールの上書きを行うことができます。この機能は、ONTAP 9.8P12およびそれ以降のONTAP 9.8のパッチでも使用できます。

[NOTE]
====
ONTAP 9.8P12またはそれ以降のONTAP 9.8パッチ リリースを使用していて、System ManagerからSnapMirrorを設定した場合、ONTAP 9.9.1またはONTAP 9.10.1リリースへのアップグレードにはONTAP 9.9.1P13以降およびONTAP 9.10.1P10以降のパッチ リリースを使用する必要があります。

====
.開始する前に
* ソース / デスティネーション クラスタとSVMのピア関係が確立されている必要があります。
+
link:../peering/index.html["クラスタとSVMのピアリング"]

* デスティネーション ボリューム上の言語は、ソース ボリューム上の言語と同じである必要があります。


.タスク概要
ONTAP 9.3までは、DPモードで起動するSnapMirrorとXDPモードで起動するSnapMirrorは異なるレプリケーション エンジンを使用しており、バージョン依存性に対するアプローチも異なっていました。

* SnapMirrorがDPモードで呼び出された場合は、_バージョン依存_のレプリケーション エンジンが使用され、プライマリ ストレージとセカンダリ ストレージでONTAPバージョンが同じである必要がありました。
+
[listing]
----
cluster_dst::>  snapmirror create -type DP -source-path ... -destination-path ...
----
* XDPモードで呼び出されたSnapMirrorは、プライマリ ストレージとセカンダリ ストレージで異なるONTAPバージョンをサポートする_バージョンに依存しない_レプリケーション エンジンを使用しました：
+
[listing]
----
cluster_dst::>  snapmirror create -type XDP -source-path ... -destination-path ...
----


パフォーマンスの改善に伴い、レプリケーション スループットではバージョンに依存するモードの方がわずかに優れてはいるものの、バージョンに依存しないSnapMirrorの方がはるかに大きなメリットが得られるようになりました。そのため、ONTAP 9.3以降ではXDPモードが新しいデフォルト値となり、コマンドラインまたは新規 / 既存のスクリプトにおけるDPモードの起動は自動的にXDPモードに変換されます。

既存の関係には影響しません。DPタイプの既存の関係は引き続きDPタイプになります。次の表は、想定される動作を示しています。

[cols="25,25,50"]
|===


| 指定するモード | タイプ | デフォルト ポリシー（ポリシーを指定しない場合） 


 a| 
DP
 a| 
XDP
 a| 
MirrorAllSnapshots（SnapMirror DR）



 a| 
なし
 a| 
XDP
 a| 
MirrorAllSnapshots（SnapMirror DR）



 a| 
XDP
 a| 
XDP
 a| 
XDPDefault（SnapVault）

|===
以下の手順の例も参照してください。

以下は例外です。

* SVMデータ保護関係のデフォルトは引き続きDPモードです。
+
デフォルトの `MirrorAllSnapshots`ポリシーで XDP モードを取得するには、XDP を明示的に指定します。

* 負荷共有データ保護関係のデフォルトは引き続きDPモードです。
* SnapLockデータ保護関係のデフォルトは引き続きDPモードです。
* 次のクラスタ全体のオプションを設定した場合、DPを明示的に指定した場合のデフォルトは引き続きDPモードです。
+
[listing]
----
options replication.create_data_protection_rels.enable on
----
+
DPを明示的に指定しない場合、このオプションは無視されます。



ONTAP 9.14.1以降では、 `-backoff-level`オプションが `snapmirror create`、 `snapmirror modify`、および `snapmirror restore`コマンドに追加され、関係ごとにバックオフレベルを指定できるようになりました。このオプションはFlexVol SnapMirror関係でのみサポートされます。オプションのコマンドは、クライアントオペレーションによるSnapMirrorバックオフレベルを指定します。バックオフ値は、high、medium、noneのいずれかに設定できます。デフォルト値はhighです。

ONTAP 9.5以降では、SnapMirror同期関係がサポートされます。

ONTAP 9.4以降では、デスティネーション ボリュームに最大1019個のSnapshotを保存できます。ONTAP 9.3以前では、デスティネーション ボリュームに最大251個のSnapshotを保存できます。

.手順
System ManagerまたはONTAP CLIを使用して、レプリケーション関係を作成できます。

[role="tabbed-block"]
====
.System Manager
--
. 保護するボリュームまたはLUNを選択します。*[ストレージ] > [ボリューム]*または*[ストレージ] > [LUN]*をクリックし、ボリュームまたはLUNの名前をクリックします。
. image:icon_protect.gif["保護アイコン"]をクリックします。
. デスティネーションのクラスタとStorage VMを選択します。
. デフォルトでは非同期ポリシーが選択されます。同期ポリシーを選択するには、*[その他のオプション]*をクリックします。
. *[保護]*をクリックします。
. 選択したボリュームまたはLUNの*[SnapMirror（ローカルまたはリモート）]*タブをクリックし、保護が正しくセットアップされたことを確認します。


--
.CLI
--
. デスティネーション クラスタから、レプリケーション関係を作成します。
+
このコマンドを実行する前に、山かっこ内の変数を必要な値に置き換える必要があります。

+
[source, cli]
----
snapmirror create -source-path <SVM:volume> -destination-path <SVM:volume> -type <DP|XDP> -schedule <schedule> -policy <policy>
----
+

NOTE:  `schedule`パラメータは、SnapMirror同期関係を作成する場合は適用されません。

+
次の例では、デフォルト `MirrorLatest`ポリシーを使用してSnapMirror DR関係を作成します：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst -type XDP -schedule my_daily -policy MirrorLatest
----
+
次の例では、デフォルト `XDPDefault`ポリシーを使用してSnapVault関係を作成します：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst -type XDP -schedule my_daily -policy XDPDefault
----
+
次の例では、デフォルトの `MirrorAndVault`ポリシーを使用して統合レプリケーション関係を作成します：

+
[listing]
----
cluster_dst:> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst -type XDP -schedule my_daily -policy MirrorAndVault
----
+
次の例では、カスタム `my_unified`ポリシーを使用して統合レプリケーション関係を作成します：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst -type XDP -schedule my_daily -policy my_unified
----
+
次の例では、デフォルトの `Sync`ポリシーを使用してSnapMirror同期関係を作成します：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst -type XDP -policy Sync
----
+
次の例では、デフォルトの `StrictSync`ポリシーを使用してSnapMirror同期関係を作成します：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst -type XDP -policy StrictSync
----
+
以下の例では、SnapMirror DR関係を作成します。DPタイプは自動的にXDPに変換され、ポリシーは指定されていないため、ポリシーは `MirrorAllSnapshots`ポリシーにデフォルト設定されます：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst -type DP -schedule my_daily
----
+
次の例では、SnapMirror DR関係を作成します。タイプまたはポリシーを指定しない場合、ポリシーは `MirrorAllSnapshots`ポリシーにデフォルト設定されます：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst -schedule my_daily
----
+
次の例では、SnapMirror DR関係を作成します。ポリシーを指定しない場合、ポリシーは `XDPDefault`ポリシーにデフォルト設定されます：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst -type XDP -schedule my_daily
----
+
次の例では、定義済みポリシー `SnapCenterSync`を使用してSnapMirror同期関係を作成します：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1:volA -destination-path svm_backup:volA_dst -type XDP -policy SnapCenterSync
----
+

NOTE: 定義済みポリシー `SnapCenterSync`のタイプは `Sync`です。このポリシーは、 `snapmirror-label`が「app_consistent」で作成されたスナップショットをすべて複製します。



.終了後の操作
 `snapmirror show`コマンドを使用して、SnapMirror関係が作成されたことを確認します。

 `snapmirror show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-show.html["ONTAPコマンド リファレンス"^]を参照してください。

--
====
.関連情報
* link:create-delete-snapmirror-failover-test-task.html["SnapMirrorフェイルオーバー テスト ボリュームの作成と削除"]。




== ONTAPでこの処理を行うその他の方法

[cols="2"]
|===
| タスクを実行するツール | 参照するコンテンツ 


| System Manager Classic（ONTAP 9.7以前で使用可能） | link:https://docs.netapp.com/us-en/ontap-system-manager-classic/volume-backup-snapvault/index.html["SnapVaultを使用したボリューム バックアップの概要"^] 
|===
.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-create.html["snapmirror create"^]

