---
permalink: data-protection/preserve-snapshot-copy-primary-source-volume-task.html 
sidebar: sidebar 
keywords: ensure, snapshot, copy, mirror-vault, deployment 
summary: snapmirror snapshot-owner create コマンドを使用すると、ミラー・ヴォールト構成において、ラベル付きスナップショットをセカンダリ上に保存できます。これにより、ヴォールト関係の更新時に共通のスナップショットが確保されます。 
---
= ONTAPミラー - Vaultデプロイメントで共通のSnapshotを確保する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
 `snapmirror snapshot-owner create`コマンドを使用すると、ミラー - ヴォールト構成において、ラベル付きSnapshotをセカンダリ上に保存できます。これにより、ヴォールト関係の更新時に共通のSnapshotが確保されます。

.タスク概要
ミラー ヴォールト ファンアウトまたはカスケード展開の組み合わせを使用する場合は、ソース ボリュームとデスティネーション ボリュームに共通の Snapshot が存在しない場合は更新が失敗することに注意してください。

ミラー ボールト ファンアウトまたはカスケード展開のミラー関係では、SnapMirrorは更新を実行する前に常にソース ボリュームのスナップショットを作成するため、これが問題になることはありません。

ただし、SnapMirrorはボールト関係を更新する際にソースボリュームのスナップショットを作成しないため、ボールト関係に問題が発生する可能性があります。 `snapmirror snapshot-owner create`を使用して、ボールト関係のソースとデスティネーションの両方に少なくとも1つの共通スナップショットが存在することを確認する必要があります。link:supported-deployment-config-concept.html["データ保護のファンアウトとカスケード展開の詳細"]。

.手順
. ソース ボリュームで、保存するラベル付き Snapshot に所有者を割り当てます：
+
`snapmirror snapshot-owner create -vserver <SVM> -volume <volume> -snapshot <snapshot> -owner <owner>`

+
次の例では、 `ApplicationA`を `snap1`スナップショットの所有者として割り当てます：

+
[listing]
----
clust1::> snapmirror snapshot-owner create -vserver vs1 -volume vol1
-snapshot snap1 -owner ApplicationA
----
+
 `snapmirror snapshot-owner create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-snapshot-owner-create.html["ONTAPコマンド リファレンス"^]を参照してください。

. link:update-replication-relationship-manual-task.html["手動によるレプリケーション関係の更新"]の説明に従って、ミラー関係を更新します。
+
または、スケジュールされたミラー関係の更新が実行されるまで待つこともできます。

. ラベル付けされたスナップショットを Vault のデスティネーションに転送します：
+
`snapmirror update -source-path <SVM:volume>|<cluster://SVM/volume>, ... -destination-path <SVM:volume>|<cluster://SVM/volume>, ... -source-snapshot snapshot`

+
次の例では `snap1`スナップショットを転送します::
+
--
[listing]
----
clust1::> snapmirror update -vserver vs1 -volume vol1
-source-snapshot snap1
----
ボールト関係が更新されても、ラベル付けされた Snapshot は保持されます。

 `snapmirror update`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-update.html["ONTAPコマンド リファレンス"^]をご覧ください。

--


. ソース ボリュームで、ラベルの付いたスナップショットから所有者を削除します：
+
`snapmirror snapshot-owner delete -vserver _SVM_ -volume _volume_ -snapshot _snapshot_ -owner _owner_`

+
次の例では、 `snap1`スナップショットの所有者として `ApplicationA`を削除します：

+
[listing]
----
clust1::> snapmirror snapshot-owner delete -vserver vs1 -volume vol1
-snapshot snap1 -owner ApplicationA
----
+
 `snapmirror snapshot-owner delete`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-snapshot-owner-delete.html["ONTAPコマンド リファレンス"^]を参照してください。


