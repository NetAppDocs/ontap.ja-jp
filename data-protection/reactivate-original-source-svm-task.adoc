---
permalink: data-protection/reactivate-original-source-svm-task.html 
sidebar: sidebar 
keywords: reactivate, original, source, svm, quick resync, resynchronize, reverse resync 
summary: デスティネーションからデータを提供する必要がなくなった場合は、ソースSVMとデスティネーションSVMの間で元のデータ保護関係を再確立できます。この手順は、1つの例外を除き、ボリューム レプリケーションの手順とほぼ同じです。ソースSVMを再アクティブ化する前に、デスティネーションSVMを停止する必要があります。 
---
= 元のONTAP SnapMirrorソースSVMを再アクティブ化する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
デスティネーションからデータを提供する必要がなくなった場合は、ソースSVMとデスティネーションSVMの間で元のデータ保護関係を再確立できます。この手順は、1つの例外を除き、ボリューム レプリケーションの手順とほぼ同じです。ソースSVMを再アクティブ化する前に、デスティネーションSVMを停止する必要があります。

.開始する前に
* デスティネーション ボリュームからデータを提供している間にそのサイズを拡張した場合は、ソース ボリュームを再アクティブ化する前に、元のソース ボリュームを十分拡張できるようにmax-autosizeを手動で増やす必要があります。


link:destination-volume-grows-automatically-concept.html["デスティネーション ボリュームが自動的に拡張される状況"]


WARNING: クラスタ管理者は、データの損失を避けるために、元のソース SVM を再アクティブ化する前に、クライアントからの書き込みを一時停止する必要があります。

.タスク概要
ONTAP 9.11.1以降では、SVM DR関係の逆再同期を実行する際に `snapmirror resync`コマンドのCLI `-quick-resync true`オプションを使用することで、ディザスタリカバリのリハーサル中の再同期時間を短縮できます。クイック再同期によりデータ ウェアハウスの再構築とリストア処理をバイパスできるため、本番環境への復帰にかかる時間を短縮できます。link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-resync.html["ONTAPコマンド リファレンス"^]の `snapmirror resync`の詳細をご覧ください。


NOTE: クイック再同期では、デスティネーション ボリュームのストレージ効率は維持されません。クイック再同期を有効にすると、デスティネーション ボリュームで使用されるボリューム スペースが増加する可能性があります。

この手順は、元のソース ボリュームにあるベースラインが損なわれていないことを前提としています。ベースラインが損なわれている場合は、この手順を実行する前に、データの提供元のボリュームと元のソース ボリュームの間の関係を作成して初期化する必要があります。

ONTAP 9.8以降では、System Managerを使用して、災害発生後にソースStorage VMを再アクティブ化できます。

.手順
このタスクは、System Manager または ONTAP CLI を使用して実行できます。

[role="tabbed-block"]
====
.System Manager ONTAP 9.17.1 以降
--
. デスティネーション クラスタで、必要な保護関係を選択します：*保護 > レプリケーション*をクリックします。
. ソース名の上にカーソルを合わせてimage:icon_kabob.gif["メニューオプションアイコン"]をクリックし、*逆再同期*をクリックします。
. *逆再同期関係*ウィンドウで、*逆再同期*をクリックします。
+
関係は *Replication* テーブルから消え、元のソース クラスタによって管理されるようになります。

. 元のソース クラスターで、*Protection > Replication* をクリックし、状態に *Mirrored* と表示されていることを確認し、逆再同期が完了したことを確認します。
. 元のデスティネーション クラスタで、*クラスター > ストレージ VM* に移動します。
. ストレージ VM を見つけて、ストレージ VM 名の上にカーソルを置き、image:icon_kabob.gif["メニューオプションアイコン"]をクリックして、*停止*をクリックします。
. *ストレージ VM の停止*ウィンドウで、*停止*をクリックします。
. ソース クラスタで、*[保護] > [レプリケーション]* に移動し、再アクティブ化するストレージ VM を見つけて、ストレージ VM 名の上にカーソルを移動し、image:icon_kabob.gif["メニューオプションアイコン"] をクリックして、*[デスティネーション ストレージ VM のアクティブ化]* をクリックします。
. *デスティネーション Storage VM のアクティブ化*ウィンドウで、*デスティネーション Storage VM をアクティブ化して関係を解除*を選択し、*アクティブ化*をクリックします。
. *レプリケーション* ページに戻ったら、もう一度カーソルをストレージ VM 名の上に置いてimage:icon_kabob.gif["メニューオプションアイコン"]をクリックし、*逆再同期* をクリックします。


--
.System Manager ONTAP 9.16.1 以前
--
. デスティネーション クラスタで、必要な保護関係を選択します：*[保護] > [関係]*をクリックします。
. ソース名の上にカーソルを合わせてimage:icon_kabob.gif["メニューオプションアイコン"]をクリックし、*逆再同期*をクリックします。
. *逆再同期関係*ウィンドウで、*逆再同期*をクリックします。
+
リレーションシップは元のソース クラスタによって管理されるようになったため、*Relationships* テーブルから消えます。

. 元のソース クラスターで、*Protection > Relationships* をクリックし、状態が *Mirrored* と表示されていることを確認し、逆再同期が完了したことを確認します。
. 元のデスティネーション クラスタで、*ストレージ > ストレージ VM* に移動します。
. ストレージ VM を見つけて、ストレージ VM 名の上にカーソルを置き、image:icon_kabob.gif["メニューオプションアイコン"]をクリックして、*停止*をクリックします。
. *ストレージ VM の停止*ウィンドウで、*停止*をクリックします。
. ソース クラスタで、ストレージ VM（反転された関係のソース SVM）を見つけ、SVM 名の上にカーソルを合わせて image:icon_kabob.gif["メニューオプションアイコン"] をクリックし、*宛先ストレージ VM のアクティブ化* をクリックします。
. *デスティネーション Storage VM のアクティブ化*ウィンドウで、*デスティネーション Storage VM をアクティブ化して関係を解除*を選択し、*アクティブ化*をクリックします。
. *関係* ページに戻ったら、もう一度カーソルをストレージ VM 名の上に置いてimage:icon_kabob.gif["メニューオプションアイコン"]をクリックし、*逆再同期* をクリックします。


--
.CLI
--
. 元のソースSVMまたはソース クラスタから、元のSVM DR関係と同じ設定、ポリシー、およびidentity-preserve設定を使用して、反転したSVM DR関係を作成します。
+
[source, cli]
----
snapmirror create -source-path <SVM>: -destination-path <SVM>:
----
+

NOTE:  `-source-path`および `-destination-path`オプションでは、SVM名の後にコロン（：）を入力する必要があります。以下の例をご覧ください。

+
次の例では、データの提供元となる SVM `svm_backup`と元のソース SVM `svm1`の間に関係を作成します：

+
[listing]
----
cluster_src::> snapmirror create -source-path svm_backup: -destination-path svm1:
----
+
 `snapmirror create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-create.html["ONTAPコマンド リファレンス"^]を参照してください。

. 元のソースSVMまたはソース クラスタから次のコマンドを実行して、データ保護関係を反転します。
+
[source, cli]
----
snapmirror resync -source-path <SVM>: -destination-path <SVM>:
----
+

NOTE:  `-source-path`および `-destination-path`オプションでは、SVM名の後にコロン（：）を入力する必要があります。以下の例をご覧ください。

+
再同期の際にベースライン転送は不要ですが、再同期には時間がかかる場合があります。再同期はオフピークの時間帯に実行することを推奨します。

+

NOTE: ソースとデスティネーションに共通の Snapshot が存在しない場合、コマンドは失敗します。 `snapmirror initialize`を使用して関係を再初期化します。

+
次の例では、元のソース SVM `svm1`とデータの提供元となる SVM `svm_backup`の関係を反転します：

+
[listing]
----
cluster_src::> snapmirror resync -source-path svm_backup: -destination-path svm1:
----
+
-quick-resyncオプションの使用例：

+
[listing]
----
cluster_src::> snapmirror resync -source-path svm_backup: -destination-path svm1: -quick-resync true
----
. 元のソースSVMへのデータ アクセスを再確立する準備ができたら、元のデスティネーションSVMを停止してSVMに接続されているクライアントをすべて切断します。
+
[source, cli]
----
vserver stop -vserver <SVM>
----
+
次の例は、現在データを提供している元のデスティネーションSVMを停止します。

+
[listing]
----
cluster_dst::> vserver stop svm_backup
----
.  `vserver show`コマンドを使用して、元のデスティネーション SVM が停止状態になっていることを確認します。
+
[listing]
----
cluster_dst::> vserver show
                                  Admin      Operational Root
Vserver        Type    Subtype    State      State       Volume     Aggregate
--------       ------- ---------- ---------- ----------- ---------- ----------
svm_backup     data    default    stopped    stopped     rv         aggr1
----
. 元のソースSVMまたはソース クラスタから次のコマンドを実行して反転した関係を最後にもう一度更新し、元のデスティネーションSVMから元のソースSVMにすべての変更を転送します。
+
[source, cli]
----
snapmirror update -source-path <SVM>: -destination-path <SVM>:
----
+

NOTE:  `-source-path`および `-destination-path`オプションでは、SVM名の後にコロン（：）を入力する必要があります。以下の例をご覧ください。

+
次の例では、データの提供元である元のデスティネーション SVM,`svm_backup`と元のソース SVM `svm1`の関係を更新します：

+
[listing]
----
cluster_src::> snapmirror update -source-path svm_backup: -destination-path svm1:
----
+
 `snapmirror update`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-update.html["ONTAPコマンド リファレンス"^]をご覧ください。

. 元のソースSVMまたはソース クラスタから次のコマンドを実行して、反転した関係のスケジュールされた転送を停止します。
+
[source, cli]
----
snapmirror quiesce -source-path <SVM>: -destination-path <SVM>:
----
+

NOTE:  `-source-path`および `-destination-path`オプションでは、SVM名の後にコロン（：）を入力する必要があります。以下の例をご覧ください。

+
次の例では、データの提供元である SVM `svm_backup`と元の SVM `svm1`の間のスケジュールされた転送を停止します：

+
[listing]
----
cluster_src::> snapmirror quiesce -source-path svm_backup: -destination-path svm1:
----
. 最後の更新が完了して関係のステータスが「Quiesced」になったら、元のソースSVMまたは元のソース クラスタから次のコマンドを実行して反転した関係を解除します。
+
[source, cli]
----
snapmirror break -source-path <SVM>: -destination-path <SVM>:
----
+

NOTE:  `-source-path`および `-destination-path`オプションでは、SVM名の後にコロン（：）を入力する必要があります。以下の例をご覧ください。

+
次の例では、データの提供元である元のデスティネーション SVM `svm_backup`と元のソース SVM `svm1`の関係を解除します：

+
[listing]
----
cluster_src::> snapmirror break -source-path svm_backup: -destination-path svm1:
----
+
 `snapmirror break`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-break.html["ONTAPコマンド リファレンス"^]を参照してください。

. 元のソースSVMを停止していた場合は、元のソース クラスタから元のソースSVMを起動します。
+
[source, cli]
----
vserver start -vserver <SVM>
----
+
次の例は、元のソースSVMを起動します。

+
[listing]
----
cluster_src::> vserver start svm1
----
. 元のデスティネーションSVMまたはデスティネーション クラスタから、元のデータ保護関係を再確立します。
+
[source, cli]
----
snapmirror resync -source-path <SVM>: -destination-path <SVM>:
----
+

NOTE:  `-source-path`および `-destination-path`オプションでは、SVM名の後にコロン（：）を入力する必要があります。以下の例をご覧ください。

+
次の例では、元のソース SVM `svm1`と元のデスティネーション SVM `svm_backup`の関係を再確立します：

+
[listing]
----
cluster_dst::> snapmirror resync -source-path svm1: -destination-path svm_backup:
----
. 元のソースSVMまたはソース クラスタから次のコマンドを実行して、反転したデータ保護関係を削除します。
+
[source, cli]
----
snapmirror delete -source-path <SVM>: -destination-path <SVM>:
----
+

NOTE:  `-source-path`および `-destination-path`オプションでは、SVM名の後にコロン（：）を入力する必要があります。以下の例をご覧ください。

+
次の例では、元のデスティネーション SVM `svm_backup`と元のソース SVM `svm1`間の逆の関係を削除します：

+
[listing]
----
cluster_src::> snapmirror delete -source-path svm_backup: -destination-path svm1:
----
. 元のデスティネーションSVMまたはデスティネーション クラスタから、反転したデータ保護関係をリリースします。
+
[source, cli]
----
snapmirror release -source-path <SVM>: -destination-path <SVM>:
----
+

NOTE:  `-source-path`および `-destination-path`オプションでは、SVM名の後にコロン（：）を入力する必要があります。以下の例をご覧ください。

+
次の例では、元のデスティネーション SVM である svm_backup と元のソース SVM 間の逆の関係を解除します。 `svm1`

+
[listing]
----
cluster_dst::> snapmirror release -source-path svm_backup: -destination-path svm1:
----


--
====
.次の手順
*  `snapmirror show`コマンドを使用して、SnapMirror関係が作成されたことを確認します。
+
 `snapmirror show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-show.html["ONTAPコマンド リファレンス"^]を参照してください。

* クライアントから元のソース SVM への書き込み操作を再開します。


.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-create.html["snapmirror create"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-delete.html["snapmirror delete"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-initialize.html["snapmirror initialize"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-quiesce.html["snapmirror quiesce"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-release.html["snapmirror release"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-resync.html["snapmirror resync"^]

