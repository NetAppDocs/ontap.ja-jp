---
permalink: data-protection/replicate-entire-svm-config-task.html 
sidebar: sidebar 
keywords: replicate, entire, svm, storage vm, disaster, protection, configuration, snapmirror, snap mirror, replication, mirror vault policy, snapshot 
summary: SVMディザスタ リカバリ（SVM DR）関係を作成して、SVMの設定を別のSVMにレプリケートできます。プライマリ サイトで災害が発生したときに、デスティネーションSVMを迅速にアクティブ化できます。 
---
= ONTAP SVM構成全体を複製する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SVMディザスタ リカバリ（SVM DR）関係を作成して、SVMの設定を別のSVMにレプリケートできます。プライマリ サイトで災害が発生したときに、デスティネーションSVMを迅速にアクティブ化できます。

.開始する前に
ソース クラスタとデスティネーション クラスタおよび SVM はピアリングされている必要があります。詳細については、link:../peering/create-cluster-relationship-93-later-task.html["クラスタ ピア関係の作成"]およびlink:../peering/create-intercluster-svm-peer-relationship-93-later-task.html["SVMクラスタ間ピア関係を作成する"]を参照してください。

この手順で説明されているコマンドの詳細については、link:https://docs.netapp.com/us-en/ontap-cli/["ONTAPコマンド リファレンス"^]を参照してください。

.タスク概要
このワークフローでは、デフォルト ポリシーまたはカスタム レプリケーション ポリシーをすでに使用していることを前提としています。

ONTAP 9.9.1以降では、mirror-vaultポリシーを使用する場合、ソースSVMとデスティネーションSVMで異なるSnapshotポリシーを作成でき、デスティネーションのSnapshotがソースのSnapshotによって上書きされることはありません。詳細については、link:snapmirror-svm-replication-concept.html["SnapMirror SVMレプリケーションの概要"]を参照してください。

この手順は、デスティネーションから実行してください。新しい保護ポリシーを作成する必要がある場合（例えば、ソース ストレージVMにSMBが設定されている場合など）は、ポリシーを作成し、*Identity preserve*オプションを使用してください。詳細については、link:create-custom-replication-policy-concept.html["カスタムのデータ保護ポリシーの作成"]を参照してください。

.手順
このタスクは、System ManagerまたはONTAP CLIから実行できます。

[role="tabbed-block"]
====
.System Manager
--
. デスティネーション クラスタで、*保護 > 関係*をクリックします。
. *関係*で、*保護*をクリックし、*Storage VM（DR）*を選択します。
. 保護ポリシーを選択します。カスタムの保護ポリシーを作成した場合は、そのポリシーを選択してから、レプリケートするソース クラスタとStorage VMを選択します。新しいStorage VM名を入力して新しいデスティネーションStorage VMを作成することもできます。
. 必要に応じて、デスティネーションの設定を変更し、ID保持を上書きするかどうか、ネットワーク インターフェイスおよびプロトコルを含めるか除外するかを指定します。
. *保存*をクリックします。


--
.CLI
--
. デスティネーションSVMを作成します。
+
[source, cli]
----
vserver create -vserver <SVM_name> -subtype dp-destination
----
+
SVM名はソース クラスタとデスティネーション クラスタの間で一意である必要があります。

+
次の例では、 `svm_backup`という名前のデスティネーション SVM を作成します：

+
[listing]
----
cluster_dst:> vserver create -vserver svm_backup -subtype dp-destination
----
+
 `vserver create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/vserver-create.html["ONTAPコマンド リファレンス"^]を参照してください。

. デスティネーション クラスタから、 `vserver peer create`コマンドを使用して SVM ピア関係を作成します。
+
詳細については、link:../peering/create-intercluster-svm-peer-relationship-93-later-task.html["SVMクラスタ間ピア関係を作成する"]を参照してください。

+
 `vserver peer create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/vserver-peer-create.html["ONTAPコマンド リファレンス"^]をご覧ください。

. レプリケーション ジョブ スケジュールを作成します。
+
[source, cli]
----
job schedule cron create -name <job_name> -month <month> -dayofweek <day_of_week> -day <day_of_month> -hour <hour> -minute <minute>
----
+
 `-month`、 `-dayofweek`、および `-hour`の場合、 `all`を指定して、それぞれ毎月、曜日ごと、および時間ごとにジョブを実行できます。

+

NOTE: SVM SnapMirror関係のFlexVolに設定可能な最短スケジュール（RPO）は15分です。SVM SnapMirror関係のFlexGroupボリュームに設定可能な最短スケジュール（RPO）は30分です。

+
次の例では、土曜日の午前3：00に実行される `my_weekly`という名前のジョブ スケジュールを作成します：

+
[listing]
----
cluster_dst::> job schedule cron create -name my_weekly -dayofweek saturday -hour 3 -minute 0
----
+
 `job schedule cron create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/job-schedule-cron-create.html["ONTAPコマンド リファレンス"^]を参照してください。

. デスティネーションSVMまたはデスティネーション クラスタから、レプリケーション関係を作成します。
+
[source, cli]
----
snapmirror create -source-path <SVM_name>: -destination-path <SVM_name>: -type <DP|XDP> -schedule <schedule> -policy <policy> -identity-preserve true
----
+

NOTE:  `-source-path`および `-destination-path`オプションでは、SVM 名の後にコロン（：）を入力する必要があります。

+
次の例では、デフォルト `MirrorAllSnapshots`ポリシーを使用してSnapMirror DR関係を作成します：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1: -destination-path svm_backup: -type XDP -schedule my_daily -policy MirrorAllSnapshots -identity-preserve true
----
+
次の例では、デフォルトの `MirrorAndVault`ポリシーを使用して統合レプリケーション関係を作成します：

+
[listing]
----
cluster_dst:> snapmirror create -source-path svm1: -destination-path svm_backup: -type XDP -schedule my_daily -policy MirrorAndVault -identity-preserve true
----
+
ポリシー タイプ `async-mirror`でカスタム ポリシーを作成したと仮定すると、次の例ではSnapMirror DR関係が作成されます：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1: -destination-path svm_backup: -type XDP -schedule my_daily -policy my_mirrored -identity-preserve true
----
+
ポリシー タイプ `mirror-vault`でカスタム ポリシーを作成したと仮定すると、次の例では統合レプリケーション関係が作成されます：

+
[listing]
----
cluster_dst::> snapmirror create -source-path svm1: -destination-path svm_backup: -type XDP -schedule my_daily -policy my_unified -identity-preserve true
----
+
 `snapmirror create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-create.html["ONTAPコマンド リファレンス"^]を参照してください。

. デスティネーションSVMを停止します。
+
[source, cli]
----
vserver stop -vserver <SVM_name>
----
+
次の例は、svm_backupという名前のデスティネーションSVMを停止します。

+
[listing]
----
cluster_dst::> vserver stop -vserver svm_backup
----
+
 `vserver stop`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/vserver-stop.html["ONTAPコマンド リファレンス"^]を参照してください。

. デスティネーションSVMまたはデスティネーション クラスタから、SVMレプリケーション関係を初期化します。
+
[source, cli]
----
snapmirror initialize -source-path <SVM_name>: -destination-path <SVM_name>:
----
+

NOTE:  `-source-path`および `-destination-path`オプションでは、SVM 名の後にコロン（：）を入力する必要があります。

+
次の例では、ソース SVM `svm1`とデスティネーション SVM `svm_backup`の関係を初期化します：

+
[listing]
----
cluster_dst::> snapmirror initialize -source-path svm1: -destination-path svm_backup:
----
+
 `snapmirror initialize`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-initialize.html["ONTAPコマンド リファレンス"^]を参照してください。



--
====