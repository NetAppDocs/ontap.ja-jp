---
permalink: data-protection/restore-volume-snapvault-backup-task.html 
sidebar: sidebar 
keywords: restore, content, volume, snapmirror, destination, snap mirror, snapshot, vault, snapvault, read-write, incremental 
summary: SnapMirrorデスティネーション ボリュームのSnapshotからボリューム全体の内容をリストアできます。ボリュームの内容を元のソース ボリュームまたは別のボリュームにリストアできます。 
---
= ONTAP SnapMirrorデスティネーションからボリュームの内容を復元する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SnapMirrorデスティネーション ボリュームのSnapshotからボリューム全体の内容をリストアできます。ボリュームの内容を元のソース ボリュームまたは別のボリュームにリストアできます。

.タスク概要
この手順は、FAS、AFF、およびASAシステムに適用されます。ASA r2システム（ASA A1K、ASA A90、ASA A70、ASA A50、ASA A30、ASA A20、またはASA C30）をご利用の場合は、link:https://docs.netapp.com/us-en/asa-r2/data-protection/restore-data.html["これらの手順"^]に従ってデータを復元してください。ASA r2システムは、SANのみをご利用のお客様向けに、簡素化されたONTAPエクスペリエンスを提供します。

リストア処理のデスティネーション ボリュームは次のいずれかにする必要があります。

* 読み取り / 書き込みボリュームの場合、SnapMirrorはソース ボリュームとデスティネーション ボリュームに共通のSnapshotがあれば（元のソース ボリュームにリストアする場合が一般的）、_増分リストア_を実行します。
+
[NOTE]
====
共通Snapshotがない場合、コマンドは失敗します。ボリュームの内容を空の読み取り / 書き込みボリュームにリストアすることはできません。

====
* 空のデータ保護ボリューム。この場合、SnapMirrorは_ベースライン復元_を実行し、指定されたスナップショットとそれが参照するすべてのデータ ブロックがソース ボリュームに転送されます。


ボリュームの内容のリストアはシステム停止を伴う処理です。リストア処理を実行しているときに、SnapVaultプライマリ ボリューム上でSMBトラフィックを実行してはなりません。

リストア処理のデスティネーション ボリュームで圧縮が有効になっていて、ソース ボリュームで圧縮が有効になっていない場合は、デスティネーション ボリュームで圧縮を無効にします。リストア処理が完了したら、圧縮を再度有効にする必要があります。

復元を実行する前に、デスティネーション ボリュームに定義されているクォータ ルールはすべて無効になります。 `volume quota modify`コマンドを使用して、復元処理の完了後にクォータ ルールを再度有効にすることができます。

ボリューム内のデータが失われたり破損したりした場合は、以前のSnapshotから復元することでデータをロールバックできます。

この手順では、ソースボリューム上の現在のデータを以前のスナップショットバージョンのデータに置き換えます。このタスクはデスティネーション クラスタで実行する必要があります。

.手順
ボリュームの内容は、System ManagerまたはONTAP CLIを使用してリストアできます。

[role="tabbed-block"]
====
.System Manager
--
. *[保護] > [関係]*をクリックし、ソース ボリュームの名前をクリックします。
. image:icon_kabob.gif["メニューオプションアイコン"]をクリックし、*復元*を選択します。
. *Source*では、デフォルトでソース ボリュームが選択されています。ソース以外のボリュームを選択する場合は、*Other Volume*をクリックしてください。
. *Destination*で、復元するスナップショットを選択します。
. ソースとデスティネーションのクラスタが異なる場合は、リモート クラスタで*[保護] > [関係]*をクリックしてリストアの進捗を監視します。


--
.CLI
--
. デスティネーション ボリューム内のSnapshotを一覧表示します：
+
[source, cli]
----
volume snapshot show -vserver <SVM> -volume <volume>
----
+
次の例は、 `vserverB:secondary1`デスティネーションのSnapshotを示しています：

+
[listing]
----

cluster_dst::> volume snapshot show -vserver vserverB -volume secondary1

Vserver     Volume      Snapshot                State    Size  Total% Used%
-------     ------      ---------- ----------- ------   -----  ------ -----
vserverB    secondary1  hourly.2013-01-25_0005  valid   224KB     0%    0%
                        daily.2013-01-25_0010   valid   92KB      0%    0%
                        hourly.2013-01-25_0105  valid   228KB     0%    0%
                        hourly.2013-01-25_0205  valid   236KB     0%    0%
                        hourly.2013-01-25_0305  valid   244KB     0%    0%
                        hourly.2013-01-25_0405  valid   244KB     0%    0%
                        hourly.2013-01-25_0505  valid   244KB     0%    0%

7 entries were displayed.
----
. SnapMirrorデスティネーション ボリュームのSnapshotからボリュームの内容をリストアします：
+
`snapmirror restore -source-path <SVM:volume>|<cluster://SVM/volume> -destination-path <SVM:volume>|<cluster://SVM/volume> -source-snapshot <snapshot>`

+

NOTE: このコマンドは元のソースSVMまたは元のソース クラスタから実行する必要があります。

+
次のコマンドは、元のデスティネーション ボリューム `secondary1`のSnapshot `daily.2013-01-25_0010`から元のソース ボリューム `primary1`の内容を復元します：

+
[listing]
----
cluster_src::> snapmirror restore -source-path vserverB:secondary1 -destination-path vserverA:primary1 -source-snapshot daily.2013-01-25_0010

Warning: All data newer than snapshot daily.2013-01-25_0010 on volume vserverA:primary1 will be deleted.

Do you want to continue? {y|n}: y

[Job 34] Job is queued: snapmirror restore from source vserverB:secondary1 for the snapshot daily.2013-01-25_0010.
----
. リストアしたボリュームを再マウントし、ボリュームを使用するすべてのアプリケーションを再起動します。


--
====


== ONTAPでこの処理を行うその他の方法

[cols="2"]
|===
| タスクを実行するツール | 参照するコンテンツ 


| System Manager Classic（ONTAP 9.7以前で使用可能） | link:https://docs.netapp.com/us-en/ontap-system-manager-classic/volume-restore-snapvault/index.html["SnapVaultを使用したボリューム復元の概要"^] 
|===
.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-restore.html["snapmirror restore"^]
* link:https://docs.netapp.com/us-en/ontap-cli/volume-snapshot-show.html["volume snapshot show"^]

