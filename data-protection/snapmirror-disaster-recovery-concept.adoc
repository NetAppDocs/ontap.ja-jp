---
permalink: data-protection/snapmirror-disaster-recovery-concept.html 
sidebar: sidebar 
keywords: asynchronous, snapmirror, disaster, recovery basics 
summary: SnapMirrorは、地理的に離れたサイトのプライマリ ストレージからセカンダリ ストレージへのフェイルオーバー用に設計されたディザスタ リカバリ テクノロジです。名前が示すように、SnapMirrorは本番データの複製（ミラー）をセカンダリ ストレージに作成し、プライマリ サイトに災害が発生しても、セカンダリ ストレージから引き続きデータを提供できるようにします。 
---
= ONTAP SnapMirror非同期ディザスタリカバリについて学ぶ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
_SnapMirror_ は、地理的に離れたサイトにあるプライマリ ストレージからセカンダリ システムへのフェイルオーバーを目的とした災害復旧テクノロジーです。その名の通り、SnapMirrorはセカンダリ ストレージに作業データのレプリカ（_ミラー_）を作成します。プライマリ サイトで災害が発生した場合でも、このミラーから引き続きデータを提供できます。

プライマリ サイトがまだデータを提供できる状態であれば、必要なデータをプライマリ サイトに転送するだけで、ミラー サイトからのクライアントへのデータ提供は一切不要になります。フェイルオーバーのユース ケースからもわかるように、セカンダリ システムのコントローラーは、ミラー ストレージから効率的にデータを提供するために、プライマリ システムのコントローラーと同等、またはほぼ同等である必要があります。



== データ保護関係

データはボリュームレベルでミラーリングされます。プライマリストレージのソースボリュームとセカンダリストレージのデスティネーションボリュームの関係は、_データ保護関係_と呼ばれます。ボリュームが存在するクラスタと、ボリュームからデータを提供するSVMは、link:../peering/index.html["ピア関係にある"]必要があります。ピア関係により、クラスタとSVMは安全にデータを交換できます。

この図はSnapMirrorデータ保護関係を示しています：

image:snapmirror-for-dp-pg.gif["SnapMirrorデータ保護関係の図解"]



== データ保護関係の範囲

データ保護関係は、ボリューム間またはボリュームを所有するSVM間で直接作成できます。_SVMデータ保護関係_では、NFSエクスポート、SMB共有、RBACなど、SVM設定のすべてまたは一部がレプリケートされ、SVMが所有するボリューム内のデータもレプリケートされます。

次に示す特殊なデータ保護アプリケーションにSnapMirrorを使用することもできます。

* SVMルート ボリュームの_負荷共有ミラー_ コピーにより、ノードの停止やフェイルオーバーが発生した場合でもデータへのアクセスが維持されます。
* _SnapLock ボリューム_間のデータ保護関係により、WORM ファイルをセカンダリ ストレージにレプリケートできます。
+
link:../snaplock/index.html["SnapLockテクノロジを使用したアーカイブとコンプライアンス"]

* ONTAP 9.13.1以降では、SnapMirror非同期レプリケーションを使用してxref:../consistency-groups/index.html[整合性グループ]を保護できます。ONTAP 9.14.1以降では、SnapMirror非同期レプリケーションを使用して、整合性グループ関係によりボリューム単位のスナップショットをデスティネーション クラスタにレプリケートできます。詳細については、xref:../consistency-groups/protect-task.html#configure-snapmirror-asynchronous[SnapMirror非同期保護を構成する]を参照してください。




== SnapMirrorデータ保護関係を初期化する方法

SnapMirrorを初めて起動すると、ソース ボリュームからデスティネーション ボリュームへの_ベースライン転送_が実行されます。関係の_SnapMirrorポリシー_によって、ベースラインの内容と更新内容が定義されます。

デフォルトのSnapMirrorポリシーによるベースライン転送には `MirrorAllSnapshots`、次の手順が含まれます：

* ソースボリュームのスナップショットを作成します。
* スナップショットとそれが参照するすべてのデータ ブロックを宛先ボリュームに転送します。
* 「`active`」ミラーが破損した場合に備えて、ソース ボリュームに残っている、それほど新しくないスナップショットを宛先ボリュームに転送します。




== SnapMirrorデータ保護関係を更新する方法

更新は非同期で、設定したスケジュールに従って行われます。保持期間はソースのSnapshotポリシーを反映します。

 `MirrorAllSnapshots`ポリシーに基づく更新のたびに、SnapMirrorはソースボリュームのスナップショットを作成し、そのスナップショットと前回の更新以降に作成されたスナップショットを転送します。 `MirrorAllSnapshots`ポリシーの `snapmirror policy show`コマンドからの次の出力では、次の点に注意してください：

* `Create Snapshot`が「`true`」の場合、 `MirrorAllSnapshots`がSnapMirror関係を更新するときにスナップショットを作成することを示します。
* `MirrorAllSnapshots`には、ルール "`sm_created`" と "`all_source_snapshots`" があり、SnapMirrorによって作成されたスナップショットと、最後の更新以降に作成されたスナップショットの両方が、SnapMirrorが関係を更新するときに転送されることを示します。


[listing]
----
cluster_dst::> snapmirror policy show -policy MirrorAllSnapshots -instance

                     Vserver: vs0
      SnapMirror Policy Name: MirrorAllSnapshots
      SnapMirror Policy Type: async-mirror
                Policy Owner: cluster-admin
                 Tries Limit: 8
           Transfer Priority: normal
   Ignore accesstime Enabled: false
     Transfer Restartability: always
 Network Compression Enabled: false
             Create Snapshot: true
                     Comment: SnapMirror asynchronous policy for mirroring all snapshots
                              and the latest active file system.
       Total Number of Rules: 2
                  Total Keep: 2
                       Rules: SnapMirror Label     Keep  Preserve Warn Schedule Prefix
                              ----------------     ----  -------- ---- -------- ------
                              sm_created              1  false       0 -        -
                              all_source_snapshots    1  false       0 -        -
----


== MirrorLatestポリシー

事前設定された `MirrorLatest`ポリシーは `MirrorAllSnapshots`とまったく同じように動作しますが、初期化および更新時にSnapMirrorによって作成されたスナップショットのみが転送される点が異なります。

[listing]
----

                       Rules: SnapMirror Label     Keep  Preserve Warn Schedule Prefix
                              ----------------     ----  -------- ---- -------- ------
                              sm_created              1  false       0 -        -
----
.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-show.html["snapmirror policy show"^]

