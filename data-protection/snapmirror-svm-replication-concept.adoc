---
permalink: data-protection/snapmirror-svm-replication-concept.html 
sidebar: sidebar 
keywords: understand, snapmirror, svm, replication, SVM disaster recovery storage limits 
summary: SnapMirrorを使用して、SVM間のデータ保護関係を作成できます。このタイプのデータ保護関係では、NFSエクスポートやSMB共有からRBACまで、SVMの設定のすべてまたは一部と、SVMが所有するボリューム内のデータがレプリケートされます。 
---
= ONTAP SnapMirror SVMレプリケーションについて学ぶ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SnapMirrorを使用すると、SVM間のデータ保護関係を作成できます。このタイプのデータ保護関係では、SVMのすべてまたは一部の設定がNFSエクスポートおよびSMB共有からRBACにレプリケートされます。また、SVMが所有するボリューム内のデータもレプリケートされます。



== サポートされている関係タイプ

レプリケート可能なのはデータ提供用SVMのみです。サポートされているデータ保護関係タイプは次のとおりです。

* _SnapMirror DR_ では、通常、デスティネーションには現在ソースにあるスナップショットのみが含まれます。
+
ONTAP 9.9.1以降では、mirror-vaultポリシーを使用している場合、この動作が変更されます。ONTAP 9.9.1以降では、ソースとデスティネーションで異なるSnapshotポリシーを作成でき、デスティネーションのSnapshotがソースのSnapshotによって上書きされることはありません：

+
** 通常のスケジュールされた操作、更新、再同期中にソースからデスティネーションに上書きされることはありません。
** ブレーク操作では削除されません。
** これらは、フリップ再同期操作では削除されません。ONTAP 9.9.1以降でミラー・ヴォールト・ポリシーを使用してSVM災害関係を設定する場合、ポリシーは次のように動作します：
** ソースのユーザー定義のSnapshotポリシーは、デスティネーションにコピーされません。
** システム定義のスナップショット ポリシーはデスティネーションにコピーされません。
** ユーザーおよびシステム定義のスナップショット ポリシーとのボリュームの関連付けは、デスティネーションにコピーされません。+ SVM。


* _SnapMirror 統合レプリケーション_ では、デスティネーションは DR と長期保存の両方に対して構成されます。


SnapMirror統合レプリケーションの詳細については、link:snapmirror-unified-replication-concept.html["SnapMirrorユニファイド レプリケーションの基本"]を参照してください。

レプリケーション ポリシーの_ポリシー タイプ_によって、サポートされる関係の種類が決まります。次の表に、使用可能なポリシー タイプを示します。

[cols="2*"]
|===


| ポリシー タイプ | 関係タイプ 


 a| 
async-mirror
 a| 
SnapMirror DR



 a| 
mirror-vault
 a| 
ユニファイド レプリケーション

|===


== ONTAP 9.4におけるSVMレプリケーションのデフォルトの変更（DP→XDP）

ONTAP 9.4以降では、SVMデータ保護関係のデフォルトがXDPモードに変更されました。ONTAP 9.3以前のSVMデータ保護関係のデフォルトは引き続きDPモードです。

既存のリレーションシップはXDPのデフォルト設定の影響を受けません。リレーションシップが既にDPタイプである場合は、引き続きDPタイプのままとなります。次の表に、想定される動作を示します。

[cols="3*"]
|===


| 指定するモード | タイプ | デフォルト ポリシー（ポリシーを指定しない場合） 


 a| 
DP
 a| 
XDP
 a| 
MirrorAllSnapshots（SnapMirror DR）



 a| 
なし
 a| 
XDP
 a| 
MirrorAllSnapshots（SnapMirror DR）



 a| 
XDP
 a| 
XDP
 a| 
MirrorAndVault（ユニファイド レプリケーション）

|===
DP リレーションシップを XDP リレーションシップに変換する方法やその他の詳細については、こちらをご覧ください：link:convert-snapmirror-version-flexible-task.html["既存のONTAP DPタイプ関係をXDPに変換する"]

[NOTE]
====
バージョンに依存しないレプリケーションは、SVMレプリケーションではサポートされません。SVMディザスタ リカバリ構成では、フェイルオーバー処理とフェイルバック処理をサポートするためには、ソースSVMクラスタと同じバージョンのONTAPを実行しているクラスタにデスティネーションSVMを配置する必要があります。

====
link:compatible-ontap-versions-snapmirror-concept.html["SnapMirror関係に対応したONTAPバージョン"]



== SVMの設定のレプリケート方法

SVMレプリケーション関係の内容は、以下に示すフィールドの設定の組み合わせによって決定されます。

*  `snapmirror create`コマンドの `-identity-preserve true`オプションは、SVM構成全体を複製します。
+
 `-identity-preserve false`オプションは、SVMのボリュームと認証および承認の設定、およびlink:snapmirror-svm-replication-concept.html#configurations-replicated-in-svm-disaster-recovery-relationships["SVMディザスタ リカバリ関係でレプリケートされる設定"]にリストされているプロトコルとネーム サービスの設定のみを複製します。

*  `snapmirror policy create`コマンドの `-discard-configs network`オプションは、ソースSVMとデスティネーションSVMが異なるサブネットにある場合に使用するために、LIFと関連するネットワーク設定をSVMレプリケーションから除外します。
*  `volume modify`コマンドの `-vserver-dr-protection unprotected`オプションは、指定されたボリュームをSVMレプリケーションから除外します。


上記の点を除き、SVMレプリケーションはボリューム レプリケーションとほぼ同じです。ボリューム レプリケーションに使用するのとほぼ同じワークフローをSVMレプリケーションにも使用できます。



== サポートの詳細

次の表は、SnapMirror SVMレプリケーションのサポートの詳細を示しています。

[cols="2*"]
|===


| リソースまたは機能 | サポートの詳細 


 a| 
構成タイプ
 a| 
* 1つのソースから1つのデスティネーション
* ONTAP 9.4以降はファンアウト（ただしファンアウトのデスティネーションは2つのみ）
+
デフォルトでは、-identity-preserve trueの関係はソースSVMごとに1つだけ許可されます。





 a| 
関係タイプ
 a| 
* SnapMirrorディザスタ リカバリ
* SnapMirrorユニファイド レプリケーション




 a| 
レプリケーションの範囲
 a| 
クラスタ間のみ。同じクラスタ内のSVMをレプリケートすることはできません。



 a| 
自律型ランサムウェア対策
 a| 
* ONTAP 9.12.1以降でサポートされます。詳細については、link:../anti-ransomware/index.html["自律型ランサムウェア対策"]を参照してください。




 a| 
整合性グループの非同期サポート
 a| 
ONTAP 9.14.1以降では、コンシステンシグループが存在する場合、最大32個のSVMディザスタリカバリ関係がサポートされます。詳細については、link:../consistency-groups/protect-task.html["整合性グループの保護"]およびlink:../consistency-groups/limits.html["整合性グループの制限"]を参照してください。



 a| 
FabricPool
 a| 
ONTAP 9.6以降、SnapMirror SVMレプリケーションはFabricPoolでサポートされます。SVM DR関係では、ソースボリュームとデスティネーションボリュームでFabricPoolアグリゲートを使用する必要はありませんが、同じ階層化ポリシーを使用する必要があります。

ONTAP 9.12.1以降、SnapMirror SVMレプリケーションはFabricPoolとFlexGroupボリュームと連携して動作することがサポートされています。9.12.1より前は、これらの機能のうち2つは連携して動作していましたが、3つすべては連携して動作していませんでした。



 a| 
MetroCluster
 a| 
ONTAP 9.11.1以降では、MetroCluster構成内のSVMディザスタ リカバリ関係のソースとデスティネーション両方を、追加のSVMディザスタ リカバリ構成のソースにすることができます。

ONTAP 9.5以降のMetroCluster構成では、SnapMirror SVMレプリケーションがサポートされます。

* ONTAP 9.10.Xより前のリリースでは、MetroCluster構成をSVMディザスタ リカバリ関係のデスティネーションにすることはできません。
* ONTAP 9.10.1 以降のリリースでは、MetroCluster構成は移行目的のみで SVM ディザスタ リカバリ関係の宛先になることができ、 https://www.netapp.com/pdf.html?item=/media/83785-tr-4966.pdf["TR-4966：SVMをMetroClusterソリューションに移行する"^]に記載されている必要な要件をすべて満たす必要があります。
* SVMディザスタ リカバリ関係のソースとして使用できるのは、MetroCluster構成のアクティブなSVMだけです。
+
スイッチオーバー前の同期元のSVMとスイッチオーバー後の同期先のSVMのどちらもソースに使用できます。

* MetroCluster構成が安定した状態のときはMetroClusterの同期先のSVMはオンラインでないため、同期先ボリュームをSVMディザスタ リカバリ関係のソースにすることはできません。
* SVMディザスタ リカバリ関係のソースが同期元のSVMの場合、ソースのSVMディザスタ リカバリ関係情報がMetroClusterパートナーにレプリケートされます。
* スイッチオーバーおよびスイッチバックの実行中に、SVMディザスタ リカバリのデスティネーションへのレプリケーションが失敗することがあります。
+
ただし、スイッチオーバーまたはスイッチバック処理の完了後、SVMディザスタ リカバリの次回のスケジュールされている更新は成功します。





 a| 
整合性グループ
 a| 
ONTAP 9.14.1以降でサポートされます。詳細については、xref:../consistency-groups/protect-task.html[整合性グループの保護]を参照してください。



 a| 
ONTAP S3
 a| 
SVMディザスタ リカバリではサポートされません。



 a| 
SnapMirror Synchronous
 a| 
SVMディザスタ リカバリではサポートされません。



 a| 
バージョンへの非依存性
 a| 
サポートされていません。



 a| 
ボリューム暗号化
 a| 
* ソースで暗号化されたボリュームがデスティネーションで暗号化されます。
* オンボード キー マネージャまたはKMIPサーバをデスティネーションで設定する必要があります。
* 新しい暗号化キーはデスティネーションで生成されます。
* ボリューム暗号化をサポートするノードがデスティネーションに含まれていない場合、レプリケーションは成功しますが、デスティネーション ボリュームは暗号化されません。


|===


== SVMディザスタ リカバリ関係でレプリケートされる設定

次の表は、 `snapmirror create -identity-preserve`オプションと `snapmirror policy create -discard-configs network`オプションの相互作用を示しています：

[cols="5*"]
|===


2+| レプリケートされる設定 2+| `*‑identity‑preserve true*` | `*‑identity‑preserve false*` 


|  |  | * `-discard-configs network`が設定されていないポリシー* | * `-discard-configs network`が設定されたポリシー* |  


 a| 
ネットワーク
 a| 
NAS LIF
 a| 
はい
 a| 
いいえ
 a| 
いいえ



 a| 
LIFのKerberos設定
 a| 
はい
 a| 
いいえ
 a| 
いいえ



 a| 
SAN LIF
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
ファイアウォール ポリシー
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
サービス ポリシー
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
ルート
 a| 
はい
 a| 
いいえ
 a| 
いいえ



 a| 
ブロードキャスト ドメイン
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
サブネット
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
IPspace
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
SMB
 a| 
SMB サーバ
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
ローカル グループおよびローカル ユーザ
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
権限
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
シャドウ コピー
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
BranchCache
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
サーバ オプション
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
サーバ セキュリティ
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
ホーム ディレクトリ、共有
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
シンボリックリンク
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
Fpolicyポリシー、Fsecurityポリシー、およびFsecurity NTFS
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
ネーム マッピングおよびグループ マッピング
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
監査情報
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
NFS
 a| 
エクスポート ポリシー
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
エクスポート ポリシー ルール
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
NFS サーバ
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
RBAC
 a| 
セキュリティ証明書
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
ログイン ユーザ、公開鍵、ロール、およびロール設定
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
SSL
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
ネーム サービス
 a| 
DNSおよびDNSホスト
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
UNIXユーザおよびUNIXグループ
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
Kerberos RealmおよびKerberosキーブロック
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
LDAPおよびLDAPクライアント
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
Netgroup
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
NIS
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
WebおよびWebアクセス
 a| 
はい
 a| 
はい
 a| 
いいえ



 a| 
Volume
 a| 
オブジェクト
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
スナップショットとスナップショット ポリシー
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
自動削除ポリシー
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
効率化ポリシー
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
クォータ ポリシーおよびクォータ ポリシー ルール
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
リカバリ キュー
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
ルート ボリューム
 a| 
ネームスペース
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
ユーザ データ
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
qtree
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
クォータ
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
ファイルレベルのQoS
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
属性：ルート ボリュームの状態、スペース ギャランティ、サイズ、オートサイズ、およびファイル総数
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
ストレージQoS
 a| 
QoSポリシー グループ
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
Fibre Channel（FC）
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
iSCSI
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
LUN
 a| 
オブジェクト
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
igroup
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
ポートセット
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
シリアル番号
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ



 a| 
SNMP
 a| 
v3ユーザ
 a| 
はい
 a| 
はい
 a| 
いいえ

|===


== SVMディザスタ リカバリのストレージ制限

以下の表は、ストレージオブジェクトごとにサポートされるボリュームとSVMディザスタリカバリ関係の推奨最大数を示しています。制限はプラットフォームによって異なる場合があることに注意してください。特定の構成の制限については、link:https://hwu.netapp.com/["Hardware Universe"^]を参照してください。

[cols="2*"]
|===


| ストレージ オブジェクト | 制限 


 a| 
SVM
 a| 
300個のフレキシブル ボリューム



 a| 
HAペア
 a| 
1,000 Flexible Volume



 a| 
クラスタ
 a| 
128個のSVMディザスタ リカバリ関係

|===
.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-create.html["snapmirror create"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-create.html["snapmirror policy create"^]

