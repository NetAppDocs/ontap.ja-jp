---
permalink: data-protection/snapmirror-synchronous-disaster-recovery-basics-concept.html 
sidebar: sidebar 
keywords: snapmirror, synchronous, disaster, recovery 
summary: ONTAP 9.5以降では、16GB以上のメモリを搭載したすべてのFASプラットフォームとAFFプラットフォーム、およびすべてのONTAP SelectプラットフォームでSnapMirror同期（SM-S）テクノロジがサポートされます。SnapMirror同期テクノロジはノード単位でライセンスされる機能で、ボリューム レベルの同期データ レプリケーションを提供します。 
---
= ONTAP SnapMirror同期ディザスタリカバリについて学ぶ
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.5以降では、16GB以上のメモリを搭載したすべてのFASプラットフォームとAFFプラットフォーム、およびすべてのONTAP SelectプラットフォームでSnapMirror同期（SM-S）テクノロジがサポートされます。SnapMirror同期テクノロジはノード単位でライセンスされる機能で、ボリューム レベルの同期データ レプリケーションを提供します。

この機能を使用すると、データ損失ゼロが求められる金融や医療などの業種で、同期レプリケーションに関する規制や国の規定に対応できます。



== 許可されるSnapMirror同期の処理

SnapMirror同期レプリケーションのHAペアあたりの最大処理数は、コントローラのモデルによって異なります。

次の表は、1つのHAペアで許可されるSnapMirror同期処理の最大数をプラットフォーム タイプとONTAPのリリース別に示しています。

|===


| プラットフォーム | ONTAP 9.14.1からONTAP 9.11.1 | ONTAP 9.10.1 | ONTAP 9.9.1 | ONTAP 9.9.1より前のリリース 


 a| 
AFF
 a| 
400
 a| 
200
 a| 
160
 a| 
80



 a| 
ASA
 a| 
400
 a| 
200
 a| 
160
 a| 
80



 a| 
FAS
 a| 
80
 a| 
80
 a| 
80
 a| 
40



 a| 
ONTAP Select
 a| 
40
 a| 
40
 a| 
40
 a| 
20

|===


== サポートされる機能

次の表に、SnapMirror同期でサポートされる機能と、サポートが提供されるONTAPリリースを示します。

[cols="3,1,4"]
|===


| 機能 | 最初にサポートされたリリース | 追加情報 


| SnapMirror同期関係のプライマリ ボリュームに対するウイルス対策 | ONTAP 9.6 |  


| アプリケーションで作成されたSnapshotのレプリケーション | ONTAP 9.7 |  `snapshot create`操作時にCLIまたはONTAP APIを使用してスナップショットに適切なラベルが付けられている場合、SnapMirror同期レプリケーションは、アプリケーションを静止させた後、ユーザーが作成したスナップショットと外部スクリプトで作成されたスナップショットの両方を同期的にレプリケートします。スナップショット ポリシーを使用して作成されたスケジュールされたスナップショットはレプリケートされません。アプリケーション作成スナップショットのレプリケーションの詳細については、link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapMirror/How_to_replicate_application_created_snapshots_with_SnapMirror_Synchronous["NetAppナレッジベース：アプリケーションが作成したスナップショットをSnapMirror同期的に複製する方法"^]を参照してください。 


| クローンの自動削除 | ONTAP 9.6 |  


| 階層化ポリシーが「None」、「Snapshot」、「Auto」のいずれかに設定されたFabricPoolアグリゲートがSnapMirror同期のソースとデスティネーションでサポートされます。 | ONTAP 9.5 | FabricPoolアグリゲート内のデスティネーション ボリュームに「All」階層化ポリシーを設定することはできません。 


| FC | ONTAP 9.5 | すべてのネットワークでレイテンシが10ミリ秒以内に抑えられます。 


| FC-NVMe | ONTAP 9.7 |  


| ファイルのクローン | ONTAP 9.7 |  


| SnapMirror同期関係のプライマリ ボリュームに対するFPolicy | ONTAP 9.6 |  


| SnapMirror同期関係のプライマリ ボリュームに対するハード クォータおよびソフト クォータ | ONTAP 9.6 | クォータ ルールはデスティネーションにレプリケートされないため、クォータ データベースはデスティネーションにレプリケートされません。 


| クラスタ内同期関係 | ONTAP 9.14.1 | ソース ボリュームとデスティネーション ボリュームを異なるHAペアに配置することで、高可用性が実現されます。クラスタ全体がダウンした場合、クラスタが回復するまでボリュームにアクセスできなくなります。クラスタ内SnapMirror同期関係は、同時xref:SnapMirror synchronous operations allowed[HAペアごとの関係]の全体的な制限に影響します。 


| iSCSI | ONTAP 9.5 |  


| LUNクローンとNVMeネームスペース クローン | ONTAP 9.7 |  


| アプリケーションが作成したSnapshotでバックアップされたLUNクローン | ONTAP 9.7 |  


| 混在プロトコル アクセス（NFS v3とSMB） | ONTAP 9.6 |  


| NDMP / NDMPのリストア | ONTAP 9.13.1 | ソース クラスタとデスティネーション クラスタの両方で、SnapMirror SynchronousでNDMPを使用するにはONTAP 9.13.1以降を実行している必要があります。詳細については、xref:../tape-backup/transfer-data-ndmpcopy-task.html[ndmpコピーを使用してデータを転送する]を参照してください。 


| AFF / ASAプラットフォームでのみ実行できる無停止のSnapMirror同期処理（NDO）。 | ONTAP 9.12.1 | ノンストップ オペレーションがサポートされることで、ダウンタイムを予定することなく多くの代表的なメンテナンス作業を実行できます。サポートされる処理にはテイクオーバーとギブバック、およびボリューム移動があり、2つのクラスタ間で1つのノードが稼働しているかぎりこれらの処理を実行できます。 


| NFS v4.2 | ONTAP 9.10.1 |  


| NFS v4.0 | ONTAP 9.6 |  


| NFS v4.1 | ONTAP 9.6 |  


| NVMe/TCP | 9.10.1 |  


| メタデータ処理頻度の上限の削除 | ONTAP 9.6 |  


| TLS 1.2暗号化を使用した機密データ転送時のセキュリティ | ONTAP 9.6 |  


| 単一ファイルのリストアとファイルの部分リストア | ONTAP 9.13.1 |  


| SMB 2.0以降 | ONTAP 9.6 |  


| SnapMirror同期ミラー-ミラー カスケード | ONTAP 9.6 | SnapMirror同期関係のデスティネーション ボリュームからの関係はSnapMirror非同期関係である必要があります。 


| SVMディザスタ リカバリ | ONTAP 9.6 | * SnapMirror同期ソースは、SVMディザスタ リカバリ ソースになることもできます。たとえば、SnapMirror同期を一方のレッグとし、SVMディザスタ リカバリをもう一方のレッグとするファンアウト構成などです。* SnapMirror同期はデータ保護ソースのカスケードをサポートしていないため、SnapMirror同期ソースをSVMディザスタ リカバリ デスティネーションにすることはできません。デスティネーション クラスタでSVMディザスタ リカバリのフリップ再同期を実行する前に、同期関係を解放する必要があります。* SVMディザスタ リカバリはDPボリュームのレプリケーションをサポートしていないため、SnapMirror同期デスティネーションをSVMディザスタ リカバリ ソースにすることはできません。同期ソースのフリップ再同期を実行すると、SVMディザスタ リカバリによってデスティネーション クラスタのDPボリュームが除外されます。 


| ソース ボリュームへのテープベースのリストア | ONTAP 9.13.1 |  


| NASのソース ボリュームとデスティネーション ボリュームの間のタイムスタンプ パリティ | ONTAP 9.6 | ONTAP 9.5からONTAP 9.6にアップグレードした場合、タイムスタンプはソース ボリューム内の新規または変更されたファイルについてのみレプリケートされます。ソース ボリューム内の既存のファイルのタイムスタンプは同期されません。 
|===


== サポートされない機能

SnapMirror同期関係では、次の機能はサポートされません。

* 自律型ランサムウェア対策
* 整合性グループ
* DP_Optimized（DPO）システム
* FlexGroupボリューム
* FlexCacheボリューム
* グローバル スロットル
* ファンアウト構成で確立できるSnapMirror同期関係は1つだけで、ソース ボリュームからの残りの関係はすべてSnapMirror非同期関係にする必要がある。
* LUNの移動
* MetroCluster構成
* 同じボリュームまたはSVMでは、SANとNVMeアクセスLUNおよびNVMe名前空間の混在はサポートされません。
* SnapCenter
* SnapLockボリューム
* 改ざん防止スナップショット
* デスティネーション ボリュームでのダンプおよびSMTapeを使用したテープ バックアップまたはリストア
* ソース ボリュームのしきい値の下限（最小QoS）
* ボリュームのSnapRestore
* VVol




== 動作モード

SnapMirror同期には、使用するSnapMirrorポリシーに基づいて2つの動作モードがあります。

* *同期モード* 同期モードでは、アプリケーションのI/O操作はプライマリ ストレージ システムとセカンダリ ストレージ システムに並列に送信されます。何らかの理由でセカンダリ ストレージへの書き込みが完了しなかった場合、アプリケーションはプライマリ ストレージへの書き込みを続行できます。エラー状態が修正されると、SnapMirror同期テクノロジはセカンダリ ストレージと自動的に再同期し、プライマリ ストレージからセカンダリ ストレージへのレプリケーションを同期モードで再開します。同期モードでは、セカンダリ レプリケーションに障害が発生するまではRPO=0でRTOは非常に低くなりますが、セカンダリ レプリケーションに障害が発生するとRPOとRTOは不確定になります。ただし、セカンダリ レプリケーションの障害原因を修復し、再同期を完了するまでの時間はRPOとRTOに等しくなります。
* *StrictSyncモード* SnapMirror同期は、オプションでStrictSyncモードで動作できます。何らかの理由でセカンダリ ストレージへの書き込みが完了しなかった場合、アプリケーションI/Oは失敗し、プライマリ ストレージとセカンダリ ストレージの同一性が確保されます。プライマリへのアプリケーションI/Oは、SnapMirror関係が `InSync`ステータスに戻った後にのみ再開されます。プライマリ ストレージに障害が発生した場合、フェイルオーバー後にセカンダリ ストレージでアプリケーションI/Oを再開でき、データ損失はありません。StrictSyncモードでは、RPOは常にゼロであり、RTOは非常に低くなります。




== 関係のステータス

SnapMirror同期関係のステータスは、通常動作中は常に `InSync`ステータスです。何らかの理由でSnapMirror転送が失敗した場合、デスティネーションはソースと同期していないため、 `OutofSync`ステータスになる可能性があります。

SnapMirror同期関係の場合、システムは一定の間隔で関係のステータス（ `InSync`または `OutofSync`）を自動的にチェックします。関係のステータスが `OutofSync`の場合、ONTAPは自動再同期プロセスを自動的にトリガーし、関係を `InSync`ステータスに戻します。自動再同期は、ソースまたはデスティネーションでの計画外のストレージフェイルオーバーやネットワーク障害など、何らかの操作が原因で転送が失敗した場合にのみトリガーされます。 `snapmirror quiesce`や `snapmirror break`などのユーザによる操作では、自動再同期はトリガーされません。

StrictSyncモードのSnapMirror同期関係で関係ステータスが `OutofSync`になると、プライマリボリュームへのすべてのI/O操作が停止されます。SyncモードのSnapMirror同期関係で `OutofSync`状態になっても、プライマリには影響がなく、プライマリボリュームでI/O操作が許可されます。

.関連情報
* https://www.netapp.com/pdf.html?item=/media/17174-tr4733pdf.pdf["NetAppテクニカル レポート4733：SnapMirror同期構成とベストプラクティス"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-break.html["snapmirror break"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-quiesce.html["snapmirror quiesce"^]

