---
permalink: data-protection/snapmirror-unified-replication-concept.html 
sidebar: sidebar 
keywords: snapmirror, unified, replication 
summary: SnapMirrorユニファイド レプリケーションを使用すると、同じデスティネーション ボリュームでディザスタ リカバリとアーカイブを設定できます。ユニファイド レプリケーションでは、必要なセカンダリ ストレージ容量の削減、ベースライン転送の回数の制限、およびネットワーク トラフィックの減少というメリットが得られます。 
---
= ONTAP SnapMirror統合レプリケーションについて学ぶ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SnapMirror_統合レプリケーション_を使用すると、同じデスティネーション ボリュームでディザスタ リカバリとアーカイブを設定できます。統合レプリケーションが適切な場合、必要なセカンダリ ストレージの量を削減し、ベースライン転送の数を制限し、ネットワーク トラフィックを減らすというメリットがあります。



== 統合データ保護関係の初期化方法

SnapMirrorと同様に、一元化されたデータ保護機能の初回起動時に、ベースライン転送が実行されます。関係のSnapMirrorポリシーは、ベースラインおよび更新の内容を定義します。

デフォルトの統合データ保護ポリシー `MirrorAndVault`でのベースライン転送では、ソース ボリュームのスナップショットが作成され、そのコピーとそれが参照するデータ ブロックがデスティネーション ボリュームに転送されます。ボルト アーカイブと同様に、統合データ保護では古いスナップショットはベースラインに含まれません。



== 統合データ保護関係の更新方法

 `MirrorAndVault`ポリシーに基づく更新のたびに、SnapMirrorはソース ボリュームのSnapshotを作成し、そのSnapshotと前回の更新以降に作成されたすべてのSnapshotを転送します（ただし、Snapshotポリシー ルールで定義されたラベルと一致するラベルが付いている場合）。 `MirrorAndVault`ポリシーの `snapmirror policy show`コマンドからの次の出力では、以下の点に注意してください：

* `Create Snapshot`は「`true`」で、 `MirrorAndVault`がSnapMirror関係を更新するときにスナップショットを作成することを示します。
* `MirrorAndVault`には、ルール「`sm_created`」、「`daily`」、および「`weekly`」があり、SnapMirrorが関係を更新するときに、SnapMirrorによって作成されたスナップショットと、ソース上の一致するラベルを持つスナップショットの両方が転送されることを示します。


[listing]
----
cluster_dst::> snapmirror policy show -policy MirrorAndVault -instance

                     Vserver: vs0
      SnapMirror Policy Name: MirrorAndVault
      SnapMirror Policy Type: mirror-vault
                Policy Owner: cluster-admin
                 Tries Limit: 8
           Transfer Priority: normal
   Ignore accesstime Enabled: false
     Transfer Restartability: always
 Network Compression Enabled: false
             Create Snapshot: true
                     Comment: A unified SnapMirror synchronous and SnapVault policy for
                              mirroring the latest file system and daily and weekly snapshots.
       Total Number of Rules: 3
                  Total Keep: 59
                       Rules: SnapMirror Label     Keep  Preserve Warn Schedule Prefix
                              ----------------     ----  -------- ---- -------- ------
                              sm_created              1  false       0 -        -
                              daily                   7  false       0 -        -
                              weekly                 52  false       0 -        -
----


== 統一7年ポリシー

事前設定された `Unified7year`ポリシーは `MirrorAndVault`とまったく同じように動作しますが、4番目のルールによって毎月のスナップショットが転送され、7年間保持される点が異なります。

[listing]
----

                       Rules: SnapMirror Label     Keep  Preserve Warn Schedule Prefix
                              ----------------     ----  -------- ---- -------- ------
                              sm_created              1  false       0 -        -
                              daily                   7  false       0 -        -
                              weekly                 52  false       0 -        -
                              monthly                84  false       0 -        -
----


== データ破損からの保護

統合レプリケーションは、ベースライン転送の内容を、初期化時にSnapMirrorによって作成されたスナップショットに限定します。更新のたびに、SnapMirrorはソースの別のスナップショットを作成し、そのスナップショットと、スナップショット ポリシー ルールで定義されたラベルと一致するラベルを持つ新しいスナップショットを転送します。

更新されたスナップショットが破損する可能性を防ぐには、最後に転送されたスナップショットのコピーをデスティネーションに作成します。この「`ローカル コピー`」は、ソースの保持ルールに関係なく保持されるため、SnapMirrorによって最初に転送されたスナップショットがソースで利用できなくなっても、デスティネーションにはそのコピーが存在します。



== ユニファイド データ レプリケーション使用の判断

完全なミラーを維持するメリットと、ユニファイド レプリケーションが提供するメリット（セカンダリ ストレージ容量の削減、ベースライン転送の回数削減、ネットワーク トラフィックの削減）を比較検討する必要があります。

統合レプリケーションの適切性を判断する上で重要な要素は、アクティブ ファイル システムの変更率です。たとえば、データベース トランザクション ログの1時間ごとのスナップショットを保持するボリュームには、従来のミラーの方が適している場合があります。

.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-show.html["snapmirror policy show"^]

