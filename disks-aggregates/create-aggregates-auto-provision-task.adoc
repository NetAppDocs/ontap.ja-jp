---
permalink: disks-aggregates/create-aggregates-auto-provision-task.html 
sidebar: sidebar 
keywords: create, aggregates, auto-provision, add, local tier, automatic, automatically, create, aggregate, auto-provisioning, System Manager, CLI, storage, disk, ownership, assign 
summary: ONTAPのローカル ティアを自動的に追加するための推奨事項を受け入れ、ONTAPにローカル ティアを追加させることができます。 
---
= ONTAPローカル階層を自動的に追加
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAPが提供するローカル階層の自動追加に関するベストプラクティスの推奨事項が環境に適している場合は、その推奨事項を受け入れて、ONTAPにローカル階層を追加させることができます。


NOTE: ONTAP 9.7より前のバージョンでは、System Managerは_ローカル階層_を説明するために_aggregate_という用語を使用しています。ONTAPバージョンに関係なく、ONTAP CLIでは_aggregate_という用語が使用されます。ローカル階層の詳細については、link:../disks-aggregates/index.html["ディスクとローカル階層"]を参照してください。

.開始する前に
ディスクをローカル層で使用するには、ノードがディスクを所有している必要があります。クラスターがディスク所有権の自動割り当てを使用するように構成されていない場合は、link:manual-assign-disks-ownership-prep-task.html["所有権を手動で割り当てる"]必要があります。

この手順で説明されているコマンドの詳細については、link:https://docs.netapp.com/us-en/ontap-cli/["ONTAPコマンド リファレンス"^]を参照してください。

[role="tabbed-block"]
====
.System Manager
--
.手順
. System Managerで、*Storage > Tiers*をクリックします。
. *ティア* ページから、image:icon-add-local-tier.png["ローカル ティア アイコンを追加"]をクリックして新しいローカル ティアを作成します：
+
*ローカル ティアの追加* ページには、ノード上に作成できるローカル ティアの推奨数と使用可能なストレージが表示されます。

. *推奨の詳細*をクリックして、System Managerによって推奨される構成を表示します。
+
ONTAP 9.8以降では次の情報が表示されます。

+
** *ローカル階層名*（ONTAP 9.10.1以降ではローカル階層名を編集できます）
** *ノード名*
** *使用可能サイズ*
** *ストレージの種類*


+
ONTAP 9.10.1以降では、追加で次の情報が表示されます。

+
** *ディスク*：ディスクの数、サイズ、種類を表示します
** *レイアウト*：どのディスクがパリティまたはデータであるか、どのスロットが未使用であるかなど、RAIDグループのレイアウトを表示します。
** *スペア ディスク*：ノード名、スペア ディスクの数とサイズ、ストレージの種類を表示します。


. 次のいずれかの手順を実行します。
+
|===


| 次の操作を行う場合： | 次に、以下を実行します… 


 a| 
System Manager からの推奨事項を受け入れます。
 a| 
<<step5-okm-encrypt,暗号化のためにOnboard Key Managerを構成する手順>>に進みます。



 a| 
ローカル層を手動で構成し、System Manager からの推奨事項は使用し*_ない_*でください。
 a| 
link:create-aggregates-manual-task.html["ローカル階層を手動で追加する"]に進む：

** ONTAP 9.10.1以前の場合は、CLIを使用する手順に従います。
** ONTAP 9.11.1以降の場合は、System Managerを使用する手順に従います。


|===
. [[step5-okm-encrypt]] （オプション）：Onboard Key Managerがインストールされている場合は、暗号化を設定できます。*Configure Onboard Key Manager for encryption*チェックボックスをオンにします。
+
.. パスフレーズを入力します。
.. 確認のためにもう一度パスフレーズを入力します。
.. あとでシステムのリカバリが必要になったときのためにパスフレーズを保存します。
.. あとで使用できるようにキー データベースをバックアップします。


. *保存*をクリックしてローカル層を作成し、ストレージ ソリューションに追加します。


--
.CLI
--
 `storage aggregate auto-provision`コマンドを実行すると、ローカル階層レイアウトの推奨事項が生成されます。その後、ONTAP推奨事項を確認して承認した後、ローカル階層を作成できます。

.タスク概要
 `storage aggregate auto-provision`コマンドで生成されるデフォルトのサマリーには、作成が推奨されるローカル階層（名前と使用可能サイズを含む）がリストされます。このリストを確認し、プロンプトが表示されたら推奨されるローカル階層を作成するかどうかを決定できます。

 `-verbose`オプションを使用して詳細な概要を表示することもできます。次のレポートが表示されます：

* 作成する新しいローカル層、検出されたスペア、およびローカル層作成後の残りのスペア ディスクとパーティションのノードごとの概要
* 使用するディスクとパーティションの数を指定して作成する新しいデータ ローカル層
* 作成される新しいデータ ローカル階層でスペア ディスクとパーティションがどのように使用されるかを示すRAIDグループ レイアウト
* ローカル層の作成後に残っているスペア ディスクとパーティションの詳細


自動プロビジョニング方法に精通しており、環境が適切に準備されている場合は、 `-skip-confirmation`オプションを使用して、表示や確認なしで推奨ローカル層を作成できます。 `storage aggregate auto-provision`コマンドは、CLIセッション `-confirmations`設定の影響を受けません。

 `storage aggregate auto-provision`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/storage-aggregate-auto-provision.html["ONTAPコマンド リファレンス"^]をご覧ください。

.手順
.  `storage aggregate auto-provision`コマンドを必要な表示オプションを指定して実行します。
+
** オプションなし：標準の概要を表示
** `-verbose` option：詳細な概要を表示
** `-skip-confirmation`オプション：表示や確認なしで推奨ローカル階層を作成する


. 次のいずれかの手順を実行します。
+
[cols="35,65"]
|===


| 次の操作を行う場合： | 次に、以下を実行します… 


 a| 
ONTAPからの推奨事項を受け入れます。
 a| 
推奨されるローカル ティアの表示を確認し、プロンプトに応答して推奨されるローカル ティアを作成します。

[listing]
----
myA400-44556677::> storage aggregate auto-provision
Node               New Data Aggregate            Usable Size
------------------ ---------------------------- ------------
myA400-364        myA400_364_SSD_1                    3.29TB
myA400-363        myA400_363_SSD_1                    1.46TB
------------------ ---------------------------- ------------
Total:             2   new data aggregates            4.75TB

Do you want to create recommended aggregates? {y|n}: y

Info: Aggregate auto provision has started. Use the "storage aggregate
      show-auto-provision-progress" command to track the progress.

myA400-44556677::>

----


 a| 
ローカル階層を手動で構成し、ONTAPからの推奨事項を使用し*_ない_*。
 a| 
link:create-aggregates-manual-task.html["ローカル階層を手動で追加する"]に進みます。

|===


--
====
.関連情報
* https://docs.netapp.com/us-en/ontap-cli["ONTAPコマンド リファレンス"^]

