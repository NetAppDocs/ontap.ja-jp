---
permalink: disks-aggregates/sanitize-disk-maintenance-mode-task.html 
sidebar: sidebar 
keywords: sanitize, disk, maintenance mode, nodeshell, node shell, sanitization 
summary: ONTAP 9.6以降では、メンテナンス モードでディスク完全消去を実行できます。これにより、運用を終了したシステムや動作していないシステムにおいて、1本または一連のディスクからデータを削除し、データをリカバリ不能にできます。 
---
= ONTAPディスクを完全消去する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ディスクを完全消去すると、運用を終了したシステムや動作していないシステムにおいて、1本または一連のディスクからデータを削除し、データをリカバリ不能な状態にすることができます。

CLIを使用してディスクを完全消去する方法は2つあります。

.「メンテナンス モード」コマンドを使用してディスク完全消去を実行する
[%collapsible]
====
ONTAP 9.6以降では、メンテナンス モードでディスク完全消去を実行できます。

.開始する前に
* 自己暗号化ディスク（SED）は完全消去できません。
+
SED を完全消去するには、 `storage encryption disk sanitize`コマンドを使用する必要があります。

+
link:../encryption-at-rest/index.html["保存中のデータを暗号化"]

+
 `storage encryption disk sanitize`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/storage-encryption-disk-sanitize.html["ONTAPコマンド リファレンス"^]を参照してください。



.手順
. メンテナンス モードでブートします。
+
..  `halt`と入力して現在のシェルを終了します。
+
LOADERプロンプトが表示されます。

..  `boot_ontap maint`と入力してメンテナンス モードに入ります。
+
情報が表示されたあとに、メンテナンス モード プロンプトが表示されます。



. 完全消去するディスクがパーティショニングされている場合は、各ディスクのパーティショニングを解除します。
+

NOTE: ディスクのパーティションを解除するコマンドは診断レベルでのみ使用可能であり、NetAppサポートの監督下でのみ実行する必要があります。続行する前にNetAppサポートにお問い合わせいただくことを強くお勧めします。また、link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Systems/FAS_Systems/How_to_unpartition_a_spare_drive_in_ONTAP["NetAppナレッジベース：ONTAPでスペアドライブのパーティション化を解除する方法"^]を参照することもできます。

+
`disk unpartition <disk_name>`

. 指定したディスクの完全消去を実行します。
+
`disk sanitize start [-p <pattern1>|-r [-p <pattern2>|-r [-p <pattern3>|-r]]] [-c <cycle_count>] <disk_list>`

+

NOTE: ディスク完全消去中は、ノードの電源を切ったり、ストレージ接続を中断したり、対象ディスクを取り外したりしないでください。フォーマットフェーズ中にディスク完全消去が中断された場合は、ディスクが完全消去されてスペアプールに戻す準備ができるまで、フォーマットフェーズを再開して完了させる必要があります。ディスク完全消去プロセスを中止する必要がある場合は、 `disk sanitize abort`コマンドを使用して中止できます。指定したディスクがディスク完全消去のフォーマットフェーズ中の場合、フェーズが完了するまで中止は行われません。

+
 `-p` `<pattern1>` `-p` `<pattern2>` `-p` `<pattern3>`消去対象のディスクに連続して適用できる、1～3個のユーザー定義16進バイト上書きパターンのサイクルを指定します。デフォルトのパターンは3パスで、最初のパスには0x55、2番目のパスには0xaa、3番目のパスには0x3cが使用されます。

+
`-r`一部またはすべてのパスのパターン上書きをランダム上書きに置き換えます。

+
`-c` `<cycle_count>`指定された上書きパターンを適用する回数を指定します。デフォルト値は1サイクルです。最大値は7サイクルです。

+
`<disk_list>`完全消去するスペア ディスクの ID をスペースで区切ったリストを指定します。

. 必要に応じて、ディスク完全消去プロセスのステータスを確認します。
+
`disk sanitize status [<disk_list>]`

. 完全消去プロセスが完了したら、ディスクを各ディスクのスペア ステータスに戻します。
+
`disk sanitize release <disk_name>`

. メンテナンス モードを終了します。


====
.「nodeshell」コマンドを使用してディスクを完全消去する（すべてのONTAP 9リリース）
[%collapsible]
====
ノード上でノードシェル コマンドを使用してディスク完全消去機能を有効にすると、無効にすることはできません。

.開始する前に
* ディスクはスペア ディスクである必要があります。また、ノードによって所有されている必要がありますが、ローカル層では使用できません。
+
ディスクがパーティション分割されている場合、どちらのパーティションもローカル階層で使用できません。

* 自己暗号化ディスク（SED）は完全消去できません。
+
SED を完全消去するには、 `storage encryption disk sanitize`コマンドを使用する必要があります。

+
link:../encryption-at-rest/index.html["保存中のデータを暗号化"]

* ストレージ プールの一部であるディスクを使用することはできません。


.手順
. 完全消去するディスクがパーティショニングされている場合は、各ディスクのパーティショニングを解除します。
+
--

NOTE: ディスクのパーティションを解除するコマンドは、diagレベルでのみ使用可能であり、NetAppサポートの監督下でのみ実行する必要があります。**続行する前にNetAppサポートに連絡することを強くお勧めします。**link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Systems/FAS_Systems/How_to_unpartition_a_spare_drive_in_ONTAP["NetAppナレッジベース：ONTAPでスペアドライブのパーティション化を解除する方法"^]を参照することもできます。

--
+
`disk unpartition <disk_name>`

. 完全消去するディスクを所有するノードのノードシェルに切り替えます。
+
`system node run -node <node_name>`

. ディスク完全消去を有効にします。
+
`options licensed_feature.disk_sanitization.enable on`

+
このコマンドは取り消すことができないため、確認を求められます。

. ノードシェルのadvanced権限レベルに切り替えます。
+
`priv set advanced`

. 指定したディスクの完全消去を実行します。
+
`disk sanitize start [-p <pattern1>|-r [-p <pattern2>|-r [-p <pattern3>|-r]]] [-c <cycle_count>] <disk_list>`

+

NOTE: ディスク完全消去中は、ノードの電源を切ったり、ストレージ接続を中断したり、対象ディスクを取り外したりしないでください。フォーマットフェーズ中にディスク完全消去が中断された場合は、ディスクが完全消去されてスペアプールに戻せる状態になる前に、フォーマットフェーズを再開して完了させる必要があります。ディスク完全消去プロセスを中止する必要がある場合は、disk sanitize abort コマンドを使用してください。指定したディスクがディスク完全消去のフォーマットフェーズ中の場合、フェーズが完了するまで中止は行われません。

+
`-p <pattern1> -p <pattern2> -p <pattern3>`消去対象のディスクに連続して適用できる、1～3個のユーザー定義16進バイト上書きパターンのサイクルを指定します。デフォルトのパターンは3パスで、最初のパスには0x55、2番目のパスには0xaa、3番目のパスには0x3cが使用されます。

+
`-r`一部またはすべてのパスのパターン上書きをランダム上書きに置き換えます。

+
`-c <cycle_count>` 指定された上書きパターンが適用される回数を指定します。

+
デフォルト値は1です。最大値は7です。

+
`<disk_list>`完全消去するスペア ディスクの ID をスペースで区切ったリストを指定します。

. ディスク完全消去プロセスのステータスを確認するには、次のコマンドを入力します。
+
`disk sanitize status [<disk_list>]`

. 完全消去プロセスが完了したら、ディスクをスペア ステータスに戻します。
+
`disk sanitize release <disk_name>`

. ノードシェルのadmin権限レベルに戻ります。
+
`priv set admin`

. ONTAP CLIに戻ります。
+
`exit`

. 次のコマンドを入力して、すべてのディスクがスペア ステータスに戻ったかどうかを確認します。
+
`storage aggregate show-spare-disks`

+
[cols="1,2"]
|===


| 状況 | 操作 


| 完全消去したすべてのディスクがスペアとして表示される | 処理は完了しています。ディスクは完全消去され、スペア状態になっています。 


| 完全消去した一部のディスクがスペアとして表示されない  a| 
次の手順を実行します。

.. advanced権限モードに切り替えます。
+
`set -privilege advanced`

.. 完全消去した未割り当てのディスクを各ディスクの適切なノードに割り当てます。
+
`storage disk assign -disk <disk_name> -owner <node_name>`

.. 各ディスクをスペア ステータスに戻します。
+
`storage disk unfail -disk <disk_name> -s -q`

.. adminモードに戻ります。
+
`set -privilege admin`



|===
+
 `storage aggregate show-spare-disks`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/storage-aggregate-show-spare-disks.html["ONTAPコマンド リファレンス"^]をご覧ください。



====
.結果
指定されたディスクは完全消去され、ホットスペアとして指定されます。完全消去されたディスクのシリアル番号は `/etc/log/sanitized_disks`に書き込まれます。

指定されたディスクの完全消去ログ（各ディスクで完了した内容を示す）が `/mroot/etc/log/sanitization.log`に書き込まれます。

.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=storage+aggregate+show["storage aggregate show"^]
* link:https://docs.netapp.com/us-en/ontap-cli/storage-disk-assign.html["storage disk assign"^]
* link:https://docs.netapp.com/us-en/ontap-cli/storage-disk-unfail.html["ストレージディスクのアンフェイル"^]
* link:https://docs.netapp.com/us-en/ontap-cli/storage-encryption-disk-sanitize.html["ストレージ暗号化ディスク完全消去"^]

