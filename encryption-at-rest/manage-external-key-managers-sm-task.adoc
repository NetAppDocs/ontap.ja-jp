---
permalink: encryption-at-rest/manage-external-key-managers-sm-task.html 
sidebar: sidebar 
keywords: system manager, external key manager, configure external key manager, migrate keys, store keys, authentication keys, encryption keys 
summary: ONTAP 9.13.1以降では、System Managerを使用して外部キー管理ツールを管理し、認証キーと暗号化キーを保存、管理できます。 
---
= ONTAP System Managerで外部キーマネージャを管理する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.7以降では、オンボード キー マネージャを使用して認証キーと暗号化キーを保存、管理できます。ONTAP 9.13.1以降では、外部キー管理ツールを使用してこれらのキーを保存、管理することもできます。

オンボード キー マネージャを使用する場合、キーはクラスタ内部のセキュアなデータベースで格納、管理されます。スコープはクラスタです。外部キー管理ツールを使用する場合、キーはクラスタの外部で格納、管理されます。スコープは、クラスタでもStorage VMでもあり得ます。1つ以上の外部キー管理ツールを使用できます。次の条件が適用されます。

* オンボード キー マネージャが有効になっている場合、外部キー管理ツールをクラスタ レベルで有効にすることはできませんが、Storage VMレベルで有効にすることはできます。
* 外部キー管理ツールがクラスタ レベルで有効になっている場合、オンボード キー マネージャを有効にすることはできません。


外部キー管理ツールを使用する場合、Storage VMとクラスタごとに最大4つのプライマリ キー サーバを登録できます。各プライマリ キー サーバには、最大3台のセカンダリ キー サーバを追加してクラスタ化できます。



== 外部キー管理ツールの設定

ストレージVMに外部キーマネージャーを追加するには、ストレージVMのネットワークインターフェースを構成する際に、オプションのゲートウェイを追加する必要があります。ストレージVMがネットワークルートなしで作成された場合は、外部キーマネージャー用のルートを明示的に作成する必要があります。link:../networking/create_a_lif.html["LIF（ネットワーク インターフェイス）の作成"]を参照してください。

.手順
外部キー管理ツールの設定は、System Manager内の複数のメニューから開始できます。

. 次のいずれかのオプションを使用して、外部キー管理の設定を開始します。
+
[cols="25,25,50"]
|===


| ワークフロー | ナビゲーション | 開始ステップ 


 a| 
Key Managerを設定する
 a| 
*クラスター* > *設定*
 a| 
*セキュリティ*セクションまでスクロールします。*暗号化*でimage:icon_gear.gif["アクションアイコン"]を選択します。*外部キーマネージャー*を選択します。



 a| 
ローカル階層を追加
 a| 
*ストレージ* > *階層*
 a| 
*+ ローカル層の追加*を選択します。「キーマネージャーの設定」チェックボックスをオンにします。*外部キーマネージャー*を選択します。



 a| 
ストレージを準備
 a| 
*ダッシュボード*
 a| 
*容量*セクションで*ストレージの準備*を選択します。次に、「キーマネージャーの設定」を選択します。*外部キーマネージャー*を選択します。



 a| 
暗号化を設定する（ストレージ VM スコープのキー マネージャのみ）
 a| 
*ストレージ* > *Storage VM*
 a| 
ストレージVMを選択します。*設定*タブを選択します。*セキュリティ*の*暗号化*セクションで、image:icon_gear_blue_bg.png["アクションアイコン"]を選択します。

|===
. プライマリ キー サーバーを追加するには、image:icon_add.gif["アイコンを追加"]を選択し、*IP Address or Host Name* および *Port* フィールドに入力します。
. 既にインストールされている証明書は、「*KMIP サーバー CA 証明書*」および「*KMIP クライアント証明書*」フィールドに表示されます。以下のいずれかの操作を実行できます：
+
** image:icon_dropdown_arrow.gif["ドロップダウンアイコン"]を選択して、キー マネージャーにマップするインストール済みの証明書を選択します。（複数のサービス CA 証明書を選択できますが、クライアント証明書は 1 つだけ選択できます。）
** まだインストールされていない証明書を追加し、外部キー マネージャーにマップするには、*新しい証明書の追加*を選択します。
** 外部キー マネージャーにマップしないインストール済みの証明書を削除するには、証明書名の横にあるimage:icon-x-close.gif["閉じるアイコン"]を選択します。


. セカンダリ キー サーバーを追加するには、*セカンダリ キー サーバー*列で*追加*を選択し、詳細を入力します。
. *保存*を選択して設定を完了します。




== 既存の外部キー管理ツールの編集

すでに外部キー管理ツールの設定が完了している場合は、その設定を変更できます。

.手順
. 外部キー管理ツールの設定を編集するには、次のいずれかの手順を実行します。
+
[cols="25,25,50"]
|===


| Scope | ナビゲーション | 開始ステップ 


 a| 
クラスタ スコープの外部キー マネージャ
 a| 
*クラスター* > *設定*
 a| 
*セキュリティ*セクションまでスクロールします。*暗号化*でimage:icon_kabob.gif["メニューオプションアイコン"]を選択し、*外部キーマネージャーの編集*を選択します。



 a| 
Storage VMスコープ外部キー マネージャ
 a| 
*ストレージ* > *Storage VM*
 a| 
ストレージVMを選択します。*設定*タブを選択します。*セキュリティ*の*暗号化*セクションで、image:icon_kabob.gif["メニューオプションアイコン"]を選択し、*外部キーマネージャーの編集*を選択します。

|===
. 既存の鍵サーバーは*鍵サーバー*テーブルにリストされます。以下の操作を実行できます：
+
** image:icon_add.gif["アイコンを追加"]を選択して新しいキー サーバーを追加します。
** キーサーバーを削除するには、キーサーバー名を含むテーブルセルの末尾にあるimage:icon_kabob.gif["メニューオプションアイコン"]を選択します。そのプライマリキーサーバーに関連付けられているセカンダリキーサーバーも設定から削除されます。






== 外部キー管理ツールの削除

ボリュームが暗号化されていない場合は、外部キー管理ツールを削除できます。

.手順
. 次のいずれかの手順を実行して、外部キー管理を削除します。
+
[cols="25,25,50"]
|===


| Scope | ナビゲーション | 開始ステップ 


 a| 
クラスタ スコープの外部キー マネージャ
 a| 
*クラスター* > *設定*
 a| 
*Security*セクションまでスクロールします。*Encryption*でimage:icon_kabob.gif["メニューオプションアイコン"]を選択し、*Delete External Key Manager*を選択します。



 a| 
Storage VMスコープ外部キー マネージャ
 a| 
*ストレージ* > *Storage VM*
 a| 
ストレージVMを選択します。*設定*タブを選択します。*セキュリティ*の*暗号化*セクションで、image:icon_kabob.gif["メニューオプションアイコン"]を選択し、*外部キーマネージャーの削除*を選択します。

|===




== キー管理ツール間のキーの移行

クラスタで複数のキー管理ツールが有効になっている場合、1つのキー管理ツールから別のキー管理ツールにキーを移行する必要があります。このプロセスは、System Managerで自動的に実行されます。

* オンボード キー マネージャまたは外部キー管理ツールがクラスタ レベルで有効になっていて、一部のボリュームが暗号化されている場合、Storage VMレベルで外部キー管理ツールを設定する際には、クラスタ レベルのオンボード キー マネージャまたは外部キー管理ツールからStorage VMレベルの外部キー管理ツールにキーを移行する必要があります。このプロセスは、System Managerで自動的に実行されます。
* 暗号化せずにStorage VMにボリュームを作成した場合、キーを移行する必要はありません。

