---
permalink: encryption-at-rest/manage-external-key-managers-sm-task.html 
sidebar: sidebar 
keywords: system manager, external key manager, configure external key manager, migrate keys, store keys, authentication keys, encryption keys 
summary: ONTAP 9.13.1以降では、System Managerを使用して外部キー管理ツールを管理し、認証キーと暗号化キーを格納および管理できます。 
---
= System Managerを使用して外部キー管理ツールを管理します。
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.7以降では、オンボードキーマネージャを使用して認証キーと暗号化キーを格納および管理できます。ONTAP 9.13.1以降では、外部キー管理ツールを使用してこれらのキーを格納および管理することもできます。

オンボードキーマネージャは、クラスタ内のセキュアなデータベースにキーを格納および管理します。スコープはクラスタです。外部キー管理ツールは、クラスタの外部にキーを格納および管理します。スコープには、クラスタまたはStorage VMを指定できます。1つ以上の外部キー管理ツールを使用できます。次の条件が適用されます。

* オンボードキーマネージャが有効になっている場合、外部キー管理ツールをクラスタレベルで有効にすることはできませんが、Storage VMレベルで有効にすることはできます。
* 外部キー管理ツールがクラスタレベルで有効になっている場合、オンボードキーマネージャを有効にすることはできません。


外部キー管理ツールを使用する場合は、Storage VMおよびクラスタごとに最大4つのプライマリキーサーバを登録できます。各プライマリキーサーバは、最大3台のセカンダリキーサーバでクラスタ化できます。



== 外部キー管理ツールを設定する

Storage VMに外部キー管理ツールを追加するには、Storage VMのネットワークインターフェイスの設定時にオプションのゲートウェイを追加する必要があります。Storage VMをネットワークルートなしで作成した場合は、外部キー管理ツール用のルートを明示的に作成する必要があります。を参照してください link:../networking/create_a_lif.html["LIFを作成する（ネットワークインターフェイス）"]。

.手順
外部キー管理ツールは、System Managerの別の場所から設定できます。

. 外部キー管理ツールを設定するには、次のいずれかの開始手順を実行します。
+
[cols="25,25,50"]
|===


| ワークフロー | ナビゲーション | 開始ステップ 


 a| 
キーマネージャを設定します
 a| 
*[クラスタ]*>*[設定]*
 a| 
[セキュリティ]*セクションまでスクロールします。[暗号化]*で、を選択します image:icon_gear.gif["アクションアイコン"]。[外部キーマネージャ]*を選択します。



 a| 
ローカル階層を追加してください
 a| 
*ストレージ*>*階層*
 a| 
[+ローカル階層の追加]*を選択します。[Configure Key Manager]チェックボックスをオンにします。[外部キーマネージャ]*を選択します。



 a| 
ストレージを準備
 a| 
*ダッシュボード*
 a| 
[容量]*セクションで、*[ストレージの準備]*を選択します。  次に、[Configure Key Manager]を選択します。[外部キーマネージャ]*を選択します。



 a| 
暗号化を設定（キー管理ツールをStorage VMスコープでのみ使用）
 a| 
*ストレージ*>* Storage VM *
 a| 
Storage VMを選択します。[設定]タブを選択します。[セキュリティ]*の*[暗号化]*セクションで、を選択します image:icon_gear_blue_bg.png["アクションアイコン"]。

|===
. プライマリキーサーバを追加するには、を選択し image:icon_add.gif["追加アイコン"]、*[IPアドレス]または[ホスト名]*および*[ポート]*フィールドに入力します。
. インストールされている既存の証明書は、*[KMIP Server CA Certificates]*フィールドと*[KMIP Client Certificate]*フィールドに表示されます。  次のいずれかの操作を実行できます。
+
** を選択し image:icon_dropdown_arrow.gif["ドロップダウンアイコン"] て、キー管理ツールにマッピングするインストール済み証明書を選択します。（複数のサービスCA証明書を選択できますが、選択できるクライアント証明書は1つだけです）。
** まだインストールされていない証明書を追加して外部キー管理ツールにマッピングする場合は、*[新しい証明書の追加]*を選択します。
** 外部キー管理ツールにマッピングしないインストール済みの証明書を削除するには、証明書名の横にあるを選択し image:icon-x-close.gif["閉じるアイコン"] ます。


. セカンダリキーサーバを追加するには、*[セカンダリキーサーバ]*列で*[追加]*を選択し、詳細を指定します。
. [保存]*を選択して設定を完了します。




== 既存の外部キー管理ツールを編集します

すでに外部キー管理ツールを設定している場合は、その設定を変更できます。

.手順
. 外部キー管理ツールの設定を編集するには、次のいずれかの開始手順を実行します。
+
[cols="25,25,50"]
|===


| 適用範囲 | ナビゲーション | 開始ステップ 


 a| 
クラスタスコープの外部キー管理ツール
 a| 
*[クラスタ]*>*[設定]*
 a| 
[セキュリティ]*セクションまでスクロールします。[暗号化]*でを選択し image:icon_kabob.gif["メニューオプションアイコン"]、*[外部キーマネージャの編集]*を選択します。



 a| 
Storage VMスコープの外部キー管理ツール
 a| 
*ストレージ*>* Storage VM *
 a| 
Storage VMを選択します。[設定]タブを選択します。[暗号化]*セクションの*[セキュリティ]*で、を選択し image:icon_kabob.gif["メニューオプションアイコン"]、*[外部キーマネージャの編集]*を選択します。

|===
. 既存のキーサーバは*[キーサーバ]*の表に表示されます。次の操作を実行できます。
+
** を選択して新しいキーサーバを追加し image:icon_add.gif["追加アイコン"]ます。
** キーサーバを削除するには、テーブルセルの末尾にあるキーサーバの名前を選択します image:icon_kabob.gif["メニューオプションアイコン"] 。そのプライマリキーサーバに関連付けられているセカンダリキーサーバも設定から削除されます。






== 外部キー管理ツールを削除します

ボリュームが暗号化されていない場合は、外部キー管理ツールを削除できます。

.手順
. 外部キー管理ツールを削除するには、次のいずれかの手順を実行します。
+
[cols="25,25,50"]
|===


| 適用範囲 | ナビゲーション | 開始ステップ 


 a| 
クラスタスコープの外部キー管理ツール
 a| 
*[クラスタ]*>*[設定]*
 a| 
[セキュリティ]*セクションまでスクロールします。[暗号化]*で、を選択し image:icon_kabob.gif["メニューオプションアイコン"]、*[外部キーマネージャの削除]*を選択します。



 a| 
Storage VMスコープの外部キー管理ツール
 a| 
*ストレージ*>* Storage VM *
 a| 
Storage VMを選択します。[設定]タブを選択します。[暗号化]*セクションの*[セキュリティ]*で、を選択し image:icon_kabob.gif["メニューオプションアイコン"]、*[外部キーマネージャの削除]*を選択します。

|===




== キー管理ツール間でキーを移行する

クラスタで複数のキー管理ツールを有効にしている場合は、キー管理ツール間でキーを移行する必要があります。このプロセスはSystem Managerで自動的に完了します。

* オンボードキーマネージャまたは外部キーマネージャがクラスタレベルで有効になっていて、一部のボリュームが暗号化されている場合は、 その後、Storage VMレベルで外部キー管理ツールを設定する際には、それらのキーをクラスタレベルのオンボードキーマネージャまたは外部キー管理ツールからStorage VMレベルの外部キー管理ツールに移行する必要があります。  このプロセスは、System Managerによって自動的に実行されます。
* Storage VMで暗号化なしでボリュームを作成した場合は、キーを移行する必要はありません。

