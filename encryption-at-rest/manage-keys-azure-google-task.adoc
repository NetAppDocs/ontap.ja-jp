---
permalink: encryption-at-rest/manage-keys-azure-google-task.html 
sidebar: sidebar 
keywords: key management, Azure, AKV, key vault, NVE keys, third-party, GCP, google cloud, Cloud KMS 
summary: Azure Key Vault （ AKV ）を使用すると、 ONTAP 暗号化キーの保護を合理化できます。 
---
= Azure Key Vault または Google Cloud KMS を使用してキーを管理します
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.10.1 以降では、を使用できます link:https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts["Azure キーボールト（ AKV ）"^] および link:https://cloud.google.com/kms/docs["Google Cloud Platform のキー管理サービス（ Cloud KMS ）"^] Azure または Google Cloud Platform 導入アプリケーションで ONTAP 暗号化キーを保護します。

AKV と Cloud KMS を使用して保護することができます link:configure-netapp-volume-encryption-concept.html["NetApp Volume Encryption （ NVE ）キー"] データSVMの場合のみ。

AKV または Cloud KMS を使用したキー管理は、 CLI または ONTAP REST API を使用して有効にすることができます。

AKVまたはCloud KMSを使用する際は、デフォルトでデータSVM LIFがクラウドキー管理エンドポイントとの通信に使用されることに注意してください。ノード管理ネットワークは、クラウドプロバイダの認証サービス（ login.microsoftonline.com for Azure ； oauth2.googleapis.com for Cloud KMS ）との通信に使用されます。クラスタネットワークが正しく設定されていないと、クラスタでキー管理サービスが適切に利用されません。

.前提条件
* ONTAP クラスタのノードで NVE がサポートされている必要があります
* Volume Encryption （ VE ）ライセンスがインストールされている
* Multi-tenant Encryption Key Management （ MTEKM ）ライセンスがインストールされています
* クラスタ管理者またはSVMの管理者である必要があります


.制限
* AKV および Cloud KMS は NSE および NAE には利用できません。 link:enable-external-key-management-96-later-nve-task.html["外部 KMIP"] 代わりに使用できます
* AKV および Cloud KMS は、 MetroCluster 構成では利用できません。
* AKVとCloud KMSはデータSVMでのみ設定できます




== CLI を使用して外部キー管理を有効にします

外部キー管理を有効にする方法は、使用するキー管理ツールによって異なります。Cloud Volumes ONTAP で AKV を有効にする場合は、別の手順 が存在することに注意してください。ニーズに合わせてキー管理ツールと環境のタブを選択します。

[role="tabbed-block"]
====
.Azure
--
.ONTAP 用 Azure Key Vault を有効にします
. 作業を開始する前に、クライアントシークレットまたは証明書のいずれかで、 Azure アカウントから適切な認証クレデンシャルを取得する必要があります。また、クラスタ内のすべてのノードが正常であることを確認する必要があります。これは 'cluster show コマンドで確認できます
. 特権レベルを advanced に設定します（ set -priv advanced
. SVM 「 security key-manager external Azure enable -client-id_client_id_ -stenant -id_ttenant_id _ -name -key_id_ -authentication-method ｛ certificate | client-secret ｝ 」で AKV を有効にするか、プロンプトが表示されたら Azure アカウントからクライアント証明書またはクライアントシークレットを入力します。
. AKVが正しく有効になっていることを確認します。「security key-manager external Azure show vserver_svm_name_`サービスの到達可能性が問題でない場合は、データSVM LIFを介してAKVキー管理サービスへの接続を確立します。


--
.Google Cloud
--
.ONTAP の CLI を使用して Cloud KMS を有効にします
. 作業を開始する前に、 Google Cloud KMS アカウントキーファイルの秘密鍵を JSON 形式で取得する必要があります。これは GCP アカウントにあります。また、クラスタ内のすべてのノードが正常であることを確認する必要があります。これは 'cluster show コマンドで確認できます
. 特権レベルを advanced に設定します（ set -priv advanced
. SVM の「 security key-manager external GCP enable -vserver _data_SVM_name_id_ -project-id_key_ring_id_ -key-ring-name _key_ring_name 」で Cloud KMS を有効にするかどうかを確認するメッセージが表示されたら、 JSON ファイルの内容をプライベートアカウントで入力します
. Cloud KMSが正しいパラメータで構成されていることを確認します。「security key-manager external GCP show vserver_svm_name_`暗号化されたボリュームが作成されていない場合、「kmsラップされた鍵のステータス」は「不明」になります。サービスへの到達可能性がOKでない場合は、データSVM LIFを介してGCPキー管理サービスへの接続を確立します。


--
====
データSVM用にすでに暗号化されたボリュームが1つ以上設定され、管理SVMのオンボードキーマネージャで対応するNVEキーが管理されている場合は、それらのキーを外部キー管理サービスに移行する必要があります。CLIでこの操作を行うには、次のコマンドを実行します。security key-manager key migrate-from -Vserver_admin_svm_name -to-Vserver_data_SVM_`データSVMのNVEキーがすべて移行されるまで、テナントのデータSVM用に新しい暗号化ボリュームを作成することはできません。
