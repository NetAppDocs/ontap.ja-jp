---
permalink: encryption-at-rest/manage-keys-azure-google-task.html 
sidebar: sidebar 
keywords: Azure, AKV, key vault, NVE keys, third-party, GCP, google cloud, Cloud KMS, AWS, amazon 
summary: Azure、Google Cloud、または AWS キー マネージャーを使用して、ONTAP 暗号化キーの保護を効率化します。 
---
= クラウド プロバイダを使用したONTAP データSVMのNVEキーの管理
:allow-uri-read: 


[role="lead"]
ONTAP 9.10.1以降では、link:https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts["Azure Key Vault（AKV）"^]とlink:https://cloud.google.com/kms/docs["Google Cloud Platform の Key Management Service（Cloud KMS）"^]を使用して、クラウドホスト型アプリケーションでONTAP暗号化キーを保護できます。ONTAP 9.12.0以降では、link:https://docs.aws.amazon.com/kms/latest/developerguide/overview.html["AWSのKMS"^]を使用してNVEキーを保護することもできます。

AWS KMS、AKV、Cloud KMS は、データ SVM のlink:configure-netapp-volume-encryption-concept.html["NetApp Volume Encryption（NVE）キー"]の保護にのみ使用できます。

.タスク概要
クラウド プロバイダによるキー管理は、CLIまたはONTAP REST APIを使用して有効にすることができます。

クラウド プロバイダを使用してキーを保護する場合、クラウドキー管理エンドポイントとの通信にはデフォルトでデータSVM LIFが使用されることに注意してください。クラウド プロバイダの認証サービス（Azureの場合はlogin.microsoftonline.com、Cloud KMSの場合はoauth2.googleapis.com）との通信にはノード管理ネットワークが使用されます。クラスタ ネットワークが正しく設定されていない場合、クラスタはキー管理サービスを適切に使用できません。

クラウド プロバイダのキー管理サービスを利用する場合は、次の制限事項に注意してください。

* クラウド プロバイダ キー管理は、NetApp Storage Encryption（NSE）およびNetApp Aggregate Encryption（NAE）では使用できません。代わりにlink:enable-external-key-management-96-later-nve-task.html["外部KMIP"]を使用できます。
* クラウド プロバイダによるキー管理は、MetroCluster構成では利用できません。
* クラウド プロバイダによるキー管理を設定できるのは、データSVMのみです。


.開始する前に
* 適切なクラウド プロバイダでKMSを設定しておく必要があります。
* ONTAPクラスタのノードでNVEがサポートされている必要があります。
* link:../encryption-at-rest/install-license-task.html["ボリューム暗号化（VE）ライセンスとマルチテナント暗号化キー管理（MTEKM）ライセンスがインストールされている必要があります。"]。これらのライセンスはlink:../system-admin/manage-licenses-concept.html#licenses-included-with-ontap-one["ONTAP One"]に含まれています。
* クラスタ管理者またはSVM管理者である必要があります。
* データSVMに暗号化されたボリュームが含まれていないことと、キー管理ツールを使用していないことを確認してください。データSVMに暗号化されたボリュームが含まれている場合は、KMSを設定する前にそれらのボリュームを移行する必要があります。




== 外部キー管理の有効化

外部キー管理を有効にする方法は、使用するキー管理ツールによって異なります。適切なキー管理ツールと環境のタブを選択します。

[role="tabbed-block"]
====
.AWS
--
.開始する前に
* 暗号化を管理するIAMロールで使用されるAWS KMSキーに対応するグラントを作成する必要があります。IAMロールには、次の処理を許可するポリシーが含まれている必要があります。
+
** `DescribeKey`
** `Encrypt`
** `Decrypt` + 詳細については、link:https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#grant["助成金"^]のAWSドキュメントを参照してください。




.ONTAP SVMでAWS KMVを有効にする
. 作業を開始する前に、AWS KMSからアクセスキーIDとシークレット キーを取得しておきます。
. 権限レベルを advanced に設定します：
`set -priv advanced`
. AWS KMS を有効にする：
`security key-manager external aws enable -vserver _svm_name_ -region _AWS_region_ -key-id _key_ID_ -encryption-context _encryption_context_`
. プロンプトが表示されたら、シークレット キーを入力します。
. AWS KMS が正しく設定されていることを確認します：
`security key-manager external aws show -vserver _svm_name_`
+
 `security key-manager external aws`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=security+key-manager+external+aws["ONTAPコマンド リファレンス"^]を参照してください。



--
.Azure
--
.ONTAP SVMでAzure Key Vaultを有効にする
. 始める前に、Azureアカウントから適切な認証クレデンシャル（クライアントシークレットまたは証明書）を取得する必要があります。また、クラスター内のすべてのノードが正常であることを確認する必要があります。これは次のコマンドで確認できます `cluster show`。 `cluster show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/cluster-show.html["ONTAPコマンド リファレンス"^]を参照してください。
. 権限レベルを advanced に設定します
`set -priv advanced`
. SVM で AKV を有効にします。
`security key-manager external azure enable -client-id _client_id_ -tenant-id _tenant_id_ -name -key-id _key_id_ -authentication-method {certificate|client-secret}`プロンプトが表示されたら、Azure アカウントのクライアント証明書またはクライアント シークレットを入力します。
. AKV が正しく有効化されていることを確認します：
`security key-manager external azure show vserver _svm_name_`サービスの到達可能性が正常でない場合は、データ SVM LIF を介して AKV キー管理サービスへの接続を確立します。
+
 `security key-manager external azure`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=security+key-manager+external+azure["ONTAPコマンド リファレンス"^]を参照してください。



--
.Google Cloud
--
.ONTAP SVMでCloud KMSを有効にする
. 始める前に、Google Cloud KMSアカウントキーファイルの秘密鍵をJSON形式で取得してください。これはGCPアカウントで確認できます。また、クラスタ内のすべてのノードが正常であることを確認する必要があります。これはコマンド `cluster show`で確認できます。 `cluster show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/cluster-show.html["ONTAPコマンド リファレンス"^]を参照してください。
. 特権レベルを詳細に設定します：
`set -priv advanced`
. SVMでCloud KMSを有効にする
`security key-manager external gcp enable -vserver _svm_name_ -project-id _project_id_-key-ring-name _key_ring_name_ -key-ring-location _key_ring_location_ -key-name _key_name_`プロンプトが表示されたら、Service Account Private Keyを含むJSONファイルの内容を入力します
. Cloud KMS が正しいパラメータで設定されていることを確認してください：
`security key-manager external gcp show vserver _svm_name_` `kms_wrapped_key_status`のステータスは、暗号化されたボリュームが作成されていない場合、 `"UNKNOWN"`になります。サービス到達可能性が OK でない場合は、データ SVM LIF を介して GCP 鍵管理サービスへの接続を確立してください。
+
 `security key-manager external gcp`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=security+key-manager+external+gcp["ONTAPコマンド リファレンス"^]を参照してください。



--
====
データSVMに1つ以上の暗号化ボリュームがすでに設定されており、対応するNVEキーが管理SVMのオンボードキーマネージャによって管理されている場合は、それらのキーを外部キー管理サービスに移行する必要があります。CLIでこれを行うには、次のコマンドを実行します：
`security key-manager key migrate -from-Vserver _admin_SVM_ -to-Vserver _data_SVM_`データSVMのすべてのNVEキーが正常に移行されるまで、テナントのデータSVMに新しい暗号化ボリュームを作成することはできません。

.関連情報
* link:https://docs.netapp.com/us-en/cloud-manager-cloud-volumes-ontap/task-encrypting-volumes.html["Cloud Volumes ONTAP の NetApp 暗号化ソリューションによるボリュームの暗号化"^]
* link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=security+key-manager+external+["セキュリティ キーマネージャー外部"^]

