---
permalink: fabricpool/fabricpool-object-deletion.html 
sidebar: sidebar 
keywords: fabricpool, fabric pool, tiering, delete, defrag, unreclaimed, threshold 
summary: FabricPoolは、オブジェクト内のブロックの一定の割合がONTAPで参照されなくなったあとでオブジェクトを削除します。 
---
= ONTAP FabricPoolオブジェクトの削除とデフラグをカスタマイズする
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
FabricPoolは、接続されたオブジェクト ストレージからブロックを削除しません。代わりに、オブジェクト内のブロックの一定の割合がONTAPで参照されなくなった時点で、FabricPoolはオブジェクトを削除します。

たとえば、Amazon S3に階層化された4MBのオブジェクトには、1,024個の4KBブロックがあります。デフラグと削除は、205個未満の4KBブロック（1,024個の20％）がONTAPによって参照されるまで発生しません。十分な数のブロック（1,024個）に参照がない場合、元の4MBオブジェクトが削除され、新しいオブジェクトが作成されます。

再利用されていないスペースのしきい値の割合をカスタマイズして、オブジェクトストアごとに異なるデフォルトレベルに設定できます。デフォルト設定は次のとおりです。

|===


| オブジェクト ストア | ONTAP 9.8以降 | ONTAP 9.7 から 9.4 | ONTAP 9.3以前 | Cloud Volumes ONTAP 


 a| 
Amazon S3
 a| 
20%
 a| 
20%
 a| 
0%
 a| 
30%



 a| 
Google Cloud Storage
 a| 
20%
 a| 
12%
 a| 
N/A
 a| 
35%



 a| 
Microsoft Azure Blob Storage
 a| 
25%
 a| 
15%
 a| 
N/A
 a| 
35%



 a| 
NetApp ONTAP S3
 a| 
40%
 a| 
N/A
 a| 
N/A
 a| 
N/A



 a| 
NetApp StorageGRID
 a| 
40%
 a| 
40%
 a| 
0%
 a| 
N/A

|===


== 解放されていないスペースのしきい値

デフォルトの再利用されていないスペースのしきい値設定を変更すると、オブジェクトの断片化の許容量が増減します。断片化を減らすと、追加のオブジェクトストアリソース（読み取りと書き込み）を犠牲にして、クラウド階層で使用される物理容量が削減されます。



=== しきい値の削減

追加のコストを回避するには、ストレージ コストを削減しながら読み取りコストを増加させるオブジェクト ストレージの価格設定スキームを使用する際に、再利用されないスペースのしきい値を削減することを検討します。たとえば、AmazonのStandard-IAやAzure Blob StorageのCoolなどです。

たとえば、法的な理由で保存された10年前のプロジェクトのボリュームを階層化すると、Standard-IAやCoolなどの価格設定スキームを使用する場合、標準価格設定スキームを使用する場合よりもコストが低くなる可能性があります。このようなボリュームの読み取りは、オブジェクトのデフラグに必要な読み取りも含めて高価ですが、頻繁に発生することはほとんどありません。



=== しきい値の増加

また、オブジェクトの断片化によってONTAPで参照されるデータに必要以上に多くのオブジェクトストアの容量が使用される場合は、再利用されていないスペースのしきい値を増やすことを検討してください。たとえば、すべてのオブジェクトが最大許容範囲まで均等に断片化されるという最悪のシナリオで再利用されていないスペースのしきい値を20%に設定すると、クラウド階層の合計容量の80%がONTAPで参照されなくなる可能性があります。例：

ONTAPで参照される2TBとONTAPで参照されない8TBを合わせて、クラウド階層で使用される総容量は10TBになります。

この場合は、解放されていないスペースのしきい値を増やすか、ボリュームの最小クーリング日数を増やして、参照されていないブロックで使用される容量を減らすことができます。

[NOTE]
====
システムでオブジェクトがデフラグされてストレージ効率が向上すると、より効率的な新しいオブジェクトに参照ブロックを書き込むことで、基盤となるファイルが断片化される可能性があります。再利用されていないスペースのしきい値を大幅に増やすと、ストレージ効率に優れたオブジェクトを作成できますが、シーケンシャル読み取りのパフォーマンスは低下します。

この追加アクティビティにより、AWS、Azure、GoogleなどのサードパーティのS3プロバイダのコストが増加します。

NetAppでは、未解放スペースのしきい値を60%を超えないようにすることを推奨しています。

====


== 再利用されていないスペースのしきい値を変更する

オブジェクトストアごとに再利用されていないスペースのしきい値をカスタマイズできます。

.開始する前に
Advanced権限レベルが必要です。

.手順
. デフォルトの再利用されていないスペースのしきい値を変更するには、をカスタマイズして次のコマンドを実行します。
+
[source, cli]
----
storage aggregate object-store modify -aggregate <name> -object-store-name <name> -unreclaimedspace-threshold <%> (0%-99%)
----


.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/storage-aggregate-object-store-modify.html["ストレージ集約オブジェクトストア変更"^]

