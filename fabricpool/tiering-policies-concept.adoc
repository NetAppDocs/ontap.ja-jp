---
permalink: fabricpool/tiering-policies-concept.html 
sidebar: sidebar 
keywords: understanding, fabricpool, tiering, policies, types, modify, volume, clone, cloud migration 
summary: FabricPool階層化ポリシーを使用すると、データがホットまたはコールドになったときに階層間でデータを効率的に移動できます。階層化ポリシーについて理解しておくと、ストレージ管理のニーズに適したポリシーを選択するのに役立ちます。 
---
= FabricPool階層化ポリシーについて
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
FabricPool階層化ポリシーを使用すると、データがホットまたはコールドになったときに階層間でデータを効率的に移動できます。階層化ポリシーについて理解しておくと、ストレージ管理のニーズに適したポリシーを選択するのに役立ちます。



== FabricPool階層化ポリシーの種類

FabricPool 階層化ポリシーは、 FabricPool 内のボリュームのユーザデータブロックをクラウド階層に移動するタイミングとそのタイミングを、ホット（アクティブ）のボリューム「 temperature 」またはコールド（非アクティブ）に基づいて決定します。ボリューム「温度」は、頻繁にアクセスされると増加し、アクセスされない場合は減少します。一部の階層化ポリシーには、階層化の最小クーリング期間が関連付けられています。最小クーリング期間は、データが「コールド」とみなされてクラウド階層に移動されるために、 FabricPool のボリューム内のユーザデータが非アクティブのままになる時間を設定します。

ブロックがコールドとして識別されると、階層化の対象としてマークされます。毎日のバックグラウンド階層化スキャンでコールドブロックが検索されます。同じボリュームから十分な4KBブロックが収集されると、それらは4MBオブジェクトに連結され、ボリューム階層化ポリシーに基づいてクラウド階層に移動されます。

[NOTE]
====
階層化ポリシーを使用するボリューム内のデータ `all`はすぐにコールドとしてマークされ、できるだけ早くクラウド階層への階層化が開始されます。毎日の階層化スキャンの実行を待つ必要はありません。

====
FabricPoolボリュームの階層化ステータスは、コマンドを使用して表示できます `volume object-store tiering show`。詳細については、を参照してlink:https://docs.netapp.com/us-en/ontap-cli/["コマンドリファレンス"]ください。

FabricPool階層化ポリシーはボリュームレベルで指定します。次の4つのオプションがあります。

* 階層化ポリシー（デフォルト）は `snapshot-only`、アクティブなファイルシステムに関連付けられていないボリュームSnapshotコピーのユーザデータブロックをクラウド階層に移動します。
+
階層化の最小クーリング期間は2日です。階層化の最小クーリング期間のデフォルト設定は、advanced権限レベルのパラメータを `volume create`使用して変更できます `-tiering-minimum-cooling-days` `volume modify`。有効な値は、ONTAP 9 .8以降を使用した場合の2~183日です。9.8より前のバージョンのONTAPを使用している場合、有効な値は2~63日です。

* この `auto`階層化ポリシーはONTAP 9 .4以降のリリースでのみサポートされ、Snapshotコピーとアクティブなファイルシステムの両方のコールドユーザデータブロックをクラウド階層に移動します。
+
デフォルトの階層化の最小クーリング期間は31日で、アクティブなファイルシステムとSnapshotコピーの両方について、ボリューム全体に適用されます。

+
階層化の最小クーリング期間のデフォルト設定は、advanced権限レベルのパラメータを `volume create`使用して変更できます `-tiering-minimum-cooling-days` `volume modify`。有効な値は2～183日です。

*  `all`階層化ポリシー（ONTAP 9 .6以降でのみサポート）は、アクティブなファイルシステムとSnapshotコピーの両方のすべてのユーザデータブロックをクラウド階層に移動します。階層化ポリシーに代わる `backup`ものです。
+
 `all`クライアントトラフィックが正常な読み取り/書き込みボリュームでは、ボリューム階層化ポリシーを使用しないでください。

+
階層化スキャンの実行と同時にデータがクラウド階層に移動するため、階層化の最小クーリング期間は適用されません。この設定は変更できません。

*  `none`階層化ポリシーは、ボリュームのデータを高パフォーマンス階層に保持し、コールドデータをクラウド階層に移動しません。
+
階層化ポリシーをに設定すると、 `none`新しい階層化が行われなくなります。以前にクラウド階層に移動されたボリュームデータは、ホットになるまでクラウド階層に残り、自動的にローカル階層に戻ります。

+
データがクラウド階層に移動されることはないため、階層化の最小クーリング期間は適用されません。この設定は変更できません。

+
階層化ポリシーがに設定されているボリューム内のコールドブロックが読み取られると、 `none`それらはホットになり、ローカル階層に書き込まれます。



 `volume show`コマンド出力には、ボリュームの階層化ポリシーが表示されます。FabricPoolで使用されたことがないボリュームの場合、出力に階層化ポリシーが表示され `none`ます。



== FabricPoolでボリュームの階層化ポリシーを変更した場合の動作

ボリュームの階層化ポリシーは、を実行することで変更できます `volume modify`。階層化ポリシーを変更することが、データがコールドと認識されてクラウド階層に移動されるまでの時間にどのように影響するかを理解しておく必要があります。

* 階層化ポリシーをまたは `none`に `auto`変更する `snapshot-only`と、アクティブなファイルシステムのすでにコールドなユーザデータブロックがONTAPからクラウド階層に送信されます。これは、それらのユーザデータブロックが以前はクラウド階層に送信されなかった場合でも同様です。
* 階層化ポリシーを別のポリシーからに変更する `all`と、ONTAPはアクティブなファイルシステムとSnapshotコピー内のすべてのユーザブロックをできるだけ早くクラウドに移動します。ONTAP 9 8より前は、次の階層化スキャンが実行されるまで待機する必要があったブロックがありました。
+
移動されたブロックを高パフォーマンス階層に戻すことはできません。

* 階層化ポリシーをからまたはに `snapshot-only`変更して `auto`も、 `none`すでにクラウド階層に移動されたアクティブなファイルシステムブロックはパフォーマンス階層に戻されません。
+
ボリュームの読み取りは、データを高パフォーマンス階層に戻すために必要です。

* ボリュームの階層化ポリシーを変更すると、階層化の最小クーリング期間は常にそのポリシーのデフォルト値にリセットされます。




== ボリュームを移動した場合の階層化ポリシーへの影響

* ボリュームを対応アグリゲートに移動したりFabricPool対応アグリゲートから移動したりする際に、別の階層化ポリシーを明示的に指定しないかぎり、ボリュームの階層化ポリシーは元のままです。
+
ただし、階層化ポリシーが有効になるのは、ボリュームがFabricPool対応アグリゲートに含まれている場合のみです。

* ボリュームのパラメータの既存の値は `-tiering-minimum-cooling-days`、デスティネーションに別の階層化ポリシーを指定しないかぎり、ボリュームとともに移動されます。
+
別の階層化ポリシーを指定した場合は、そのポリシーのデフォルトの階層化の最小クーリング期間が使用されます。デスティネーションがFabricPoolかどうかは関係ありません。

* アグリゲート間でボリュームを移動し、同時に階層化ポリシーも変更できます。
* 処理に階層化ポリシーが関係する `auto`場合は、特に注意が必要です `volume move`。
+
次の表に、ソースとデスティネーションの両方がFabricPool対応アグリゲートである場合の、に関するポリシーの変更を実行した処理 `auto`の結果を示し `volume move`ます。

+
|===


| ボリュームの階層化ポリシー | 移動時に設定する階層化ポリシー | ボリューム移動後の結果 


 a| 
`all`
 a| 
`auto`
 a| 
すべてのデータが高パフォーマンス階層に移動されます。



 a| 
`snapshot-only`、 `none`、または `auto`
 a| 
`auto`
 a| 
データブロックは、ソースと同じデスティネーションの階層に移動されます。



 a| 
`auto`または `all`
 a| 
`snapshot-only`
 a| 
すべてのデータが高パフォーマンス階層に移動されます。



 a| 
`auto`
 a| 
`all`
 a| 
すべてのユーザデータがクラウド階層に移動されます。



 a| 
`snapshot-only`,`auto`または `all`
 a| 
`none`
 a| 
すべてのデータが高パフォーマンス階層に保持されます。

|===




== ボリュームをクローニングした場合の階層化ポリシーへの影響

* ONTAP 9.8以降、クローン ボリュームは常に階層化ポリシーとクラウド読み出しポリシーの両方を親ボリュームから継承します。
+
ONTAP 9 .8より前のリリースでは、親に階層化ポリシーが設定されている場合を除き、クローンは親から階層化ポリシーを継承します。 `all`

* 親ボリュームにクラウド読み出しポリシーが設定されている場合、 `never`クローンボリュームにはクラウド読み出しポリシーまたは `all`階層化ポリシーと、対応するクラウド読み出しポリシーが `default`設定されている必要があります `never`。
* 親ボリュームのクラウド読み出しポリシーをに変更する `never`には、クローンボリュームにクラウド読み出しポリシーがすべて設定され `never`ている必要があります。


ボリュームをクローニングするときは、次のベストプラクティスに注意してください。

*  `-tiering-policy`クローンのオプションと `tiering-minimum-cooling-days`オプションは、クローンに固有のブロックの階層化動作のみを制御します。そのため、親FlexVolでは、どのクローンよりも同じ量または少ない量のデータしか移動しない階層化設定を使用することを推奨します。
* 親FlexVolのクラウド読み出しポリシーでは、すべてのクローンの読み出しポリシーと同じ量かそれよりも多くのデータを移動する必要があります。




== 階層化ポリシーとクラウド移行との相互運用性

FabricPoolのクラウドデータ読み出しは階層化ポリシーで制御されます。階層化ポリシーは、読み取りパターンに基づいてクラウド階層から高パフォーマンス階層へのデータの読み出しを決定します。読み取りパターンにはシーケンシャルとランダムがあります。

次の表に、階層化ポリシーと各ポリシーのクラウドデータ読み出しルールを示します。

|===


| 階層化ポリシー | 読み出し動作 


 a| 
なし
 a| 
シーケンシャルリードとランダムリード



 a| 
Snapshotのみ
 a| 
シーケンシャルリードとランダムリード



 a| 
自動
 a| 
ランダムリード



 a| 
すべて
 a| 
データ読み出しなし

|===
ONTAP 9 .8以降では、クラウド移行制御 `cloud-retrieval-policy`オプションによって、階層化ポリシーで制御されるデフォルトのクラウド移行（読み出し）動作が上書きされます。

次の表に、サポートされているクラウド読み出しポリシーとその読み出し動作を示します。

|===


| クラウド読み出しポリシー | 読み出し動作 


 a| 
デフォルト
 a| 
どのデータを移行するかは階層化ポリシーによって決定されるため、「デフォルト」のクラウドデータの読み出しに変更はありません,`" `cloud-retrieval-policy`。このポリシーは、ホストされているアグリゲートのタイプに関係なく、すべてのボリュームのデフォルト値です。



 a| 
オンリード
 a| 
クライアントによって読み取られたデータはすべてクラウド階層から高パフォーマンス階層に移行されます。



 a| 
しない
 a| 
クライアントによって読み取られたデータはクラウド階層から高パフォーマンス階層に移行されません。



 a| 
プロモート
 a| 
* 階層化ポリシー「 none 」の場合、すべてのクラウドデータはクラウド階層からパフォーマンス階層にプルされます
* 階層化ポリシー「スナップショットのみ」の場合、「 AFS データ」はプルされます。


|===