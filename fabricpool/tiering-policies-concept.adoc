---
permalink: fabricpool/tiering-policies-concept.html 
sidebar: sidebar 
keywords: understanding, fabricpool, tiering, policies, types, modify, volume, clone, cloud migration 
summary: FabricPool 階層化ポリシーを使用すると、データがホットまたはコールドになったときに階層間でデータを効率的に移動できます。階層化ポリシーの概要を理解することで、ストレージ管理のニーズに応じた適切なポリシーを選択できます。 
---
= FabricPool 階層化ポリシーについて
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
FabricPool 階層化ポリシーを使用すると、データがホットまたはコールドになったときに階層間でデータを効率的に移動できます。階層化ポリシーの概要を理解することで、ストレージ管理のニーズに応じた適切なポリシーを選択できます。



== FabricPool 階層化ポリシーのタイプ

FabricPool 階層化ポリシーは、 FabricPool 内のボリュームのユーザデータブロックをクラウド階層に移動するタイミングとそのタイミングを、ホット（アクティブ）のボリューム「 temperature 」またはコールド（非アクティブ）に基づいて決定します。ボリューム「温度」は、頻繁にアクセスされると増加し、アクセスされない場合は減少します。一部の階層化ポリシーには、階層化の最小クーリング期間が関連付けられています。最小クーリング期間は、データが「コールド」とみなされてクラウド階層に移動されるために、 FabricPool のボリューム内のユーザデータが非アクティブのままになる時間を設定します。

ブロックがコールドとして識別されると、階層化の対象としてマークされます。  毎日のバックグラウンド階層化スキャンでコールドブロックが検索されます。同じボリュームから十分な4KBブロックが収集されると、それらは4MBオブジェクトに連結され、ボリューム階層化ポリシーに基づいてクラウド階層に移動されます。

[NOTE]
====
シヨウシタホリユウムナイノテエタ `all` 階層化ポリシーはすぐにコールドとしてマークされ、できるだけ早くクラウド階層への階層化を開始します。毎日の階層化スキャンの実行を待つ必要はありません。

====
を使用できます `volume object-store tiering show` コマンドを使用してFabricPoolボリュームの階層化ステータスを表示します。詳細については、を参照してください link:https://docs.netapp.com/us-en/ontap-cli-9131/["コマンドリファレンス"]。

FabricPool 階層化ポリシーはボリュームレベルで指定し、次の 4 つのオプションがあります。

* 。 `snapshot-only` 階層化ポリシー（デフォルト）は、アクティブなファイルシステムに関連付けられていないボリュームSnapshotコピーのユーザデータブロックをクラウド階層に移動します。
+
階層化の最小クーリング期間は 2 日です。階層化の最小クーリング期間のデフォルト設定は、で変更できます `-tiering-minimum-cooling-days` パラメータを指定します `volume create` および `volume modify` コマンド有効な値は、 ONTAP 9.8 以降で 2 ～ 183 日です。9.8 より前のバージョンの ONTAP を使用している場合、有効な値は 2~63 日です。

* 。 `auto` 階層化ポリシーはONTAP 9.4以降のリリースでのみサポートされ、Snapshotコピーとアクティブなファイルシステムの両方のコールドユーザデータブロックをクラウド階層に移動します。
+
アクティブなファイルシステムと Snapshot コピーのどちらについても、階層化の最小クーリング期間のデフォルトは 31 日、ボリューム全体の環境を設定します。

+
階層化の最小クーリング期間のデフォルト設定は、で変更できます `-tiering-minimum-cooling-days` パラメータを指定します `volume create` および `volume modify` コマンド有効な値は 2 ～ 183 日です。

* 。 `all` 階層化ポリシー（ONTAP 9.6以降でのみサポート）は、アクティブなファイルシステムとSnapshotコピーの両方のすべてのユーザデータブロックをクラウド階層に移動します。の代わりになります `backup` 階層化ポリシー：
+
。 `all` クライアントトラフィックが正常な読み取り/書き込みボリュームでは、ボリューム階層化ポリシーを使用しないでください。

+
階層化スキャンの実行と同時にデータがクラウド階層に移動するため、階層化の最小クーリング期間は適用されません。この設定は変更できません。

* 。 `none` 階層化ポリシーはボリュームのデータを高パフォーマンス階層に保持し、コールドデータをクラウド階層に移動しません。
+
階層化ポリシーをに設定しています `none` 新しい階層化を防止以前にクラウド階層に移動されたボリュームデータは、ホットになるまでクラウド階層に残り、自動的にローカル階層に戻ります。

+
データがクラウド階層に移動されることはないため、階層化の最小クーリング期間は適用されません。この設定は変更できません。

+
階層化ポリシーがに設定されているボリューム内のコールドブロック `none` が読み取られ、ホットになり、ローカル階層に書き込まれます。



。 `volume show` コマンド出力には、ボリュームの階層化ポリシーが表示されます。FabricPool で使用されたことがないボリュームにはが表示されます `none` 出力に階層化ポリシーが表示されます。



== FabricPool でボリュームの階層化ポリシーを変更した場合の動作

ボリュームの階層化ポリシーを変更するには、を実行します `volume modify` 操作。階層化ポリシーを変更することが、データがコールドと認識されてクラウド階層に移動されるまでの時間にどのように影響するかを理解しておく必要があります。

* 階層化ポリシーをから変更しています `snapshot-only` または `none` 終了： `auto` アクティブなファイルシステム内のすでにコールドなユーザデータブロックをONTAP からクラウド階層に送信します。これは、それらのユーザデータブロックが以前はクラウド階層に送信されなかった場合でも同様です。
* 階層化ポリシーをに変更しています `all` 別のポリシーでは、階層化スキャンの次回実行時に、アクティブなファイルシステムとSnapshotコピー内のすべてのユーザブロックがONTAP によってクラウド階層に移動されます。
+
移動されたブロックを高パフォーマンス階層に戻すことはできません。

* 階層化ポリシーをから変更しています `auto` 終了： `snapshot-only` または `none` は、すでにクラウド階層に移動されて高パフォーマンス階層に戻すために移動されたアクティブなファイルシステムブロックを原因 にしません。
+
データを高パフォーマンス階層に戻すには、ボリュームの読み取りが必要です。

* ボリュームの階層化ポリシーを変更すると、階層化の最小クーリング期間は常にそのポリシーのデフォルト値にリセットされます。




== ボリュームを移動した場合の階層化ポリシーへの影響

* ボリュームを FabricPool 対応アグリゲートに移動したり FabricPool 対応アグリゲートから移動しても、別の階層化ポリシーを明示的に指定しないかぎり、ボリュームの階層化ポリシーは元のままです。
+
ただし、階層化ポリシーが適用されるのは、ボリュームが FabricPool 対応アグリゲート内にある場合のみです。

* の既存の値 `-tiering-minimum-cooling-days` ボリュームのパラメータは、デスティネーションに別の階層化ポリシーを指定しないかぎり、ボリュームと一緒に移動します。
+
別の階層化ポリシーを指定した場合は、そのポリシーのデフォルトの階層化の最小クーリング期間が使用されます。デスティネーションが FabricPool かどうかは関係ありません。

* アグリゲート間でボリュームを移動し、同時に階層化ポリシーも変更できます。
* あなたは特別な注意を払う必要がありますときa `volume move` 操作には、が含まれます `auto` 階層化ポリシー：
+
次の表に、ソースとデスティネーションの両方がFabricPool対応アグリゲートである場合の処理結果を示します `volume move` に関連するポリシーの変更を含む処理 `auto`：

+
|===


| ボリュームの階層化ポリシー | 移動時に設定する階層化ポリシー | ボリューム移動後の結果 


 a| 
`all`
 a| 
`auto`
 a| 
すべてのデータが高パフォーマンス階層に移動されます。



 a| 
`snapshot-only`、 `none`または `auto`
 a| 
`auto`
 a| 
データブロックは、以前ソースと同じデスティネーションの階層に移動されます。



 a| 
`auto` または `all`
 a| 
`snapshot-only`
 a| 
すべてのデータが高パフォーマンス階層に移動されます。



 a| 
`auto`
 a| 
`all`
 a| 
すべてのユーザデータがクラウド階層に移動されます。



 a| 
`snapshot-only`,`auto` または `all`
 a| 
`none`
 a| 
すべてのデータが高パフォーマンス階層に保持されます。

|===




== ボリュームをクローニングした場合の階層化ポリシーへの影響

* ONTAP 9.8 以降では、クローンボリュームは常に階層化ポリシーとクラウド読み出しポリシーの両方を親ボリュームから継承します。
+
ONTAP 9.8より前のリリースでは、親にがある場合を除き、クローンは親から階層化ポリシーを継承します `all` 階層化ポリシー：

* 親ボリュームにがある場合 `never` クラウド読み出しポリシーを使用している場合、クローンボリュームにはどちらかのが必要です `never` クラウド読み出しポリシーまたは `all` 階層化ポリシー、および対応するクラウド読み出しポリシー `default`。
* 親ボリュームのクラウド読み出しポリシーをに変更することはできません `never` すべてのクローンボリュームにクラウド読み出しポリシーが設定されていない場合 `never`。


ボリュームをクローニングするときは、次のベストプラクティスに注意してください。

* 。 `-tiering-policy` オプションおよび `tiering-minimum-cooling-days` クローンのオプションで制御されるのは、クローンに固有のブロックの階層化のみです。そのため、親 FlexVol では、同じ量のデータを移動するか、クローンよりも少ないデータを移動する階層化設定を使用することを推奨します
* 親 FlexVol でのクラウド読み出しポリシーでは、同じ量のデータを移動するか、いずれかのクローンの読み出しポリシーよりも多くのデータを移動する必要があります




== 階層化ポリシーがクラウド移行とどのように連携するか

FabricPool クラウドデータの読み出しは、読み取りパターンに基づいてクラウド階層からパフォーマンス階層へのデータの読み出しを決定する階層化ポリシーで制御されます。読み取りパターンは、シーケンシャルまたはランダムのいずれかです。

次の表に、各ポリシーについて、階層化ポリシーとクラウドデータの読み出しルールを示します。

|===


| 階層化ポリシー | 取得動作 


 a| 
なし
 a| 
シーケンシャルリードとランダムリード



 a| 
Snapshot のみ
 a| 
シーケンシャルリードとランダムリード



 a| 
自動
 a| 
ランダムリード



 a| 
すべて
 a| 
データの取得は行われません

|===
ONTAP 9.8以降では、クラウド移行の管理が可能になりました `cloud-retrieval-policy` オプションは、階層化ポリシーで制御されるデフォルトのクラウド移行または読み出し動作を上書きします。

次の表に、サポートされているクラウドの読み出しポリシーとその読み出し動作を示します。

|===


| クラウド取得ポリシー | 取得動作 


 a| 
デフォルト
 a| 
どのデータを移行するかは階層化ポリシーによって決定されるため、「デフォルト」のクラウドデータの読み出しに変更はありません,`" `cloud-retrieval-policy`。ホストされているアグリゲートタイプに関係なく、このポリシーはすべてのボリュームのデフォルト値です。



 a| 
オンリード
 a| 
クライアントからの読み取りは、すべてクラウド階層からパフォーマンス階層に送られます。



 a| 
なし
 a| 
クラウド階層からパフォーマンス階層にクライアントベースのデータが移動されることはありません



 a| 
ステートアップ
 a| 
* 階層化ポリシー「 none 」の場合、すべてのクラウドデータはクラウド階層からパフォーマンス階層にプルされます
* 階層化ポリシー「スナップショットのみ」の場合、「 AFS データ」はプルされます。


|===