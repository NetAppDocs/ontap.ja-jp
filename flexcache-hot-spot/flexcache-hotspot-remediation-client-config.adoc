---
permalink: flexcache-hot-spot/flexcache-hotspot-remediation-client-config.html 
sidebar: sidebar 
keywords: tr, hotspot, hot-spot, flexcache, hdfa, client configuration 
summary: ホットスポットを解決するには、CPUボトルネックを防ぐ役割を果たすようにクライアントを適切に設定する必要があります。 
---
= ONTAP NAS接続を分散するようにクライアントを構成する
:allow-uri-read: 


[role="lead"]
ホットスポットを解決するには、CPUボトルネックを防ぐ役割を果たすようにクライアントを適切に設定します。



== Linuxクライアントの設定

SVM内またはSVM間のHDFAデプロイメントを選択した場合でも、Linuxで `autofs`を使用して、クライアントが異なるHDF間で負荷分散されていることを確認する必要があります。 `autofs`の設定は、SVM間とSVM内で異なります。

.開始する前に
 `autofs`と適切な依存関係をインストールする必要があります。詳細については、Linuxのドキュメントを参照してください。

.タスク概要
説明する手順では、次のエントリを含むサンプルの `/etc/auto_master`ファイルを使用します：

[listing]
----
/flexcache auto_hotspot
----
この設定により、プロセスが `/flexcache`ディレクトリにアクセスしようとするたびに、 `autofs`が `/etc`ディレクトリ内の `auto_hotspot`というファイルを検索します。 `auto_hotspot`ファイルの内容により、 `/flexcache`ディレクトリ内にマウントするNFSサーバとジャンクション パスが指定されます。ここで説明する例は、 `auto_hotspot`ファイルのさまざまな設定です。



=== SVM内HDFA autofs設定

以下の例では、<<Figure-1,図1>>の図の `autofs`マップを作成します。各キャッシュは同じジャンクションパスを持ち、ホスト名 `cache`には4つのDNS Aレコードがあるため、必要な行は1行だけです：

[listing]
----
hotspot cache:/hotspot
----
このシンプルな1行で、NFSクライアントはホスト名 `cache`のDNSルックアップを実行します。DNSはラウンドロビン方式でIPアドレスを返すように設定されています。これによりフロントエンドNAS接続が均等に分散されます。クライアントはIPアドレスを受信すると、ジャンクションパス `/hotspot`を `/flexcache/hotspot`にマウントします。接続先のSVMはSVM1、SVM2、SVM3、またはSVM4ですが、どのSVMに接続しても構いません。

.図1：2x2x2インターSVM HDFA
image:flexcache-hotspot-hdfa-2x2x2-inter-svm-hdfa.png["図1：2x2x2 HDFA"]



=== SVM内HDFA autofs設定

以下の例では、<<Figure-2,図2>>の図の `autofs`マップを作成します。NFSクライアントがHDFジャンクション パス デプロイメントに含まれるIPをマウントするようにする必要があります。つまり、 `/hotspot1`をIPアドレス192.168.0.11以外でマウントしないようにする必要があります。そのためには、 `auto_hotspot`マップ内の1つのローカル マウント場所に対して、4つのIP/ジャンクション パスのペアをすべてリストします。


NOTE: 次の例のバックスラッシュ（(`\`）はエントリを次の行に継続し、読みやすくします。

[listing]
----
hotspot     cache1:/hostspot1 \
            cache2:/hostspot2 \
            cache3:/hostspot3 \
            cache4:/hostspot4
----
クライアントが `/flexcache/hotspot`にアクセスしようとすると、 `autofs`は4つのホスト名すべてに対して前方参照を実行します。4つのIPアドレスすべてがクライアントと同じサブネット内にあるか、異なるサブネット内にあると仮定すると、 `autofs`は各IPアドレスに対してNFS NULL pingを発行します。

このNULL pingでは、ONTAPのNFSサービスによるパケット処理が必要ですが、ディスクアクセスは必要ありません。最初に返されるpingが、 `autofs`がマウントに選択するIPアドレスとジャンクションパスになります。

.図2：4x1x4 SVM内HDFA
image:flexcache-hotspot-hdfa-4x1x4-intra-svm-hdfa.png["図2：s4x1x4 SVM内HDFA"]



== Windowsクライアントの設定

Windowsクライアントでは、SVM内HDFAを使用する必要があります。SVM内の異なるHDF間で負荷分散を行うには、各HDFに一意の共有名を追加する必要があります。その後、link:https://learn.microsoft.com/en-us/windows-server/storage/dfs-namespaces/create-a-dfs-namespace["Microsoftのドキュメント"^]の手順に従って、同じフォルダに複数のDFSターゲットを実装してください。
