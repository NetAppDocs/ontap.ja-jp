---
permalink: flexcache-writeback/flexcache-write-back-guidelines.html 
sidebar: sidebar 
keywords: tr-4743, flexcache writeback, flexcache write-back, flexcache, write-back, write back, guidelines, best practices, performance, ontap tr, netapp tr 
summary: FlexCacheライトバックを使用するときに最適なパフォーマンスを確保するには、次のガイドラインに従ってください。 
---
= ONTAP FlexCacheライトバックガイドライン
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
FlexCacheライトバックには、オリジンとキャッシュ間の複雑な相互作用が多数発生します。最適なパフォーマンスを得るには、環境が以下のガイドラインに準拠していることを確認してください。これらのガイドラインは、コンテンツ作成時点で利用可能な最新のメジャーONTAPバージョン（ONTAP 9.17.1）に基づいています。

ベストプラクティスとして、本番環境のワークロードを非本番環境でテストすることをお勧めします。これらのガイドラインに従わずにFlexCacheライトバックを実装する場合は、特に重要です。

以下のガイドラインはNetApp社内で十分にテストされています。これらのガイドラインに従うことを*_強く_*推奨します。従わない場合、予期しない動作が発生する可能性があります。

* ONTAP 9.17.1P1では、FlexCacheライトバック機能が大幅に強化されました。オリジンクラスタとキャッシュクラスタの両方で、9.17.1P1の適用後は最新の推奨リリースを実行することを*強く*推奨します。9.17.1コードラインを実行できない場合は、9.16.1の最新のPリリースを次の推奨リリースとしてご利用ください。ONTAP 9.15.1にはFlexCacheライトバック機能に必要な修正と改善がすべて含まれていないため、本番環境のワークロードには推奨されません。
* 現在のバージョンでは、FlexCache の書き戻しキャッシュは、FlexCache ボリューム全体に対して単一のコンスティチュエントで構成する必要があります。複数コンスティチュエントの FlexCache を使用すると、キャッシュから不要なデータのエビクションが発生する可能性があります。
* テストは100GB未満のファイルと、キャッシュとオリジン間のWANラウンドトリップタイムが200ミリ秒を超えない条件で実施されています。これらの制限を超えるワークロードでは、予期しないパフォーマンス特性が発生する可能性があります。
* SMB代替データストリームへの書き込みは、メインファイルをキャッシュから削除します。メインファイルに対して他の処理を実行する前に、メインファイルのすべてのダーティー データをオリジンにフラッシュする必要があります。代替データストリームもオリジンに転送されます。
* ファイル名を変更すると、そのファイルはキャッシュから削除されます。そのファイルに対して他の操作を実行する前に、そのファイルのすべてのダーティー データをオリジンにフラッシュする必要があります。
* 現時点では、ライトバック対応FlexCacheボリューム上のファイルで変更または設定できる属性は次のとおりです：
+
** タイムスタンプ
** モードビット
** NT ACL
** 所有者
** グループ
** サイズ
+
その他の属性の変更または設定はオリジンに転送され、その結果、ファイルがキャッシュから削除される可能性があります。キャッシュでその他の属性の変更または設定が必要な場合は、アカウント チームにPVRの開設を依頼してください。



* オリジンでスナップショットを作成すると、そのオリジンボリュームに関連付けられたライトバック対応キャッシュから、未処理のダーティー データがすべて呼び出されます。大量のライトバック処理が進行中の場合、ダーティファイルの削除に時間がかかるため、この操作を複数回再試行する必要がある可能性があります。
* 書き込み用の SMB 便宜的ロック（Oplock）は、ライトバック対応FlexCacheボリュームではサポートされません。
* オリジンの使用量は常に80%未満である必要があります。オリジンボリュームの空き容量が20%未満の場合、キャッシュボリュームへの排他ロック委任は許可されません。この場合、ライトバック対応キャッシュへの呼び出しはオリジンに転送されます。これにより、オリジンの空き容量が不足し、ライトバック対応キャッシュにダーティー データが孤立してしまうのを防ぐことができます。
* 低帯域幅やロスの多いクラスタ間ネットワークは、FlexCacheライトバックのパフォーマンスに重大な悪影響を及ぼす可能性があります。帯域幅に関する具体的な要件はありませんが、ワークロードに大きく依存するため、キャッシュとオリジン間のクラスタ間リンクの健全性を確保することを*_強く_*推奨します。

