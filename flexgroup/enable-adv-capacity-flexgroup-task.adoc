---
permalink: flexgroup/enable-adv-capacity-flexgroup-task.html 
sidebar: sidebar 
keywords: flexgroup advanced capacity balancing, flexgroup granular data distribution, gdd, flexgroup, volume, balancing 
summary: ONTAP 9.16.1 以降では、非常に大きなファイルが増加して 1 つのメンバー ボリューム上のスペースを消費する場合に、FlexGroup メンバー ボリューム間でデータを分散するための高度な容量バランスが導入されています。 
---
= ファイル データの再分配によるONTAP FlexGroupボリュームのバランシング
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.16.1以降では、高度な容量バランシング機能を有効にすることで、大容量ファイルが肥大化して1つのメンバー ボリュームのスペースが消費された場合にFlexGroupメンバー ボリューム間でデータを分散させることができます。

高度な容量バランシングは、ONTAP 9.12.1で導入されたきめ細かなデータ機能を拡張し、ONTAPがlink:manage-flexgroup-rebalance-task.html["FlexGroupボリュームの再調整"]ファイルを他のメンバーに移動できるようにします。ONTAP 9.16.1以降では、 `-granular-data advanced`オプションを使用して高度な容量バランシングを有効にすると、「基本的な」ファイル再バランシング機能と高度な容量機能の両方がアクティブ化されます。

[NOTE]
====
ファイルのリバランシングと高度な容量バランシングは、どちらもデフォルトで無効になっています。これらの機能は、いったん有効にすると、無効にすることはできません。容量バランシングを無効にする必要がある場合は、高度な容量バランシングを有効にする前に作成されたSnapshotからリストアする必要があります。

====
高度な容量バランシングは、新しい書き込みによって10GBまたはボリュームの空きスペースの1%に達するとトリガーされます。



== ファイルの分散方法

作成された大容量ファイルまたは肥大化したファイルによって高度な容量バランシングがトリガーされると、ファイルは、メンバーFlexGroupボリュームに1GBから10GBの間のストライプで分散されます。

高度な容量バランシングが有効な場合、ONTAPは、既存の大容量ファイルをさかのぼってストライピングしません。高度な容量バランシングを有効にしたあとも既存の大容量ファイルが肥大化し続ける場合は、ファイルのサイズと使用可能なスペースに応じて、既存の大容量ファイルの新しいコンテンツがメンバーFlexGroupボリュームにストライピングされることがあります。

高度な容量バランシングでストライプ幅を決定する1つの方法として、メンバー ボリュームで使用可能な空きスペースの量が使用されます。高度な容量バランシングにより、使用可能な空きスペースの1%のファイル ストライプが作成されます。つまり、使用可能なスペースが増えるとストライプのサイズが大きくなり、FlexGroupがいっぱいになるとストライプのサイズが小さくなります。



== サポートされるプロトコル

高度な容量バランシングは、次のプロトコルでサポートされます。

* NFSv3、NFSv4、NFSv4.1
* pNFS
* SMB




== 高度な容量バランシングの有効化

デフォルトでは、高度な容量バランシングは無効になっています。FlexGroup容量を自動的にバランシングするには、高度な容量バランシングを有効にする必要があります。この機能は、いったん有効にすると無効にすることはできません。ただし、高度な容量バランシングを有効にする前に作成されたSnapshotからリストアすることはできます。

.開始する前に
* クラスタのすべてのノードでONTAP 9.16.1以降が実行されている必要があります。
* 高度な容量バランシングが有効になっている場合、ONTAP 9.16.1より前のリリースにリバートすることはできません。リバートが必要な場合は、高度な容量バランシングを有効にする前に作成されたSnapshotからリストアする必要があります。
* SVMでNFSコピー オフロード(`vserver nfs -vstorage enabled`が有効になっている場合、FlexGroupボリュームで高度な容量バランス調整を有効にすることはできません。同様に、SVM内のいずれかのFlexGroupボリュームで高度な容量バランス調整が有効になっている場合も、NFSコピー オフロードを有効にすることはできません。
* 高度な容量バランス調整はFlexCacheライトバックではサポートされません。
* SnapMirror転送は、ONTAP 9.16.1以降を実行しているクラスタ内のボリュームで高度な容量バランシングが有効になっている場合、ONTAP 9.16.1より前のONTAPバージョンではサポートされません。


.タスク概要
詳細データ オプション（基本または高度）を使用してDPデスティネーション ボリュームを作成する場合、SnapMirror転送が完了するまで、デスティネーションには設定が「disabled」と表示されます。転送が完了すると、DPデスティネーションに詳細データが「enabled」と表示されます。



=== FlexGroupの作成時の高度な容量バランシングの有効化

.手順
System ManagerまたはONTAP CLIを使用して、新しいFlexGroupボリュームを作成するときに高度な容量バランシングを有効にすることができます。

[role="tabbed-block"]
====
.System Manager
--
. *ストレージ > ボリューム* に移動して image:icon_add_blue_bg.gif["アイコンを追加"] をクリックします。
. *ボリュームの追加*ウィンドウで、ボリューム名とサイズを入力します。次に、*その他のオプション*をクリックします。
. *ストレージと最適化*の下で、*ボリュームデータをクラスター全体に分散する（FlexGroup）*を選択します。
. *Advanced capacity balancing*を選択します。
. ボリュームの設定を完了し、*保存*をクリックします。


--
.CLI
--
. 高度な容量バランシングを有効にしてボリュームを作成します。
+
[source, cli]
----
volume create -vserver <svm name> -volume <volume name> -size <volume size> -auto-provision-as flexgroup -junction-path /<path> -granular-data advanced
----
+
例：

+
[listing]
----
volume create -vserver vs0 -volume newvol -size 1TB -auto-provision-as flexgroup -junction-path /newvol -granular-data advanced
----


--
====


=== 既存のFlexGroupボリュームでの高度な容量バランシングの有効化

.手順
System ManagerまたはONTAP CLIを使用して、高度な容量バランシングを有効化できます。

[role="tabbed-block"]
====
.System Manager
--
. *ストレージ > ボリューム* に移動し、image:icon_kabob.gif["メニューオプションアイコン"]をクリックして、*編集 > ボリューム* を選択します。
. *ボリュームの編集* ウィンドウの *ストレージと最適化* で、*高度な容量バランス調整* を選択します。
. *保存*をクリックします。


--
.CLI
--
. 既存のFlexGroupボリュームを変更して、高度な容量バランシングを有効にします。
+
[source, cli]
----
volume modify -vserver <svm name> -volume <volume name> -granular-data advanced
----
+
例：

+
[listing]
----
volume modify -vserver vs0 -volume newvol  -granular-data advanced
----


--
====