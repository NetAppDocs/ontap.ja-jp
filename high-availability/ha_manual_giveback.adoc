---
sidebar: sidebar 
permalink: high-availability/ha_manual_giveback.html 
keywords: ontap, high, availability, ha, pair, manual, giveback, interrupted, vetoed, veto, commands, performing, perform 
summary: パートナー ノードのプロセスを終了する標準ギブバック、または強制ギブバックを実行できます。 
---
= ONTAPの手動ギブバックコマンド
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
パートナー ノードのプロセスを終了する標準ギブバック、または強制ギブバックを実行できます。


NOTE: ギブバックを実行する前に、link:../disks-aggregates/index.html["ディスクおよびアグリゲートの管理"]の説明に従って、引き継いだシステム内の障害が発生したドライブを削除する必要があります。



== ギブバックが中断された場合

ギブバック プロセスの実行中にテイクオーバー ノードで障害が発生したり停電が起きたりすると、そのプロセスは停止します。また、障害が修復されるか電力が回復するまでテイクオーバー ノードはテイクオーバー モードになります。

ただし、障害がギブバックのどの段階で発生したかによって、この動作が変わることがあります。障害や停電が部分的なギブバック状態の間（ルート アグリゲートのギブバックの完了後）に発生した場合、ノードはテイクオーバー モードにはならず、部分的なギブバックモードになります。この場合、プロセスを完了するには、ギブバック処理をもう一度実行します。



== ギブバックが拒否された場合

ギブバックが拒否された場合、EMSメッセージを調べて原因を特定する必要があります。原因に応じて、拒否を無視しても問題がないかどうかを判断することができます。

この `storage failover show-giveback`コマンドは、ギブバックの進行状況と、ギブバックを拒否したサブシステム（存在する場合）を表示します。ソフト拒否はオーバーライドできますが、ハード拒否は強制されてもオーバーライドできません。以下の表は、オーバーライドすべきではないソフト拒否と、推奨される回避策をまとめたものです。

次のコマンドを使用して、ギブバックの拒否に関するEMSの詳細を確認できます。

`event log show -node * -event gb*`

 `event log show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/event-log-show.html["ONTAPコマンド リファレンス"^]を参照してください。



== ルート アグリゲートのギブバック

次の拒否は、アグリゲートの再配置処理には適用されません。

[cols="35,65"]
|===


| 拒否サブシステムモジュール | 回避策 


 a| 
vfiler_low_level
 a| 
拒否の原因となっているSMBセッションを終了するか、セッションが開いているSMBアプリケーションをシャットダウンします。

この拒否を無視すると、SMBを使用しているアプリケーションが突然切断され、データが失われる可能性があります。



 a| 
Disk Check
 a| 
ギブバックを実行する前に、障害が発生したかバイパスされたディスクをすべて取り外します。ディスクの完全消去を実行中の場合は、処理が完了するまで待ちます。

この拒否を無視すると、リザベーションの競合やアクセスできないディスクが原因でアグリゲートやボリュームがオフラインになり、システムが停止する可能性があります。

|===


== SFOアグリゲートのギブバック

次の拒否は、アグリゲートの再配置処理には適用されません。

[cols="35,65"]
|===


| 拒否サブシステムモジュール | 回避策 


 a| 
Lock Manager
 a| 
ファイルを開いているSMBアプリケーションを適切な手順でシャットダウンするか、それらのボリュームを別のアグリゲートに移動します。

この拒否を無視すると、SMBロックの状態が失われ、システムが停止してデータが失われます。



 a| 
Lock Manager NDO
 a| 
ロックがミラーされるまで待ちます。

この拒否を無視すると、Microsoft Hyper-V仮想マシンへのアクセスが中断します。



| RAID  a| 
EMSメッセージを調べて拒否の原因を特定します。

NVFailが原因の場合は、オフラインのボリュームとアグリゲートをオンラインにします。

ディスクの追加処理またはディスク所有権の再割り当て処理を実行中の場合は、処理が完了するまで待ちます。

アグリゲートの名前またはUUIDの競合が原因の場合は、問題を解決します。

ミラーの再同期、ミラーの検証、またはオフライン ディスクが原因の場合は無視してかまいません。ギブバック後に処理が再開されます。



| ディスク インベントリ  a| 
トラブルシューティングを行って、問題の原因を特定して解決します。

移行中のアグリゲートに属するディスクは、デスティネーション ノードで認識できないことがあります。

ディスクにアクセスできないと、アグリゲートまたはボリュームにアクセスできない可能性があります。



| ボリューム移動処理  a| 
トラブルシューティングを行って、問題の原因を特定して解決します。

この拒否は、重要なカットオーバー フェーズ中にボリューム移動処理が中止されるのを防止します。カットオーバー中にジョブが中止されると、ボリュームにアクセスできなくなる可能性があります。

|===


=== 手動ギブバックの実行用コマンド

メンテナンスの完了後、またはテイクオーバーの原因となった問題を解決した後、HAペアのノードでギブバックを手動で開始して、ストレージを元の所有者に返すことができます。

|===


| 状況 | 使用するコマンド 


 a| 
パートナーノードにストレージを返す
| `storage failover giveback ‑ofnode _nodename_` 


 a| 
パートナーがギブバック待機モードでない場合でもストレージをギブバックする
 a| 
`storage failover giveback ‑ofnode _nodename_`
`‑require‑partner‑waiting false`

このオプションは、長時間クライアントが停止しても問題がない場合にのみ使用してください。



| ギブバック処理がプロセスで拒否されてもストレージをギブバックする（強制的にギブバックを実行する）  a| 
`storage failover giveback ‑ofnode _nodename_`
`‑override‑vetoes true`

このオプションを使用すると、長時間クライアントが停止したり、ギブバックの完了後にアグリゲートやボリュームがオンラインにならなくなったりする可能性があります。



| CFOアグリゲート（ルート アグリゲート）だけをギブバックする  a| 
`storage failover giveback ‑ofnode _nodename_`

`‑only‑cfo‑aggregates true`



| ギブバック コマンドの実行後にギブバックの進捗を監視する | `storage failover show‑giveback` 
|===
.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/storage-failover-giveback.html["storage failover giveback"^]
* link:https://docs.netapp.com/us-en/ontap-cli/storage-failover-show-giveback.html["storage failover show-giveback"^]

