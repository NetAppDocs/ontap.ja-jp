---
sidebar: sidebar 
permalink: high-availability/ha_manual_giveback.html 
keywords: ontap, high, availability, ha, pair, manual, giveback, interrupted, vetoed, veto, commands, performing, perform 
summary: パートナーノードのプロセスを終了する標準ギブバック、または強制ギブバックを実行できます。 
---
= ONTAP 手動ギブバックコマンド
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
パートナーノードのプロセスを終了する標準ギブバック、または強制ギブバックを実行できます。


NOTE: ギブバックを実行する前に、テイクオーバーされたシステムから障害が発生したドライブを取り外す必要があります（を参照）link:../disks-aggregates/index.html["ディスクとアグリゲートの管理"]。



== ギブバックが中断された場合

ギブバックプロセス中にテイクオーバーノードで障害や停電が発生すると、そのプロセスは停止し、障害が修復されるか電源が復旧するまでテイクオーバーノードはテイクオーバーモードに戻ります。

ただし、これは障害が発生したギブバックの段階によって異なります。（ルートアグリゲートのギブバック後に）部分的なギブバック状態の間に障害や停電が発生した場合、ノードはテイクオーバーモードに戻りません。代わりに、部分的なギブバックモードに戻ります。この場合、プロセスを完了するには、ギブバック処理をもう一度実行します。



== ギブバックが拒否された場合

ギブバックが拒否された場合は、EMSメッセージを確認して原因を特定する必要があります。理由に応じて、拒否を無視しても問題がないかどうかを判断できます。

 `storage failover show-giveback`ギブバックの進捗が表示されます。ギブバックを拒否したサブシステムがある場合はそのサブシステムも表示されます。ソフトな拒否は無視できますが、ハードな拒否は、強制した場合でも無視できません。次の表に、無視すべきでないソフトな拒否と推奨される対処方法を示します。

次のコマンドを使用して、ギブバックの拒否に関するEMSの詳細を確認できます。

`event log show -node * -event gb*`

の詳細については `event log show`、をlink:https://docs.netapp.com/us-en/ontap-cli/event-log-show.html["ONTAPコマンド リファレンス"^]参照してください。



== ルートアグリゲートのギブバック

次の拒否は、アグリゲートの再配置処理には適用されません。

[cols="35,65"]
|===


| 拒否しているサブシステムモジュールです | 回避策 


 a| 
vFiler_low_level
 a| 
拒否の原因となっているSMBセッションを終了するか、開いているセッションを確立したSMBアプリケーションをシャットダウンします。

この拒否を無視すると、SMBを使用しているアプリケーションが原因によって突然切断され、データが失われる可能性があります。



 a| 
ディスクチェック
 a| 
ギブバックを実行する前に、障害が発生したかバイパスされたディスクをすべて取り外します。ディスクの完全消去を実行中の場合は、処理が完了するまで待ちます。

この拒否を無視すると、リザベーションの競合やディスクにアクセスできないことが原因でアグリゲートやボリュームがオフラインになり、システムが停止する可能性があります。

|===


== SFOアグリゲートのギブバック

次の拒否は、アグリゲートの再配置処理には適用されません。

[cols="35,65"]
|===


| 拒否しているサブシステムモジュールです | 回避策 


 a| 
ロックマネージャ
 a| 
ファイルを開いているSMBアプリケーションを正常にシャットダウンするか、それらのボリュームを別のアグリゲートに移動します。

この拒否を無視すると、SMBロック状態が失われ、システムが停止してデータが失われます。



 a| 
ロックマネージャNDO
 a| 
ロックがミラーされるまで待ちます。

この拒否を無視すると、Microsoft Hyper-V仮想マシンが停止します。



| RAID  a| 
EMSメッセージを確認して拒否の原因を特定します。

nvfileが原因で拒否された場合は、オフラインのボリュームとアグリゲートをオンラインにします。

ディスクの追加処理またはディスク所有権の再割り当て処理を実行中の場合は、処理が完了するまで待ちます。

アグリゲート名またはUUIDの競合が原因で拒否された場合は、問題をトラブルシューティングして解決します。

ミラーの再同期、ミラーの検証、またはディスクのオフライン化が原因で拒否された場合は無視してかまいません。ギブバック後に処理が再開されます。



| ディスクインベントリ  a| 
トラブルシューティングを行い、問題の原因を特定して解決します。

移行中のアグリゲートに属するディスクをデスティネーションノードで認識できないことがあります。

ディスクにアクセスできないと、アグリゲートまたはボリュームにアクセスできない可能性があります。



| ボリューム移動処理  a| 
トラブルシューティングを行い、問題の原因を特定して解決します。

この拒否は、重要なカットオーバーフェーズ中にボリューム移動処理が中止されるのを防ぎます。カットオーバー中にジョブが中止されると、ボリュームにアクセスできなくなる可能性があります。

|===


=== 手動ギブバックの実行用コマンド

HA ペアのノードで、メンテナンスが完了したあとやテイクオーバーの原因となった問題を解決したあとに元の所有者にストレージを戻すには、手動でギブバックを開始します。

|===


| 状況 | 使用するコマンド 


 a| 
パートナーノードにストレージをギブバックします
| `storage failover giveback ‑ofnode _nodename_` 


 a| 
パートナーがギブバック待機モードになっていなくてもストレージをギブバックします
 a| 
`storage failover giveback ‑ofnode _nodename_`
`‑require‑partner‑waiting false`

このオプションは、長時間クライアントが停止しても問題がない場合にのみ使用してください。



| ギブバック処理がプロセスで拒否されてもストレージをギブバックする（強制的にギブバックを実行する）  a| 
`storage failover giveback ‑ofnode _nodename_`
`‑override‑vetoes true`

このオプションを使用すると、長時間クライアントが停止したり、ギブバック後にアグリゲートやボリュームがオンラインにならなくなったりする可能性があります。



| CFOアグリゲート（ルートアグリゲート）のみをギブバックする  a| 
`storage failover giveback ‑ofnode _nodename_`

`‑only‑cfo‑aggregates true`



| givebackコマンドの実行後にギブバックの進捗を監視する | `storage failover show‑giveback` 
|===
.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/storage-failover-giveback.html["storage failover giveback"^]
* link:https://docs.netapp.com/us-en/ontap-cli/storage-failover-show-giveback.html["storage failover show-giveback"^]

