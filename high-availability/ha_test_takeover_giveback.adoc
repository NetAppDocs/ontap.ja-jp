---
sidebar: sidebar 
permalink: high-availability/ha_test_takeover_giveback.html 
keywords: ontap, high, availability, ha, pair, test, testing, takeover, giveback 
summary: HAペアのすべての側面を設定した後、テイクオーバーとギブバック操作中に両方のノードのストレージへの中断のないアクセスを維持するという点で、期待どおりに動作していることを確認する必要があります 
---
= ONTAPクラスタでのテイクオーバーとギブバックのテスト
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
HAペアのすべての設定が完了したら、テイクオーバー処理やギブバック処理の際に両方のノードのストレージに中断なくアクセスできることを確認する必要があります。テイクオーバーの処理中は、通常はパートナー ノードから提供されるデータがローカル（テイクオーバー）ノードで継続して提供されるようにする必要があります。ギブバックの際に、パートナーのストレージを制御および提供する役割がパートナー ノードに戻らなければなりません。

.手順
. HAインターコネクト ケーブルの接続を調べて、確実に接続されていることを確認します。
. ライセンスが付与されたプロトコルごとに、両方のノードでファイルを作成および検出できることを確認します。
. 次のコマンドを入力します。
+
`storage failover takeover -ofnode partnernode`

+
 `storage failover takeover`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/storage-failover-takeover.html["ONTAPコマンド リファレンス"^]を参照してください。

. 次のいずれかのコマンドを入力して、テイクオーバーが実行されたことを確認します。
+
`storage failover show-takeover`

+
`storage failover show`

+
--
 `storage failover`コマンドの `-auto-giveback`オプションが有効になっている場合：

|===


| ノード | パートナー | テイクオーバーが可能か | 状態の説明 


| ノード1 | ノード2 | - | Waiting for giveback 


| ノード2 | ノード1 | false | テイクオーバーでは、数秒以内にAuto givebackが開始されます 
|===
 `storage failover`コマンドの `-auto-giveback`オプションを無効にしている場合：

|===


| ノード | パートナー | テイクオーバーが可能か | 状態の説明 


| ノード1 | ノード2 | - | Waiting for giveback 


| ノード2 | ノード1 | false | In takeover 
|===
--
. パートナー ノード（ノード2）に属するディスクのうち、テイクオーバー ノード（ノード1）で検出できるすべてのディスクを表示します。
+
`storage disk show -home node2 -ownership`

+
--
次のコマンドは、Node1が検出できるNode2に属するすべてのディスクを表示します：
`cluster::> storage disk show -home node2 -ownership`

|===


| ディスク | Aggregate | ホーム | 所有者 | DR ホーム | ホームID | 所有者ID | DR ホーム ID | 予約者 | プール 


| 1.0.2 | - | ノード2 | ノード2 | - | 4078312453 | 4078312453 | - | 4078312452 | Pool0 


| 1.0.3 | - | ノード2 | ノード2 | - | 4078312453 | 4078312453 | - | 4078312452 | Pool0 
|===
--
. テイクオーバー ノード（ノード1）がパートナー ノード（ノード2）のアグリゲートを制御していることを確認します。
+
`aggr show ‑fields home‑id,home‑name,is‑home`

+
--
|===


| アグリゲート | ホームID | ホーム名h | ホームである 


 a| 
aggr0_1
 a| 
2014942045
 a| 
ノード1
 a| 
true



 a| 
aggr0_2
 a| 
4078312453
 a| 
ノード2
 a| 
false



 a| 
aggr1_1
 a| 
2014942045
 a| 
ノード1
 a| 
true



| aggr1_2 | 4078312453 | ノード2  a| 
false

|===
テイクオーバー中、パートナーノードのアグリゲートの「`is-home`」値は false になります。

--
. 「`Waiting for giveback`」というメッセージが表示されたら、パートナー ノードのデータ サービスをギブバックします。
+
`storage failover giveback -ofnode partnernode`

. 次のいずれかのコマンドを入力して、ギブバック処理の進捗を監視します。
+
`storage failover show-giveback`

+
`storage failover show`

. ギブバックが正常に終了したというメッセージが表示されたかどうかに応じて、次の手順に進みます。
+
--
|===


| テイクオーバーとギブバックの場合… | 操作 


| 正常に完了 | パートナー ノードで手順2～8を繰り返します。 


| 失敗 | テイクオーバーまたはギブバックのエラーを修正してから、この手順をもう一度実行します。 
|===
--


.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/storage-disk-show.html["storage disk show"^]
* link:https://docs.netapp.com/us-en/ontap-cli/storage-failover-giveback.html["storage failover giveback"^]
* link:https://docs.netapp.com/us-en/ontap-cli/storage-failover-show.html["storage failover show"^]
* link:https://docs.netapp.com/us-en/ontap-cli/storage-failover-show-giveback.html["storage failover show-giveback"^]

