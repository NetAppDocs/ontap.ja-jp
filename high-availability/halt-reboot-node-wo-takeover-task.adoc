---
sidebar: sidebar 
permalink: high-availability/halt-reboot-node-wo-takeover-task.html 
keywords: high availability pair, hair, inhibit-takeover, reboot, epsilon, HA 
summary: 2ノード クラスタにおいて、ノードやシェルフで特定のハードウェア メンテナンスを実施する際にパートナー ノードを稼働させておくことでダウンタイムを抑えたい場合や、何らかの問題で手動テイクオーバーを実行できない状態でパートナー ノードのアグリゲートを稼働させてデータの提供を続けたい場合、テイクオーバーを開始せずにノードを停止またはリブートします。この手順は、テクニカル サポートに問題のトラブルシューティングを依頼した場合に、その一環として実行するように求められることもあります。 
---
= 2ノードクラスタでテイクオーバーを開始せずにONTAPノードを停止または再起動する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
2ノード クラスタにおいて、ノードやシェルフで特定のハードウェア メンテナンスを実施する際にパートナー ノードを稼働させておくことでダウンタイムを抑えたい場合や、何らかの問題で手動テイクオーバーを実行できない状態でパートナー ノードのアグリゲートを稼働させてデータの提供を続けたい場合、テイクオーバーを開始せずにノードを停止またはリブートします。この手順は、テクニカル サポートに問題のトラブルシューティングを依頼した場合に、その一環として実行するように求められることもあります。

.タスク概要
* テイクオーバーを禁止する前に（ `-inhibit-takeover true`パラメータを使用して）、クラスタHAを無効にします。


[CAUTION]
====
* 2ノードクラスタでは、クラスタHAにより、1つのノードに障害が発生してもクラスタが無効になることはありません。ただし、 `-inhibit-takeover true`パラメータを使用する前にクラスタHAを無効にしないと、両方のノードでデータ処理が停止します。
* クラスタHAを無効にせずにノードを停止またはリブートしようとすると、ONTAPから警告が表示され、クラスタHAを無効にするように指示されます。


====
* オンラインのままにするパートナー ノードにLIF（論理インターフェイス）を移行します。
* 停止またはリブートするノードに稼働したままにしたいアグリゲートがある場合は、それらをオンラインのままにするノードに移動します。


.手順
. 両方のノードが正常であることを確認します：
`cluster show`
+
両方のノードについて、 `true`が `Health`列に表示されます。

+
[listing]
----
cluster::> cluster show
Node         Health  Eligibility
------------ ------- ------------
node1        true     true
node2        true     true
----
+
 `cluster show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/cluster-show.html["ONTAPコマンド リファレンス"^]をご覧ください。

. 停止または再起動するノードからすべての LIF をパートナーノードに移行します：
`network interface migrate-all -node _node_name_`
+
 `network interface migrate-all`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-migrate-all.html["ONTAPコマンド リファレンス"^]をご覧ください。

. 停止またはリブートするノードにノードの停止時にオンラインのままにしておくアグリゲートがある場合は、それらをパートナー ノードに再配置します。それ以外の場合は、次の手順に進みます。
+
.. 停止または再起動するノード上のアグリゲートを表示します：
`storage aggregates show -node _node_name_`
+
たとえば、node1が停止またはリブートするノードの場合、次のようになります。

+
[listing]
----
cluster::> storage aggregates show -node node1
Aggregate  Size  Available  Used%  State  #Vols   Nodes   RAID  Status
---------  ----  ---------  -----  -----  -----   -----   ----  ------
aggr0_node_1_0
           744.9GB   32.68GB   96% online       2 node1    raid_dp,
                                                                normal
aggr1       2.91TB    2.62TB   10% online       8 node1    raid_dp,
                                                                normal
aggr2
            4.36TB    3.74TB   14% online      12 node1    raid_dp,
                                                                normal
test2_aggr  2.18TB    2.18TB    0% online       7 node1    raid_dp,
                                                                normal
4 entries were displayed.
----
.. アグリゲートをパートナーノードに移動します：
`storage aggregate relocation start -node _node_name_ -destination _node_name_ -aggregate-list _aggregate_name_`
+
たとえば、アグリゲートaggr1、aggr2、およびtest2_aggrをnode1からnode2に移動します。

+
`storage aggregate relocation start -node _node1_ -destination _node2_ -aggregate-list _aggr1_,_aggr2_,_test2_aggr_`



. クラスター HA を無効にする：
`cluster ha modify -configured false`
+
戻り出力により、HAが無効になっていることが確認されます： `Notice: HA is disabled`

+

NOTE: この処理ではストレージ フェイルオーバーは無効になりません。

. 該当するコマンドを使用して、ターゲット ノードをテイクオーバーなしで停止またはリブートします。
+
** `system node halt -node _node_name_ -inhibit-takeover true`
** `system node reboot -node _node_name_ -inhibit-takeover true`
+

NOTE: コマンド出力に、続行するかどうかを尋ねる警告が表示されるので、 `y`と入力します。



. まだオンラインになっているノードが正常な状態であることを確認します（パートナーがダウンしている間）：
`cluster show`
+
オンラインノードの場合は、 `Health`列に `true`が表示されます。

+

NOTE: コマンド出力に、クラスタHAが構成されていないことを示す警告が表示されます。この警告は無視してかまいません。

. ノードの停止またはリブートに必要な操作を実行します。
. LOADER プロンプトからオフラインのノードをブートします：
`boot_ontap`
. 両方のノードが正常であることを確認します：
`cluster show`
+
両方のノードについて、 `true`が `Health`列に表示されます。

+

NOTE: コマンド出力に、クラスタHAが構成されていないことを示す警告が表示されます。この警告は無視してかまいません。

. クラスタ HA を再度有効にします：
`cluster ha modify -configured true`
. この手順の前半でアグリゲートをパートナーノードに再配置した場合は、それらをホームノードに戻します。それ以外の場合は、次の手順に進みます。
`storage aggregate relocation start -node _node_name_ -destination _node_name_ -aggregate-list _aggregate_name_`
+
たとえば、アグリゲート aggr1、aggr2、test2_aggr はノード node2 からノード node1 に移動されます：
`storage aggregate relocation start -node _node2_ -destination _node1_ -aggregate-list _aggr1_,_aggr2_,_test2_aggr_`

. LIFをそれぞれのホーム ポートにリバートします。
+
.. ホームポートにないLIFを表示します：
`network interface show -is-home false`
+
 `network interface show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-show.html["ONTAPコマンド リファレンス"^]を参照してください。

.. 停止したノードから移行したLIF以外にもホームにないLIFがある場合は、リバートする前に移動しても問題がないことを確認します。
.. 安全であれば、すべてのLIFをホームに戻します。 `network interface revert *` +  `network interface revert`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-revert.html["ONTAPコマンド リファレンス"^]を参照してください。




.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/cluster-ha-modify.html["クラスタ ha modify"^]
* link:https://docs.netapp.com/us-en/ontap-cli/storage-aggregate-relocation-start.html["storage aggregate relocation start"^]

