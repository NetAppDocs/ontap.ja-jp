---
sidebar: sidebar 
permalink: high-availability/index.html 
keywords: high availability, ha, overview 
summary: テイクオーバーとは、ノードがパートナーのストレージの制御を引き継ぐプロセスです。ギブバックとは、ストレージをパートナーに返却するプロセスです。 
---
= ONTAPクラスタにおけるHAペア管理について学ぶ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
クラスタノードは、フォールトトレランスと無停止運用を実現するために、高可用性（HA）ペアで構成されます。ノードに障害が発生した場合、または定期メンテナンスのためにノードを停止する必要がある場合、パートナーノードがそのストレージを引き継ぎ、そこから引き続きデータを提供できます。ノードがオンラインに戻ると、パートナーノードはストレージを返却します。

HAペアコントローラ構成は、対応するストレージコントローラのペア（ローカルノードとパートナーノード）で構成されます。各ノードは、もう一方のノードのディスクシェルフに接続されます。HAペアの一方のノードにエラーが発生し、データ処理が停止すると、パートナーノードがそのノードの障害状態を検出し、そのコントローラからすべてのデータ処理を引き継ぎます。

_テイクオーバー_ は、ノードがパートナーのストレージの制御を引き継ぐプロセスです。

_Giveback_は、ストレージをパートナーに返却するプロセスです。

デフォルトでは、次のいずれかの場合にテイクオーバーが自動的に実行されます。

* ノードでソフトウェアまたはシステムの障害が発生してパニック状態になった場合。HAペア コントローラがパートナー ノードに自動的にフェイルオーバーします。パートナーがパニック状態から回復してブートすると、ギブバックが自動的に実行されてパートナーが通常の動作状態に戻ります。
* ノードでシステム障害が発生し、リブートできない場合。たとえば、電源喪失が原因でノードに障害が発生すると、HAペア コントローラがパートナー ノードに自動的にフェイルオーバーし、稼働しているストレージ コントローラからデータを提供します。



NOTE: ノードのストレージへの電源も同時に喪失した場合は、標準テイクオーバーは実行できません。

* ノードのパートナーからハートビート メッセージが届かない場合。この状況は、パートナーでハードウェアまたはソフトウェア障害（インターコネクト障害など）が発生し、パニック状態にはならなかったものの、正常に機能しなくなった場合に発生します。
*  `-f`または `-inhibit-takeover true`パラメータを使用せずにノードの1つを停止します。



NOTE: cluster HAが有効になっている2ノードクラスタでは、 `‑inhibit‑takeover true`パラメータを使用してノードを停止または再起動すると、最初にcluster HAを無効にしてからオンラインのままにするノードにepsilonを割り当てない限り、両方のノードでデータ処理が停止します。

*  `‑inhibit‑takeover true`パラメータを使用せずにノードの1つを再起動します。（ `storage failover`コマンドの `‑onboot`パラメータはデフォルトで有効になっています。）
* リモート管理デバイス（Service Processor）がパートナーノードの障害を検出します。ハードウェアアシストテイクオーバーを無効にしている場合は該当しません。


 `storage failover takeover`コマンドを使用して手動でテイクオーバーを開始することもできます。

ONTAP 9.18.1以降では、HAペアノード間の暗号化通信を設定できます。詳細については、link:ha-pair-encryption.html["ONTAP HAトラフィックの暗号化を設定する"]を参照してください。



== クラスタの耐障害性と診断の強化

ONTAP 9.9.1 以降では、次の復元力と診断機能の追加により、クラスタの動作が改善されています：

* *ポート監視と回避*：2ノードのスイッチレスクラスタ構成では、システムは全パケット損失（接続損失）が発生したポートを回避します。ONTAP 9.8.1以前では、この機能はスイッチ構成でのみ利用可能でした。
* *自動ノードフェイルオーバー*：ノードがクラスタネットワーク全体にデータを提供できない場合、そのノードはディスクを所有してはなりません。代わりに、HAパートナーが正常な場合は、そのパートナーが処理を引き継ぎます。
* *接続の問題を分析するためのコマンド*：パケット損失が発生しているクラスタパスを表示するには、次のコマンドを使用します： `network interface check cluster-connectivity show`
+
 `network interface check cluster-connectivity show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-check-cluster-connectivity-show.html["ONTAPコマンド リファレンス"^]を参照してください。


