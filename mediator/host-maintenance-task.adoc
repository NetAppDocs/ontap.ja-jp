---
permalink: mediator/host-maintenance-task.html 
sidebar: sidebar 
keywords: mediator, maintain, host, maintenance, package update, kernel upgrade, change hostname, change IP, self-signed certificate, self signed certificate 
summary: 最適なパフォーマンスを得るために、ONTAP Mediator のホスト OS を定期的にメンテナンスしてください。 
---
= ONTAP MediatorのホストOSを保守する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
最適なパフォーマンスを実現するために、ONTAP Mediator のホスト OS が定期的にメンテナンスされていることを確認してください。



== ホストのリブート

クラスタが正常な状態になった場合にのみホストを再起動してください。ONTAP Mediatorがオフラインの間は、クラスタは障害に対応できません。再起動する前に、メンテナンスの時間を設定してください。

ONTAP Mediator は再起動時に自動的に再開し、ONTAP クラスタとの以前に設定された関係を再入力します。



== ホスト パッケージの更新

カーネルを除くすべてのライブラリまたはyumパッケージを更新します。変更を有効にするために必要な場合は、ホストを再起動します。ホストを再起動する前に、サービスウィンドウをスケジュールします。

 `yum-utils`パッケージをインストールする場合は、 `needs-restarting`コマンドを使用して、パッケージの変更に再起動が必要かどうかを検出します。

変更はすぐには有効にならないため、ONTAP Mediator の依存関係を更新した後は再起動してください。



== ホストOSカーネルをアップグレードする

SCSTは、使用しているカーネルに合わせてコンパイルする必要があります。OSをアップデートするには、メンテナンスのための時間をスケジュールする必要があります。

.手順
ホスト OS カーネルをアップグレードするには、次の手順に従います。


NOTE: カーネルをアップグレードする前に、OSとONTAP Mediatorのバージョンに互換性があることを確認してください。サポートされているバージョンについては、link:whats-new-concept.html#os-support-matrix["OSのサポート対応表"]を参照してください。

. ONTAPメディエーターを停止します。
. SCST パッケージをアンインストールします。<<ホストのメンテナンスを実行する>>を参照してください。（SCST ではアップグレード メカニズムは提供されません。）
. OSをアップグレードし、リブートします。
. SCSTパッケージを再インストールします。
. ONTAP Mediator を再度有効にします。




== ホストのメンテナンスを実行する

VMカーネルをアップグレードすると、SCSTモジュールとの互換性の問題が発生する可能性があります。SCSTを手動でアンインストールし、再インストールしてください。



=== ステップ1：SCSTをアンインストールする

SCST をアンインストールするには、 ONTAP Mediator バージョンの tar バンドルを使用します。

.手順
. 適切な SCST バンドル（次の表を参照）をダウンロードして解凍します。
+
[cols="50,50"]
|===


| このバージョンでは... | この tar バンドルを使用してください... 


 a| 
ONTAP Mediator 1.11
 a| 
scst-3.9.tar.gz



 a| 
ONTAP Mediator 1.10
 a| 
scst-3.9.tar.gz



 a| 
ONTAP Mediator 1.9.1
 a| 
scst-3.8.0.tar.bz2



 a| 
ONTAP Mediator 1.9
 a| 
scst-3.8.0.tar.bz2



 a| 
ONTAP Mediator 1.8
 a| 
scst-3.8.0.tar.bz2



 a| 
ONTAP Mediator 1.7
 a| 
scst-3.7.0.tar.bz2



 a| 
ONTAP Mediator 1.6
 a| 
scst-3.7.0.tar.bz2



 a| 
ONTAP Mediator 1.5
 a| 
scst-3.6.0.tar.bz2



 a| 
ONTAP Mediator 1.4
 a| 
scst-3.6.0.tar.bz2



 a| 
ONTAP Mediator 1.3
 a| 
scst-3.5.0.tar.bz2



 a| 
ONTAP Mediator 1.1
 a| 
scst-3.4.0.tar.bz2



 a| 
ONTAP Mediator 1.0
 a| 
scst-3.3.0.tar.bz2

|===
+
.. link:https://scst.sourceforge.net/downloads.html["SCST SourceForge ダウンロード"^]からオープンソース パッケージにアクセスします。
.. *Download released versions*を選択します。
.. バンドルを VM に抽出します。


.  `scst`ディレクトリ内で次のアンインストール コマンドを実行します：
+
.. `systemctl stop mediator-scst`
.. `make scstadm_uninstall`
.. `make iscsi_uninstall`
.. `make usr_uninstall`
.. `make scst_uninstall`
.. `depmod`






=== ステップ2：SCSTをインストールする

SCST を手動でインストールするには、インストールされているバージョンの ONTAP Mediator で使用される SCST tar バンドルが必要です（<<scst-bundle-table,SCSTテーブルARPテーブル>>を参照）。


NOTE: ONTAP Mediatorをインストールする前にこの手順を実行してください。使用しているSCSTのバージョンがONTAP Mediatorインストーラにバンドルされているバージョンよりも新しい場合、インストーラはこの手順をスキップします。

.  `scst`ディレクトリで次のインストールコマンドを実行します：
+
.. `make 2release`
.. `make scst_install`
.. `make usr_install`
.. `make iscsi_install`
.. `make scstadm_install`
.. `depmod`
+
[NOTE]
====
初めてインストールを実行し、ONTAP Mediatorを事前にインストールする場合は、次の手順に進む前に次のコマンドを実行します：

`mkdir -p /opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys`

====
.. `cp scst/src/certs/scst_module_key.der /opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/`
.. `patch /etc/init.d/scst < /opt/netapp/lib/ontap_mediator/systemd/scst.patch`
+

NOTE: 初回インストール時にONTAP Mediatorの前にSCSTを事前にインストールする場合は、この手順をスキップしてください。インストーラによって関連するSCSTパッチが適用されます。



. オプションとして、セキュア ブートが有効になっている場合は、再起動する前に次の手順を実行します：
+
..  `scst_vdisk`、 `scst`、および `iscsi_scst`モジュールの各ファイル名を決定します：
+
....
[root@localhost ~]# modinfo -n scst_vdisk
[root@localhost ~]# modinfo -n scst
[root@localhost ~]# modinfo -n iscsi_scst
....
.. カーネルリリースを確認します：
+
....
[root@localhost ~]# uname -r
....
.. 各モジュール ファイルをカーネルで署名します：
+
....
[root@localhost ~]# /usr/src/kernels/<KERNEL-RELEASE>/scripts/sign-file \sha256 \
/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/scst_module_key.priv \
/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/scst_module_key.der \
_module-filename_
....
.. ファームウェアとともに UEFI キーをインストールします。
+
UEFIキーのインストール手順については、以下を参照してください。

+
`/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/README.module-signing`

+
生成されたUEFIキーは次の場所に保存されます。

+
`/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/scst_module_key.der`



. システムを再起動します：
+
`reboot`





== ホストのホスト名またはIPの変更

.タスク概要
* この作業は、ONTAP Mediator をインストールした Linux ホストで実行してください。
* ONTAP Mediator をインストールした後にホスト名または IP アドレスが変更されたために自己署名証明書が有効でなくなった場合にのみ、これを実行してください。
* 一時的な自己署名証明書を信頼できるサードパーティの証明書に置き換えた後は、このタスクを使用して証明書を再生成しないでください。自己署名証明書をお持ちでない場合は、この手順は使用できません。


.手順
現在のホストの一時的な自己署名証明書を作成します：

. ONTAP Mediatorを再起動します：
+
`./make_self_signed_certs.sh overwrite`

+
[listing]
----
[root@xyz000123456 ~]# cd /opt/netapp/lib/ontap_mediator/ontap_mediator/server_config
[root@xyz000123456 server_config]# ./make_self_signed_certs.sh overwrite

Adding Subject Alternative Names to the self-signed server certificate
#
# OpenSSL example configuration file.
Generating self-signed certificates
Generating RSA private key, 4096 bit long modulus (2 primes)
..................................................................................................................................................................++++
........................................................++++
e is 65537 (0x010001)
Generating a RSA private key
................................................++++
.............................................................................................................................................++++
writing new private key to 'ontap_mediator_server.key'
-----
Signature ok
subject=C = US, ST = California, L = San Jose, O = "NetApp, Inc.", OU = ONTAP Core Software, CN = ONTAP Mediator, emailAddress = support@netapp.com
Getting CA Private Key

[root@xyz000123456 server_config]# systemctl restart ontap_mediator
----

