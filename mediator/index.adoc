---
permalink: mediator/index.html 
sidebar: sidebar 
keywords: ontap mediator service, install requirements, mediator requirements 
summary: ONTAP メディエーターサービスをインストールするには、すべての前提条件を満たしていることを確認してから、インストールパッケージを取得してホストでインストーラを実行する必要があります。 
---
= ONTAP メディエーターサービスをインストールまたはアップグレードします
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP メディエーターサービスをインストールするには、すべての前提条件を満たしていることを確認してから、インストールパッケージを取得してホストでインストーラを実行する必要があります。この手順は、既存の環境のインストールまたはアップグレードに使用します。

.このタスクについて
* ONTAP 9.7以降では、任意のバージョンのONTAP メディエーターを使用してMetroCluster IP構成を監視できます。
* ONTAP 9.8以降では、任意のバージョンのONTAP メディエーターを使用してSM-BC関係を監視できます。


次の前提条件を満たしている必要があります。

[cols="30,70"]
|===


| メディエーターのバージョン | サポートされている Linux バージョン 


 a| 
1.4
 a| 
* Red Hat Enterprise Linux：7.6、7.7、7.8、7.9、8.1、 8.2、8.3、8.4、8.5
* CentOS ： 7.6 、 7.7 、 7.8 、 7.9




 a| 
1.3
 a| 
* Red Hat Enterprise Linux：7.6、7.7、7.8、7.9、8.1、 8.2、8.3
* CentOS ： 7.6 、 7.7 、 7.8 、 7.9




 a| 
1/2
 a| 
* Red Hat Enterprise Linux：7.6、7.7、7.8、8.1
* CentOS ： 7.6 、 7.7 、 7.8


|===

NOTE: カーネルのバージョンがオペレーティングシステムのバージョンと一致している必要があります。

* 64 ビットの物理インストールまたは仮想マシン
* 8GB の RAM
* ユーザ：ルートアクセス




== ホストのオペレーティングシステムをアップグレードしてからメディエーターをアップグレードします

次の表に、メディエーターのバージョンをアップグレードするだけでなく、 RHEL / CentOS 7.6 から新しい RHEL / CentOS リリースにアップグレードする場合のアップグレードガイドラインを示します。

[cols="20,20,60"]
|===


| Linux のターゲットバージョン | メディエーターのターゲットのバージョン | アップグレードに関する注意事項 


 a| 
* Red Hat Enterprise Linux：7.6、7.7、7.8、8.1
* CentOS ： 7.6 、 7.7 、 7.8

 a| 
1/2
 a| 
* アップグレードは、次の順序で実行する必要があります。
+
.. オペレーティングシステムを RHEL / CentOS のバージョンからアップグレードします。
.. ホストをリブートしてカーネルモジュールの変更を適用します。
.. メディエーターのバージョンを今すぐ前のバージョンから現在のバージョンにアップグレードします。


* MetroCluster の場合：
+
.. アップグレードの実行中に、 storage iscsi-initiator show コマンドでメディエーターサービスへの接続が停止したと報告されます。
.. ONTAP オペレーティングシステムでは、次の EMS イベントが生成されます。
+
... アップグレード中に cf.mccip.med.auso.stDisabled にアクセスします
... cf.mccip.med.auso.stEnabled ：自動計画外スイッチオーバーが再度有効になります








 a| 
* Red Hat Enterprise Linux：7.6、7.7、7.8、7.9、8.1、 8.2、8.3
* CentOS ： 7.6 、 7.7 、 7.8 、 7.9

 a| 
1.3
 a| 
. オペレーティングシステムを RHEL / CentOS のバージョンからアップグレードします。
. ホストをリブートしてカーネルモジュールの変更を適用します。
. メディエーターのバージョンを今すぐ前のバージョンから現在のバージョンにアップグレードします。




 a| 
* Red Hat Enterprise Linux：7.6、7.7、7.8、7.9、8.1、 8.2、8.3、8.4、8.5
* CentOS ： 7.6 、 7.7 、 7.8 、 7.9

 a| 
1.4
 a| 
. オペレーティングシステムを RHEL / CentOS のバージョンからアップグレードします。
. ホストをリブートしてカーネルモジュールの変更を適用します。
. メディエーターのバージョンを今すぐ前のバージョンから現在のバージョンにアップグレードします。


|===
Red Hat Enterprise Linux または CentOS とその関連リポジトリをシステムにインストールする際のベストプラクティスは次のとおりです。別の方法でインストールまたは設定されたシステムでは、追加の手順が必要になる

* Red Hat Enterprise Linux または CentOS のインストールについては、 Red Hat のベストプラクティスに従う必要があります。CentOS 8.xバージョンはサポートされないため、互換性があるバージョンのCentOS 8.xは推奨されません。
* Red Hat Enterprise Linux または CentOS への ONTAP メディエーターサービスのインストール中にインストールプログラムが必要なすべてのソフトウェアにアクセスしてインストールできるように、システムには該当するリポジトリへのアクセスが必要です。
* yum インストーラで Red Hat Enterprise Linux リポジトリから依存するソフトウェアを検索するには、 Red Hat Enterprise Linux のインストール中またはインストール後に有効な Red Hat サブスクリプションを使用してシステムを登録しておく必要があります。
+
Red Hat Subscription Manager については、 Red Hat のドキュメントを参照してください。

* 次のポートをメディエーター用に空けておく必要があります。
+
** 31784 です
** 3260


* サードパーティ製ファイアウォールを使用している場合は、を参照してください link:https://docs.netapp.com/us-en/ontap-metrocluster/install-ip/concept_mediator_requirements.html#firewall-requirements-for-ontap-mediator["ONTAP メディエーターのファイアウォール要件"^]
* Linuxホストがインターネットにアクセスできない場所にある場合は、必要なパッケージがローカルリポジトリにあることを確認する必要があります。
+
Linux 環境で Link Aggregation Control Protocol （ LACP ）を使用している場合は、カーネルを正しく設定し、「 ysctl net.ipv4.conf all.arp_ignore 」が「 2 」に設定されていることを確認する必要があります。

+
ONTAP メディエーターサービスで必要なパッケージは次のとおりです。

+
[cols="25,35,40"]
|===


| すべての RHEL または CentOS バージョン | RHEL / CentOS 7.x の追加パッケージ | RHEL 8.x 用の追加パッケージ 


 a| 
** openssl
** openssl-devel
** kernel-devel
** GCC
** libselinux-utils
** メーカー
** RedHat LSB コアです
** パッチ
** Bzip2.
** ピトノン 36
** python36-devel
** Perl - データダンパー
** PERLA-ExtUtils-MakeMaker
** python3-pip の略

 a| 
** policycoreutils - Python
** ピトノン 36-pip

 a| 
** elfutils-libelf-devel
** policycoreutils -python-utils


|===


メディエーターのインストールパッケージは自己解凍形式の圧縮 tar ファイルで、次のものが含まれます。

* サポートされているリリースのリポジトリから取得できないすべての依存関係を含む RPM ファイル。
* インストールスクリプト。


この手順に記載されているように、有効な SSL 証明書を使用することを推奨します。



== リポジトリへのアクセスを有効にします

|===


| オペレーティングシステム | リポジトリへのアクセスを指定する必要があります ... 


 a| 
RHEL 7.x
 a| 
rhel-7-server-optional-rpms のいずれかです



 a| 
CentOS 7.x
 a| 
C7.6.1810 - ベースリポジトリ



 a| 
RHEL 8.x の場合
 a| 
* RHEL-8-For x86_64-baseos-RPMs
* RHEL-8-For x86_64-AppStream-RPMs


|===
インストールプロセスでメディエーターから必要なパッケージにアクセスできるように、上記のリポジトリへのアクセスを有効にします。お使いのオペレーティングシステムに応じて、以下の手順を使用してください。

* の手順 <<rhel7x,RHEL 7.x>> オペレーティングシステム：
* の手順 <<rhel8x,RHEL 8.x の場合>> オペレーティングシステム：
* の手順 <<centos7x,CentOS 7.x>> オペレーティングシステム：




=== RHEL 7.x オペレーティングシステム用の手順

オペレーティング・システムが * RHEL 7.x * の場合：

.手順
. 必要なリポジトリに登録します。
+
'subscription-manager repos_--enable rhel-7-server-optional-rpms

+
次の例は、このコマンドの実行例を示しています。

+
[listing]
----
[root@localhost ~]# subscription-manager repos --enable rhel-7-server-optional-rpms
Repository 'rhel-7-server-optional-rpms' is enabled for this system.
----
. yum repolist' コマンドを実行します
+
次の例は、このコマンドの実行例を示しています。rhel-7-server-optional-rpms リポジトリがリストに表示されている必要があります。

+
[listing]
----
[root@localhost ~]# yum repolist
Loaded plugins: product-id, search-disabled-repos, subscription-manager
rhel-7-server-optional-rpms | 3.2 kB  00:00:00
rhel-7-server-rpms | 3.5 kB  00:00:00
(1/3): rhel-7-server-optional-rpms/7Server/x86_64/group                                               |  26 kB  00:00:00
(2/3): rhel-7-server-optional-rpms/7Server/x86_64/updateinfo                                          | 2.5 MB  00:00:00
(3/3): rhel-7-server-optional-rpms/7Server/x86_64/primary_db                                          | 8.3 MB  00:00:01
repo id                                      repo name                                             status
rhel-7-server-optional-rpms/7Server/x86_64   Red Hat Enterprise Linux 7 Server - Optional (RPMs)   19,447
rhel-7-server-rpms/7Server/x86_64            Red Hat Enterprise Linux 7 Server (RPMs)              26,758
repolist: 46,205
[root@localhost ~]#
----




=== RHEL 8.x オペレーティングシステム用の手順

オペレーティング・システムが * RHEL 8.x * の場合：

.手順
. 必要なリポジトリに登録します。
+
'subscription-manager repos_--enable RHEL-8-For -x86_64-baseos-rpms

+
'subscription-manager repos_--enable RHEL-8-For -x86_64-AppStream-RPM'

+
次の例は、このコマンドの実行例を示しています。

+
[listing]
----
[root@localhost ~]# subscription-manager repos --enable rhel-8-for-x86_64-baseos-rpms
[root@localhost ~]# subscription-manager repos --enable rhel-8-for-x86_64-appstream-rpms
Repository 'rhel-8-for-x86_64-baseos-rpms' is enabled for this system.
Repository 'rhel-8-for-x86_64-appstream-rpms' is enabled for this system.
----
. yum repolist' コマンドを実行します
+
新しくサブスクライブしたリポジトリがリストに表示されます。





=== CentOS 7.x オペレーティングシステムの手順

オペレーティングシステムが * CentOS 7.x * の場合：


NOTE: 次の例は、CentOS 7.6のリポジトリを示していますが、それ以外のCentOSバージョンでは使用できない場合があります。使用しているCentOSのバージョンにはベースリポジトリを使用してください。

.手順
. C7.6.1810 ベースリポジトリを追加します。C7.6.1810 - ベースボールトリポジトリには、 ONTAP メディエーターに必要な kernel-devel パッケージが含まれています。
. 次の行を /etc/yum.repos_d/Center-Vault.repo に追加します。
+
[listing]
----
[C7.6.1810-base]
name=CentOS-7.6.1810 - Base
baseurl=http://vault.centos.org/7.6.1810/os/$basearch/
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
enabled=1
----
. yum repolist' コマンドを実行します
+
次の例は、このコマンドの実行例を示しています。CentOS-7.6.1810 ベースリポジトリがリストに表示されます。

+
[listing]
----
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: distro.ibiblio.org
 * extras: distro.ibiblio.org
 * updates: ewr.edge.kernel.org
C7.6.1810-base                                                   | 3.6 kB  00:00:00
(1/2): C7.6.1810-base/x86_64/group_gz                            | 166 kB  00:00:00
(2/2): C7.6.1810-base/x86_64/primary_db                          | 6.0 MB  00:00:04
repo id                                           repo name                                                                                                    status
C7.6.1810-base/x86_64                             CentOS-7.6.1810 - Base                                                                                       10,019
base/7/x86_64                                     CentOS-7 - Base                                                                                              10,097
extras/7/x86_64                                   CentOS-7 - Extras                                                                                               307
updates/7/x86_64                                  CentOS-7 - Updates                                                                                            1,010
repolist: 21,433
[root@localhost ~]#
----




== メディエーターのインストールパッケージをダウンロードします

.手順
. ONTAP メディエーターのページからメディエーターのインストールパッケージをダウンロードします。
+
https://mysupport.netapp.com/site/products/all/details/ontap-mediator/downloads-tab["ONTAP メディエーターのダウンロードページ"^]

. メディエーターのインストールパッケージがターゲットディレクトリにあることを確認します。
+
「 ls 」と入力します

+
[listing]
----
[root@mediator-host ~]#ls
ontap-mediator
----
+
インターネットにアクセスできない場所にいる場合は、インストーラが必要なパッケージにアクセスできることを確認する必要があります。

. 必要に応じて、メディエーターのインストールパッケージをダウンロードディレクトリから Linux メディエーターホストのインストールディレクトリに移動します。




== ONTAP メディエーターのインストールパッケージをインストールします

.このタスクについて
* ONTAP メディエーター1.4以降では、セキュアブートメカニズムはUEFIシステムで有効になっています。セキュアブートが有効になっている場合は、インストール後に追加の手順を実行してセキュリティキーを登録する必要があります。
+
** READMEファイルの指示に従います。/opt/NetApp/lib/ONTAP_mediator/ONTAP_mediator/SCST_mod_keys/README.module-signing'はSCSTカーネルモジュールに署名します。
** 必要なキーを探します。「/opt/NetApp/lib/ONTAP_mediator/ONTAP_mediator/SCST_MOD_Keys


+

NOTE: インストール後は、READMEファイルとキーの場所もシステム出力に含まれています。



.ステップ
. メディエーターのインストールパッケージをインストールし、必要に応じてプロンプトに応答します。
+
「./ontap - mediator'」と入力します

+
インストールプロセスが開始され、必要なアカウントの作成と必要なパッケージのインストールが行われます。以前のバージョンのメディエーターがホストにインストールされている場合は、アップグレードを確認するプロンプトが表示されます。



.ONTAP メディエーター1.4のインストールの例（コンソール出力）
====
[listing]
----
[root@scs000065018 ~]# ./ontap-mediator
ONTAP Mediator: Self Extracting Installer
ONTAP Mediator requires two user accounts. One for the service (netapp), and one for use by ONTAP to the mediator API (mediatoradmin).
Would you like to use the default account names: netapp + mediatoradmin? (Y(es)/n(o)): y
Enter ONTAP Mediator user account (mediatoradmin) password:
Re-Enter ONTAP Mediator user account (mediatoradmin) password:
Checking if SELinux is in enforcing mode
Checking for default Linux firewall
Linux firewall is running. Open ports 31784 and 3260? y(es)/n(o): y
success
success



Preparing for installation of ONTAP Mediator packages.
Do you wish to continue? Y(es)/n(o): y
+ Installing required packages.
Last metadata expiration check: 1:56:17 ago on Thu 07 Apr 2022 11:35:42 AM EDT.
Package openssl-1:1.1.1k-6.el8_5.x86_64 is already installed.
Package openssl-devel-1:1.1.1k-6.el8_5.x86_64 is already installed.

.
.
.
.

Dependencies resolved.
Nothing to do.
Complete!
OS package installations finished
+ Installing ONTAP Mediator. (Log: /tmp/ontap_mediator.5gmxnI/ontap-mediator/install_20220407133105.log)
    This step will take several minutes. Use the log file to view progress.
Sudo include verified
ONTAP Mediator logging enabled
+ Install successful. (Moving log to /opt/netapp/lib/ontap_mediator/log/install_20220407133105.log)
+ WARNING: This system supports UEFI
           Secure Boot (SB) is currently enabled on this system.
           The following action need be taken:
           Using the keys in /opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys follow
           instructions in /opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/README.module-signing
           to sign the SCST kernel module. Note that reboot will be needed.
     SCST will not start automatically when Secure Boot is enabled and not configured properly.
+ Note: ONTAP Mediator uses a kernel module compiled specifically for the current
        system OS. Using 'yum update' to upgrade the kernel may cause a service
        interruption.
    For more information, see /opt/netapp/lib/ontap_mediator/README
[root@scs000065018 ~]#
----
====


== インストールを確認します。

.手順
. 次のコマンドを実行して、ONTAP メディエーターサービスのステータスを表示します。
+
.. systemctl status ONTAP_mediator'を実行します
+
[listing]
----
[root@scspr1915530002 ~]# systemctl status ontap_mediator

 ontap_mediator.service - ONTAP Mediator
Loaded: loaded (/etc/systemd/system/ontap_mediator.service; enabled; vendor preset: disabled)
Active: active (running) since Mon 2022-04-18 10:41:49 EDT; 1 weeks 0 days ago
Process: 286710 ExecStop=/bin/kill -s INT $MAINPID (code=exited, status=0/SUCCESS)
Main PID: 286712 (uwsgi)
Status: "uWSGI is ready"
Tasks: 3 (limit: 49473)
Memory: 139.2M
CGroup: /system.slice/ontap_mediator.service
      ├─286712 /opt/netapp/lib/ontap_mediator/pyenv/bin/uwsgi --ini /opt/netapp/lib/ontap_mediator/uwsgi/ontap_mediator.ini
      ├─286716 /opt/netapp/lib/ontap_mediator/pyenv/bin/uwsgi --ini /opt/netapp/lib/ontap_mediator/uwsgi/ontap_mediator.ini
      └─286717 /opt/netapp/lib/ontap_mediator/pyenv/bin/uwsgi --ini /opt/netapp/lib/ontap_mediator/uwsgi/ontap_mediator.ini

[root@scspr1915530002 ~]#
----
.. systemctl status mediator-scstを実行します
+
[listing]
----
[root@scspr1915530002 ~]# systemctl status mediator-scst
   Loaded: loaded (/etc/systemd/system/mediator-scst.service; enabled; vendor preset: disabled)
   Active: active (running) since Mon 2022-04-18 10:41:47 EDT; 1 weeks 0 days ago
  Process: 286595 ExecStart=/etc/init.d/scst start (code=exited, status=0/SUCCESS)
 Main PID: 286662 (iscsi-scstd)
    Tasks: 1 (limit: 49473)
   Memory: 1.2M
   CGroup: /system.slice/mediator-scst.service
           └─286662 /usr/local/sbin/iscsi-scstd

[root@scspr1915530002 ~]#
----


. ONTAP メディエーターサービスで使用しているポート「netstat」を確認します
+
[listing]
----
[root@scspr1905507001 ~]# netstat -anlt | grep -E '3260|31784'

         tcp   0   0 0.0.0.0:31784   0.0.0.0:*      LISTEN

         tcp   0   0 0.0.0.0:3260    0.0.0.0:*      LISTEN

         tcp6  0   0 :::3260         :::*           LISTEN
----




== 結果

これで、 ONTAP メディエーターサービスがインストールされて実行された状態になります。メディエーターの機能を使用するには、 ONTAP ストレージシステムでさらに設定を行う必要があります。

* MetroCluster IP 構成で ONTAP メディエーターサービスを使用する場合は、を参照してください link:https://docs.netapp.com/us-en/ontap-metrocluster/install-ip/task_configuring_the_ontap_mediator_service_from_a_metrocluster_ip_configuration.html["MetroCluster IP 構成での ONTAP メディエーターサービスの設定"^]
* SnapMirror のビジネス継続性機能を使用する手順については、を参照して link:https://docs.netapp.com/us-en/ontap/smbc/smbc_install_confirm_ontap_cluster.html["ONTAP メディエーターサービスをインストールし、 ONTAP クラスタの設定を確認します"^]

