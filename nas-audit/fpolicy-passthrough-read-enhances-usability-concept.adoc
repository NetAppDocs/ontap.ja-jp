---
permalink: nas-audit/fpolicy-passthrough-read-enhances-usability-concept.html 
sidebar: sidebar 
keywords: fpolicy, passthrough-read, enhances, usability, hierarchical, storage management 
summary: パススルー リードを使用すると、移行されたオフライン ファイルに対する読み取りアクセスを（階層型ストレージ管理（HSM）サーバとして機能している）FPolicyサーバから提供できます。セカンダリ ストレージ システムからプライマリ ストレージ システムにファイルをリコールする必要はありません。 
---
= ONTAP FPolicyパススルーリードが階層型ストレージ管理の使いやすさを向上させる仕組み
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
パススルー リードを使用すると、移行されたオフライン ファイルに対する読み取りアクセスを（階層型ストレージ管理（HSM）サーバとして機能している）FPolicyサーバから提供できます。セカンダリ ストレージ システムからプライマリ ストレージ システムにファイルをリコールする必要はありません。

FPolicyサーバがSMBサーバ上にあるファイルに対してHSMを提供するように構成されている場合は、ポリシーベースのファイル移行が行われます。この場合、ファイルはセカンダリ ストレージ上にオフライン格納され、スタブ ファイルのみがプライマリ ストレージ上に残ります。たとえクライアントからは通常のファイルのように見えても、スタブ ファイルは実際には元のファイルと同じサイズのスパース ファイルです。スパース ファイルは、SMBのオフライン ビットが設定されており、セカンダリ ストレージに移行された実際のファイルを参照しています。

通常は、オフライン ファイルに対する読み取り要求が届くと、プライマリ ストレージ上への要求されたコンテンツのリコール（呼び戻し）を行ったうえで、プライマリ ストレージを介してそのコンテンツにアクセスする必要があります。データをプライマリ ストレージにリコールする必要があることから、いくつかの好ましくない影響が生じます。特に、コンテンツをリコールしてから要求に応じる必要があるためにクライアント要求に対する遅延が大きくなる点と、プライマリ ストレージで必要となる領域の使用量がリコールされるファイルのサイズだけ増える点が挙げられます。

FPolicyのパススルー リードを使用すると、移行されたオフライン ファイルに対する読み取りアクセスをHSMサーバ（FPolicyサーバ）から提供できます。セカンダリ ストレージ システムからプライマリ ストレージ システムにファイルをリコールする必要はありません。プライマリ ストレージにファイルをリコールして戻す代わりに、読み取り要求をセカンダリ ストレージから直接処理できます。

[NOTE]
====
FPolicyのパススルー リード処理では、コピー オフロード（ODX）はサポートされません。

====
パススルー リードは、次のような利点を提供してユーザビリティを向上します。

* 要求されたデータをリコールするための十分な領域がプライマリ ストレージになくても、読み取り要求を処理できます。
* スクリプトまたはバックアップ ソリューションで多数のオフライン ファイルへのアクセスが必要になる場合など、データのリコールが急増した場合でも容量やパフォーマンスの管理を適切に行うことができます。
* スナップショット内のオフライン ファイルの読み取り要求を処理できます。
+
スナップショットは読み取り専用であるため、スタブファイルがスナップショット内に存在する場合、FPolicyサーバーは元のファイルを復元できません。パススルー読み取りを使用すると、この問題は解消されます。

* セカンダリ ストレージ上のファイルへのアクセスによって読み取り要求が処理されるタイミングや、オフライン ファイルをプライマリ ストレージにリコールするタイミングを制御するポリシーを設定できます。
+
たとえば、オフライン ファイルをプライマリ ストレージ上に移行し直すまでの指定された期間内にオフライン ファイルにアクセスできる回数を指定するポリシーをHSMサーバ上に作成できます。このタイプのポリシーにより、滅多にアクセスされないファイルのリコールを回避できます。





== FPolicyパススルー リードが有効になっている場合の読み取り要求の管理方法

Storage Virtual Machine（SVM）およびFPolicyサーバ間の接続を最適な形で設定できるように、FPolicyパススルー リードが有効になっている場合の読み取り要求の管理方法を理解しておく必要があります。

FPolicyパススルー リードが有効になっている場合にSVMがオフラインのファイルに対する要求を受け取ると、FPolicyによって標準の接続チャネル経由でFPolicyサーバ（HSMサーバ）に通知が送信されます。

通知を受け取ったあと、FPolicyサーバはその通知で送信されたファイル パスからデータを読み取り、要求されたデータをSVMおよびFPolicy間に確立されたパススルー リード特権データ接続を介してSVMに送信します。

このデータの送信後、FPolicyサーバは読み取り要求にALLOW（許可）またはDENY（拒否）で応答します。読み取り要求が許可されたか拒否されたかによって、ONTAPは要求された情報またはエラー メッセージをクライアントに送信します。
