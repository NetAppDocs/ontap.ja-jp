---
permalink: nas-audit/plan-auditing-config-concept.html 
sidebar: sidebar 
keywords: plan, audit, configuration, svm, rotate, logs, size, schedule, rotation, dr, disaster recovery 
summary: Storage Virtual Machine（SVM）で監査を設定する前に、使用可能な設定オプションを理解し、各オプションに設定する値を計画する必要があります。この情報は、ビジネスニーズを満たす監査の設定に役立ちます。 
---
= ONTAP SVMでの監査の設定を計画する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Storage Virtual Machine（SVM）で監査を設定する前に、使用可能な設定オプションを理解し、各オプションに設定する値を計画する必要があります。この情報は、ビジネスニーズを満たす監査の設定に役立ちます。

すべての監査設定に共通の設定パラメータがあります。

また、統合および変換された監査ログのローテーション時に使用する方法を指定するためのパラメータもいくつかあります。監査の設定時に、次の3つの方法のいずれかを指定できます。

* ログサイズに基づくログのローテーション
+
ログのローテーションに使用されるデフォルトの方法です。

* スケジュールに基づいたログのローテーション
* ログ サイズとスケジュール（早い方）に基づいたログのローテーション


[NOTE]
====
ログのローテーション方法は必ず指定する必要があります。

====


== すべての監査設定に共通するパラメータ

監査設定の作成時に指定する必要がある2つの必須パラメータがあります。また、指定できるオプションのパラメータが3つあります。

[cols="40,30,10,10,10"]
|===


| 情報の種類 | オプション | 必須 | 含める | 自分の価値観 


 a| 
SVM 名 _

監査設定を作成するSVMの名前。SVMがすでに存在している必要があります。
 a| 
`-vserver` `vserver_name`
 a| 
〇
 a| 
〇
 a| 



 a| 
_ ログデスティネーションパス _

変換された監査ログを格納するディレクトリ（通常は専用のボリュームまたはqtree）を指定します。SVMネームスペースにすでに存在しているパスを指定する必要があります。

パスは最大864文字で、読み取り/書き込み権限が必要です。

パスが無効な場合、監査設定コマンドは失敗します。

SVMがSVMディザスタリカバリのソースである場合、ログデスティネーションパスをルートボリュームに配置することはできません。これは、ルートボリュームのコンテンツがディザスタリカバリデスティネーションにレプリケートされないためです。

FlexCacheボリュームをログのデスティネーションとして使用することはできません（ONTAP 9 .7以降）。
 a| 
`-destination` `text`
 a| 
〇
 a| 
〇
 a| 



 a| 
_ 監査するイベントのカテゴリ _

監査するイベントのカテゴリを指定します。監査できるイベント カテゴリは次のとおりです。

* ファイル アクセス イベント（SMBとNFSv4の両方）
* SMBロクオンオヨヒログオフイヘント
* 集約型アクセスポリシーのステージングイベント
+
集約型アクセスポリシーのステージングイベントは、Windows Server 2012 Active Directoryドメイン以降で使用できます。

* 非同期-削除
* ファイル共有カテゴリイベント
* 監査ポリシー変更イベント
* ローカルユーザアカウント管理イベント
* セキュリティグループ管理イベント
* 認証ポリシー変更イベント


デフォルトでは、ファイルアクセスイベントとSMBログオンおよびログオフイベントが監査されます。

*注：*イベントカテゴリとしてを指定するには、 `cap-staging`SVM上にSMBサーバが存在している必要があります。監査の設定では、SMBサーバでダイナミックアクセス制御を有効にしなくても集約型アクセスポリシーのステージングを有効にできますが、集約型アクセスポリシーのステージングイベントはダイナミックアクセス制御が有効になっている場合にのみ生成されます。ダイナミックアクセス制御はSMBサーバオプションを使用して有効にします。デフォルトでは有効になっていません。
 a| 
`-events`{`file-ops`|`cifs-logon-logoff`|`cap-staging`|`file-share`|`audit-policy-change`|`user-account`|`security-group`|`authorization-policy-change`|`async-delete`}
 a| 
いいえ
 a| 
 a| 



 a| 
_ ログファイル出力形式 _

監査ログの出力形式を指定します。出力形式は、ONTAP固有またはMicrosoft Windows `EVTX`ログ形式のいずれかになり `XML`ます。デフォルトの出力形式はです `EVTX`。
 a| 
`-format`{`xml`|`evtx`}
 a| 
いいえ
 a| 
 a| 



 a| 
ログファイルのローテーションの上限 _

保持する監査ログファイルの数を指定します。この数を超えると、最も古いログファイルがローテーションから除外されます。たとえば、の値を入力する `5`と、最後の5つのログファイルが保持されます。

値がの `0`場合は、すべてのログファイルが保持されます。デフォルト値は0です。
 a| 
`-rotate-limit` `integer`
 a| 
いいえ
 a| 
 a| 

|===


== 監査イベントログのローテーションのタイミングの決定に使用するパラメータ

* ログサイズに基づいてログを回転 *

デフォルトでは、監査ログのローテーションはサイズに基づいて行われます。

* デフォルトのログサイズは100MBです。
* デフォルトのログローテーション方式とデフォルトのログサイズを使用する場合は、ログローテーションのパラメータを設定する必要はありません。
* ログサイズのみに基づいて監査ログのローテーションを行う場合は、次のコマンドを使用してパラメータの設定を解除し `-rotate-schedule-minute`ます。 `vserver audit modify -vserver vs0 -destination / -rotate-schedule-minute -`


デフォルトのログサイズを使用しない場合は、カスタムログサイズを指定するようにパラメータを設定でき `-rotate-size`ます。

[cols="40,30,10,10,10"]
|===


| 情報の種類 | オプション | 必須 | 含める | 自分の価値観 


 a| 
_ ログファイルサイズ制限 _

監査ログファイルの最大サイズを決定します。
 a| 
`-rotate-size`{`integer`[KB|MB|GB|TB|PB]｝
 a| 
いいえ
 a| 
 a| 

|===
* スケジュールに基づいてログを回転 *

スケジュールに基づく監査ログのローテーションを選択した場合は、時間に基づくローテーションパラメータを任意の組み合わせで使用して、ログのローテーションをスケジュールできます。

* 時間に基づくローテーションを使用する場合、 `-rotate-schedule-minute`パラメータは必須です。
* その他の時間ベースのローテーションパラメータはすべてオプションです。
* ローテーションスケジュールは、時間に関連するすべての値を使用して計算されます。
+
たとえば、パラメータのみを指定する `-rotate-schedule-minute`と、監査ログファイルのローテーションは、毎月のすべての曜日の毎時間、指定した分に行われます。

* 時間に基づくローテーションパラメータを1つか2つだけ指定した場合（、など `-rotate-schedule-month` `-rotate-schedule-minutes`）、ログファイルのローテーションは、指定した月にのみ、すべての曜日の毎時間、指定した分に行われます。
+
たとえば、監査ログのローテーションを、1月、3月、8月の月曜日、水曜日、土曜日の午前10時30分に実行するように指定できます。

* との `-rotate-schedule-day`両方に値を指定すると `-rotate-schedule-dayofweek`、それらは独立して考慮されます。
+
たとえば、にFridayを指定し、 `-rotate-schedule-day`に13を指定する `-rotate-schedule-dayofweek`と、監査ログのローテーションは、13日の金曜日だけでなく、毎週金曜日、および指定した月の13日にも実行されます。

* スケジュールのみに基づいて監査ログのローテーションを行う場合は、次のコマンドを使用してパラメータの設定を解除し `-rotate-size`ます。 `vserver audit modify -vserver vs0 -destination / -rotate-size -`


次に示す使用可能な監査パラメータのリストを使用して、監査イベントログのローテーションのスケジュールの設定に使用する値を決定できます。

[cols="40,30,10,10,10"]
|===


| 情報の種類 | オプション | 必須 | 含める | 自分の価値観 


 a| 
ログローテーションスケジュール： Month_

監査ログのローテーションを実行する月を指定します。

有効な値は `January`、～ `December`、および `all`です。たとえば、監査ログのローテーションを1月、3月、8月に実行するように指定できます。
 a| 
`-rotate-schedule-month` `chron_month`
 a| 
いいえ
 a| 
 a| 



 a| 
ログローテーションスケジュール：曜日 _

監査ログのローテーションを実行する日（曜日）を指定します。

有効な値は `Sunday`、～ `Saturday`、および `all`です。たとえば、監査ログのローテーションを火曜日と金曜日に、またはすべての曜日に実行するように指定できます。
 a| 
`-rotate-schedule-dayofweek` `chron_dayofweek`
 a| 
いいえ
 a| 
 a| 



 a| 
ログローテーションスケジュール： Day _

監査ログのローテーションを実行する日にちを指定します。

有効な値の範囲は `1`~ `31`です。たとえば、監査ログのローテーションを毎月10日と20日に、またはすべての日に実行するように指定できます。
 a| 
`-rotate-schedule-day` `chron_dayofmonth`
 a| 
いいえ
 a| 
 a| 



 a| 
ログローテーションスケジュール： Hour _

監査ログのローテーションを実行する時間単位のスケジュールを決定します。

有効な値の範囲は、 `0`（午前0時）~ `23`（午後11時）です。を指定する `all`と、監査ログのローテーションが1時間ごとに行われます。たとえば、監査ログのローテーションを6（午前6時）と18（午後6時）に行うように指定できます。
 a| 
`-rotate-schedule-hour` `chron_hour`
 a| 
いいえ
 a| 
 a| 



 a| 
ログローテーションスケジュール：分 _

監査ログのローテーションを実行する分を指定します。

有効な値の範囲は `0`~ `59`です。たとえば、監査ログのローテーションを30分に行うように指定できます。
 a| 
`-rotate-schedule-minute` `chron_minute`
 a| 
はい（スケジュールベースのログローテーションを設定する場合）。それ以外の場合はいいえ。
 a| 
 a| 

|===
* ログサイズとスケジュールに基づいてログを回転 *

ログサイズとスケジュールに基づいてログファイルをローテーションするように選択するには、パラメータと時間ベースのローテーションパラメータの両方を任意に組み合わせて設定し `-rotate-size`ます。たとえば、が10MBに設定され、 `-rotate-schedule-minute`が15に設定されている場合 `-rotate-size`、ログファイルのサイズが10MBに達したとき、または1時間ごとの15分（いずれか早い方）にログファイルがローテーションされます。
