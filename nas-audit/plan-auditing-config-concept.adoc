---
permalink: nas-audit/plan-auditing-config-concept.html 
sidebar: sidebar 
keywords: plan, audit, configuration, svm, rotate, logs, size, schedule, rotation, dr, disaster recovery 
summary: Storage Virtual Machine（SVM）で監査を設定する前に、使用可能な設定オプションを理解し、各オプションに設定する値を計画する必要があります。この情報は、ビジネス ニーズに合った監査設定の作成に役立ちます。 
---
= ONTAP SVMの監査設定を計画する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Storage Virtual Machine（SVM）で監査を設定する前に、使用可能な設定オプションを理解し、各オプションに設定する値を計画する必要があります。この情報は、ビジネス ニーズに合った監査設定の作成に役立ちます。

すべての監査構成に共通する特定の構成パラメータがあります。

また、統合および変換された監査ログのローテーション時に使用する方法を指定するパラメータもあります。監査設定時に次の3つの方法のいずれかを指定できます。

* ログ サイズに基づいたログのローテーション
+
ログのローテーションに使用されるデフォルトの方法です。

* スケジュールに基づいたログのローテーション
* ログ サイズとスケジュール（早い方）に基づいたログのローテーション


[NOTE]
====
ログのローテーション方法は必ず指定する必要があります。

====


== すべての監査設定に共通するパラメータ

監査設定の作成時に指定する必要がある2つの必須パラメータがあります。また、指定できるオプションのパラメータが3つあります。

[cols="40,30,10,10,10"]
|===


| 情報の種類 | オプション | 必須 | 含める | 値 


 a| 
_SVM 名_

監査設定を作成するSVMの名前。既存のSVMを指定する必要があります。
 a| 
`-vserver` `vserver_name`
 a| 
はい
 a| 
はい
 a| 



 a| 
_ログの保存先パス_

変換された監査ログを格納するディレクトリを指定します。通常は専用のボリュームまたはqtreeです。SVMネームスペース内の既存のパスを指定する必要があります。

パスは864文字以内で、読み取り / 書き込みアクセス権が設定されている必要があります。

パスが有効でない場合、監査設定コマンドは失敗します。

SVMがSVMディザスタ リカバリ ソースである場合、ログのデスティネーション パスをルート ボリューム上に設定することはできません。これは、ルート ボリュームのコンテンツはディザスタ リカバリ先にレプリケートされないためです。

FlexCacheボリュームをログのデスティネーションとして使用することはできません（ONTAP 9.7以降）。
 a| 
`-destination` `text`
 a| 
はい
 a| 
はい
 a| 



 a| 
_監査対象イベントのカテゴリー_

監査するイベントのカテゴリを指定します。監査できるイベント カテゴリは次のとおりです。

* ファイル アクセス イベント（SMBとNFSv4の両方）
* SMBログオンおよびログオフ イベント
* 集約型アクセス ポリシーのステージング イベント
+
集約型アクセス ポリシーのステージング イベントは、Windows Server 2012 Active Directoryドメイン以降で使用できます。

* 非同期削除
* ファイル共有カテゴリ イベント
* 監査ポリシー変更イベント
* ローカル ユーザ アカウント管理イベント
* セキュリティ グループ管理イベント
* 認証ポリシー変更イベント


デフォルトでは、ファイル アクセス イベントとSMBログオンおよびログオフ イベントが監査されます。

*注：* `cap-staging`をイベントカテゴリとして指定するには、SVM上にSMBサーバが存在している必要があります。SMBサーバでダイナミックアクセス制御を有効にしなくても、監査設定で集約型アクセスポリシーのステージングを有効にすることはできますが、集約型アクセスポリシーのステージングイベントはダイナミックアクセス制御が有効になっている場合にのみ生成されます。ダイナミックアクセス制御はSMBサーバオプションで有効になります。デフォルトでは有効になっていません。
 a| 
`-events` {`file-ops`|`cifs-logon-logoff`|`cap-staging`|`file-share`|`audit-policy-change`|`user-account`|`security-group`|`authorization-policy-change`|`async-delete`}
 a| 
いいえ
 a| 
 a| 



 a| 
_ログ ファイルの出力形式_

監査ログの出力形式を指定します。出力形式は、ONTAP固有の形式 `XML`またはMicrosoft Windowsの `EVTX`ログ形式のいずれかです。デフォルトの出力形式は `EVTX`です。
 a| 
`-format` {`xml`|`evtx`}
 a| 
いいえ
 a| 
 a| 



 a| 
_ログ ファイルのローテーション制限_

最も古いログファイルをローテーションする前に保持する監査ログファイルの数を決定します。たとえば、 `5`の値を入力すると、最後の5つのログファイルが保持されます。

 `0`の値は、すべてのログファイルが保持されることを示します。デフォルト値は0です。
 a| 
`-rotate-limit` `integer`
 a| 
いいえ
 a| 
 a| 

|===


== 監査イベント ログをいつローテーションするかを決定するために使用されるパラメータ

*ログのサイズに基づいてログをローテーションする*

デフォルトでは、サイズに基づいて監査ログがローテーションされます。

* デフォルトのログ サイズは100MBです。
* デフォルトのログ ローテーション方法とログ サイズを使用する場合、ログ ローテーションに関して特定のパラメータを設定する必要はありません。
* ログ サイズのみに基づいて監査ログをローテーションする場合は、次のコマンドを使用して `-rotate-schedule-minute`パラメータを設定解除します： `vserver audit modify -vserver vs0 -destination / -rotate-schedule-minute -`


デフォルトのログ サイズを使用しない場合は、 `-rotate-size` パラメータを設定してカスタム ログ サイズを指定できます：

[cols="40,30,10,10,10"]
|===


| 情報の種類 | オプション | 必須 | 含める | 値 


 a| 
_ログ ファイルのサイズ制限_

監査ログ ファイルの最大サイズを指定します。
 a| 
`-rotate-size` {`integer`［KB｜MB｜GB｜TB｜PB］}
 a| 
いいえ
 a| 
 a| 

|===
*スケジュールに基づいてログをローテーションする*

スケジュールに基づいて監査ログをローテーションすることを選択した場合は、時間ベースのローテーション パラメータを任意の組み合わせで使用して、ログのローテーションをスケジュールできます。

* 時間ベースのローテーションを使用する場合、 `-rotate-schedule-minute`パラメータは必須です。
* それ以外の時間に基づくローテーション パラメータは、すべてオプションです。
* ローテーション スケジュールは、時間を指定するすべての値を使用して計算されます。
+
たとえば、 `-rotate-schedule-minute`パラメータのみを指定すると、監査ログ ファイルは、年間のすべての月のすべての時間帯、すべての曜日に指定された分に基づいてローテーションされます。

* 時間ベースのローテーション パラメータを 1 つまたは 2 つだけ指定すると（たとえば、 `-rotate-schedule-month`および `-rotate-schedule-minutes`）、指定した月のみ、すべての曜日、すべての時間帯で指定した分の値に基づいてログ ファイルがローテーションされます。
+
たとえば、監査ログを1月、3月、8月のすべての月曜日、水曜日、土曜日の午前10：30にローテーションするように指定できます。

*  `-rotate-schedule-dayofweek`と `-rotate-schedule-day`の両方に値を指定した場合、それらは独立して考慮されます。
+
たとえば、 `-rotate-schedule-dayofweek`を金曜日、 `-rotate-schedule-day`を13と指定した場合、監査ログは13日の金曜日だけでなく、毎週金曜日と指定した月の13日にローテーションされます。

* スケジュールのみに基づいて監査ログをローテーションする場合は、次のコマンドを使用して `-rotate-size`パラメータを設定解除します： `vserver audit modify -vserver vs0 -destination / -rotate-size -`


使用可能な監査パラメータの次のリストを使用して、監査イベント ログのローテーションのスケジュールを構成するために使用する値を決定できます：

[cols="40,30,10,10,10"]
|===


| 情報の種類 | オプション | 必須 | 含める | 値 


 a| 
_ログローテーションスケジュール：月_

監査ログのローテーションを実行する月を指定します。

有効な値は `January`から `December`まで、および `all`です。たとえば、監査ログを1月、3月、8月の3か月間にローテーションするように指定できます。
 a| 
`-rotate-schedule-month` `chron_month`
 a| 
いいえ
 a| 
 a| 



 a| 
_ログローテーションスケジュール：曜日_

監査ログのローテーションを実行する日（曜日）を指定します。

有効な値は `Sunday`から `Saturday`まで、および `all`です。たとえば、監査ログを火曜日と金曜日にローテーションするように指定することも、週のすべての曜日にローテーションするように指定することもできます。
 a| 
`-rotate-schedule-dayofweek` `chron_dayofweek`
 a| 
いいえ
 a| 
 a| 



 a| 
_ログローテーションスケジュール：日_

監査ログのローテーションを実行する日（月の日）を指定します。

有効な値の範囲は `1`から `31`です。たとえば、監査ログを毎月 10 日と 20 日にローテーションするように指定することも、毎月すべての日にローテーションするように指定することもできます。
 a| 
`-rotate-schedule-day` `chron_dayofmonth`
 a| 
いいえ
 a| 
 a| 



 a| 
_ログローテーションスケジュール：時間_

監査ログをローテーションする時間単位のスケジュールを決定します。

有効な値の範囲は `0`（午前0時）から `23`（午後11：00）です。 `all`を指定すると、監査ログは1時間ごとにローテーションされます。例えば、監査ログを6（午前6時）と18（午後6時）にローテーションするように指定できます。
 a| 
`-rotate-schedule-hour` `chron_hour`
 a| 
いいえ
 a| 
 a| 



 a| 
_ログローテーションスケジュール：分_

監査ログをローテーションする分単位のスケジュールを決定します。

有効な値の範囲は `0`～ `59`です。たとえば、監査ログを 30 分にローテーションするように指定できます。
 a| 
`-rotate-schedule-minute` `chron_minute`
 a| 
スケジュールベースのログローテーションを構成する場合は「はい」、それ以外の場合は「いいえ」。
 a| 
 a| 

|===
*ログのサイズとスケジュールに基づいてログをローテーションする*

ログ サイズとスケジュールに基づいてログ ファイルをローテーションするには、 `-rotate-size`パラメータと時間ベースのローテーション パラメータを任意に組み合わせて設定します。例： `-rotate-size`を10 MBに設定し、 `-rotate-schedule-minute`を15に設定した場合、ログ ファイルのサイズが10 MBに達したとき、または毎時15分（どちらか早く発生したイベント）にログ ファイルがローテーションされます。
