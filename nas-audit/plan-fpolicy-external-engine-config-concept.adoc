---
permalink: nas-audit/plan-fpolicy-external-engine-config-concept.html 
sidebar: sidebar 
keywords: plan, fpolicy, external engine, configuration 
summary: FPolicy 外部エンジンを設定する前に、外部エンジンを作成することの意味を理解し、使用可能な設定パラメータを理解する必要があります。この情報は、各パラメータに設定する値を決定するのに役立ちます。 
---
= FPolicy 外部エンジンの設定を計画します
:icons: font
:imagesdir: ../media/


[role="lead"]
FPolicy 外部エンジンを設定する前に、外部エンジンを作成することの意味を理解し、使用可能な設定パラメータを理解する必要があります。この情報は、各パラメータに設定する値を決定するのに役立ちます。



== FPolicy 外部エンジンの作成時に定義される情報

外部エンジンの設定では、外部 FPolicy サーバ（ FPolicy サーバ）への接続を作成および管理するために FPolicy が必要とする、次のような情報を定義します。

* Storage Virtual Machine （ SVM ）名
* エンジン名
* FPolicy サーバへの接続時に使用するプライマリおよびセカンダリ FPolicy サーバの IP アドレスと TCP ポート番号
* エンジンタイプが非同期か同期か
* ノードと FPolicy サーバ間の接続を認証する方法
+
相互 SSL 認証を設定することを選択した場合は、 SSL 証明書情報を提供するパラメータも設定する必要があります。

* 各種の高度な権限設定を使用して接続を管理する方法
+
これには、タイムアウト値、リトライ値、キープアライブ値、最大要求値、送信および受信バッファサイズ値、セッションタイムアウト値などを定義するパラメータが含まれます。



FPolicy 外部エンジンの作成には、 vserver fpolicy policy external-engine create コマンドを使用します。



== 外部エンジンの基本パラメータ

次に示す FPolicy 基本設定パラメータの一覧は、構成を計画するのに役立ちます。

[cols="2*"]
|===
| 情報のタイプ | オプション 


 a| 
SVM

この外部エンジンに関連付ける SVM の名前を指定します。

各 FPolicy 設定は、単一の SVM 内で定義されます。FPolicy ポリシーの構成要素となる外部エンジン、ポリシーイベント、ポリシーのスコープ、およびポリシーを、すべて同じ SVM に関連付ける必要があります。
 a| 
「 -vserver `vserver_name` 」



 a| 
_ エンジン名 _

外部エンジンの設定に割り当てる名前を指定します。FPolicy ポリシーを作成した場合、あとで外部エンジンの名前を指定する必要があります。これにより、外部エンジンがポリシーに関連付けられます。

この名前に指定できる文字数は最大 256 文字です。

[NOTE]
====
MetroCluster または SVM ディザスタリカバリ設定で外部エンジンの名前を設定する場合、この名前は最大 200 文字にする必要があります。

====
名前には、次の ASCII 文字の任意の組み合わせを含めることができます。

* 「 a 」 ～ 「 z 」
* 「 A 」 ～ 「 Z 」
* 0 ～ 9
* "`_`","`-`","`.")

 a| 
「 -engine-name 」「 engine_name 」



 a| 
プライマリ FPolicy サーバ _

所定の FPolicy ポリシーに関してノードが送信する通知の宛先となるプライマリ FPolicy サーバを指定します。IP アドレスをカンマで区切って指定します。

複数のプライマリサーバの IP アドレスを指定した場合、 SVM が参加しているすべてのノードに、ポリシーが有効にされたときに指定されたすべてのプライマリ FPolicy サーバへの制御接続が作成されます。複数のプライマリ FPolicy サーバを設定した場合、通知は各 FPolicy サーバにラウンドロビン方式で送信されます。

外部エンジンが MetroCluster または SVM ディザスタリカバリ設定で使用されている場合は、ソースサイトでの FPolicy サーバの IP アドレスをプライマリサーバとして指定する必要があります。デスティネーションサイトでの FPolicy サーバの IP アドレスは、セカンダリサーバとして指定する必要があります。
 a| 
` -primary-servers `ip_address '...



 a| 
ポート番号 _

FPolicy サービスのポート番号を指定します。
 a| 
「 -port 」の「 integer 」を参照してください



 a| 
_ セカンダリ FPolicy サーバ _

所定の FPolicy ポリシーに関して、ファイルアクセスイベントの送信先となるセカンダリ FPolicy サーバを指定します。IP アドレスをカンマで区切って指定します。

セカンダリサーバは、いずれのプライマリにも到達できない場合にのみ使用されます。ポリシーが有効になっている場合はセカンダリサーバへの接続が確立されますが、通知はいずれのプライマリサーバにも到達できない場合にのみセカンダリサーバに送信されます。複数のセカンダリ FPolicy サーバを設定した場合、通知は各 FPolicy サーバにラウンドロビン方式で送信されます。
 a| 
`-ssecondary-servers `IP_address`,...



 a| 
_ 外部エンジンタイプ _

外部エンジンが同期モードで動作するか非同期モードで動作するかを指定します。デフォルトでは、 FPolicy は同期モードで動作します。

同期に設定すると、ファイル要求処理によって FPolicy サーバに通知が送信されますが、 FPolicy サーバから応答を受信するまでは、それ以降の通知は送信されません。この時点で、 FPolicy サーバからの応答が要求されたアクションを許可するかどうかによって、要求フローが続行されるか処理が拒否されるかが決まります。

asynchronous に設定すると、ファイル要求処理は、 FPolicy サーバに通知を送信したあとも処理を続行します。
 a| 
-extern -engine-type `external_engine_type] このパラメータの値は ' 次のいずれかになります

* 静止
* 「非同期」




 a| 
_SSL オプションを使用して FPolicy サーバと通信します

FPolicy サーバとの通信のための SSL オプションを指定します。これは必須パラメータです。次の情報に基づいて、いずれかのオプションを選択できます。

* 「 no-auth 」に設定すると、認証は行われません。
+
通信リンクは TCP を介して確立されます。

* 「 server-auth 」に設定すると、 SVM は SSL サーバ認証を使用して FPolicy サーバを認証します。
* 「 manual -auth 」に設定すると、 SVM と FPolicy サーバ間で相互認証が行われ、 SVM は FPolicy サーバを認証し、 FPolicy サーバは SVM を認証します。
+
相互 SSL 認証を設定する場合は '-certificate-common-name'`-certificate-serial`'-certifcate-ca` の各パラメータも設定する必要があります


 a| 
-ssl-option '{`no-auth`|`server-auth`|`m utual -auth`}



 a| 
_ 証明書 FQDN またはカスタム共通名 _

SVM と FPolicy サーバ間の SSL 認証が設定されている場合、使用される証明書の名前を指定します。証明書の名前は、 FQDN またはカスタム共通名として指定できます。

「 -ssl-option 」パラメータに「 manual -auth」 を指定した場合は、「 -certificate-common-name 」パラメータに値を指定する必要があります。
 a| 
`-certificate-common-name`text`



 a| 
証明書シリアル番号 _

SVM と FPolicy サーバ間の SSL 認証が設定されている場合、認証に使用される証明書のシリアル番号を指定します。

「 -ssl-option 」パラメータに「 manual -auth」 を指定した場合は、「 -certificate-serial 」パラメータの値を指定する必要があります。
 a| 
`-certificate-serial `text`



 a| 
_ 認証局 _

SVM と FPolicy サーバ間の SSL 認証が設定されている場合、認証に使用される証明書の CA 名を指定します。

「 -ssl-option 」パラメータに「 manual -auth」 を指定した場合は、「 -certifcate-ca 」パラメータの値を指定する必要があります。
 a| 
`-certifcate-ca`text`

|===


== 外部エンジンの詳細オプション

高度な FPolicy 設定パラメータの次の表は、高度なパラメータを使用して設定をカスタマイズするかどうかを計画する際に使用できます。これらのパラメータは、クラスタノードと FPolicy サーバ間の通信動作を変更するために使用します。

[cols="2*"]
|===
| 情報のタイプ | オプション 


 a| 
_ リクエストをキャンセルするためのタイムアウト _

ノードが FPolicy サーバからの応答を待機する時間間隔を時間（「 h 」）、分（「 m 」）、または秒（「 ` 」）で指定します。

タイムアウト間隔が経過すると、ノードは FPolicy サーバにキャンセル要求を送信します。その後、ノードから代替 FPolicy サーバに通知が送信されます。このタイムアウトは、応答しない FPolicy サーバを処理するのに役立ちます。これにより SMB / NFS クライアントの応答を向上させることができます。また、通知要求がパフォーマンスの低い、またはダウンした FPolicy サーバから代替 FPolicy サーバへ移されているため、タイムアウトによってリクエストをキャンセルすることは、システムリソースを解放するのに役立ちます。

この値の範囲は「 0 」 ～ 「 100 」です。値が「 0 」に設定されている場合、オプションは無効になり、キャンセルされた要求メッセージは FPolicy サーバに送信されません。デフォルトは「 20s 」です。
 a| 
`-reqs-cancel-timeout`integer [h|m|s]



 a| 
_ 要求を破棄するためのタイムアウト _

要求を破棄するためのタイムアウトを時間（「 h 」）、分（「 m 」）、または秒（「 ` 」）で指定します。

この値の範囲は「 0 」 ～ 「 200 」です。
 a| 
`-reqs-abort-timeout`````````integer [h|m|s]



 a| 
ステータス要求の送信間隔 _

FPolicy サーバにステータス要求を送信する間隔を時間（「 h 」）、分（「 m 」）、または秒（「 ` 」）で指定します。

この値の範囲は「 0 」 ～ 「 50 」です。値が「 0 」に設定されている場合、オプションは無効になり、ステータス要求メッセージは FPolicy サーバに送信されません。デフォルトは「 10s 」です。
 a| 
--status-req -interval `integer [h|m|s]



 a| 
FPolicy サーバの未処理要求の最大数 _

FPolicy サーバのキューに登録できる未処理要求の最大数を指定します。

この値の範囲は '1' ～ 10000 ですデフォルトは「 50 」です。
 a| 
`-max-server-reqs `integer



 a| 
_ 応答しない FPolicy サーバを切断するタイムアウト _

FPolicy サーバへの接続を終了するまでの時間間隔を時間（「 h 」）、分（「 m 」）、または秒（「 ` 」）で指定します。

FPolicy サーバのキューに許容される最大要求数が含まれていて、タイムアウト期間内に応答がない場合のみ、タイムアウト期間が経過したあとに接続を終了します。許容される最大リクエスト数は、「 50 」（デフォルト）または「 m ax-server-reqs- 」パラメータで指定された数です。

この値の範囲は「 1 」 ～ 「 100 」です。デフォルトは「 60s 」です。
 a| 
`-server -progress-timeout`integer [h|m|s]



 a| 
FPolicy サーバにキープアライブメッセージを送信する間隔 _

キープアライブメッセージを FPolicy サーバに送信する時間間隔を時間（「 h 」）、分（「 m 」）、または秒（「 ` 」）で指定します。

キープアライブメッセージはハーフオープン接続を検出します。

この値の範囲は '10 ～ 600 です値が「 0 」に設定されている場合、オプションは無効になり、キープアライブメッセージは FPolicy サーバには送信されません。デフォルトは「 120S 」です。
 a| 
`-keep-alive] -interval-`integer [h|m|s]



 a| 
最大再接続試行回数 _

接続が切断されたあと、 SVM が FPolicy サーバへの再接続を試行できる最大回数を指定します。

この値の範囲は「 0 」 ～ 「 20 」です。デフォルトは「 5 」です。
 a| 
「 -max-connection-retries 」には「 integer 」を指定します



 a| 
受信バッファサイズ _

FPolicy サーバの接続ソケットの受信バッファサイズを指定します。

デフォルト値は 256KB に設定されています。値が 0 に設定されている場合、受信バッファのサイズはシステムによって定義されている値に設定されます。

たとえば、ソケットのデフォルト受信バッファサイズが 65 、 536 バイトの場合、この調整可能な値を 0 に設定すると、ソケットのバッファサイズは 65 、 536 バイトに設定されます。デフォルト値以外の任意の値を使用して、受信バッファのサイズ（バイト単位）を設定できます。
 a| 
-recv-buffer-size `integer



 a| 
送信バッファサイズ _

FPolicy サーバの接続ソケットの送信バッファサイズを指定します。

デフォルト値は 256KB に設定されています。値が 0 に設定されている場合、送信バッファのサイズはシステムによって定義されている値に設定されます。

たとえば、ソケットのデフォルト送信バッファサイズが 65 、 536 バイトの場合、この調整可能な値を 0 に設定すると、ソケットのバッファサイズは 65 、 536 バイトに設定されます。デフォルト値以外の任意の値を使用して、送信バッファのサイズ（バイト単位）を設定できます。
 a| 
`-send-buffer-size`integer



 a| 
_ 再接続中にセッション ID を消去するためのタイムアウト _

再接続の試行時に FPolicy サーバに新しいセッション ID が送信されるまでの間隔を時間（「 h 」）、分（「 m 」）、または秒（「 ` 」）で指定します。

ストレージコントローラと FPolicy サーバとの間の接続が終了して「 -session-timeout 」の時間内に再接続が行われた場合は、古い通知に対する応答を送信できるように、古いセッション ID が FPolicy サーバに送信されます。

デフォルト値は 10 秒に設定されています。
 a| 
「 -session-timeout 」 [`integer `h][`integer `m][`integer ````````````````````````s]]

|===