---
permalink: nas-audit/plan-fpolicy-external-engine-config-concept.html 
sidebar: sidebar 
keywords: plan, fpolicy, external engine, configuration 
summary: FPolicy外部エンジンを設定する前に、外部エンジンを作成することの意味と、使用可能なパラメータを理解する必要があります。 
---
= FPolicy外部エンジンの設定を計画する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
FPolicy外部エンジンを設定する前に、外部エンジンを作成することの意味と、使用可能な設定パラメータを理解する必要があります。この情報は、各パラメータに設定する値を決定するのに役立ちます。



== FPolicy外部エンジンの作成時に定義される情報

外部エンジンの設定では、外部FPolicyサーバへの接続を作成および管理するためにFPolicyが必要とする次のような情報を定義します。

* SVM名
* エンジン名
* FPolicyサーバへの接続時に使用するプライマリおよびセカンダリFPolicyサーバのIPアドレスとTCPポート番号
* エンジンタイプが非同期か同期か
* エンジンフォーマットがまたは `protobuf`かどうか `xml`
+
ONTAP 9 .15.1以降では、エンジン形式を使用できます `protobuf`。に設定する `protobuf`と、通知メッセージはGoogle Protobufを使用してバイナリ形式でエンコードされます。エンジン形式をに設定する前に、 `protobuf`FPolicyサーバでもデシリアライゼーションがサポートされていることを確認して `protobuf`ください。

+
protobuf形式はONTAP 9 .15.1以降でサポートされているため、以前のリリースのONTAPにリバートする前に外部エンジン形式を考慮する必要があります。ONTAP 9.15.1より前のリリースにリバートする場合は、FPolicyパートナーと協力して次のいずれかを実行します。

+
** 各エンジンフォーマットをからに `xml`変更します。 `protobuf`
** エンジンフォーマットがのエンジンを削除します。 `protobuf`


* ノードとFPolicyサーバ間の接続を認証する方法
+
相互SSL認証を設定する場合は、SSL証明書情報を提供するパラメータも設定する必要があります。

* 各種の高度な権限設定を使用して接続を管理する方法
+
これには、タイムアウト値、リトライ値、キープアライブ値、最大要求値、送信および受信バッファ サイズ値、セッション タイムアウト値などを定義するパラメータが含まれます。



コマンドは、 `vserver fpolicy policy external-engine create`FPolicy外部エンジンの作成に使用します。



== 外部エンジンの基本パラメータ

次に示すFPolicy基本設定パラメータの一覧は、設定を計画するのに役立ちます。

[cols="70,30"]
|===


| 情報の種類 | オプション 


 a| 
SVM

この外部エンジンに関連付けるSVMの名前を指定します。

各FPolicy設定は、単一のSVM内で定義されます。FPolicyポリシーの構成要素となる外部エンジン、ポリシーイベント、ポリシーのスコープ、およびポリシーを、すべて同じSVMに関連付ける必要があります。
 a| 
`-vserver` `vserver_name`



 a| 
_ エンジン名 _

外部エンジンの設定に割り当てる名前を指定します。FPolicyポリシーを作成した場合、あとで外部エンジンの名前を指定する必要があります。こうすることで、外部エンジンがポリシーに関連付けられます。

名前の最大文字数は256文字です。

[NOTE]
====
MetroClusterまたはSVMディザスタリカバリ設定で外部エンジン名を設定する場合、この名前は最大200文字にする必要があります。

====
名前には、次のASCII文字の任意の組み合わせを含めることができます。

* `a`から `z`
* `A`から `Z`
* `0`から `9`
* "`_`"、"`.`"-`", and "`

 a| 
`-engine-name` `engine_name`



 a| 
プライマリ FPolicy サーバ _

所定のFPolicyポリシーに関してノードが送信する通知の宛先となるプライマリFPolicyサーバを指定します。IPアドレスの値をカンマで区切って指定します。

複数のプライマリサーバのIPアドレスを指定した場合、SVMが参加しているすべてのノードに、ポリシーが有効になったときに指定されたすべてのプライマリFPolicyサーバへの制御接続が作成されます。複数のプライマリFPolicyサーバを設定した場合、通知はラウンドロビン方式でFPolicyサーバに送信されます。

外部エンジンがMetroClusterまたはSVMディザスタリカバリ設定で使用されている場合は、ソースサイトでのFPolicyサーバのIPアドレスをプライマリサーバとして指定する必要があります。デスティネーションサイトのFPolicyサーバのIPアドレスは、セカンダリサーバとして指定する必要があります。
 a| 
`-primary-servers` `IP_address`はい。



 a| 
ポート番号 _

FPolicyサービスのポート番号を指定します。
 a| 
`-port` `integer`



 a| 
_ セカンダリ FPolicy サーバ _

所定のFPolicyポリシーに関して、ファイルアクセスイベントの送信先となるセカンダリFPolicyサーバを指定します。IPアドレスの値をカンマで区切って指定します。

セカンダリサーバは、いずれのプライマリサーバにも到達できない場合にのみ使用されます。ポリシーを有効にすると、セカンダリサーバへの接続が確立されますが、通知がセカンダリサーバに送信されるのは、いずれのプライマリサーバにも到達できない場合だけです。複数のセカンダリサーバを設定した場合、通知はラウンドロビン方式でFPolicyサーバに送信されます。
 a| 
`-secondary-servers` `IP_address`はい。



 a| 
_ 外部エンジンタイプ _

外部エンジンが同期モードで動作するか非同期モードで動作するかを指定します。デフォルトでは、FPolicyは同期モードで動作します。

に設定する `synchronous`と、ファイル要求処理によって通知がFPolicyサーバに送信されますが、その後FPolicyサーバから応答を受信するまでは通知は送信されません。この時点で、要求されたアクションがFPolicyサーバからの応答で許可されるかどうかに応じて、要求フローが続行されるか処理が拒否されます。

に設定する `asynchronous`と、ファイル要求処理はFPolicyサーバに通知を送信したあとも続行します。
 a| 
`-extern-engine-type` `external_engine_type`このパラメータには、次のいずれかの値を指定できます。

* `synchronous`
* `asynchronous`




 a| 
_外部エンジンフォーマット_

外部エンジン形式がXMLかprotobufかを指定します。

ONTAP 9 .15.1以降では、protobufエンジン形式を使用できます。protobufに設定すると、通知メッセージはGoogle Protobufを使用してバイナリ形式でエンコードされます。エンジン形式をprotobufに設定する前に、FPolicyサーバでもprotobufデシリアライゼーションがサポートされていることを確認してください。
 a| 
`- extern-engine-format`{`protobuf` または `xml`}



 a| 
_SSL オプションを使用して FPolicy サーバと通信します

FPolicyサーバとの通信に使用するSSLオプションを指定します。これは必須パラメータです。次の情報に基づいて、いずれかのオプションを選択できます。

* に設定する `no-auth`と、認証は行われません。
+
通信リンクはTCPを介して確立されます。

* に設定する `server-auth`と、SVMはSSLサーバ認証を使用してFPolicyサーバを認証します。
* に設定する `mutual-auth`と、SVMとFPolicyサーバの間で相互認証が行われ、SVMはFPolicyサーバを認証し、FPolicyサーバはSVMを認証します。
+
相互SSL認証を設定する場合は、、 `-certificate-serial`、の `-certifcate-ca`各パラメータも設定する必要があります `-certificate-common-name`。


 a| 
`-ssl-option`{`no-auth`|`server-auth`|`mutual-auth`}



 a| 
_ 証明書 FQDN またはカスタム共通名 _

SVMとFPolicyサーバ間のSSL認証が設定されている場合に使用される証明書の名前を指定します。証明書の名前は、FQDNまたはカスタム共通名で指定できます。

パラメータに `-ssl-option`を指定する場合 `mutual-auth`は、パラメータの値を指定する必要があります `-certificate-common-name`。
 a| 
`-certificate-common-name` `text`



 a| 
証明書シリアル番号 _

SVMとFPolicyサーバ間のSSL認証が設定されている場合に認証に使用される証明書のシリアル番号を指定します。

パラメータに `-ssl-option`を指定する場合 `mutual-auth`は、パラメータの値を指定する必要があります `-certificate-serial`。
 a| 
`-certificate-serial` `text`



 a| 
_ 認証局 _

SVMとFPolicyサーバ間のSSL認証が設定されている場合に認証に使用される証明書のCA名を指定します。

パラメータに `-ssl-option`を指定する場合 `mutual-auth`は、パラメータの値を指定する必要があります `-certificate-ca`。
 a| 
`-certificate-ca` `text`

|===


== 外部エンジンの詳細オプションとは

次の高度なFPolicy設定パラメータの表は、高度なパラメータを使用して設定をカスタマイズするかどうかを計画する際に使用できます。これらのパラメータを使用して、クラスタノードとFPolicyサーバ間の通信動作を変更します。

[cols="70,30"]
|===


| 情報の種類 | オプション 


 a| 
_ リクエストをキャンセルするためのタイムアウト _

(`s`ノードがFPolicyサーバからの応答を待機する時間間隔（時間(`h`）、分(`m`、または秒）を指定します。

タイムアウト間隔が経過すると、ノードはFPolicyサーバにキャンセル要求を送信します。その後、ノードから代替FPolicyサーバに通知が送信されます。このタイムアウトは、応答していないFPolicyサーバを処理するのに役立ちます。これにより、SMB / NFSクライアントの応答を改善できます。また、通知要求が停止している、または無効なFPolicyサーバから代替FPolicyサーバに移動されるため、タイムアウト時間後に要求をキャンセルすると、システムリソースを解放するのに役立ちます。

この値の範囲は~ `100`です `0`。値がに設定されている場合 `0`、オプションは無効になり、キャンセル要求メッセージはFPolicyサーバに送信されません。デフォルトはです `20s`。
 a| 
`-reqs-cancel-timeout` `integer`[h|m|s]



 a| 
_ 要求を破棄するためのタイムアウト _

(`s`要求を中止するタイムアウト（時間）(`h`、分(`m`、または秒）を指定します。

この値の範囲は~ `200`です `0`。
 a| 
`-reqs-abort-timeout` `` `integer`[h|m|s]



 a| 
ステータス要求の送信間隔 _

(`s`FPolicyサーバにステータス要求を送信する間隔（時間(`h`）、分）(`m`、または秒）を指定します。

この値の範囲は~ `50`です `0`。値がに設定されている場合 `0`、オプションは無効になり、ステータス要求メッセージはFPolicyサーバに送信されません。デフォルトはです `10s`。
 a| 
`-status-req-interval` `integer`[h|m|s]



 a| 
FPolicy サーバの未処理要求の最大数 _

FPolicyサーバのキューに登録できる未処理要求の最大数を指定します。

この値の範囲は~ `10000`です `1`。デフォルトはです `500`。
 a| 
`-max-server-reqs` `integer`



 a| 
_ 応答しない FPolicy サーバを切断するタイムアウト _

(`s`FPolicyサーバへの接続を終了するまでの時間間隔（時間(`h`）、分）(`m`、または秒を指定します。

FPolicyサーバのキューに許容される最大要求数が含まれていて、タイムアウト期間内に応答がない場合にのみ、タイムアウト期間後に接続を終了します。許可される最大要求数は、（デフォルト）またはパラメータで指定された数 `max-server-reqs-`です `50`。

この値の範囲は~ `100`です `1`。デフォルトはです `60s`。
 a| 
`-server-progress-timeout` `integer`[h|m|s]



 a| 
FPolicy サーバにキープアライブメッセージを送信する間隔 _

(`s`FPolicyサーバにキープアライブメッセージを送信する時間間隔を時間(`h`、分(`m`、または秒で指定します。

キープアライブメッセージはハーフオープン接続を検出します。

この値の範囲は~ `600`です `10`。値がに設定されている場合 `0`、オプションは無効になり、キープアライブメッセージはFPolicyサーバに送信されません。デフォルトはです `120s`。
 a| 
`-keep-alive-interval-` `integer`[h|m|s]



 a| 
最大再接続試行回数 _

接続が切断されたあと、SVMがFPolicyサーバへの再接続を試行する最大回数を指定します。

この値の範囲は~ `20`です `0`。デフォルトはです `5`。
 a| 
`-max-connection-retries` `integer`



 a| 
受信バッファサイズ _

FPolicyサーバの接続ソケットの受信バッファサイズを指定します。

デフォルト値は256KBに設定されています。値が0に設定されている場合、受信バッファのサイズはシステムによって定義された値に設定されます。

たとえば、ソケットのデフォルトの受信バッファサイズが65536バイトの場合、調整可能な値を0に設定すると、ソケットバッファサイズは65536バイトに設定されます。デフォルト値以外の任意の値を使用して、受信バッファのサイズ（バイト単位）を設定できます。
 a| 
`-recv-buffer-size` `integer`



 a| 
送信バッファサイズ _

FPolicyサーバの接続ソケットの送信バッファサイズを指定します。

デフォルト値は256KBに設定されています。値が0に設定されている場合、送信バッファのサイズはシステムによって定義された値に設定されます。

たとえば、ソケットのデフォルトの送信バッファサイズが65536バイトに設定されている場合、調整可能な値を0に設定すると、ソケットバッファサイズは65536バイトに設定されます。デフォルト値以外の任意の値を使用して、送信バッファのサイズ（バイト単位）を設定できます。
 a| 
`-send-buffer-size` `integer`



 a| 
_ 再接続中にセッション ID を消去するためのタイムアウト _

(`s`再接続の試行時にFPolicyサーバに新しいSession IDが送信されるまでの間隔（時間(`h`）、分）(`m`、または秒を指定します。

ストレージコントローラとFPolicyサーバの間の接続が終了し、その期間内に再接続が行われる `-session-timeout`と、古い通知に対する応答を送信できるように、古いSession IDがFPolicyサーバに送信されます。

デフォルト値は10秒に設定されています。
 a| 
`-session-timeout`[h][m][s]``integer````integer````integer``

|===