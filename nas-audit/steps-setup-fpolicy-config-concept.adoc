---
permalink: nas-audit/steps-setup-fpolicy-config-concept.html 
sidebar: sidebar 
keywords: steps, setting, fpolicy configuration 
summary: FPolicyでファイルアクセスを監視するには、FPolicyの設定を作成し、FPolicyサービスが必要なSVMで有効にする必要があります。 
---
= ONTAP FPolicy設定をセットアップする
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
FPolicyでファイルアクセスを監視するには、FPolicyの設定を作成し、FPolicyサービスが必要なStorage Virtual Machine（SVM）で有効にする必要があります。

SVMでFPolicy設定をセットアップして有効にする手順は次のとおりです。

. FPolicy外部エンジンを作成します。
+
FPolicy外部エンジンは、特定のFPolicyの設定に関連付けられた外部FPolicyサーバ（FPolicyサーバ）を識別します。内部の「ネイティブ」 FPolicy エンジンを使用してネイティブ・ファイル・ブロッキング構成を作成する場合は、 FPolicy 外部エンジンを作成する必要はありません。

+
ONTAP 9 .15.1以降では、エンジン形式を使用できます `protobuf`。に設定する `protobuf`と、通知メッセージはGoogle Protobufを使用してバイナリ形式でエンコードされます。エンジン形式をに設定する前に、 `protobuf`FPolicyサーバでもデシリアライゼーションがサポートされていることを確認して `protobuf`ください。詳細については、を参照してください。 link:plan-fpolicy-external-engine-config-concept.html["FPolicy外部エンジンの設定を計画する"]

. FPolicyイベントを作成します。
+
FPolicyイベントは、FPolicyポリシーで監視する対象を定義します。イベントは監視対象のプロトコルとファイル操作で構成され、一連のフィルタを含めることができます。イベントでは、フィルタを使用して、FPolicy外部エンジンから通知を送信する必要がある監視対象イベントのリストを絞り込みます。イベントは、ポリシーがボリューム操作を監視するかどうかも指定します。

. FPolicy永続ストアを作成します（オプション）。
+
14.1以降では、ONTAP 9の必須ではない非同期ポリシーのファイルアクセスイベントをキャプチャするようにを設定できlink:persistent-stores.html["永続的ストア"]ます。同期（必須または非必須）および非同期の必須構成はサポートされていません。

+
永続的ストアを使用すると、クライアントI/O処理とFPolicy通知処理を分離して、クライアントのレイテンシを低減できます。

+
ONTAP 9 .15.1以降では、FPolicyの永続的ストアの設定が簡素化されています。 `persistent-store-create`コマンドは、SVM用のボリュームの作成を自動化し、永続的ストア用のボリュームを設定します。

. FPolicyポリシーを作成します。
+
FPolicyポリシーでは、監視する必要がある一連のイベントと、指定のFPolicyサーバ（FPolicyサーバが設定されていない場合は標準のエンジン）に通知を送信する必要がある監視対象イベントを、適切な範囲で関連付けます。また、通知を受信するデータへの権限付きアクセスをFPolicyサーバに許可するかどうかも定義します。FPolicyサーバからデータにアクセスする必要がある場合は、権限付きアクセスが必要になります。権限付きアクセスが必要な一般的なユースケースには、ファイルブロッキング、クォータ管理、階層型ストレージ管理などがあります。ポリシーは、このポリシーの設定で FPolicy サーバを使用するか、内部の「ネイティブ」 FPolicy サーバを使用するかを指定します。

+
スクリーニングを必須にするかどうかはポリシーで指定します。スクリーニングを必須にすると、すべてのFPolicyサーバが停止した場合や定義された時間内にFPolicyサーバからの応答を得られない場合に、ファイル アクセスが拒否されます。

+
ポリシーはSVM単位で適用されます。1つのポリシーを複数のSVMに適用することはできません。ただし、ある特定のSVMに複数のFPolicyポリシーを含めることは可能で、範囲、イベント、外部サーバの設定を同じ組み合わせにすることも、それぞれで異なる組み合わせにすることもできます。

. ポリシーの範囲を設定します。
+
FPolicyスコープでは、ボリューム、共有、またはエクスポート ポリシーについて、ポリシーで監視するものと除外するものを指定します。また、ファイル拡張子についても、FPolicyの監視対象に含めるものと除外するものを指定します。

+
[NOTE]
====
除外リストの方が対象リストよりも優先されます。

====
. FPolicyポリシーを有効にします。
+
ポリシーを有効にすると、制御チャネルおよび特権データ チャネル（オプション）の接続が確立されます。SVMが属するノードのFPolicyプロセスで、ファイルおよびフォルダに対するアクセスの監視が開始され、設定された条件に当てはまるイベントが見つかると、FPolicyサーバ（FPolicyサーバが設定されていない場合は標準のエンジン）に通知が送信されます。



[NOTE]
====
ポリシーでネイティブ ファイル ブロッキングを使用する場合は、外部エンジンは設定されず、関連付けられることもありません。

====