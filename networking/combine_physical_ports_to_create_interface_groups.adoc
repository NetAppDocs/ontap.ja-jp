---
sidebar: sidebar 
permalink: networking/combine_physical_ports_to_create_interface_groups.html 
keywords: combine, ports, ifgrp, interface, group, create, creating, add, adding, types, single-mode, single, mode, static, dynamic, multimode, best, practice, port-based, port, based, load, balance, balancing, ip, address, mac, sequential, remove, removing, delete, deleting, combine physical ports to create interface groups, interface group types, characteristics of single-mode interface groups, characteristics of static multimode interface groups, dynamic multimode interface group, load balancing in multimode interface groups, port-based load balancing, ip address and mac address load balancing, sequential load balancing, create an interface group, add a port to an interface group, remove a port from an interface group, delete an interface group 
summary: 複数の物理ポートを 1 つの論理ポートにまとめて、インターフェイスグループを作成します 
---
= 物理ポートを組み合わせてインターフェイスグループを作成する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
2つ以上の物理ポートを1つの論理ポートに結合することで、Link Aggregation Group（LAG；リンクアグリゲーショングループ）とも呼ばれるインターフェイスグループが作成されます。論理ポートを使用すると、耐障害性と可用性が向上し、負荷も共有できます。



== インターフェイスグループのタイプ

ストレージシステムでは、シングルモード、スタティックマルチモード、およびダイナミックマルチモードという 3 種類のインターフェイスグループがサポートされています。インターフェイスグループごとに、フォールトトレランスのレベルが異なります。マルチモードインターフェイスグループは、ネットワークトラフィックのロードバランシング方法を提供します。



=== シングルモードインターフェイスグループの特性

シングルモードインターフェイスグループでは、インターフェイスグループの 1 つのインターフェイスだけがアクティブになります。他のインターフェイスはスタンバイで、アクティブインターフェイスに障害が発生した場合に動作を引き継ぎます。

シングルモードインターフェイスグループの特性は、次のとおりです。

* フェイルオーバーでは、クラスタがアクティブリンクを監視して、フェイルオーバーを制御します。クラスタがアクティブリンクを監視するため、スイッチを設定する必要はありません。
* シングルモードインターフェイスグループには、複数のスタンバイインターフェイスを設定できます。
* シングルモードインターフェイスグループが複数のスイッチをカバーする場合は、スイッチどうしを Inter-Switch Link （ ISL ；スイッチ間リンク）で接続する必要があります。
* シングルモードインターフェイスグループの場合は、スイッチポートが同じブロードキャストドメインに属している必要があります。
* 送信元アドレスが 0.0.0.0 であるリンクモニタリング ARP パケットは、ポートを介して送信され、ポートが同じブロードキャストドメイン内にあることが確認されます。


次の図はシングルモードインターフェイスグループの例です。この例では、 e0a と e1a が a0a というシングルモードインターフェイスグループを構成しています。アクティブインターフェイスの e0a に障害が発生すると、スタンバイインターフェイスの e1a が処理を引き継ぎ、スイッチとの接続を維持します。

image:ontap_nm_image6.png["シングルモードインターフェイスグループの図"]


NOTE: シングルモード機能を実現するためには、フェイルオーバーグループを使用するアプローチが推奨されます。フェイルオーバーグループを使用すると、 2 番目のポートを引き続き他の LIF に使用でき、未使用のままにする必要はありません。また、フェイルオーバーグループは複数のポートにまたがることができ、複数のノードのポートにまたがることができます。



=== スタティックマルチモードインターフェイスグループの特性

ONTAP に実装されているスタティックマルチモードインターフェイスグループは、 IEEE 802.3ad （ static ）に準拠しています。スタティックマルチモードインターフェイスグループでは、アグリゲーションはサポートするがアグリゲーション設定のための制御パケット交換は行わないスイッチを使用できます。

スタティックマルチモードインターフェイスグループは、 Link Aggregation Control Protocol （ LACP ）とも呼ばれる IEEE 802.3ad （ dynamic ）に準拠していません。LACP はポートアグリゲーションプロトコル（ PAgP ）と同等な、 Cisco 独自のリンクアグリゲーションプロトコルです。

スタティックマルチモードインターフェイスグループの特性は、次のとおりです。

* インターフェイスグループ内のすべてのインターフェイスがアクティブで、 1 つの MAC アドレスを共有します。
+
** 複数の接続が、インターフェイスグループ内のインターフェイスに分散されます。
** 各接続またはセッションは、インターフェイスグループ内の 1 つのインターフェイスを使用します。シーケンシャルロードバランシング方式を使用する場合、すべてのセッションはパケット単位で使用可能なリンク全体に分散され、インターフェイスグループの特定のインターフェイスにバインドされません。


* スタティックマルチモードインターフェイスグループは、最大「 n-1 」個のインターフェイスの障害から回復できます。 n は、インターフェイスグループを構成しているインターフェイスの合計数です。
* あるポートで障害が発生した場合や切断された場合は、そのリンクを経由していたトラフィックが残りのインターフェイスの 1 つに自動的に再分散されます。
* スタティックマルチモードインターフェイスグループではリンクの喪失は検出できますが、クライアントへの接続の切断や、接続性とパフォーマンスに影響を及ぼす可能性があるスイッチの設定ミスは検出できません。
* スタティックマルチモードインターフェイスグループには、複数のスイッチポートでのリンクアグリゲーションをサポートするスイッチが必要です。インターフェイスグループの各リンクの接続先ポートがすべて 1 つの論理ポートを構成するよう、そのスイッチを設定します。一部のスイッチは、ジャンボフレーム用に構成されたポートのリンクアグリゲーションをサポートしていない場合があります。詳細については、スイッチベンダーのマニュアルを参照してください。
* スタティックマルチモードインターフェイスグループのインターフェイス間でのトラフィック分散には、いくつかのロードバランシングオプションを使用できます。


次の図はスタティックマルチモードインターフェイスグループの例を示したものです。インターフェイス e0a 、 e1a 、 e2a 、および e3a は、 a1a というマルチモードインターフェイスグループの一部です。この a1a マルチモードインターフェイスグループの 4 つのインターフェイスはすべてアクティブです。

image:ontap_nm_image7.png["スタティックマルチモードインターフェイスグループの図"]

1 つの集約リンク内のトラフィックを複数の物理スイッチに分散できるテクノロジーがいくつか存在します。この機能を有効にするテクノロジは、ネットワーク製品によって異なります。ONTAP のスタティックマルチモードインターフェイスグループは、 IEEE 802.3 規格に準拠しています。IEEE 802.3 規格に対応または準拠すると言われている複数スイッチリンクアグリゲーションテクノロジであれば、 ONTAP と一緒に使用できます。

IEEE 802.3 規格には、集約リンク内の送信デバイスが送信用の物理インターフェイスを決定することが規定されています。そのため、 ONTAP が受け持つのは発信トラフィックの分散だけで、着信フレームの受信方法を制御することはできません。集約リンクでの着信トラフィックの転送を管理または制御する場合は、直接接続されたネットワークデバイス上でその転送を変更する必要があります。



=== ダイナミックマルチモードインターフェイスグループ

ダイナミックマルチモードインターフェイスグループは、 Link Aggregation Control Protocol （ LACP ）を実装して、直接接続されたスイッチへのグループメンバーシップの通信を行います。LACP を使用すると、リンクステータスの喪失および直接接続されたスイッチポートと通信できないノードを検出できます。

ONTAP に実装されているダイナミックマルチモードインターフェイスグループは、 IEEE 802.3 AD （ 802.1 AX ）に準拠しています。ONTAP は、シスコ独自のリンクアグリゲーションプロトコルである Port Aggregation Protocol （ PAgP ）をサポートしていません。

ダイナミックマルチモードインターフェイスグループには、 LACP をサポートするスイッチが必要です。

ONTAP は、アクティブまたはパッシブモードに設定されているスイッチとの相性がよい、設定不可のアクティブモードで LACP を実装します。ONTAP は、 IEEE 802.3 AD （ 802.1AX ）の規定に従い、 long および short の LACP タイマーを実装し、設定不可の値（ 3 秒と 90 秒）で使用します。

ONTAP ロードバランシングアルゴリズムは、発信トラフィックの転送に使用されるメンバーポートを決定しますが、着信フレームの受信方法は制御しません。スイッチは、スイッチのポートチャネルグループに設定されたロードバランシングアルゴリズムに基づいて、転送に使用されるポートチャネルグループのメンバー（個々の物理ポート）を決定します。したがって、スイッチの設定により、トラフィックを受信するストレージシステムのメンバーポート（個々の物理ポート）が決まります。スイッチ設定の詳細については、スイッチベンダーのマニュアルを参照してください。

あるインターフェイスが、連続する LACP プロトコルパケットの受信に失敗すると、そのインターフェイスに対して、「 ifgrp status 」コマンドで「 lag_inactive 」と出力されます。既存のトラフィックは、残りのアクティブインターフェイスに自動的に再ルーティングされます。

ダイナミックマルチモードインターフェイスグループを使用する場合、次のルールが適用されます。

* ダイナミックマルチモードインターフェイスグループは、ポートベース、 IP ベース、 MAC ベース、またはラウンドロビンによるロードバランシング方式を使用するように設定する必要があります。
* ダイナミックマルチモードインターフェイスグループでは、すべてのインターフェイスをアクティブにして、 1 つの MAC アドレスを共有する必要があります。


次の図は、ダイナミックマルチモードインターフェイスグループの例です。インターフェイス e0a 、 e1a 、 e2a 、および e3a は、 a1a というマルチモードインターフェイスグループの一部です。a1a ダイナミックマルチモードインターフェイスグループの 4 つのインターフェイスはすべてアクティブです。

image:ontap_nm_image7.png["ダイナミックマルチモードインターフェイスグループの図"]



=== マルチモードインターフェイスグループでのロードバランシング

IP アドレスベース、 MAC アドレスベース、シーケンシャル、またはポートベースのロードバランシング方式を使用してマルチモードインターフェイスグループのネットワークポート上でネットワークトラフィックを均等に分散させることにより、マルチモードインターフェイスグループのすべてのインターフェイスが送信トラフィックに均等に利用されるようにすることができます。

マルチモードインターフェイスグループのロードバランシング方式を指定できるのは、インターフェイスグループの作成時だけです。

* ベストプラクティス * ：可能なかぎりポートベースのロードバランシングを推奨します。ポートベースのロードバランシングは、ネットワークに特定の理由または制限がない場合にのみ使用してください。



==== ポートベースのロードバランシング

推奨される方法はポートベースのロードバランシングです。

ポートベースのロードバランシング方式を使用して、マルチモードインターフェイスグループ上のトラフィックをトランスポートレイヤ（ TCP または UDP ）ポートに基づいて均等に分散させることができます。

ポートベースのロードバランシング方式では、トランスポートレイヤのポート番号に加え、送信元と送信先の IP アドレスに対して高速ハッシュアルゴリズムを使用します。



==== IP アドレスおよび MAC アドレスによるロードバランシング

IP アドレスおよび MAC アドレスによるロードバランシングは、マルチモードインターフェイスグループのトラフィックを均等にする方法です。

これらのロードバランシング方式では、送信元アドレスと送信先アドレス（ IP アドレスと MAC アドレス）に対して高速ハッシュアルゴリズムを使用します。ハッシュアルゴリズムの結果がリンク状態が UP でないインターフェイスに一致した場合は、次のアクティブなインターフェイスが使用されます。


NOTE: ルータに直接接続するシステムでインターフェイスグループを作成する場合は、 MAC アドレスによるロードバランシング方式を選択しないでください。このような構成では、すべての発信 IP フレームの宛先 MAC アドレスはルータの MAC アドレスです。そのため、使用されるインターフェイスグループのインターフェイスは 1 つだけです。

IP アドレスによるロードバランシングは、 IPv4 アドレスと IPv6 アドレスの両方で同様に機能します。



==== シーケンシャルロードバランシング

シーケンシャルロードバランシングでは、ラウンドロビンアルゴリズムを使用して複数のリンク間でパケットを均等に分散できます。シーケンシャルオプションを使用すると、 1 つの接続のトラフィックを複数のリンクに分散させて、単一の接続のスループットを向上させることができます。

ただし、シーケンシャルロードバランシングによって原因のパケット配信順序が乱れることがあるため、パフォーマンスが大幅に低下する可能性があります。したがって、一般にシーケンシャルロードバランシングは推奨されません。



== インターフェイスグループまたはLAGを作成します

インターフェイスグループまたはLAG（シングルモード、スタティックマルチモード、またはダイナミックマルチモード（LACP））を作成すると、集約されたネットワークポートの機能を組み合わせて、クライアントに単一のインターフェイスを提供できます。

実行する手順 は、System ManagerまたはCLIを使用するインターフェイスによって異なります。

[role="tabbed-block"]
====
.System Manager の略
--
* System Managerを使用してLAGを作成します。*

.手順
. [*Network]>[Ethernet port]>[+ Link Aggregation Group]を選択して、LAGを作成します。
. ドロップダウンリストからノードを選択します。
. 次のいずれかを選択します。
+
.. ONTAP to * automatically select broadcast domain（推奨）*。
.. ブロードキャストドメインを手動で選択します。


. LAGを形成するポートを選択します。
. モードを選択します。
+
.. Single：一度に1つのポートのみが使用されます。
.. 複数：すべてのポートを同時に使用できます。
.. LACP：LACPプロトコルによって、使用できるポートが決まります。


. ロードバランシングを選択します。
+
.. IPベース
.. MACベース
.. ポート
.. シーケンシャル


. 変更を保存します。


image:AddLag01.png["遅延図を追加"]

--
.CLI の使用
--
* CLIを使用してインターフェイスグループを作成*

ポートインターフェイスグループに適用される設定上の制限事項の一覧については、を参照してください `network port ifgrp add-port` のマニュアルページ。

マルチモードインターフェイスグループを作成するときは、次のいずれかのロードバランシング方式を指定できます。

* `port`：ネットワークトラフィックは、トランスポートレイヤ（TCP / UDP）ポートに基づいて分散されます。これは推奨されるロードバランシング方式です。
* `mac`：ネットワークトラフィックはMACアドレスに基づいて分散されます。
* `ip`：ネットワークトラフィックはIPアドレスに基づいて分散されます。
* `sequential`：ネットワークトラフィックは受信したとおりに分散されます。



NOTE: インターフェイスグループの MAC アドレスは、基盤となるポートの順序およびそれらのポートがブートアップ時にどのように初期化されるかによって決まります。そのため、 ifgrp の MAC アドレスがリブート後や ONTAP のアップグレード後に変わる可能性があることを想定しておいてください。

.ステップ
を使用します `network port ifgrp create` インターフェイスグループを作成するコマンド。

インターフェイスグループの名前には、という構文を使用する必要があります `a<number><letter>`。たとえば、 a0a 、 a0b 、 a1c 、 a2a は有効なインターフェイスグループ名です。

このコマンドの詳細については、を参照してください http://["ONTAP 9 のコマンド"^]。

次の例は、ポートの分散機能を使用し、モードを multimode に設定して、 a0a という名前のインターフェイスグループを作成する方法を示しています。

`network port ifgrp create -node _cluster-1-01_ -ifgrp _a0a_ -distr-func _port_ -mode _multimode_`

--
====


== インターフェイスグループまたはLAGにポートを追加します

インターフェイスグループまたはLAGには、すべてのポート速度に対して最大16個の物理ポートを追加できます。

実行する手順 は、System ManagerまたはCLIを使用するインターフェイスによって異なります。

[role="tabbed-block"]
====
.System Manager の略
--
* System Managerを使用して、LAGにポートを追加します。*

.手順
. [*Network]>[Ethernet port]>[LAG]を選択して、LAGを編集します。
. LAGに追加する同じノードの追加ポートを選択します。
. 変更を保存します。


--
.CLI の使用
--
* CLIを使用して、インターフェイス・グループにポートを追加します。*

.ステップ
インターフェイスグループにネットワークポートを追加します。

`network port ifgrp add-port`

このコマンドの詳細については、を参照してください link:http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-cm-cmpr/GUID-5CB10C70-AC11-41C0-8C16-B4D0DF916E9B.html["ONTAP 9 のコマンド"^]。

次の例は、 a0a というインターフェイスグループにポート e0c を追加する方法を示しています。

`network port ifgrp add-port -node _cluster-1-01_ -ifgrp _a0a_ -port _e0c_`

ONTAP 9.8 以降では、最初の物理ポートがインターフェイスグループに追加されてから約 1 分後に、インターフェイスグループが適切なブロードキャストドメインに自動的に配置されます。ONTAP でこの処理を行わず、ifgrpをブロードキャストドメインに手動で配置する場合は、を指定します `-skip-broadcast-domain-placement` パラメータをに指定します `ifgrp add-port` コマンドを実行します

--
====


== インターフェイスグループまたはLAGからポートを削除します

LIF をホストするインターフェイスグループからポートを削除できます。ただし、そのポートがインターフェイスグループの最後のポートでない場合に限ります。最後のポートをインターフェイスグループから削除しないという前提により、インターフェイスグループが LIF をホストできない、またはインターフェイスグループを LIF のホームポートに指定できないという要件はありません。ただし、最後のポートを削除する場合は、先にインターフェイスグループから LIF を移行または移動しておく必要があります。

.このタスクについて
インターフェイスグループまたはLAGから最大16個のポート（物理インターフェイス）を削除できます。

実行する手順 は、System ManagerまたはCLIを使用するインターフェイスによって異なります。

[role="tabbed-block"]
====
.System Manager の略
--
* System Managerを使用して、LAGからポートを削除します。*

.手順
. [*Network]>[Ethernet port]>[LAG]を選択して、LAGを編集します。
. LAGから削除するポートを選択します。
. 変更を保存します。


--
.CLI の使用
--
* CLIを使用して、インターフェイスグループからポートを削除します。*

.ステップ
インターフェイスグループからネットワークポートを削除します。

`network port ifgrp remove-port`

次の例は、 a0a というインターフェイスグループからポート e0c を削除する方法を示しています。

`network port ifgrp remove-port -node _cluster-1-01_ -ifgrp _a0a_ -port _e0c_`

--
====


== インターフェイスグループまたはLAGを削除します

基盤となる物理ポートにLIFを直接設定したり、インターフェイスグループやLAGモード、または分散機能を変更したりする場合は、インターフェイスグループまたはLAGを削除できます。

.作業を開始する前に
* インターフェイスグループまたはLAGがLIFをホストしていないことを確認する必要があります。
* インターフェイスグループまたはLAGは、LIFのホームポートでもフェイルオーバーターゲットでもない必要があります。


実行する手順 は、System ManagerまたはCLIを使用するインターフェイスによって異なります。

[role="tabbed-block"]
====
.System Manager の略
--
* LAGを削除するには、System Managerを使用します。*

.手順
. [*Network]>[Ethernet port]>[LAG]を選択して、LAGを削除します。
. 削除するLAGを選択します。
. LAGを削除します。


--
.CLI の使用
--
* CLIを使用してインターフェイスグループ*を削除してください

.ステップ
を使用します `network port ifgrp delete` インターフェイスグループを削除するコマンド。

このコマンドの詳細については、を参照してください link:http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-cm-cmpr/GUID-5CB10C70-AC11-41C0-8C16-B4D0DF916E9B.html["ONTAP 9 のコマンド"^]。

次に、 a0b という名前のインターフェイスグループを削除する例を示します。

`network port ifgrp delete -node _cluster-1-01_ -ifgrp _a0b_`

--
====