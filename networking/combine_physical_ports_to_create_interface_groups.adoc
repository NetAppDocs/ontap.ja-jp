---
sidebar: sidebar 
permalink: networking/combine_physical_ports_to_create_interface_groups.html 
keywords: combine, ports, ifgrp, interface, group, create, creating, add, adding, types, single-mode, single, mode, static, dynamic, multimode, best, practice, port-based, port, based, load, balance, balancing, ip, address, mac, sequential, remove, removing, delete, deleting, combine physical ports to create interface groups, interface group types, characteristics of single-mode interface groups, characteristics of static multimode interface groups, dynamic multimode interface group, load balancing in multimode interface groups, port-based load balancing, ip address and mac address load balancing, sequential load balancing, create an interface group, add a port to an interface group, remove a port from an interface group, delete an interface group 
summary: 複数の物理ポートを 1 つの論理ポートにまとめて、インターフェイスグループを作成します 
---
= 物理ポートを組み合わせてインターフェイスグループを作成
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
インターフェイスグループはLink Aggregation Group（LAG；リンクアグリゲーショングループ）とも呼ばれ、同じノード上の複数の物理ポートを1つの論理ポートにまとめることで作成されます。論理ポートを使用すると、耐障害性と可用性が向上し、負荷も共有できます。



== インターフェイス グループの種類

ストレージ システムでは、シングルモード、スタティック マルチモード、およびダイナミック マルチモードという3種類のインターフェイス グループがサポートされています。各インターフェイス グループは、フォールト トレランスのレベルが異なります。マルチモード インターフェイス グループは、ネットワーク トラフィックのロード バランシング方法を提供します。



=== シングルモード インターフェイス グループの特性

シングルモード インターフェイス グループでは、インターフェイス グループの1つのインターフェイスだけがアクティブになります。他のインターフェイスはスタンバイで、アクティブなインターフェイスに障害が発生した場合に動作を引き継ぎます。

シングルモード インターフェイス グループの特性は、次のとおりです。

* フェイルオーバーでは、クラスタがアクティブ リンクを監視して、フェイルオーバーを制御します。クラスタがアクティブ リンクを監視するので、スイッチを設定する必要はありません。
* シングルモード インターフェイス グループには、複数のスタンバイ インターフェイスを設定できます。
* シングルモード インターフェイス グループが複数のスイッチをカバーする場合は、スイッチどうしをInter-Switch Link（ISL;スイッチ間リンク）で接続する必要があります。
* シングルモード インターフェイス グループでは、スイッチ ポートが同じブロードキャスト ドメインに属している必要があります。
* ポートが同じブロードキャスト ドメイン内にあるかどうかを確認するために、リンク監視用ARPパケット（送信元アドレスは0.0.0.0）がポートを介して送信されます。


次の図はシングルモード インターフェイス グループの例です。この例では、e0aとe1aがa0aというシングルモード インターフェイス グループを構成しています。アクティブ インターフェイスのe0aに障害が発生すると、スタンバイ インターフェイスのe1aが処理を引き継ぎ、スイッチとの接続を維持します。

image:ontap_nm_image6.png["シングルモードインターフェイスグループ"]


NOTE: シングルモード機能を実現するためには、フェイルオーバーグループを使用することを推奨します。フェイルオーバーグループを使用すると、2番目のポートを引き続き他のLIFに使用でき、未使用のままにする必要はありません。さらに、フェイルオーバーグループは3つ以上のポートにまたがることも、複数のノードのポートにまたがることもできます。



=== スタティックマルチモードインターフェイスグループの特性

ONTAPに実装されているスタティックマルチモードインターフェイスグループは、IEEE 802.3ad（static）に準拠しています。スタティックマルチモードインターフェイスグループでは、アグリゲートをサポートしているが、アグリゲートを設定するための制御パケット交換が行われていないスイッチを使用できます。

スタティックマルチモードインターフェイスグループは、Link Aggregation Control Protocol（LACP）とも呼ばれるIEEE 802.3ad（dynamic）に準拠していません。LACPは、Cisco独自のリンクアグリゲーションプロトコルであるポートアグリゲーションプロトコル（PAgP）に相当します。

スタティックマルチモードインターフェイスグループの特性は次のとおりです。

* インターフェイスグループ内のすべてのインターフェイスがアクティブで、1つのMACアドレスを共有します。
+
** 複数の接続が、インターフェイスグループ内のインターフェイスに分散されます。
** 各接続またはセッションは、インターフェイスグループ内の1つのインターフェイスを使用します。シーケンシャルロードバランシング方式を使用すると、すべてのセッションがパケット単位で使用可能なリンクに分散され、インターフェイスグループの特定のインターフェイスにバインドされません。


* スタティックマルチモードインターフェイスグループは、最大で「n-1」個のインターフェイスの障害から回復できます。nは、インターフェイスグループを構成するインターフェイスの総数です。
* ポートに障害が発生した場合、またはポートが接続されていない場合、障害が発生したリンクを通過していたトラフィックは、残りのインターフェイスの1つに自動的に再配布されます。
* スタティックマルチモードインターフェイスグループではリンクの喪失は検出できますが、クライアントへの接続の喪失や、接続とパフォーマンスに影響する可能性のあるスイッチの設定ミスは検出できません。
* スタティックマルチモードインターフェイスグループには、複数のスイッチポートでのリンクアグリゲーションをサポートするスイッチが必要です。スイッチは、インターフェイスグループのリンクの接続先ポートがすべて1つの論理ポートを構成するように設定されています。一部のスイッチでは、ジャンボフレーム用に構成されたポートのリンクアグリゲーションがサポートされない場合があります詳細については、スイッチベンダーのマニュアルを参照してください。
* スタティックマルチモードインターフェイスグループのインターフェイス間でトラフィックを分散するために、いくつかのロードバランシングオプションを使用できます。


次の図は、スタティックマルチモードインターフェイスグループの例です。インターフェイスe0a、e1a、e2a、およびe3aは、a1aマルチモードインターフェイスグループの一部です。a1aマルチモードインターフェイスグループの4つのインターフェイスはすべてアクティブです。

image:ontap_nm_image7.png["ダイナミックマルチモードインターフェイスグループ"]

単一の集約リンク内のトラフィックを複数の物理スイッチに分散できるようにするテクノロジーがいくつか存在します。この機能を有効にするために使用されるテクノロジは、ネットワーク製品によって異なります。ONTAPのスタティックマルチモードインターフェイスグループは、IEEE 802.3規格に準拠しています。特定のマルチスイッチリンクアグリゲーションテクノロジがIEEE 802.3規格と相互運用または準拠していると言われている場合は、ONTAPと連携して動作する必要があります。

IEEE 802.3規格では、集約リンク内の送信デバイスが送信用の物理インターフェイスを決定すると規定されています。したがって、ONTAPは発信トラフィックの配信のみを担当し、着信フレームの着信方法を制御することはできません。集約リンク上の着信トラフィックの送信を管理または制御する場合は、直接接続されたネットワークデバイスでその送信を変更する必要があります。



=== ダイナミックマルチモードインターフェイスグループ

ダイナミックマルチモードインターフェイスグループは、Link Aggregation Control Protocol（LACP）を実装して、直接接続されたスイッチにグループメンバーシップを通信します。LACPを使用すると、リンクステータスの喪失および直接接続されたスイッチポートと通信できないノードを検出できます。

ONTAPに実装されているダイナミックマルチモードインターフェイスグループは、IEEE 802.3 AD（802.1 AX）に準拠しています。ONTAPは、Cisco独自のリンクアグリゲーションプロトコルであるポートアグリゲーションプロトコル（PAgP）をサポートしていません。

ダイナミックマルチモードインターフェイスグループには、LACPをサポートするスイッチが必要です。

ONTAPは設定不可のアクティブモードでLACPを実装します。これは、アクティブモードまたはパッシブモードに設定されたスイッチと連動します。ONTAPは、IEEE 802.3 AD（802.1AX）で規定されているように、longおよびshortのLACPタイマーを実装します（3秒および90秒の設定不可の値で使用します）。

ONTAPロードバランシングアルゴリズムは、発信トラフィックの送信に使用されるメンバーポートを決定しますが、着信フレームの受信方法は制御しません。スイッチは、スイッチのポートチャネルグループに設定されたロードバランシングアルゴリズムに基づいて、送信に使用されるポートチャネルグループのメンバー（個 々 の物理ポート）を決定します。したがって、スイッチの設定によって、トラフィックを受信するストレージシステムのメンバーポート（個 々 の物理ポート）が決まります。スイッチの設定の詳細については、スイッチベンダーのマニュアルを参照してください。

あるインターフェイスが連続するLACPプロトコルパケットの受信に失敗すると、そのインターフェイスは「ifgrp status」コマンドの出力で「lag_inactive」と表示されます。既存のトラフィックは、残りのアクティブインターフェイスに自動的に再ルーティングされます。

ダイナミックマルチモードインターフェイスグループを使用する場合は、次のルールが適用されます。

* ダイナミックマルチモードインターフェイスグループは、ポートベース、IPベース、MACベース、またはラウンドロビンによるロードバランシング方式を使用するように設定する必要があります。
* ダイナミックマルチモードインターフェイスグループでは、すべてのインターフェイスをアクティブにし、1つのMACアドレスを共有する必要があります。


次の図は、ダイナミックマルチモードインターフェイスグループの例です。インターフェイスe0a、e1a、e2a、およびe3aは、a1aマルチモードインターフェイスグループの一部です。a1aダイナミックマルチモードインターフェイスグループの4つのインターフェイスはすべてアクティブです。

image:ontap_nm_image7.png["ダイナミックマルチモードインターフェイスグループ"]



=== マルチモードインターフェイスグループでのロードバランシング

IPアドレスベース、MACアドレスベース、シーケンシャルベース、またはポートベースのロードバランシング方式を使用してマルチモードインターフェイスグループのネットワークポート上でネットワークトラフィックを均等に分散することにより、マルチモードインターフェイスグループのすべてのインターフェイスが送信トラフィックに均等に使用されるようにすることができます。

マルチモードインターフェイスグループのロードバランシング方式は、インターフェイスグループの作成時にのみ指定できます。

* ベストプラクティス * ：可能なかぎりポートベースのロードバランシングを推奨します。ポートベースのロードバランシングは、ネットワークに特定の理由または制限がないかぎり使用してください。



==== ポートベースのロードバランシング

ポートベースのロードバランシングが推奨されます。

ポートベースのロードバランシング方式を使用すると、マルチモードインターフェイスグループのトラフィックをトランスポートレイヤ（TCP / UDP）ポートに基づいて均等に分散できます。

ポートベースのロードバランシング方式では、トランスポートレイヤのポート番号に加えて、ソースとデスティネーションのIPアドレスに対して高速ハッシュアルゴリズムを使用します。



==== IPアドレスおよびMACアドレスによるロードバランシング

IPアドレスおよびMACアドレスによるロードバランシングは、マルチモードインターフェイスグループのトラフィックを均等に分散する方法です。

これらのロードバランシング方式では、送信元アドレスと宛先アドレス（IPアドレスとMACアドレス）に対して高速ハッシュアルゴリズムが使用されます。ハッシュアルゴリズムの結果がupリンクステートにないインターフェイスにマッピングされる場合、次のアクティブインターフェイスが使用されます。


NOTE: ルータに直接接続するシステムでインターフェイスグループを作成する場合は、MACアドレスによるロードバランシング方式を選択しないでください。このような設定では、すべての発信IPフレームの宛先MACアドレスがルータのMACアドレスになります。そのため、インターフェイスグループの1つのインターフェイスだけが使用されます。

IPアドレスによるロードバランシングは、IPv4アドレスとIPv6アドレスの両方で同じように機能します。



==== シーケンシャルロードバランシング

シーケンシャルロードバランシングを使用すると、ラウンドロビンアルゴリズムを使用して、複数のリンク間でパケットを均等に分散できます。シーケンシャルオプションを使用すると、単一の接続のトラフィックを複数のリンクに分散して、単一の接続のスループットを向上させることができます。

ただし、シーケンシャルロードバランシングはパケット配信の順序が乱れてしまう可能性があるため、パフォーマンスが極端に低下する可能性があります。したがって、シーケンシャルロードバランシングは一般に推奨されません。



== インターフェイスグループまたはLAGの作成

インターフェイスグループまたはLAG（シングルモード、スタティックマルチモード、またはダイナミックマルチモード（LACP））を作成すると、集約されたネットワークポートの機能を組み合わせて単一のインターフェイスとしてクライアントに提供できます。

実行する手順は、使用するインターフェイス（System ManagerまたはCLI）によって異なります。

[role="tabbed-block"]
====
.System Manager
--
* System Managerを使用してLAGを作成します。*

.手順
. [*Network]>[Ethernet port]>[+ Link Aggregation Group]を選択して、LAGを作成します。
. ドロップダウンリストからノードを選択します。
. 次のいずれかを選択します。
+
.. ONTAP to * automatically select broadcast domain（推奨）*。
.. ブロードキャストドメインを手動で選択するには、をクリックします。


. LAGを構成するポートを選択します。
. モードを選択します。
+
.. Single：一度に1つのポートのみが使用されます。
.. 複数：すべてのポートを同時に使用できます。
.. LACP：LACPプロトコルによって、使用できるポートが決まります。


. ロードバランシングを選択します。
+
.. IPベース
.. MACベース
.. ポート
.. シーケンシャル


. 変更を保存します。


image:AddLag01.png["遅延図を追加"]

--
.CLI
--
* CLIを使用してインターフェイスグループを作成*

のポートインターフェイスグループに関する詳細および設定の制限事項については、を参照して `network port ifgrp add-port`link:https://docs.netapp.com/us-en/ontap-cli/network-port-ifgrp-add-port.html["ONTAPコマンド リファレンス"^]ください。

マルチモードインターフェイスグループを作成するときは、次のいずれかのロードバランシング方式を指定できます。

* `port`：ネットワークトラフィックは、トランスポートレイヤ（TCP / UDP）ポートに基づいて分散されます。これが推奨されるロードバランシング方式です。
* `mac`：ネットワークトラフィックはMACアドレスに基づいて分散されます。
* `ip`：ネットワークトラフィックはIPアドレスに基づいて分散されます。
* `sequential`：ネットワークトラフィックは受信したとおりに分散されます。



NOTE: インターフェイスグループのMACアドレスは、基盤となるポートの順序、およびこれらのポートがブート時にどのように初期化されるかによって決まります。そのため、ifgrpのMACアドレスがリブート後やONTAPのアップグレード後に変更されることはありません。

.ステップ
コマンドを使用し `network port ifgrp create`て、インターフェイスグループを作成します。

インターフェイスグループの名前には、という構文を使用する必要があります `a<number><letter>`。たとえば、a0a、a0b、a1c、a2aは有効なインターフェイスグループ名です。

の詳細については `network port ifgrp create`、をlink:https://docs.netapp.com/us-en/ontap-cli/network-port-ifgrp-create.html["ONTAPコマンド リファレンス"^]参照してください。

次の例は、分散機能をportに、モードをmultimodeに設定して、a0aという名前のインターフェイスグループを作成する方法を示しています。

`network port ifgrp create -node _cluster-1-01_ -ifgrp _a0a_ -distr-func _port_ -mode _multimode_`

--
====


== インターフェイスグループまたはLAGへのポートの追加

すべてのポート速度のインターフェイスグループまたはLAGに最大16個の物理ポートを追加できます。

実行する手順は、使用するインターフェイス（System ManagerまたはCLI）によって異なります。

[role="tabbed-block"]
====
.System Manager
--
* System Managerを使用して、LAGにポートを追加します。*

.手順
. [*Network]>[Ethernet port]>[LAG]を選択して、LAGを編集します。
. LAGに追加する同じノードの追加ポートを選択します。
. 変更を保存します。


--
.CLI
--
* CLIを使用して、インターフェイス・グループにポートを追加します。*

.ステップ
インターフェイスグループにネットワークポートを追加します。

`network port ifgrp add-port`

の詳細については `network port ifgrp add-port`、をlink:https://docs.netapp.com/us-en/ontap-cli/network-port-ifgrp-add-port.html["ONTAPコマンド リファレンス"^]参照してください。

次の例は、a0aという名前のインターフェイスグループにポートe0cを追加する方法を示しています。

`network port ifgrp add-port -node _cluster-1-01_ -ifgrp _a0a_ -port _e0c_`

ONTAP 9 8以降では、最初の物理ポートがインターフェイスグループに追加されてから約1分後に、適切なブロードキャストドメインにインターフェイスグループが自動的に配置されます。ONTAPでこの処理を行わず、ifgrpを手動でブロードキャストドメインに配置する場合は、パラメータをコマンドの一部として `ifgrp add-port`指定します `-skip-broadcast-domain-placement`。

--
====


== インターフェイスグループまたはLAGからポートを削除する

LIFをホストするインターフェイスグループからは、そのポートがインターフェイスグループ内の最後のポートでないかぎり、ポートを削除できます。最後のポートがインターフェイスグループから削除されないことを考慮して、インターフェイスグループがLIFをホストしていない、またはインターフェイスグループがLIFのホームポートでないという要件はありません。ただし、最後のポートを削除する場合は、先にインターフェイスグループからLIFを移行または移動する必要があります。

.タスクの内容
インターフェイスグループまたはLAGから最大16個のポート（物理インターフェイス）を削除できます。

実行する手順は、使用するインターフェイス（System ManagerまたはCLI）によって異なります。

[role="tabbed-block"]
====
.System Manager
--
* System Managerを使用して、LAGからポートを削除します。*

.手順
. [*Network]>[Ethernet port]>[LAG]を選択して、LAGを編集します。
. LAGから削除するポートを選択します。
. 変更を保存します。


--
.CLI
--
* CLIを使用して、インターフェイスグループからポートを削除します。*

.ステップ
インターフェイスグループからネットワークポートを削除します。

`network port ifgrp remove-port`

次の例は、a0aという名前のインターフェイスグループからポートe0cを削除する方法を示しています。

`network port ifgrp remove-port -node _cluster-1-01_ -ifgrp _a0a_ -port _e0c_`

--
====


== インターフェイスグループまたはLAGを削除する

基盤となる物理ポートに直接LIFを設定する場合や、インターフェイスグループやLAGのモードや分散機能を変更する場合は、インターフェイスグループやLAGを削除できます。

.開始する前に
* LIFをホストしているインターフェイスグループまたはLAGは使用できません。
* インターフェイスグループまたはLAGをLIFのホームポートまたはフェイルオーバーターゲットにすることはできません。


実行する手順は、使用するインターフェイス（System ManagerまたはCLI）によって異なります。

[role="tabbed-block"]
====
.System Manager
--
* LAGを削除するには、System Managerを使用します。*

.手順
. [*Network]>[Ethernet port]>[LAG]を選択して、LAGを削除します。
. 削除するLAGを選択します。
. LAGを削除します。


--
.CLI
--
* CLIを使用してインターフェイスグループ*を削除してください

.ステップ
インターフェイスグループを削除するには、コマンドを使用し `network port ifgrp delete`ます。

の詳細については `network port ifgrp delete`、をlink:https://docs.netapp.com/us-en/ontap-cli/network-port-ifgrp-delete.html["ONTAPコマンド リファレンス"^]参照してください。

次の例は、a0bという名前のインターフェイスグループを削除する方法を示しています。

`network port ifgrp delete -node _cluster-1-01_ -ifgrp _a0b_`

--
====