---
sidebar: sidebar 
permalink: networking/configure_dns_services_auto.html 
keywords: dns, service, services, configuration, configure, configuring, set, up, setup, nfs, smb, cifs, active, directory, statistics, configure dns services, configure dns services for the svm before creating an nfs or smb server, vserver services name-service, configure dynamic dns on the svm, vserver-fqdn 
summary: NFSまたはSMBサーバーを作成する前に、SVMのDNSサービスを設定します 
---
= ONTAPネットワークのDNSサービスを設定する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
NFSまたはSMBサーバを作成する前に、SVM用のDNSサービスを設定する必要があります。通常、DNSネーム サーバは、NFSまたはSMBサーバが参加するドメインのActive Directory統合DNSサーバです。

.タスク概要
Active Directory統合DNSサーバには、ドメインLDAPおよびドメイン コントローラ サーバのサービス ロケーション レコード（SRV）が格納されます。SVMがActive Directory LDAPサーバおよびドメイン コントローラを見つけられない場合は、NFSまたはSMBサーバのセットアップに失敗します。

SVMは、ホストについての情報を検索する際に、hostsネーム サービスns-switchデータベースを使用してどのネーム サービスを使用するか、どの順番で使用するかを決定します。ホスト データベースとしてサポートされている2つのネーム サービスは、filesおよびdnsです。

SMBサーバを作成する前に、dnsがソースの1つであることを確認する必要があります。


NOTE: mgwdプロセスとSecDプロセスについてDNSネーム サービスの統計を表示するには、統計画面を使用します。

.手順
. hostsネーム サービス データベースの現在の設定を確認します。この例では、hostsネーム サービス データベースはデフォルトの設定を使用しています。
+
`vserver services name-service _ns-switch_ show -vserver _vs1_ -database _hosts_`

+
....
Vserver: vs1
Name Service Switch Database: hosts
Vserver: vs1 Name Service Switch Database: hosts
Name Service Source Order: files, dns
....
. 必要に応じて、次の操作を実行します。
+
.. DNSネーム サービスを希望の順番でhostsネーム サービス データベースに追加するか、ソースの順番を変更します。
+
この例では、DNSおよびローカル ファイルをこの順番で使用するようにhostsデータベースを設定しています。

+
`vserver services name-service _ns-switch_ modify -vserver _vs1_ -database _hosts_ -sources _dns,files_`

.. ネーム サービスの設定が正しいことを確認します。
+
`vserver services name-service _ns-switch_ show -vserver _vs1_ -database _hosts_`

+
....
Vserver: vs1
Name Service Switch Database: hosts
Name Service Source Order: dns, files
....


. DNS サービスを設定します。
+
`vserver services name-service dns create -vserver _vs1_ -domains _example.com,example2.com_ -name-servers _10.0.0.50,10.0.0.51_`

+

NOTE: vserver services name-service dns createコマンドによって設定が自動検証され、ONTAPがネーム サーバに接続できない場合はエラー メッセージが報告されます。

. DNSの設定が正しいことと、サービスが有効になっていることを確認します。
+
....
Vserver: vs1
Domains: example.com, example2.com Name Servers: 10.0.0.50, 10.0.0.51
Enable/Disable DNS: enabled Timeout (secs): 2
Maximum Attempts: 1
....
. ネーム サーバのステータスを検証します。
+
`vserver services name-service dns check -vserver _vs1_`



....
Vserver  Name Server  Status  Status Details
vs1      10.0.0.50    up      Response time (msec): 2
vs1      10.0.0.51    up      Response time (msec): 2
....


== SVMでの動的DNSの設定

Active Directory統合DNSサーバをDNSにあるNFSまたはSMBサーバのDNSレコードに動的に登録する場合は、SVMで動的DNS（DDNS）を設定する必要があります。

.開始する前に
SVMでは、DNSネーム サービスが設定される必要があります。Secure DDNSを使用する場合は、Active Directory統合DNSネーム サーバを使用して、SVM用のNFSまたはSMBサーバあるいはActive Directoryアカウントを作成しておく必要があります。

.タスク概要
一意の完全修飾ドメイン名（FQDN）を指定する必要があります。

一意の完全修飾ドメイン名（FQDN）を指定する必要があります。

* NFS の場合、 `vserver services name-service dns dynamic-update`コマンドの一部として `-vserver-fqdn`で指定された値は、LIF の登録済み FQDN になります。
* SMBの場合、CIFSサーバのNetBIOS名およびCIFSサーバの完全修飾ドメイン名として指定した値がLIFの登録済みFQDNになります。これはONTAPでは設定できません。次のシナリオでは、LIFのFQDNは「CIFS_VS1.EXAMPLE.COM」です。
+
....
cluster1::> cifs server show -vserver vs1

                                          Vserver: vs1
                         CIFS Server NetBIOS Name: CIFS_VS1
                    NetBIOS Domain/Workgroup Name: EXAMPLE
                      Fully Qualified Domain Name: EXAMPLE.COM
                              Organizational Unit: CN=Computers
Default Site Used by LIFs Without Site Membership:
                                   Workgroup Name: -
                                   Kerberos Realm: -
                             Authentication Style: domain
                CIFS Server Administrative Status: up
                          CIFS Server Description:
                          List of NetBIOS Aliases: -
....



NOTE: DDNSアップデートのRFCルールに準拠していないSVM FQDNの設定エラーを回避するには、RFCに準拠したFQDN名を使用してください。詳細については、link:https://tools.ietf.org/html/rfc1123["RFC 1123"]を参照してください。

.手順
. SVMでDDNSを設定します。
+
`vserver services name-service dns dynamic-update modify -vserver _vserver_name_ -is- enabled _true_ [-use-secure {true|false} -vserver-fqdn _FQDN_used_for_DNS_updates_`

+
`vserver services name-service dns dynamic-update modify -vserver _vs1_ -is-enabled _true_ - use-secure _true_ -vserver-fqdn _vs1.example.com_`

+
カスタマイズされた FQDN の一部としてアスタリスクを使用することはできません。たとえば、 `*.netapp.com`は無効です。

. DDNSの設定が正しいことを確認します。
+
`vserver services name-service dns dynamic-update show`

+
....
Vserver  Is-Enabled Use-Secure Vserver FQDN      TTL
-------- ---------- ---------- ----------------- -------
vs1      true       true       vs1.example.com   24h
....

