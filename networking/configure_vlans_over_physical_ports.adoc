---
sidebar: sidebar 
permalink: networking/configure_vlans_over_physical_ports.html 
keywords: configure, configuration, configuring, setup, setting, set, up, vlans, virtual local area network, physical, port, logical, segmentation, configure vlans over physical ports, vlans provide logical segmentation of networks, create a vlan, network port vlan create, delete a vlan, network port vlan delete 
summary: ONTAPでVLANを使用し、分離されたブロードキャスト ドメインを作成することで、ネットワークを論理的にセグメント化できます。このブロードキャスト ドメインは、従来の物理的な境界ではなく、スイッチ ポートに基づいて定義されます。 
---
= 物理ポート経由でONTAP VLANを設定する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAPでVLANを使用し、分離されたブロードキャスト ドメインを作成することで、ネットワークを論理的にセグメント化できます。このブロードキャスト ドメインは、従来の物理的な境界ではなく、スイッチ ポートに基づいて定義されます。

1つのVLANは、複数の物理ネットワーク セグメントにまたがることができます。それぞれのVLANには、機能またはアプリケーションで関連性のあるエンド ステーションが属します。

たとえば、エンジニアリングや財務などの部門単位、またはリリース1やリリース2などのプロジェクト単位で、VLANのエンド ステーションをまとめることができます。VLANではエンド ステーションが物理的に近接した配置であることは重要ではないので、エンド ステーションを地理的に分散させても、スイッチ化されたネットワークにブロードキャスト ドメインを含めることができます。

ONTAP 9.14.1および9.13.1では、論理インターフェイス（LIF）で使用されていないタグなしポートで、接続されたネットワーク スイッチ上でネイティブVLAN接続が確立されていないポートは、デグレード状態としてマークされます。これは未使用ポートを識別するためのものであり、機能停止を示すものではありません。ネイティブVLANは、ONTAP CFMブロードキャストなど、ifgrpベース ポートでのタグなしトラフィックを許可します。タグなしトラフィックがブロックされないように、ネットワーク スイッチ上でネイティブVLANを設定してください。

管理者は、VLANを作成または削除したり、その情報を表示したりできます。


NOTE: スイッチのネイティブVLANと同じ識別子のVLANをネットワーク インターフェイス上に作成しないでください。たとえば、ネットワーク インターフェイスe0bがネイティブVLAN 10に割り当てられている場合、そのインターフェイス上にVLAN e0b-10を作成しないでください。



== VLANの作成

System Manager または `network port vlan create`コマンドを使用して、同じネットワーク ドメイン内で個別のブロードキャスト ドメインを維持するための VLAN を作成できます。

.開始する前に
次の要件を満たしていることを確認します。

* ネットワーク上に配置されたスイッチが、IEEE 802.1Q規格に準拠しているか、ベンダー固有のVLANを実装している。
* 複数のVLANをサポートする場合、エンド ステーションが1つ以上のVLANに属するように静的に設定されている。
* VLANは、クラスタLIFをホストしているポートに接続されていない。
* VLANは、「Cluster」IPspaceに割り当てられているポートに接続されていない。
* VLANは、メンバー ポートのないインターフェイス グループ ポートに作成されていない。


.タスク概要
VLANを作成すると、クラスタの指定したノードのネットワーク ポートにそのVLANが接続されます。

VLANを初めてポートに設定したときに、ポートが停止してネットワーク接続が一時的に切断されることがあります。その後同じポートにVLANを追加するときは、この問題は発生しません。


NOTE: スイッチのネイティブVLANと同じ識別子のVLANをネットワーク インターフェイス上に作成しないでください。たとえば、ネットワーク インターフェイスe0bがネイティブVLAN 10に割り当てられている場合、そのインターフェイス上にVLAN e0b-10を作成しないでください。

実行する手順は、System ManagerとCLIのどちらのインターフェイスを使用するかによって異なります。

[role="tabbed-block"]
====
.System Manager
--
*System Managerを使用してVLANを作成する*

ONTAP 9.12.0以降では、ブロードキャスト ドメインを自動で選択することも、リストから手動で選択することもできます。以前は、ブロードキャスト ドメインはレイヤ2の接続に基づいて常に自動で選択されていました。ブロードキャスト ドメインを手動で選択すると、接続が失われる可能性があるという警告が表示されます。

.手順
. *ネットワーク > イーサネット ポート > + VLAN* を選択します。
. ドロップダウン リストからノードを選択します。
. 次のいずれかを選択します。
+
.. ONTAPで *ブロードキャスト ドメインを自動的に選択（推奨）* します。
.. リストからブロードキャスト ドメインを手動で選択する。


. VLANを構成するポートを選択します。
. VLAN IDを指定します。
. 変更を保存します。


--
.CLI
--
*CLI を使用して VLAN を作成する*

特定の状況では、ハードウェアの問題やソフトウェアの誤った構成を修正せずに、劣化したポートに VLAN ポートを作成する場合は、 `network port modify`コマンドの `-ignore-health-status`パラメータを `true`として設定できます。

 `network port modify`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-port-modify.html["ONTAPコマンド リファレンス"^]をご覧ください。

.手順
.  `network port vlan create`コマンドを使用してVLANを作成します。
. VLANを作成する際は、 `vlan-name`または `port`と `vlan-id`のいずれかのオプションを指定する必要があります。VLAN名は、ポート（またはインターフェース グループ）名とネットワーク スイッチVLAN識別子をハイフンで区切って組み合わせたものです。例えば、 `e0c-24`と `e1c-80`は有効なVLAN名です。


次の例は、ノード `cluster-1-01`上のネットワーク ポート `e1c`に接続された VLAN `e1c-80`を作成する方法を示しています：

....
network port vlan create -node cluster-1-01 -vlan-name e1c-80
....
ONTAP 9.8以降、VLANは作成後約1分で適切なブロードキャストドメインに自動的に配置されます。ONTAPによる自動配置を希望せず、VLANを手動でブロードキャストドメインに配置する場合は、 `vlan create`コマンドの一部として `-skip-broadcast-domain-placement`パラメータを指定します。

 `network port vlan create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-port-vlan-create.html["ONTAPコマンド リファレンス"^]をご覧ください。

--
====


== VLANの編集

ブロードキャスト ドメインを変更したり、VLANを無効にしたりできます。

.System Managerを使用したVLANの編集
ONTAP 9.12.0以降では、ブロードキャスト ドメインを自動で選択することも、リストから手動で選択することもできます。以前は、ブロードキャスト ドメインはレイヤ2の接続に基づいて常に自動で選択されていました。ブロードキャスト ドメインを手動で選択すると、接続が失われる可能性があるという警告が表示されます。

.手順
. *ネットワーク > イーサネット ポート > VLAN* を選択します。
. 編集アイコンを選択します。
. 次のいずれかを実行します。
+
** 別のブロードキャスト ドメインをリストから選択して変更する。
** *有効*チェック ボックスをオフにします。


. 変更を保存します。




== VLANの削除

NICをスロットから取り外す前に、VLANの削除が必要になることがあります。VLANを削除すると、そのVLANを使用しているすべてのフェイルオーバー ルールとフェイルオーバー グループから自動的に削除されます。

.開始する前に
VLANに関連付けられているLIFがないことを確認します。

.タスク概要
ポートの最後のVLANを削除すると、そのポートとネットワークの接続が一時的に切断される可能性があります。

実行する手順は、System ManagerとCLIのどちらのインターフェイスを使用するかによって異なります。

[role="tabbed-block"]
====
.System Manager
--
*System Managerを使用してVLANを削除する*

.手順
. *ネットワーク > イーサネット ポート > VLAN* を選択します。
. 削除するVLANを選択します。
. *削除*をクリックします。


--
.CLI
--
*CLI を使用して VLAN を削除する*

.手順
 `network port vlan delete`コマンドを使用してVLANを削除します。

次の例は、ノード `cluster-1-01`のネットワーク ポート `e1c`から VLAN `e1c-80`を削除する方法を示しています：

....
network port vlan delete -node cluster-1-01 -vlan-name e1c-80
....
 `network port vlan delete`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-port-vlan-delete.html["ONTAPコマンド リファレンス"^]をご覧ください。

--
====