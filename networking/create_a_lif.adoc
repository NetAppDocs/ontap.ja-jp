---
sidebar: sidebar 
permalink: networking/create_a_lif.html 
keywords: example LIFs, add LIFs, configure LIFs, create, creation, creating, add, adding, logical, interface, service, policies, policy, create a lif, network interface capacity show, lif examples 
summary: 物理ポートまたは論理ポートに関連付けられた IP アドレスである LIF を作成します。 
---
= ONTAP LIFを作成する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
SVMは、1つ以上のネットワーク論理インターフェイス（LIF）を通じてクライアントにデータを提供します。データへのアクセスに使用するポートにLIFを作成する必要があります。LIF（ネットワーク インターフェイス）は、物理ポートまたは論理ポートに関連付けられたIPアドレスです。コンポーネントに障害が発生しても、LIFは別の物理ポートにフェイルオーバーまたは移行できるので、引き続きネットワークと通信できます。

.ベストプラクティス
ONTAPに接続されたスイッチ ポートは、LIFの移行時の遅延を軽減するために、スパニングツリー エッジ ポートとして設定する必要があります。

.開始する前に
* このタスクを実行するには、クラスタ管理者である必要があります。
* 基盤となる物理または論理ネットワーク ポートの管理ステータスがupに設定されている必要があります。
* サブネット名を使用してLIFのIPアドレスとネットワーク マスク値を割り当てる場合は、そのサブネットが存在している必要があります。
+
サブネットには、同じレイヤ 3 サブネットに属する IP アドレスのプールが含まれます。System Manager または `network subnet create`コマンドを使用して作成されます。

+
 `network subnet create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-subnet-create.html["ONTAPコマンド リファレンス"^]を参照してください。

* LIFが処理するトラフィックのタイプを指定するメカニズムが変更されました。ONTAP 9.5以前ではロールで指定していました。ONTAP 9.6以降ではサービス ポリシーで指定します。


.タスク概要
* 同じLIFにNASプロトコルやSANプロトコルを割り当てることはできません。
+
サポートされるプロトコルは、SMB、NFS、FlexCache、iSCSI、およびFCです。iSCSIとFCを他のプロトコルと組み合わせることはできません。ただし、NASプロトコルとイーサネットベースのSANプロトコルは、同じ物理ポートで使用できます。

+
** SMBトラフィックを伝送するLIFを、ホーム ノードに自動的にリバートするように設定しないでください。Hyper-V over SMBまたはSQL Server over SMBでノンストップ オペレーションを実現するソリューションをSMBサーバでホストする場合、これは必須です。


* 同じネットワーク ポート上にIPv4とIPv6の両方のLIFを作成できます。
* SVMで使用するすべてのネーム マッピング サービスとホスト名解決サービス（DNS、NIS、LDAP、Active Directoryなど）が、SVMのデータ トラフィックを処理する少なくとも1つのLIFから到達可能でなければなりません。
* クラスタ内のノード間トラフィックを処理するLIFは、管理トラフィックを処理するLIFまたはデータ トラフィックを処理するLIFと同じサブネット上には存在できません。
* 有効なフェイルオーバー ターゲットのないLIFを作成すると、警告メッセージが表示されます。
* クラスタ内のLIFの数が多い場合、クラスタでサポートされるLIFの最大数を確認できます。
+
** System Manager：ONTAP 9.12.0以降では、ネットワーク インターフェイス グリッドでスループットを表示します。
** CLI： `network interface capacity show`コマンドと `network interface capacity details show`コマンド（advanced権限レベル）を使用して、各ノードでサポートされているLIF容量を確認します。
+
 `network interface capacity show`および `network interface capacity details show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=network+interface+capacity+show["ONTAPコマンド リファレンス"^]をご覧ください。



* ONTAP 9.7以降では、同じサブネットにSVM用の他のLIFがすでに存在していれば、LIFのホーム ポートを指定する必要はありません。同じサブネットにすでに設定されている他のLIFと同じブロードキャスト ドメインにあるホーム ノードから任意のポートが自動的に選択されます。
+
ONTAP 9.4以降では、FC-NVMeがサポートされます。FC-NVMe LIFを作成する場合は、次の点に注意してください。

+
** LIFを作成するFCアダプタでNVMeプロトコルがサポートされている必要があります。
** データLIFで使用できるデータ プロトコルはFC-NVMeのみです。


* SANをサポートするStorage Virtual Machine（SVM）ごとに、管理トラフィックを処理するLIFを1つ設定する必要があります。
* NVMeのLIFとネームスペースは、同じノードでホストする必要があります。
* ノードごとに、SVM ごとに、データ トラフィックを処理する NVMe LIF を最大 2 つ設定できます。
* サブネットを使用してネットワーク インターフェイスを作成すると、使用可能なIPアドレスが選択したサブネットから自動的に選択され、ネットワーク インターフェイスに割り当てられます。複数のサブネットがある場合にサブネットを変更することはできますが、IPアドレスは変更できません。
* ネットワーク インターフェイス用のSVMを作成（追加）するときに、既存のサブネット範囲に含まれるIPアドレスを指定することはできません。サブネットの競合エラーが表示されます。この問題は、SVM設定やクラスタ設定でクラスタ間ネットワーク インターフェイスを作成または変更する場合など、ネットワーク インターフェイスの他のワークフローでも発生します。
* ONTAP 9.10.1以降、 `network interface` CLIコマンドには、NFS over RDMA構成用の `-rdma-protocols`パラメータが含まれています。NFS over RDMA構成用のネットワークインターフェイスの作成は、ONTAP 9.12.1以降のSystem Managerでサポートされています。詳細については、xref:../nfs-rdma/configure-lifs-task.html[RDMA経由のNFS用にLIFを設定する]を参照してください。
* ONTAP 9.11.1以降では、オールフラッシュSANアレイ（ASA）プラットフォームで自動iSCSI LIFフェイルオーバーを使用できます。
+
指定されたSVMにiSCSI LIFが存在しない場合、または指定されたSVM内の既存のすべてのiSCSI LIFでiSCSI LIFフェイルオーバーがすでに有効になっている場合は、新しく作成されたiSCSI LIFでiSCSI LIFフェイルオーバーが自動的に有効になります（フェイルオーバー ポリシーが `sfo-partner-only`に設定され、自動復帰値が `true`に設定されます）。

+
ONTAP 9.11.1 以降にアップグレードした後、iSCSI LIF フェイルオーバー機能が有効になっていない既存の iSCSI LIF が SVM 内に存在し、同じ SVM 内に新しい iSCSI LIF を作成した場合、新しい iSCSI LIF は SVM 内の既存の iSCSI LIF と同じフェイルオーバー ポリシー(`disabled`を適用します。

+
link:../san-admin/asa-iscsi-lif-fo-task.html["ASAプラットフォームのiSCSI LIFフェイルオーバー"]



ONTAP 9.7以降では、LIFのホーム ポートは、そのIPspaceの同じサブネットに既存のLIFが1つでも存在していれば自動的に選択されます。ホーム ポートは、そのサブネットの他のLIFと同じブロードキャスト ドメインから選択されます。手動で指定することも引き続き可能です（指定したIPspaceの該当するサブネットにLIFがない場合）。

ONTAP 9.12.0以降では、実行する手順は、System ManagerとCLIのどちらのインターフェイスを使用するかによって異なります。

[role="tabbed-block"]
====
.System Manager
--
*System Managerを使用してネットワークインターフェイスを追加します*

.手順
. *ネットワーク > 概要 > ネットワーク インターフェイス*を選択します。
. image:icon_add.gif["アイコンを追加"]を選択します。
. 次のいずれかのインターフェイス ロールを選択します。
+
.. データ
.. クラスタ間
.. SVM管理


. プロトコルを選択します。
+
.. SMB/CIFS and NFS
.. iSCSI
.. FC
.. NVMe/FC
.. NVMe/TCP


. LIFの名前を指定するか、ここまでの選択内容から生成された名前をそのまま使用します。
. ホーム ノードをそのまま使用するか、ドロップダウンを使用して選択します。
. 選択したSVMのIPspaceでサブネットが1つでも設定されている場合、サブネットのドロップダウンが表示されます。
+
.. サブネットを選択する場合はドロップダウンから選択します。
.. サブネットを選択せずに次に進むと、ブロードキャスト ドメインのドロップダウンが表示されます。
+
... IPアドレスを指定します。IPアドレスが使用中の場合は、警告メッセージが表示されます。
... サブネット マスクを指定します。




. ホーム ポートをブロードキャスト ドメインから自動で選択するか（推奨）、ドロップダウン メニューから選択します。ホーム ポートのオプションは、ブロードキャスト ドメインとサブネットの選択に基づいて表示されます。
. ネットワーク インターフェイスを保存します。


--
.CLI
--
*CLIを使用してLIFを作成する*

.手順
. LIFに使用するIPspaceブロードキャスト ドメインのポートを判断します。
+
`network port broadcast-domain show -ipspace _ipspace1_`

+
....
IPspace     Broadcast                       Update
Name        Domain name   MTU   Port List   Status Details
ipspace1
            default       1500
                                node1:e0d   complete
                                node1:e0e   complete
                                node2:e0d   complete
                                node2:e0e   complete
....
+
 `network port broadcast-domain show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-port-broadcast-domain-show.html["ONTAPコマンド リファレンス"^]を参照してください。

. LIFに使用するサブネットに未使用のIPアドレスが十分にあることを確認します。
+
`network subnet show -ipspace _ipspace1_`

+
 `network subnet show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-subnet-show.html["ONTAPコマンド リファレンス"^]を参照してください。

. データへのアクセスに使用するポートに1つ以上のLIFを作成します。
+

CAUTION: NetAppでは、データSVM上のすべてのLIFに対してサブネットオブジェクトを作成することを推奨しています。これはMetroCluster構成では特に重要です。各サブネットオブジェクトにはブロードキャストドメインが関連付けられているため、サブネットオブジェクトによってONTAPがデスティネーション クラスタ上のフェイルオーバーターゲットを決定できるようになります。手順については、link:../networking/create_a_subnet.html["サブネットの作成"]を参照してください。

+
....
network interface create -vserver _SVM_name_ -lif _lif_name_ -service-policy _service_policy_name_ -home-node _node_name_ -home-port port_name {-address _IP_address_ - netmask _Netmask_value_ | -subnet-name _subnet_name_} -firewall- policy _policy_ -auto-revert {true|false}
....
+
** `-home-node`は、 `network interface revert`コマンドがLIF上で実行されたときにLIFが戻るノードです。
+
-auto-revertオプションを使用して、LIFをホーム ノードおよびホーム ポートに自動的にリバートするかどうかを指定することもできます。

+
 `network interface revert`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-revert.html["ONTAPコマンド リファレンス"^]を参照してください。

** `-home-port`は、LIF上で `network interface revert`コマンドが実行されたときにLIFが戻る物理ポートまたは論理ポートです。
**  `-address`および `-netmask`オプションを使用してIPアドレスを指定することも、 `-subnet_name`オプションを使用してサブネットからの割り当てを有効にすることもできます。
** サブネットを使用してIPアドレスとネットワーク マスクを指定した場合、サブネットにゲートウェイが定義されていると、そのサブネットを使用してLIFを作成するときにゲートウェイへのデフォルト ルートがSVMに自動的に追加されます。
** IPアドレスを手動で割り当てる場合（サブネットを使用せず）、クライアントまたはドメインコントローラが異なるIPサブネット上にある場合は、ゲートウェイへのデフォルトルートを設定する必要がある場合があります。link:https://docs.netapp.com/us-en/ontap-cli/network-route-create.html["ONTAPコマンド リファレンス"^]の `network route create`の詳細をご覧ください。
** `-auto-revert`起動時、管理データベースのステータス変更時、ネットワーク接続時などの状況において、データLIFをホームノードに自動的に戻すかどうかを指定できます。デフォルト設定は `false`ですが、環境のネットワーク管理ポリシーに応じて `true`に設定することもできます。
**  `-service-policy`ONTAP 9.5以降では、 `-service-policy`オプションを使用してLIFにサービスポリシーを割り当てることができます。LIFにサービスポリシーを指定すると、そのポリシーに基づいて、LIFのデフォルトロール、フェイルオーバーポリシー、およびデータプロトコルリストが作成されます。ONTAP 9.5では、サービスポリシーはクラスタ間サービスとBGPピアサービスでのみサポートされています。ONTAP 9.6では、複数のデータサービスと管理サービスに対してサービスポリシーを作成できます。
** `-data-protocol`FCPまたはNVMe/FCプロトコルをサポートするLIFを作成できます。IP LIFを作成する場合、このオプションは必要ありません。


. *オプション*：-address オプションで IPv6 アドレスを割り当てます。
+
..  `network ndp prefix show`コマンドを使用して、さまざまなインターフェースで学習された RA プレフィックスのリストを表示します。
+
 `network ndp prefix show`コマンドは、上級権限レベルで使用できます。

+
 `network ndp prefix show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-ndp-prefix-show.html["ONTAPコマンド リファレンス"^]を参照してください。

..  `prefix::id`の形式を使用して、IPv6アドレスを手動で構築します。
+
`prefix`は、さまざまなインターフェースで学習されたプレフィックスです。

+
 `id`を導出するには、ランダムな64ビットの16進数を選択します。



. LIFインターフェイスの設定が正しいことを確認します。
+
`network interface show -vserver vs1`

+
....
          Logical    Status     Network         Current   Current Is
Vserver   Interface  Admin/Oper Address/Mask    Node      Port    Home
--------- ---------- ---------- --------------- --------- ------- ----
vs1
           lif1       up/up      10.0.0.128/24   node1     e0d     true
....
+
 `network interface show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-show.html["ONTAPコマンド リファレンス"^]を参照してください。

. フェイルオーバー グループの設定が適切であることを確認します。
+
`network interface show -failover -vserver _vs1_`

+
....
         Logical    Home       Failover        Failover
Vserver  interface  Node:Port  Policy          Group
-------- ---------- ---------  ---------       --------
vs1
         lif1       node1:e0d  system-defined  ipspace1
Failover Targets: node1:e0d, node1:e0e, node2:e0d, node2:e0e
....
. 設定したIPアドレスに到達できることを確認します。


|===


| 対象 | 方法 


| IPv4 アドレス | network ping 


| IPv6アドレス | network ping6 
|===
.例
次のコマンドは、LIF を作成し、 `-address`および `-netmask`パラメータを使用して IP アドレスとネットワーク マスクの値を指定します：

....
network interface create -vserver vs1.example.com -lif datalif1 -service-policy default-data-files -home-node node-4 -home-port e1c -address 192.0.2.145 -netmask 255.255.255.0 -auto-revert true
....
次のコマンドは、LIFを作成し、IPアドレスとネットワーク マスク値を指定したサブネット（client1_sub）から割り当てています。

....
network interface create -vserver vs3.example.com -lif datalif3 -service-policy default-data-files -home-node node-3 -home-port e1c -subnet-name client1_sub - auto-revert true
....
次のコマンドは、NVMe/FC LIFを作成し、 `nvme-fc`データ プロトコルを指定します：

....
network interface create -vserver vs1.example.com -lif datalif1 -data-protocol nvme-fc -home-node node-4 -home-port 1c -address 192.0.2.145 -netmask 255.255.255.0 -auto-revert true
....
--
====