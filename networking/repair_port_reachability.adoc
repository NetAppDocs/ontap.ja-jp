---
sidebar: sidebar 
permalink: networking/repair_port_reachability.html 
keywords: port, reachability, repair, fix, error, switch, configuration, cable, cabling, wiring, wire, wired, re-cabled, layer 2, repair port reachability, network port reachability show -detail -node -port, repair reachability decision tree, unexpected ports, unreachable ports, lifs and repaired ports, vlans and repaired ports, interface groups and repaired ports 
summary: ポートのケーブルが再接続されたり、スイッチの構成が変更されたりした場合は、ポートを別の新しいまたは既存のブロードキャストドメインに修復する必要がある可能性があります 
---
= ONTAPポートの到達可能性を修復する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ブロードキャスト ドメインは自動的に作成されます。ただし、ポートのケーブル接続やスイッチの設定に変更があった場合は、ポートを別のブロードキャスト ドメイン（新規または既存）に修復しなければならないことがあります。

ONTAPは、ブロードキャスト ドメイン コンスティチュエントの（イーサネット ポートの）レイヤ2の到達可能性に基づいて、ネットワーク配線の問題を自動的に検出し、ソリューションを推奨します。

配線が正しくないと、ブロードキャスト ドメインのポートが想定どおりに割り当てられない可能性があります。ONTAP 9.10.1以降では、クラスタのセットアップ後や既存クラスタへの新しいノードの追加時にポートの到達可能性を確認することで、ネットワーク配線に問題がないかどうかが自動的に確認されます。

[role="tabbed-block"]
====
.System Manager
--
ポートの到達可能性に問題が検出された場合、System Managerに問題を解決するための修復処理が提示されます。

クラスタのセットアップ後は、ダッシュボードにネットワーク配線の問題が報告されます。

既存クラスタへの新しいノードの追加後は、[Nodes]ページにネットワーク配線の問題が表示されます。

ネットワーク図でネットワーク配線の状態を確認することもできます。ポートの到達可能性の問題があると、ネットワーク図に赤いエラー アイコンが表示されます。

.クラスタのセットアップ後
クラスタのセットアップ後にネットワーク配線の問題が検出されると、ダッシュボードにメッセージが表示されます。

image:auto-detect-01.png["クラスタ セットアップ後のメッセージ"]

.手順
. メッセージの指示に従って配線を修正します。
. リンクをクリックすると、「ブロードキャストドメインの更新」ダイアログが起動します。「ブロードキャストドメインの更新」ダイアログが開きます。image:auto-detect-02.png["[Update Broadcast Domains]ダイアログ"]
. ノード、問題の内容、現在のブロードキャスト ドメイン、正しいブロードキャスト ドメインなど、ポートに関する情報を確認します。
. 修復するポートを選択し、*Fix*をクリックします。システムはポートを現在のブロードキャストドメインから期待されるブロードキャストドメインに移動します。


.ノードの追加後
クラスタに新しいノードを追加したあとにネットワーク配線の問題が検出されると、[Nodes]ページにメッセージが表示されます。

image:auto-detect-03.png["ノード追加後のメッセージ"]

.手順
. メッセージの指示に従って配線を修正します。
. リンクをクリックすると、「ブロードキャストドメインの更新」ダイアログが起動します。「ブロードキャストドメインの更新」ダイアログが開きます。image:auto-detect-02.png["[Update Broadcast Domains]ダイアログ"]
. ノード、問題の内容、現在のブロードキャスト ドメイン、正しいブロードキャスト ドメインなど、ポートに関する情報を確認します。
. 修復するポートを選択し、*Fix* をクリックします。システムはポートを現在のブロードキャストドメインから期待されるブロードキャストドメインに移動します。


--
.CLI
--
.開始する前に
このタスクを実行するには、クラスタ管理者である必要があります。

.タスク概要
検出されたレイヤ2の到達可能性に基づいてポートのブロードキャスト ドメイン設定を自動的に修復するコマンドが用意されています。

.手順
. スイッチの設定とケーブル接続を確認します。
. ポートの到達可能性を確認します。
+
`network port reachability show -detail -node -port`

+
コマンドの出力に到達可能性の結果が表示されます。

+
 `network port reachability show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-port-reachability-show.html["ONTAPコマンド リファレンス"^]を参照してください。

. 次のデシジョン ツリーと表を参照して、到達可能性の結果を理解し、次に実行する手順を確認します。
+
image:ontap_nm_image1.png["到達可能性を修復するためのデシジョン ツリー"]



[cols="20,80"]
|===


| 到達可能性ステータス | 概要 


 a| 
ok
 a| 
ポートは割り当てられたブロードキャストドメインへのレイヤー2到達性を備えています。到達性ステータスが「ok」であっても「予期しないポート」がある場合は、1つ以上のブロードキャストドメインを統合することを検討してください。詳細については、次の_予期しないポート_の行を参照してください。

到達可能性ステータスが「ok」であるにもかかわらず、「到達不能ポート」が存在する場合は、1つ以上のブロードキャストドメインを分割することを検討してください。詳細については、次の_到達不能ポート_の行を参照してください。

到達可能性ステータスが「ok」で、かつ想定外のポートも到達不能なポートも存在しない場合、設定に問題はありません。



 a| 
予期しないポート
 a| 
ポートは割り当てられたブロードキャスト ドメインに対してレイヤ2到達可能性を持ちますが、少なくとも1つの他のブロードキャスト ドメインに対してもレイヤ2到達可能性を持ちます。

物理的な接続とスイッチの設定に間違いがないか、またはポートに割り当てられているブロードキャスト ドメインを1つ以上のブロードキャスト ドメインとマージする必要がないかを確認します。

詳細については、link:merge_broadcast_domains.html["ブロードキャスト ドメインのマージ"]を参照してください。



 a| 
到達不能なポート
 a| 
単一のブロードキャストドメインが2つの異なる到達可能性セットに分割されている場合は、ブロードキャストドメインを分割してONTAP構成を物理ネットワークトポロジと同期できます。

通常、到達不能なポートは、物理的な構成とスイッチの設定に間違いがないことを確認したうえで、別のブロードキャスト ドメインにスプリットする必要があります。

詳細については、link:split_broadcast_domains.html["ブロードキャスト ドメインのスプリット"]を参照してください。



 a| 
到達可能性の設定ミス
 a| 
ポートは割り当てられたブロードキャスト ドメインに対してレイヤ2到達可能性を持ちませんが、別のブロードキャスト ドメインに対してはレイヤ2到達可能性を持ちます。

ポートの到達可能性を修復します。次のコマンドを実行すると、到達可能性があるブロードキャスト ドメインにポートが割り当てられます。

`network port reachability repair -node -port`



 a| 
到達不能
 a| 
ポートには、既存のブロードキャストドメインへのレイヤー2到達可能性がありません。

ポートの到達可能性を修復します。次のコマンドを実行すると、デフォルトIPspaceに新しいブロードキャスト ドメインが自動的に作成され、ポートが割り当てられます。

`network port reachability repair -node -port`

*注：* すべてのインターフェースグループ（ifgrp）メンバーポートが `no-reachability`と報告されている場合、各メンバーポートで `network port reachability repair`コマンドを実行すると、各メンバーポートがifgrpから削除され、新しいブロードキャストドメインに配置され、最終的にはifgrp自体が削除されます。 `network port reachability repair`コマンドを実行する前に、ポートの到達可能なブロードキャストドメインが、物理ネットワークトポロジに基づいて想定されるものであることを確認してください。

 `network port reachability repair`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-port-reachability-repair.html["ONTAPコマンド リファレンス"^]をご覧ください。



 a| 
マルチドメイン到達可能性
 a| 
ポートは割り当てられたブロードキャスト ドメインに対してレイヤ2到達可能性を持ちますが、少なくとも1つの他のブロードキャスト ドメインに対してもレイヤ2到達可能性を持ちます。

物理的な接続とスイッチの設定に間違いがないか、またはポートに割り当てられているブロードキャスト ドメインを1つ以上のブロードキャスト ドメインとマージする必要がないかを確認します。

詳細については、link:merge_broadcast_domains.html["ブロードキャスト ドメインのマージ"]を参照してください。



 a| 
不明
 a| 
到達可能性ステータスが「不明」の場合は、数分待ってからコマンドを再試行してください。

|===
ポートを修復したあとに、孤立状態のLIFとVLANがないかを確認します。ポートがインターフェイス グループに属していた場合は、そのインターフェイス グループがどうなったかを把握する必要もあります。

.LIF
ポートが修復されて別のブロードキャスト ドメインに移されると、そのポートに設定されていたLIFには新しいホーム ポートが自動的に割り当てられます。このホーム ポートは、同じノード上の同じブロードキャスト ドメインから選択されます（可能な場合）。または別のノードからホーム ポートが選択されることもあります。適切なホーム ポートがない場合、ホーム ポートはクリアされます。

LIFのホーム ポートが別のノードに移された場合、またはクリアされた場合、そのLIFは「孤立状態」とみなされます。孤立状態のLIFは次のコマンドで確認できます。

`displaced-interface show`

孤立状態のLIFがある場合は、次のいずれかを行う必要があります。

* 孤立状態のLIFのホームをリストアする。
+
`displaced-interface restore`

* LIFのホームを手動で設定する。
+
`network interface modify -home-port -home-node`

+
 `network interface modify`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-modify.html["ONTAPコマンド リファレンス"^]を参照してください。

* 現在設定されているLIFのホームに問題がなければ、「displaced-interface」テーブルからエントリを削除する。
+
`displaced-interface delete`



.VLAN
修復されたポートにVLANがあった場合、それらのVLANは自動的に削除されますが、同時に「孤立状態（displaced）」として記録されます。孤立状態のVLANは次のコマンドで確認できます。

`displaced-vlans show`

孤立状態のVLANがある場合は、次のいずれかを行う必要があります。

* VLANを別のポートにリストアする。
+
`displaced-vlans restore`

* 「displaced-vlans」テーブルからエントリを削除する。
+
`displaced-vlans delete`



.インターフェイス グループ
修復されたポートがインターフェイス グループに属していた場合は、そのインターフェイス グループから削除されます。このポートがインターフェイス グループに割り当てられていた唯一のメンバー ポートであった場合は、インターフェイス グループ自体が削除されます。

--
====
.関連情報
* link:verify_your_network_configuration.html["Verify your network configuration after upgrading"]
* link:monitor_the_reachability_of_network_ports.html["ネットワーク ポートの到達可能性の監視"]
* link:https://docs.netapp.com/us-en/ontap-cli/["ONTAPコマンド リファレンス"^]

