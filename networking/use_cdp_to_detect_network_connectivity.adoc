---
sidebar: sidebar 
permalink: networking/use_cdp_to_detect_network_connectivity.html 
keywords: display, view, show, network, connectivity, neighbor, discovery, protocol, cdp, use cdp to detect network connectivity, considerations for using cdp, enable or disable cdp, view cdp neighbor information, example of showing and clearing statistics, cisco 
summary: データセンターでは、ネイバー探索プロトコルを使用して、物理システムまたは仮想システムのペアとそのネットワークインターフェース間のネットワーク接続を表示できます。ONTAPは、Cisco Discovery Protocol（CDP）とLink Layer Discovery Protocol（LLDP）という2つのネイバー探索プロトコルをサポートしています。 
---
= CDPを使用してONTAPネットワーク接続を検出する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
CDPを使用したネットワーク接続の検出は、導入に関する考慮事項の確認、データ ポートでのCDPの有効化、近隣デバイスの表示、CDPの設定値の調整（必要な場合）で構成されます。クラスタ ポートでは、CDPはデフォルトで有効になります。

近隣デバイスに関する情報を表示するには、スイッチとルーターでもCDPを有効にする必要があります。

[cols="30,70"]
|===


| ONTAPリリース | 概要 


 a| 
9.10.1以前
 a| 
CDPは、クラスタ ネットワーク スイッチと管理ネットワーク スイッチを自動検出するためにクラスタ スイッチ ヘルスモニタでも使用されます。



 a| 
9.11.1以降
 a| 
CDP は、クラスタスイッチヘルスモニタによって、クラスタ、ストレージ、および管理ネットワークスイッチを自動的に検出するためにも使用されます。

|===
.関連情報
link:../system-admin/index.html["システム管理"^]



== CDPを使用する場合の考慮事項

デフォルトでは、CDP対応デバイスはCDPv2通知を送信します。CDP対応デバイスは、CDPv1通知を受信した場合にのみ、CDPv1通知を送信します。ONTAPはCDPv1のみをサポートします。したがって、ONTAPノードがCDPv1通知を送信すると、CDP対応の近隣デバイスがCDPv1通知を返します。

ノードでCDPを有効にする前に、次のことを考慮してください。

* CDPはすべてのポートでサポートされます。
* CDP通知は、up状態のポートから送受信されます。
* CDP通知を送信および受信するために、送信デバイスおよび受信デバイスの両方でCDPを有効にする必要があります。
* CDP通知は一定間隔で送信され、送信間隔は設定可能です。
* LIFのIPアドレスが変更されると、ノードは更新された情報を次のCDP通知で送信します。
* ONTAP 9.10.1以前：
+
** CDPはクラスタ ポートで常に有効になります。
** 非クラスタ ポートでは、CDPはデフォルトで無効になります。


* ONTAP 9.11.1以降：
+
** CDPはクラスタ ポートとストレージ ポートで常に有効になります。
** 非クラスタ ポートと非ストレージ ポートでは、CDPはデフォルトで無効になります。





NOTE: ノードでLIFが変更された場合、スイッチなどの受信デバイス側でCDP情報が更新されないことがあります。このような問題が発生した場合は、ノードのネットワーク インターフェイスをいったんdown状態にしてから、up状態に設定してください。

* CDP通知で送信されるのはIPv4アドレスのみです。
* VLANが設定されている物理ネットワーク ポートの場合、VLANに設定されているすべてのLIFが通知されます。
* インターフェイス グループの一部となっている物理ポートの場合、そのインターフェイス グループに設定されているすべてのIPアドレスが、各物理ポートで通知されます。
* VLANをホストするインターフェイス グループの場合、インターフェイス グループおよびVLANに設定されているすべてのLIFが各ネットワーク ポートで通知されます。
* CDP パケットは 1500 バイト以下に制限されているため、多数の LIF が設定されているポートでは、隣接スイッチでこれらの IP アドレスのサブセットのみが報告される場合があります。




== CDPの有効化または無効化

CDP対応の近隣デバイスを検出して通知を送信するには、クラスタの各ノードでCDPが有効になっている必要があります。

ONTAP 9.10.1以前では、CDPはデフォルトでノードのすべてのクラスタ ポートで有効に、非クラスタ ポートで無効になります。

ONTAP 9.11.1以降では、CDPはデフォルトでノードのすべてのクラスタ ポートとストレージ ポートで有効に、非クラスタ ポートと非ストレージ ポートで無効になります。

.タスク概要
 `cdpd.enable`オプションは、ノードのポート上で CDP を有効にするか無効にするかを制御します：

* ONTAP 9.10.1以前では、onにすると、非クラスタ ポートでCDPが有効になります。
* ONTAP 9.11.1以降では、onにすると、非クラスタ ポートと非ストレージ ポートでCDPが有効になります。
* ONTAP 9.10.1以前では、offにすると、非クラスタ ポートでCDPが無効になります。クラスタ ポートのCDPを無効にすることはできません。
* ONTAP 9.11.1以降では、offにすると、非クラスタ ポートと非ストレージ ポートでCDPが無効になります。クラスタ ポートのCDPを無効にすることはできません。


CDP対応デバイスに接続されているポートでCDPを無効にすると、ネットワーク トラフィックが最適化されない可能性があります。

.手順
. クラスタ内の1つまたはすべてのノードの、現在のCDP設定を表示します。
+
[cols="30,70"]
|===


| ...の CDP 設定を表示するには | 入力する内容 


 a| 
1つのノード
 a| 
`run - node <node_name> options cdpd.enable`



 a| 
クラスタ内のすべてのノード
 a| 
`options cdpd.enable`

|===
. クラスタ内の1つまたはすべてのノードで、すべてのポートのCDPを有効または無効に設定します。
+
[cols="30,70"]
|===


| CDPを有効または無効にする対象 | 入力する内容 


 a| 
1つのノード
 a| 
`run -node node_name options cdpd.enable {on or off}`



 a| 
クラスタ内のすべてのノード
 a| 
`options cdpd.enable {on or off}`

|===




== CDP近隣情報の表示

クラスタノードの各ポートに接続されている隣接デバイスの情報を表示できます（ただし、ポートがCDP準拠デバイスに接続されている必要があります）。 `network device-discovery show -protocol cdp`コマンドを使用して隣接デバイス情報を表示できます。link:https://docs.netapp.com/us-en/ontap-cli/network-device-discovery-show.html["ONTAPコマンド リファレンス"^]の `network device-discovery show`の詳細をご覧ください。

.タスク概要
ONTAP 9.10.1以前の場合、クラスタ ポートではCDPが常に有効になっているため、これらのポートのCDP近隣情報は常に表示されます。非クラスタ ポートの近隣情報を表示するには、これらのポートでCDPを有効にする必要があります。

ONTAP 9.11.1以降の場合、クラスタ ポートとストレージ ポートではCDPが常に有効になっているので、これらのポートのCDP近隣情報は常に表示されます。非クラスタ ポートと非ストレージ ポートの近隣情報を表示するには、これらのポートでCDPを有効にする必要があります。

.手順
クラスタ内のノードのポートに接続されているすべてのCDP対応デバイスの情報を表示します。

....
network device-discovery show -node node -protocol cdp
....
次のコマンドは、ノードsti2650-212のポートに接続されている近隣デバイスの情報を表示します。

....
network device-discovery show -node sti2650-212 -protocol cdp
Node/       Local  Discovered
Protocol    Port   Device (LLDP: ChassisID)  Interface         Platform
----------- ------ ------------------------- ----------------  ----------------
sti2650-212/cdp
            e0M    RTP-LF810-510K37.gdl.eng.netapp.com(SAL1942R8JS)
                                             Ethernet1/14      N9K-C93120TX
            e0a    CS:RTP-CS01-510K35        0/8               CN1610
            e0b    CS:RTP-CS01-510K36        0/8               CN1610
            e0c    RTP-LF350-510K34.gdl.eng.netapp.com(FDO21521S76)
                                             Ethernet1/21      N9K-C93180YC-FX
            e0d    RTP-LF349-510K33.gdl.eng.netapp.com(FDO21521S4T)
                                             Ethernet1/22      N9K-C93180YC-FX
            e0e    RTP-LF349-510K33.gdl.eng.netapp.com(FDO21521S4T)
                                             Ethernet1/23      N9K-C93180YC-FX
            e0f    RTP-LF349-510K33.gdl.eng.netapp.com(FDO21521S4T)
                                             Ethernet1/24      N9K-C93180YC-FX
....
このコマンドの出力には、指定したノードの各ポートに接続されているCiscoデバイスが一覧表示されます。



== CDPメッセージの保持時間の設定

保持時間は、CDP通知がCDP対応の近隣デバイスのキャッシュに格納される時間です。保持時間は各CDPv1パケットで通知され、ノードがCDPv1パケットを受信するたびに更新されます。

*  `cdpd.holdtime`オプションの値は、HAペアの両方のノードで同じ値に設定する必要があります。
* デフォルトの保持時間は180ですが、10～255秒の値を入力できます。
* 保持時間が切れる前にIPアドレスが削除された場合、CDP情報は保持時間が切れるまでキャッシュされます。


.手順
. クラスタ内の1つまたはすべてのノードのCDPメッセージの現在の保持時間を表示します。
+
[cols="30,70"]
|===


| 保持時間を表示する対象 | 入力する内容 


 a| 
1つのノード
 a| 
`run -node node_name options cdpd.holdtime`



 a| 
クラスタ内のすべてのノード
 a| 
`options cdpd.holdtime`

|===
. クラスタ内の1つまたはすべてのノードで、すべてのポートのCDP通知の保持時間を設定します。
+
[cols="30,70"]
|===


| 保持時間を設定する対象 | 入力する内容 


 a| 
1つのノード
 a| 
`run -node node_name options cdpd.holdtime holdtime`



 a| 
クラスタ内のすべてのノード
 a| 
`options cdpd.holdtime holdtime`

|===




== CDP通知の送信間隔の設定

CDP通知は、一定の間隔でCDP近隣機器に送信されます。ネットワーク トラフィックの量やネットワーク トポロジの変化に応じて、CDP通知の送信間隔を調整することができます。

*  `cdpd.interval`オプションの値は、HAペアの両方のノードで同じ値に設定する必要があります。
* デフォルトの送信間隔は60秒ですが、5～900秒の値を入力できます。


.手順
. クラスタ内の1つまたはすべてのノードについて、CDP通知の現在の送信間隔を表示します。
+
[cols="30,70"]
|===


| 送信間隔を表示する対象 | 入力する内容 


 a| 
1つのノード
 a| 
`run -node node_name options cdpd.interval`



 a| 
クラスタ内のすべてのノード
 a| 
`options cdpd.interval`

|===
. クラスタ内の1つまたはすべてのノードで、すべてのポートのCDP通知の送信間隔を設定します。
+
[cols="30,70"]
|===


| 送信間隔を設定する対象 | 入力する内容 


 a| 
1つのノード
 a| 
`run -node node_name options cdpd.interval interval`



 a| 
クラスタ内のすべてのノード
 a| 
`options cdpd.interval interval`

|===




== CDP統計情報の表示と消去

ネットワーク接続で発生する可能性のある問題を見つけるために、各ノードのクラスタ ポートと非クラスタ ポートのCDP統計情報を確認できます。CDP統計情報は、前回消去されたときからの累積値です。

.タスク概要
ONTAP 9.10.1以前の場合、ポートでCDPが常に有効になっているので、これらのポートのトラフィックに関するCDP統計情報は常に表示されます。ポートのCDP統計情報を表示するには、ポートでCDPを有効にする必要があります。

ONTAP 9.11.1以降の場合、クラスタ ポートとストレージ ポートではCDPが常に有効になっているので、これらのポートのトラフィックに関するCDP統計情報は常に表示されます。非クラスタ ポートと非ストレージ ポートのCDP統計情報を表示するには、これらのポートでCDPを有効にする必要があります。

.手順
ノードのすべてのポートに関する現在のCDP統計情報を表示、または消去します。

[cols="30,70"]
|===


| 状況 | 入力する内容 


 a| 
CDP統計情報を表示
 a| 
`run -node node_name cdpd show-stats`



 a| 
CDP統計情報を消去
 a| 
`run -node node_name cdpd zero-stats`

|===


=== 統計情報の表示と消去の例

次のコマンドは、消去する前のCDP統計情報の例を示します。前回統計情報が消去されてから、送信および受信したパケットの総数が出力されています。

....
run -node node1 cdpd show-stats

RECEIVE
 Packets:         9116  | Csum Errors:       0  | Unsupported Vers:  4561
 Invalid length:     0  | Malformed:         0  | Mem alloc fails:      0
 Missing TLVs:       0  | Cache overflow:    0  | Other errors:         0

TRANSMIT
 Packets:         4557  | Xmit fails:        0  | No hostname:          0
 Packet truncated:   0  | Mem alloc fails:   0  | Other errors:         0

OTHER
 Init failures:      0
....
次のコマンドは、CDP統計情報を消去します。

....
run -node node1 cdpd zero-stats
....
....
run -node node1 cdpd show-stats

RECEIVE
 Packets:            0  | Csum Errors:       0  | Unsupported Vers:     0
 Invalid length:     0  | Malformed:         0  | Mem alloc fails:      0
 Missing TLVs:       0  | Cache overflow:    0  | Other errors:         0

TRANSMIT
 Packets:            0  | Xmit fails:        0  | No hostname:          0
 Packet truncated:   0  | Mem alloc fails:   0  | Other errors:         0

OTHER
 Init failures:      0
....
統計情報を消去すると、次にCDP通知が送信または受信された時点から情報が累積されていきます。



== CDPがサポートされないイーサネット スイッチへの接続

一部のベンダーのスイッチはCDPをサポートしていません。詳細については、link:https://kb.netapp.com/onprem/ontap/da/NAS/ONTAP_device_discovery_shows_nodes_instead_of_the_switch["NetApp ナレッジベース：ONTAP デバイス検出でスイッチではなくノードが表示される"^]をご覧ください。

この問題の解決方法は2つあります。

* CDPを無効にし、サポートされている場合はLLDPを有効にします。詳細については、link:use_lldp_to_detect_network_connectivity.html["LLDPを使用したネットワーク接続の検出"]を参照してください。
* CDP通知をドロップするように、スイッチにMACアドレス パケット フィルタを設定する

