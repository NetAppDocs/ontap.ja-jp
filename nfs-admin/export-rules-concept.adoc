---
permalink: nfs-admin/export-rules-concept.html 
sidebar: sidebar 
keywords: export, rule, work 
summary: エクスポート ルールは、エクスポート ポリシーの機能要素です。エクスポート ルールは、ボリュームへのクライアント アクセス要求を、ユーザーが設定した特定のパラメータと照合し、クライアント アクセス要求の処理方法を決定します。 
---
= ONTAP NFSエクスポート ルールの仕組み
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
エクスポート ルールは、エクスポート ポリシーの機能要素です。エクスポート ルールは、ボリュームへのクライアント アクセス要求を、ユーザーが設定した特定のパラメータと照合し、クライアント アクセス要求の処理方法を決定します。

エクスポート ポリシーには、クライアントにアクセスを許可するエクスポート ルールを少なくとも1つ含める必要があります。エクスポート ポリシーに複数のルールが含まれている場合、ルールはエクスポート ポリシーに表示される順に処理されます。ルールの順序は、ルール インデックス番号によって決まります。ルールがクライアントに一致すると、そのルールのアクセス権が使用され、それ以降のルールは処理されません。一致するルールがない場合、クライアントはアクセスを拒否されます。

次の条件を使用して、クライアントのアクセス権を決定するようにエクスポート ルールを設定できます。

* クライアントが要求の送信に使用するファイル アクセス プロトコル（NFSv4やSMBなど）
* クライアント識別子（ホスト名やIPアドレスなど）
+
 `-clientmatch`フィールドの最大サイズは4096文字です。

* クライアントが認証に使用するセキュリティ タイプ（Kerberos v5、NTLM、AUTH_SYSなど）


ルールで複数の条件が指定されている場合、クライアントがそれらのすべてに一致しないとルールは適用されません。

[NOTE]
====
ONTAP 9.3以降では、エクスポート ポリシーの設定チェックをバックグラウンド ジョブとして有効にし、ルール違反をエラー ルール リストに記録できるようになりました。 `vserver export-policy config-checker`コマンドを実行するとチェッカーが起動し、結果が表示されます。この結果を使用して設定を検証し、ポリシーからエラーのあるルールを削除できます。

このコマンドで検証されるのは、エクスポート設定のホスト名、ネットグループ、匿名ユーザのみです。

====
.例
エクスポート ポリシーに、次のパラメータが指定されたエクスポート ルールが含まれています。

* `-protocol` `nfs3`
* `-clientmatch` `10.1.16.0/255.255.255.0`
* `-rorule` `any`
* `-rwrule` `any`


クライアント アクセス要求はNFSv3プロトコルを使用して送信され、クライアントのIPアドレスは10.1.17.37です。

クライアント アクセス プロトコルは一致していますが、クライアントのIPアドレスがエクスポート ルールで指定されているアドレスとは異なるサブネット内にあります。したがって、クライアントは一致せず、このルールはこのクライアントに適用されません。

.例
エクスポート ポリシーに、次のパラメータが指定されたエクスポート ルールが含まれています。

* `-protocol` `nfs`
* `-clientmatch` `10.1.16.0/255.255.255.0`
* `-rorule` `any`
* `-rwrule` `any`


クライアント アクセス要求はNFSv4プロトコルを使用して送信され、クライアントのIPアドレスは10.1.16.54です。

クライアント アクセス プロトコルが一致し、クライアントのIPアドレスが指定されたサブネット内にあります。したがって、クライアントは一致し、このルールはこのクライアントに適用されます。セキュリティ タイプに関係なく、クライアントは読み取り / 書き込みアクセス権を取得します。

.例
エクスポート ポリシーに、次のパラメータが指定されたエクスポート ルールが含まれています。

* `-protocol` `nfs3`
* `-clientmatch` `10.1.16.0/255.255.255.0`
* `-rorule` `any`
* `-rwrule` `krb5,ntlm`


クライアント#1は、IPアドレスが10.1.16.207で、NFSv3プロトコルを使用してアクセス要求を送信し、Kerberos v5で認証されました。

クライアント#2は、IPアドレスが10.1.16.211で、NFSv3プロトコルを使用してアクセス要求を送信し、AUTH_SYSで認証されました。

両方のクライアントで、クライアント アクセス プロトコルとIPアドレスは一致しています。読み取り専用パラメータでは、認証に使用されるセキュリティ タイプに関係なく、読み取り専用アクセスがすべてのクライアントに許可されています。したがって、両方のクライアントが読み取り専用アクセス権を取得します。ただし、読み取り / 書き込みアクセス権を取得するのはクライアント#1だけです。これは、認証に承認されたセキュリティ タイプKerberos v5を使用したためです。クライアント#2は読み取り / 書き込みアクセス権を取得できません。
