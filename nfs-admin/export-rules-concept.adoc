---
permalink: nfs-admin/export-rules-concept.html 
sidebar: sidebar 
keywords: export, rule, work 
summary: エクスポートルールは、エクスポートポリシーの機能要素です。エクスポートルールでは、ボリュームへのクライアントアクセス要求が設定済みの特定のパラメータと照合され、クライアントアクセス要求の処理方法が決定されます。 
---
= エクスポートルールの仕組み
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
エクスポートルールは、エクスポートポリシーの機能要素です。エクスポートルールでは、ボリュームへのクライアントアクセス要求が設定済みの特定のパラメータと照合され、クライアントアクセス要求の処理方法が決定されます。

エクスポートポリシーには、クライアントにアクセスを許可するエクスポートルールが少なくとも 1 つ含まれている必要があります。エクスポートポリシーに複数のルールが含まれている場合、ルールはエクスポートポリシーに表示される順に処理されます。ルールの順序は、ルールインデックス番号によって決まります。ルールがクライアントに一致すると、そのルールの権限が使用され、それ以降のルールは処理されません。一致するルールがない場合、クライアントはアクセスを拒否されます。

次の条件を使用して、クライアントのアクセス権限を決定するようにエクスポートルールを設定できます。

* クライアントが要求の送信に使用するファイルアクセスプロトコル。たとえば、 NFSv4 や SMB などです。
* ホスト名や IP アドレスなどのクライアント識別子。
* Kerberos v5 、 NTLM 、 AUTH_SYS など、クライアントが認証に使用するセキュリティタイプ。


ルールで複数の条件が指定されている場合、クライアントがそれらのすべてに一致しないとルールは適用されません。

[NOTE]
====
ONTAP 9.3 以降では、エクスポートポリシーの設定チェックをバックグラウンドジョブとして有効にし、すべてのルール違反をエラールールリストに記録することができます。vserver export-policy config-checker コマンドを実行すると、このチェック結果が表示されます。このチェック結果を使用して、設定を確認したり、誤ったルールをポリシーから削除したりすることができます。

このコマンドで検証されるのは、エクスポート設定のホスト名、ネットグループ、匿名ユーザのみです。

====
エクスポートポリシーに、次のパラメータが指定されたエクスポートルールが含まれています。

* `-protocol `nfs3`
* -clientmatch `10.1.16.0/255.255.255.0
* 「 -rorule 」「 any 」
* `-rwrule ` any 」


クライアントアクセス要求は NFSv3 プロトコルを使用して送信され、クライアントの IP アドレスは 10.1.17.37 です。

クライアントアクセスプロトコルが一致していても、クライアントの IP アドレスがエクスポートルールで指定されているアドレスとは別のサブネットに属しています。そのため、クライアントは一致しなくなり、このルールはこのクライアントに適用されません。

エクスポートポリシーに、次のパラメータが指定されたエクスポートルールが含まれています。

* -protocol`nfs`
* -clientmatch `10.1.16.0/255.255.255.0
* 「 -rorule 」「 any 」
* `-rwrule ` any 」


クライアントアクセス要求は NFSv4 プロトコルを使用して送信され、クライアントの IP アドレスは 10.1.16.54 です。

クライアントアクセスプロトコルが一致し、クライアントの IP アドレスが指定したサブネット内にあります。そのため、クライアントは一致し、このルールはこのクライアントを環境します。セキュリティタイプに関係なく、クライアントは読み取り / 書き込みアクセス権を取得します。

エクスポートポリシーに、次のパラメータが指定されたエクスポートルールが含まれています。

* `-protocol `nfs3`
* -clientmatch `10.1.16.0/255.255.255.0
* 「 -rorule 」「 any 」
* `-rwrule `krb5 、 ntlm`


クライアント #1 は、 IP アドレスが 10.1.16.207 で、 NFSv3 プロトコルを使用してアクセス要求を送信し、 Kerberos v5 で認証されます。

クライアント #2 は、 IP アドレスが 10.1.16.211 で、 NFSv3 プロトコルを使用してアクセス要求を送信し、 AUTH_SYS で認証されます。

両方のクライアントで、クライアントアクセスプロトコルと IP アドレスは一致しています。読み取り専用パラメータでは、認証に使用するセキュリティタイプに関係なく、読み取り専用アクセスがすべてのクライアントに許可されています。したがって、両方のクライアントが読み取り専用アクセス権を取得します。ただし、読み取り / 書き込みアクセス権を取得するのはクライアント #1 だけです。これは、認証に承認されたセキュリティタイプ Kerberos v5 を使用したためです。クライアント #2 は読み取り / 書き込みアクセス権を取得できません。
