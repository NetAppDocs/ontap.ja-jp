---
permalink: nfs-rdma/configure-nics-task.html 
sidebar: sidebar 
keywords: networking, NICs, NFS over RDMA, NVIDIA, NFS, system manager, ports, ethernet ports 
summary: この記事では、ONTAPでNFS over RDMAを使用するためのNICのクライアント システムとストレージ プラットフォームの両方の設定プロセスと要件について説明します。 
---
= NFS over RDMA用のNICの設定
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
NFS over RDMAでは、クライアント システムとストレージ プラットフォームの両方でNICを設定する必要があります。



== ストレージ プラットフォームの設定

ターゲット RNIC サポートの詳細については、 https://hwu.netapp.com/["NetApp Hardware Universe"^]を参照してください。

高可用性（HA）構成を使用している場合、RDMAフェイルオーバーをサポートするには、両方のノードで同じRNICを使用する必要があります。NICはRoCE対応である必要があります。

* ONTAP 9.10.1以降では、次のコマンドを使用してRDMAオフロード プロトコルのリストを表示できます。
+
[source, cli]
----
network port show -rdma-protocols roce
----
+
 `network port show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-port-show.html["ONTAPコマンド リファレンス"^]を参照してください。

* ONTAP 9.16.1以降では、優先フロー制御（PFC）の使用が推奨されます。PFCは次の `network port modify`コマンドで設定します：
+
[source, cli]
----
network port modify -node <nodename> -port <portname> -flowcontrol-admin pfc -pfc-queues-admin 3
----
* ONTAP 9.16.1より前のバージョンでは、デフォルトのグローバル フロー制御（GFC）を使用することをお勧めします。フロー制御設定を変更した場合は、 `network port modify`コマンドを使用してGFCを設定します：
+
[source, cli]
----
network port modify -node <nodename> -port <portname> -flowcontrol-admin full
----
+
 `network port modify`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-port-modify.html["ONTAPコマンド リファレンス"^]をご覧ください。





== クライアント システムの設定

NFS over RDMAでサポートされているクライアント オペレーティング システムの詳細については、 https://imt.netapp.com/matrix/["NetApp相互運用性マトリックス（IMT）"^]を参照してください。RoCE v2でサポートされているRNICについては、それぞれのRNICベンダーのドキュメントを参照してください。

クライアントとサーバを直接接続することもできますが、フェイルオーバーのパフォーマンスを向上させるにはスイッチの使用をお勧めします。

クライアント、サーバ、すべてのスイッチ、およびスイッチ上のすべてのポートは、ジャンボフレームを使用して設定する必要があります。クライアントとスイッチのフロー制御設定は、ONTAPのフロー制御設定と一致している必要があります。ONTAP 9.16.1以降では、ONTAP、スイッチ、およびクライアントで優先フロー制御を有効にして設定することがベストプラクティスです。ONTAP 9.16.1より前のバージョンでは、グローバルフロー制御を使用することを推奨します。

この構成が確認されたら、RDMAを使用してNFSエクスポートをマウントできます。

[role="tabbed-block"]
====
.System Manager
--
NFS over RDMAを使用するネットワーク インターフェイスをSystem Managerを使用して設定するには、ONTAP 9.12.1以降を使用している必要があります。

.手順
. RDMAがサポートされているかどうかを確認します。*ネットワーク > イーサネットポート*に移動し、グループビューで適切なノードを選択します。ノードを展開し、特定のポートの*RDMAプロトコル*フィールドを確認します。値*RoCE*はRDMAがサポートされていることを示し、ダッシュ（*-*）はサポートされていないことを示します。
. VLANを追加するには、*+ VLAN*を選択します。適切なノードを選択します。*Port*ドロップダウンメニューでは、利用可能なポートがRDMAをサポートしている場合、*RoCE Enabled*というテキストが表示されます。RDMAをサポートしていない場合は、テキストは表示されません。
. xref:../task_nas_enable_linux_nfs.html[NFSを使用したLinuxサーバ用のNASストレージの有効化]のワークフローに従って、新しいNFSサーバを設定します。
+
ネットワークインターフェースを追加する際、「*RoCEポートを使用する*」を選択できます。NFS over RDMAを使用するネットワークインターフェースには、このオプションを選択してください。



--
.CLI
--
. 次のコマンドを使用して、NFSサーバでRDMAアクセスが有効になっているかどうかを確認します。
+
`vserver nfs show-vserver <SVM_name>`

+
デフォルトでは、 `-rdma`有効になっています。有効になっていない場合は、NFSサーバでRDMAアクセスを有効にします：

+
`vserver nfs modify -vserver <SVM_name> -rdma enabled`

. クライアントをNFSv4.0 over RDMAでマウントします。
+
.. protoパラメータへの入力は、サーバのIPプロトコル バージョンによって異なります。IPv4の場合は、 `proto=rdma`を使用します。IPv6の場合は、 `proto=rdma6`を使用します。
.. 標準ポート2049の代わりにNFSターゲット ポートを `port=20049`として指定します：
+
`mount -o vers=4,minorversion=0,proto=rdma,port=20049 <Server_IP_address>:/<volume_path> <mount_point>`



. *オプション*：クライアントをアンマウントする必要がある場合は、コマンドを実行します `unmount <mount_path>`


--
====
.詳細情報
* xref:../nfs-config/create-server-task.html[ONTAP NFSサーバを作成する]
* xref:../task_nas_enable_linux_nfs.html[NFSを使用したLinuxサーバ用のNASストレージの有効化]

