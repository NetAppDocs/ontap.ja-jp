---
permalink: nfs-trunking/index.html 
sidebar: sidebar 
keywords: NFSv4.1, trunking, Linux, VMware, FlexGroup, volumes, multipathing, AI/ML, rdma, data lake 
summary: ONTAP 9.14.1以降、v4.1以降を実行しているNFSクライアントは、セッショントランキング機能を利用してNFSサーバへの複数の接続を開くことができるため、データ転送速度が向上し、マルチパスによる復元力が得られます。 
---
= ONTAP NFSトランキングについて学ぶ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.14.1以降では、NFSv4.1クライアントでセッション トランキングを利用してNFSサーバ上の異なるLIFへの複数の接続を確立できます。これにより、データ転送速度が向上し、マルチパスにより耐障害性が強化されます。

トランキングは、FlexVolボリュームをトランキング対応のクライアント（特にVMwareクライアントやLinuxクライアント）にエクスポートする場合や、NFS over RDMA、TCP、pNFSで便利な機能です。

ONTAP 9.14.1では、トランキングは単一ノード上のLIFに制限されます。複数のノードにわたるLIFを対象にしたトランキングはできません。

FlexGroupボリュームでは、トランキングがサポートされています。トランキングによるパフォーマンス向上は可能ですが、FlexGroupボリュームへのマルチパス アクセスは単一のノードにしか設定できません。

このリリースのマルチパスでサポートされるのは、セッション トランキングのみです。



== トランキングの使用方法

トランキングが提供するマルチパスのメリットを活用するには、トランキング対応のNFSサーバを含むSVMに関連付けられた、_トランキンググループ_と呼ばれるLIFのセットが必要です。トランキンググループ内のLIFは、クラスタ内の同じノードにホームポートを持ち、それらのホームポート上に配置されている必要があります。ベストプラクティスとして、トランキンググループ内のすべてのLIFを同じフェイルオーバーグループのメンバーにすることをお勧めします。

ONTAPでは、1つのクライアントからノードあたり最大16のトランク接続がサポートされます。

クライアントでトランキング対応サーバからのエクスポートをマウントする場合は、トランキング グループ内のLIFのIPアドレスの数を指定します。クライアントが1つ目のLIFに接続したあとで追加されたLIFは、NFSv4.1セッションのみに追加され、トランキング グループの要件を満たしていればトランキングに使用されます。クライアントでは、独自のアルゴリズム（ラウンドロビンなど）に基づいて、NFS処理が複数の接続に分散されます。

最大限のパフォーマンスを引き出すには、シングルパス エクスポートではなく、マルチパス エクスポート専用のSVMにトランキングを設定します。つまり、トランキング対応クライアントのみにエクスポートを提供しているSVM内のNFSサーバのみでトランキングを有効にします。



== サポート対象のクライアント

ONTAP NFSv4.1サーバでは、NFSv4.1セッション トランキングを実行できる任意のクライアントとのトランキングがサポートされます。

次のクライアントは、ONTAP 9.14.1でテスト済みです。

* VMware - ESXi 7.0U3F以降
* Linux - Red Hat Enterprise Linux（RHEL）8.8および9.3



NOTE: RHEL NFSクライアントは、フェイルオーバーイベント（コントローラフェイルオーバーなど）でトランクLIFが別のノードに移行された場合、トランキングを再確立しません。LIFが別のノードに移行されると、トランキンググループから削除されます。トランキンググループ内のすべてのLIFが移行された場合、NFSクライアントは最初のLIFのみを使用してI/Oを続行します。


NOTE: NFSサーバでトランキングを有効にしている場合、トランキングをサポートしていないNFSクライアントでエクスポートされた共有にアクセスすると、パフォーマンスが低下することがあります。これは、SVMデータLIFへの複数のマウントに使用されるTCP接続が1つしかないためです。



== NFSトランキングとnconnectの違い

ONTAP 9.8以降、NFSv4.1が有効になっている場合はデフォルトでnconnect機能を使用できます。nconnect対応クライアントでは、1つのNFSマウントで1つのLIFを介して複数（最大16）のTCP接続を確立できます。

一方、トランキングは、複数のLIFを介して複数のTCP接続を提供する_マルチパス_機能です。環境内で追加のNICを使用できる場合、トランキングはnconnectの能力を超える並列処理とパフォーマンスの向上を実現します。

link:../nfs-admin/ontap-support-nfsv41-concept.html["nconnect"]についての詳細をご覧ください。
