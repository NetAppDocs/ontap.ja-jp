---
permalink: nfs-trunking/prepare-network-task.html 
sidebar: sidebar 
keywords: NFS, servers, network, prepare, NFS trunking, LIF, trunking group, NIC 
summary: NFSv4.1トランキングのメリットを享受するには、トランキング グループ内のLIFが同じノードにあり、ホーム ポートが同じノード上にある必要があります。 
---
= ONTAPのNFSトランキングに向けたネットワークの準備
:allow-uri-read: 


[role="lead"]
NFSv4.1トランキングのメリットを享受するには、トランキング グループ内のLIFが同じノードにあり、ホーム ポートが同じノード上にある必要があります。LIFは、同じノードのフェイルオーバー グループに構成されている必要があります。

.タスク概要
LIFとNICを1対1でマッピングするとパフォーマンスが最大限に向上しますが、トランキングを有効にする必要はありません。少なくとも2枚のNICを取り付けるとパフォーマンス上のメリットが得られますが、必須ではありません。

トランキング グループ内のすべてのLIFは、同じフェイルオーバー グループに属している必要があります。同じノードのフェイルオーバー グループにLIFが設定されている場合、そのノードでコントローラ フェイルオーバーが発生すると、LIFがオフラインになる可能性があることに注意してください。同じノードのフェイルオーバー グループにLIFが設定されておらず、別のノードにフェイルオーバーした場合、トランキングは機能しなくなります。

フェイルオーバー グループからの接続（と基盤になるNIC）を追加または削除する際には、常にトランキング フェイルオーバー グループの調整が必要になります。

.開始する前に
* フェイルオーバー グループを作成するには、NICに関連付けられているポート名を確認しておく必要があります。
* すべてのポートが同じノード上にある必要があります。


.手順
. 使用するネットワーク ポートの名前とステータスを確認します。
+
[source, cli]
----
network port show
----
. フェイルオーバー グループを作成します。
+
`network interface failover-groups create -vserver <svm_name> -failover-group <failover_group_name> -targets <ports_list>`

+

NOTE: フェイルオーバー グループは必須ではありませんが、作成しておくことが強く推奨されます。

+
** `<svm_name>`は、NFSサーバを含むSVMの名前です。
** `<ports_list>`は、フェイルオーバー グループに追加されるポートのリストです。
+
ポートは `<node_name>:<port_number>`の形式で追加されます。例： `node1:e0c`

+
次のコマンドは、vs1というSVMにfg3というフェイルオーバー グループを作成してポートを3つ追加します。

+
`network interface failover-groups create -vserver vs1 -failover-group fg3 -targets cluster1-01:e0c,cluster1-01:e0d,cluster1-01:e0e`

+
link:../networking/configure_failover_groups_and_policies_for_lifs_overview.html["フェイルオーバーグループ。"]の詳細

+
 `network interface failover-groups create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-failover-groups-create.html["ONTAPコマンド リファレンス"^]をご覧ください。



. 必要に応じて、トランキング グループのメンバー用のLIFを作成します。
+
`network interface create -vserver <svm_name> -lif <lif_name> -home-node <node_name> -home-port <port_name> -address <IP_address> -netmask <IP_address> [-service-policy <policy>] [-auto-revert <true|false>]`

+
** `-home-node` - LIFでnetwork interface revertコマンドが実行されたときにLIFが戻るノード。
+
 `-auto-revert`オプションを使用して、LIFがホームノードとホームポートに自動的にリバートするかどうかも指定できます。

** `-home-port`は、LIFでnetwork interface revertコマンドが実行されたときにLIFが戻る物理ポートまたは論理ポートです。
** IPアドレスは `-address`オプションと `-netmask`オプションで指定できますが、 `-subnet`オプションでは指定できません。
** IPアドレスを割り当てる際に、異なるIPサブネット上にクライアントまたはドメインコントローラが存在する場合は、ゲートウェイへのデフォルトルートの設定が必要になることがあります。 `network route create`およびSVM内でのスタティックルートの作成方法の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-route-create.html["ONTAPコマンド リファレンス"^]をご覧ください。
** `-service-policy` - LIFのサービスポリシー。ポリシーが指定されていない場合は、デフォルトのポリシーが自動的に割り当てられます。 `network interface service-policy show`コマンドを使用して、利用可能なサービスポリシーを確認してください。
** `-auto-revert` - 起動時、管理データベースのステータス変更時、ネットワーク接続時などの状況下で、データLIFをホームノードに自動的に戻すかどうかを指定します。デフォルト設定はfalseですが、環境のネットワーク管理ポリシーに応じてtrueに設定できます。
+
トランキング グループ内のすべてのLIFについて、この手順を繰り返します。

+
次のコマンドは、ノード `cluster1_01`のポート `e0c`上で、SVM `vs1`用の `lif-A`を作成します：

+
`network interface create -vserver vs1 -lif lif-A -service-policy default-intercluster -home-node cluster1_01 -home-port e0c -address 192.0.2.0`

+
link:../networking/create_lifs.html["LIF の作成。"]の詳細



. LIFが作成されたことを確認します。
+
[source, cli]
----
network interface show
----
. 設定したIPアドレスに到達できることを確認します。
+
[cols="25,75"]
|===
| 対象 | 方法 


| IPv4 アドレス | `network ping` 


| IPv6アドレス | `network ping6` 
|===


.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/network-ping.html["network ping"^]
* link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=network+interface["ネットワーク インターフェイス"^]
* link:https://docs.netapp.com/us-en/ontap-cli/network-port-show.html["network port show"^]

