---
permalink: performance-admin/guarantee-throughput-qos-task.html 
sidebar: sidebar 
keywords: throughput, qos, understand, ceilings, floors, shared, policy, adaptive, general, support, workloads, 
summary: ストレージQuality of Service（QoS；サービス品質）を使用して、重要なワークロードのパフォーマンスが競合するワークロードによって低下しないようにすることができます。競合するワークロードにスループットの上限を設定してシステムリソースへの影響を制限したり、重要なワークロードにスループットの下限を設定したりすることで、競合するワークロードからの要求に関係なく必要な最小スループットを確保できます。同じワークロードに対して上限と下限を設定することもできます。 
---
= ONTAPのQoS概要でスループットを保証
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ストレージQuality of Service（QoS；サービス品質）を使用して、重要なワークロードのパフォーマンスが競合するワークロードによって低下しないようにすることができます。競合するワークロードに Throughput Ceil天 を設定して、システムリソースへの影響を制限したり、重要なワークロードに Throughput Floor_ を設定したりすることで、競合するワークロードによる要求に関係なく最小のスループットターゲットを満たすことができます。同じワークロードに対して上限と下限を設定することもできます。



== スループットの上限（最大QoS）について

スループットの上限は、ワークロードのスループットを最大IOPS、最大MBps、またはIOPSとMBpsに制限します。次の図では、ワークロード2のスループットの上限により、ワークロード1と3の「Bully」にならないようになっています。

a_policy group_ は、 1 つ以上のワークロードに対するスループットの上限を定義します。ワークロードとは、 a_storage オブジェクト： _a ボリューム、ファイル、 qtree 、または LUN 、あるいは SVM 内のすべてのボリューム、ファイル、 qtree 、または LUN の I/O 処理のことです。上限はポリシーグループの作成時に指定することも、ワークロードを監視してから指定することもできます。


NOTE: ワークロードのスループットは、特にスループットが急激に変化した場合、指定された上限を10%までは超えることができます。バーストに対処するために、上限を50%まで超過することがあります。バーストは、トークンが最大150%蓄積すると、シングルノードで発生します。

image:qos-ceiling.gif["スループットの上限の適用前後のQoSを比較するグラフ。"]



== スループットの下限（最小QoS）について

スループットの下限は、ワークロードのスループットが最小IOPS、最小MBps、またはIOPSとMBpsを下回らないことを保証します。次の図では、ワークロード1とワークロード3のスループットの下限が設定されているため、ワークロード2からの要求に関係なく、必要な最小スループットが確保されています。


TIP: これらの例からわかるように、スループットの上限はスループットを直接調整するのに対し、スループットの下限は下限が設定されたワークロードを優先することでスループットを間接的に調整します。

下限はポリシーグループの作成時に指定できます。また、ワークロードを監視したあとで指定することもできます。

ONTAP 9.13.1以降では、を使用してSVMスコープでスループットの下限を設定でき<<adaptive-qos-templates>>ます。ONTAP 9.13.1より前のリリースでは、スループットの下限を定義するポリシーグループはSVMに適用できません。

[NOTE]
====
ONTAP 9 .7より前のリリースでは、十分なパフォーマンス容量がある場合にスループットの下限が保証されます。

ONTAP 9 .7以降では、十分なパフォーマンス容量がない場合でもスループットの下限が保証されます。この新しい下限の動作は、下限v2と呼ばれます。下限v2では、この保証を満たすために、スループットの下限がないワークロードや下限の設定を超える作業でレイテンシが高くなる可能性があります。下限v2は、QoSとアダプティブQoSの両方に適用されます。

ONTAP 9.7P6以降では、下限v2の新しい動作を有効または無効にするオプションを使用できます。などの重要な処理の実行中は、ワークロードが指定された下限を下回ることがあります `volume move trigger-cutover`。利用可能な容量が十分にあり、重要な処理を実行していない場合でも、ワークロードのスループットが指定された下限を最大5%下回ることがあります。下限がオーバープロビジョニングされていてパフォーマンス容量がない場合、一部のワークロードが指定された下限を下回ることがあります。

====
image:qos-floor.gif["下限適用前後のQoSスループットを比較する2つのグラフ。"]



== 共有および非共有のQoSポリシーグループについて

ONTAP 9.4 以降では、 _non-shared_QoS ポリシーグループを使用して、定義されたスループットの上限または下限の環境を各メンバーのワークロードごとに指定できます。_shared_policy グループの動作は ' ポリシー・タイプによって異なります

* スループットの上限については、共有ポリシーグループに割り当てられたワークロードの合計スループットが指定した上限を超えることはできません。
* スループットの下限の場合、共有ポリシーグループは単一のワークロードにのみ適用できます。




== アダプティブQoSについて

通常、ストレージオブジェクトに割り当てるポリシーグループの値は固定値です。ストレージオブジェクトのサイズが変わった場合は、値を手動で変更する必要があります。たとえば、ボリュームの使用スペースが増えた場合、通常は指定されているスループットの上限も増やす必要があります。

アダプティブ QoS _ ワークロードのサイズの変更に合わせてポリシーグループの値が自動的に調整され、 TB または GB あたりの IOPS が一定に維持されます。これは、数百、数千のワークロードを管理する大規模な環境では大きなメリットです。

アダプティブQoSは、主にスループットの上限の調整に使用しますが、下限の管理（ワークロードサイズが増加した場合）にも使用できます。ワークロードのサイズは、ストレージオブジェクトに割り当てられたスペースまたはストレージオブジェクトで使用されているスペースのいずれかで表されます。


NOTE: ONTAP 9 .5以降では、使用済みスペースをスループットの下限に使用できます。ONTAP 9 .4以前のスループットの下限ではサポートされません。

* 割り当て済みスペースのポリシーでは、ストレージオブジェクトの公称サイズを基準に IOPS と TB / GB の比率が維持されます。比率が100 IOPS/GBの場合、150GBのボリュームのスループットの上限は、ボリュームのサイズが変わらないかぎり15、000 IOPSです。ボリュームのサイズが300GBに変更されると、アダプティブQoSによってスループットの上限が30、000 IOPSに調整されます。
* a_used space-policy （デフォルト）は、ストレージ効率化前に格納されている実際のデータの量に基づいて、 IOPS/TB|GB の比率を維持します。比率が100 IOPS/GBの場合、100GBのデータが格納されている150GBのボリュームのスループットの上限は10、000 IOPSです。使用済みスペースの量が変わると、アダプティブQoSによって比率に応じてスループットの上限が調整されます。


ONTAP 9 5以降では、アプリケーションのI/Oブロックサイズを指定して、スループット制限をIOPSとMBpsの両方で表すことができます。MBps制限は、ブロックサイズにIOPS制限を掛けて計算されます。たとえば、32KのI/OブロックサイズでIOPSの制限が6144IOPS/TBの場合、MBpsの制限は192MBpsになります。

スループットの上限と下限の両方について、次の動作が想定されます。

* アダプティブQoSポリシーグループにワークロードを割り当てると、上限または下限がただちに更新されます。
* アダプティブQoSポリシーグループに含まれるワークロードのサイズを変更すると、上限または下限が約5分で更新されます。


更新を実行するには、スループットが少なくとも10 IOPS増加する必要があります。

アダプティブQoSポリシーグループは常に非共有です。定義されているスループットの上限または下限は、各メンバーワークロードに個別に適用されます。

ONTAP 9.6以降では、SSDを使用するONTAP Select Premiumでスループットの下限がサポートされます。



=== アダプティブポリシーグループテンプレート

ONTAP 9.13.1以降では、アダプティブQoSテンプレートをSVMに設定できます。アダプティブポリシーグループテンプレートを使用すると、SVM内のすべてのボリュームにスループットの下限と上限を設定できます。

アダプティブポリシーグループテンプレートは、SVMの作成後にのみ設定できます。 `vserver modify`コマンドでパラメータを指定し `-qos-adaptive-policy-group-template`て、ポリシーを設定します。

アダプティブポリシーグループテンプレートを設定すると、ポリシーの設定後に作成または移行されたボリュームには自動的にポリシーが継承されます。ポリシーテンプレートを割り当てても、SVM上の既存のボリュームには影響しません。SVMでポリシーを無効にすると、以降SVMに移行または作成されたボリュームにポリシーは適用されません。アダプティブポリシーグループテンプレートを無効にしても、ポリシーテンプレートが保持されるため、そのポリシーテンプレートを継承したボリュームには影響しません。

詳細については、を参照してください xref:../performance-admin/adaptive-policy-template-task.html[アダプティブポリシーグループテンプレートの設定]。



== 一般的なサポート

次の表に、スループットの上限、スループットの下限、およびアダプティブQoSのサポートの違いを示します。

|===
| リソースまたは機能 | スループットの上限 | スループットの下限 | スループットの下限v2 | アダプティブQoS 


 a| 
ONTAP 9バージョン
 a| 
すべて
 a| 
9.2以降
 a| 
9.7以降
 a| 
9.3以降



 a| 
プラットフォーム
 a| 
すべて
 a| 
* AFF
* C190 *
* SSDを使用したONTAP Select Premium *

 a| 
* AFF
* C190
* SSDを使用したONTAP Select Premium

 a| 
すべて



 a| 
プロトコル
 a| 
すべて
 a| 
すべて
 a| 
すべて
 a| 
すべて



 a| 
FabricPool
 a| 
〇
 a| 
○（階層化ポリシーが「none」に設定されていて、ブロックがクラウドにない場合）
 a| 
○（階層化ポリシーが「none」に設定されていて、ブロックがクラウドにない場合）
 a| 
いいえ



 a| 
SnapMirror Synchronous
 a| 
〇
 a| 
いいえ
 a| 
いいえ
 a| 
〇

|===
C190とONTAP Selectのサポートは、ONTAP 9 .6リリースから開始されました。



== スループットの上限がサポートされるワークロード

次の表に、スループットの上限でサポートされるワークロードをONTAP 9のバージョン別に示します。ルートボリューム、負荷共有ミラー、およびデータ保護ミラーはサポートされません。

|===
| ワークロード - 上限 | ONTAP 9.0 | ONTAP 9.1 | ONTAP 9.2 | ONTAP 9.3 | ONTAP 9 .4 ~ 9.7 | ONTAP 9.8以降 


 a| 
ボリューム
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
ファイル
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
LUN
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
SVM
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
FlexGroupボリューム
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
qtree *
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ
 a| 
はい



 a| 
ポリシーグループごとに複数のワークロード
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい
 a| 
はい



 a| 
非共有ポリシーグループ
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ
 a| 
いいえ
 a| 
はい
 a| 
はい

|===
ONTAP 9 .8以降では、NFSが有効なFlexVolおよびFlexGroupボリュームのqtreeでNFSアクセスがサポートされます。ONTAP 9 .9.1以降では、SMBが有効なFlexVolおよびFlexGroupボリュームのqtreeでもSMBアクセスがサポートされます。



== スループットの下限がサポートされるワークロード

次の表に、スループットの下限がサポートされるワークロードをONTAP 9のバージョン別に示します。ルートボリューム、負荷共有ミラー、およびデータ保護ミラーはサポートされません。

|===
| ワークロード - 下限 | ONTAP 9.2 | ONTAP 9.3 | ONTAP 9 .4 ~ 9.7 | ONTAP 9 .8 ~ 9.13.0 | ONTAP 9.13.1以降 


| ボリューム | はい | はい | はい | はい | はい 


| ファイル | いいえ | はい | はい | はい | はい 


| LUN | はい | はい | はい | はい | はい 


| SVM | いいえ | いいえ | いいえ | いいえ | はい 


| FlexGroupボリューム | いいえ | いいえ | はい | はい | はい 


| qtree * | いいえ | いいえ | いいえ | はい | はい 


| ポリシーグループごとに複数のワークロード | いいえ | いいえ | はい | はい | はい 


| 非共有ポリシーグループ | いいえ | いいえ | はい | はい | はい 
|===
\* ONTAP 9.8以降では、NFSが有効なFlexVol およびFlexGroup のqtreeでNFSアクセスがサポートされます。ONTAP 9 .9.1以降では、SMBが有効なFlexVolおよびFlexGroupボリュームのqtreeでもSMBアクセスがサポートされます。



== アダプティブQoSがサポートされるワークロード

次の表に、アダプティブQoSがサポートされるワークロードをONTAP 9のバージョン別に示します。ルートボリューム、負荷共有ミラー、およびデータ保護ミラーはサポートされません。

|===
| ワークロード-アダプティブQoS | ONTAP 9.3 | ONTAP 9 .4 ~ 9.13.0 | ONTAP 9.13.1以降 


| ボリューム | はい | はい | はい 


| ファイル | いいえ | はい | はい 


| LUN | いいえ | はい | はい 


| SVM | いいえ | いいえ | はい 


| FlexGroupボリューム | いいえ | はい | はい 


| ポリシーグループごとに複数のワークロード | はい | はい | はい 


| 非共有ポリシーグループ | はい | はい | はい 
|===


== ワークロードとポリシーグループの最大数

次の表に、ワークロードとポリシーグループの最大数をONTAP 9のバージョン別に示します。

|===
| ワークロードのサポート | ONTAP 9.3以前 | ONTAP 9.4以降 


 a| 
クラスタあたりの最大ワークロード
 a| 
12,000
 a| 
40,000



 a| 
ノードあたりの最大ワークロード
 a| 
12,000
 a| 
40,000



 a| 
ポリシーグループの最大数
 a| 
12,000
 a| 
12,000

|===