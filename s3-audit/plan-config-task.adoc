---
permalink: s3-audit/plan-config-task.html 
sidebar: sidebar 
keywords: s3, audit, create, configure s3 audit 
summary: このタスクでは、s3 監査で使用されるパラメータについて説明します。 
---
= ONTAP S3監査構成を計画する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
S3の監査設定では、いくつかのパラメータを指定する必要があります（デフォルトを受け入れることもできます）。特に、ログ ローテーションのパラメータについては、十分な空きスペースを確保できるように検討が必要です。

 `vserver object-store-server audit create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/vserver-object-store-server-audit-create.html["ONTAPコマンド リファレンス"^]をご覧ください。



== 一般パラメータ

監査設定の作成時に指定する必要がある2つの必須パラメータがあります。また、オプションのパラメータが3つあります。

[cols="4,2,1"]
|===


| 情報の種類 | オプション | 必須 


 a| 
_SVM 名_

監査設定を作成するSVMの名前。

S3対応の既存のSVMを指定する必要があります。
 a| 
`-vserver _svm_name_`
 a| 
はい



 a| 
_ログの保存先パス_

変換された監査ログを格納する場所を指定します。SVM上の既存のパスを指定する必要があります。

パスは864文字以内で、読み取り / 書き込みアクセス権が設定されている必要があります。

パスが有効でない場合、監査設定コマンドは失敗します。
 a| 
`-destination _text_`
 a| 
はい



 a| 
_監査対象イベントのカテゴリー_

監査できるイベント カテゴリは次のとおりです。

* データGetObject、PutObject、DeleteObjectイベント
* 管理 PutBucket および DeleteBucket イベント


デフォルトでは、データ イベントのみが監査されます。
 a| 
`-events {data{vbar}management}, ...`
 a| 
いいえ

|===
監査ログ ファイルの数を制御するには、次のどちらかのパラメータを入力します。値を入力しないと、すべてのログ ファイルが保持されます。

[cols="4,2,1"]
|===


| 情報の種類 | オプション | 必須 


 a| 
_ログ ファイルのローテーション制限_

最も古いログファイルをローテーションする前に保持する監査ログファイルの数を決定します。たとえば、値に5を入力すると、最後の5つのログファイルが保持されます。

値を0に設定すると、すべてのログ ファイルが保持されます。デフォルト値は0です。
 a| 
`-rotate-limit _integer_`
 a| 
いいえ



 a| 
_ログファイルの保存期間制限_

ログ ファイルを削除するまでの保持期間を指定します。たとえば、「5d0h0m」という値を入力すると、5日以上経過したログが削除されます。

値を0に設定すると、すべてのログ ファイルが保持されます。デフォルト値は0です。
 a| 
`-retention duration _integer_time_`
 a| 
いいえ

|===


== 監査ログのローテーション パラメータ

監査ログは、サイズまたはスケジュールに基づいてローテーションできます。デフォルトでは、サイズに基づいて監査ログがローテーションされます。



=== ログ サイズに基づいたログのローテーション

デフォルトのログローテーション方法とデフォルトのログサイズを使用する場合は、ログローテーションに関する特別なパラメータを設定する必要はありません。デフォルトのログサイズは100 MBです。

デフォルトのログ サイズを使用しない場合は、 `-rotate-size` パラメータを構成してカスタム ログ サイズを指定できます。

ログ サイズのみに基づいてローテーションをリセットする場合は、次のコマンドを使用して `-rotate-schedule-minute`パラメータの設定を解除します：

`vserver audit modify -vserver _svm_name_ -destination / -rotate-schedule-minute -`



=== スケジュールに基づいたログのローテーション

スケジュールに基づいて監査ログをローテーションすることを選択した場合は、時間ベースのローテーション パラメータを任意の組み合わせで使用して、ログのローテーションをスケジュールできます。

* 時間ベースのローテーションを使用する場合、 `-rotate-schedule-minute`パラメータは必須です。
* それ以外の時間に基づくローテーション パラメータは、すべてオプションです。
+
** `-rotate-schedule-month`
** `-rotate-schedule-dayofweek`
** `-rotate-schedule-day`
** `-rotate-schedule-hour`


* ローテーション スケジュールは、すべての時間関連値を使用して計算されます。たとえば、 `-rotate-schedule-minute`パラメータのみを指定した場合、監査ログ ファイルは、年間を通じてすべての月のすべての時間帯において、すべての曜日で指定された分に基づいてローテーションされます。
* 時間ベースのローテーション パラメータを 1 つまたは 2 つだけ指定すると（たとえば、 `-rotate-schedule-month`および `-rotate-schedule-minutes`）、指定した月のみ、すべての曜日、すべての時間帯で指定した分の値に基づいてログ ファイルがローテーションされます。
+
たとえば、監査ログを1月、3月、8月のすべての月曜日、水曜日、土曜日の午前10：30にローテーションするように指定できます。

*  `-rotate-schedule-dayofweek`と `-rotate-schedule-day`の両方に値を指定した場合、それらは独立して考慮されます。
+
たとえば、 `-rotate-schedule-dayofweek`を金曜日、 `-rotate-schedule-day`を13と指定した場合、監査ログは13日の金曜日だけでなく、毎週金曜日と指定した月の13日にローテーションされます。

* スケジュールのみに基づいてローテーションをリセットする場合は、次のコマンドを使用して `-rotate-size parameter`の設定を解除します：
+
`vserver audit modify -vserver _svm_name_ -destination / -rotate-size -`





=== ログ サイズとスケジュールに基づいたログのローテーション

-rotate-size パラメータと時間ベースのローテーション パラメータを任意の組み合わせで設定することで、ログ サイズとスケジュールに基づいてログ ファイルをローテーションできます。例： `-rotate-size`が10 MBに設定され、 `-rotate-schedule-minute`が15に設定されている場合、ログ ファイルのサイズが10 MBに達したとき、または毎時15分（どちらか早い方のイベント）にログ ファイルがローテーションされます。

この手順で説明されているコマンドの詳細については、link:https://docs.netapp.com/us-en/ontap-cli/["ONTAPコマンド リファレンス"^]を参照してください。
