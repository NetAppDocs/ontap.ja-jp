---
permalink: s3-config/create-bucket-mcc-task.html 
sidebar: sidebar 
keywords: s3, bucket, system manager, metrocluster, unmirrored, mirrored, aggregate 
summary: ONTAP 9.14.1以降では、MetroCluster FC構成およびIP構成のミラーされたアグリゲートまたはミラーされていないアグリゲートにバケットをプロビジョニングできます。 
---
= MetroCluster構成内のミラーされたアグリゲートまたはミラーされていないアグリゲートに ONTAP S3 バケットを作成する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.14.1以降では、MetroCluster FC構成およびIP構成のミラーされたアグリゲートまたはミラーされていないアグリゲートにバケットをプロビジョニングできます。

.タスク概要
* デフォルトでは、バケットはミラーされたアグリゲートにプロビジョニングされます。
* link:create-bucket-task.html["バケットの作成"]で概説されているのと同じプロビジョニングガイドラインが、MetroCluster環境でバケットを作成する場合に適用されます。
* 次の S3 オブジェクト ストレージ機能は MetroCluster 環境ではサポートされて*いません*：
+
** SnapMirror S3
** S3バケットのライフサイクル管理
** *Compliance* モードでの S3 オブジェクトロック
+

NOTE: *ガバナンス* モードでの S3 オブジェクトロックがサポートされています。

** ローカルFabricPool階層化




.開始する前に
S3サーバを含むSVMがすでに存在している必要があります。



== バケットを作成するプロセス

[role="tabbed-block"]
====
.CLI
--
. アグリゲートとFlexGroupコンポーネントを自分で選択する場合は、権限レベルをadvancedに設定します（それ以外の場合は、admin権限レベルで十分です）： `set -privilege advanced`
. バケットを作成します。
+
`vserver object-store-server bucket create -vserver <svm_name> -bucket <bucket_name> [-size integer[KB|MB|GB|TB|PB]] [-use-mirrored-aggregates true/false]`

+
 `-use-mirrored-aggregates`オプションを `true`または `false`に設定します。ミラーされたアグリゲートとミラーされていないアグリゲートのどちらを使用するかによって異なります。

+

NOTE: デフォルトでは、 `-use-mirrored-aggregates`オプションは `true`に設定されています。

+
** SVM名はデータSVMである必要があります。
** オプションを指定しない場合、800GBのバケットが作成され、システムで使用可能な最上位のサービス レベルが設定されます。
** パフォーマンスまたは使用量に基づいてバケットを作成する場合は、次のいずれかのオプションを使用します。
+
*** サービス レベル
+
 `-storage-service-level`オプションに次のいずれかの値を指定します： `value`、 `performance`、または `extreme`。

*** 階層化
+
 `-used-as-capacity-tier true`オプションを含めます。



** 使用するFlexGroupボリュームを作成するアグリゲートを指定する場合は、次のオプションを使用します。
+
***  `-aggr-list`パラメータは、FlexGroupボリュームの構成要素に使用されるアグリゲートのリストを指定します。
+
指定したエントリごとに、そのアグリゲート上にコンスティチュエントが1つ作成されます。同じアグリゲートを複数回指定すると、そのアグリゲート上に複数のコンスティチュエントを作成できます。

+
FlexGroupボリューム全体で一貫したパフォーマンスが得られるように、ディスク タイプとRAIDグループ構成をすべてのアグリゲートで同じにする必要があります。

***  `-aggr-list-multiplier`パラメータは、FlexGroupボリュームの作成時に `-aggr-list`パラメータでリストされているアグリゲートを反復処理する回数を指定します。
+
 `-aggr-list-multiplier`パラメータのデフォルト値は4です。





. 必要に応じてQoSポリシー グループを追加します。
+
`vserver object-store-server bucket modify -bucket _bucket_name_ -qos-policy-group _qos_policy_group_`

. バケットが作成されたことを確認します。
+
`vserver object-store-server bucket show [-instance]`



.例
次の例では、ミラーされたアグリゲートにサイズが1TBのSVM vs1のバケットを作成しています。

[listing]
----
cluster-1::*> vserver object-store-server bucket create -vserver svm1.example.com -bucket testbucket  -size 1TB -use-mirrored-aggregates true
----
--
.System Manager
--
. S3対応Storage VMに新しいバケットを追加します。
+
.. *Storage > Buckets*をクリックし、*Add*をクリックします。
.. 名前を入力し、Storage VMを選択してサイズを入力します。
+
デフォルトでは、バケットはミラーリングされたアグリゲート上にプロビジョニングされます。ミラーされていないアグリゲート上にバケットを作成する場合は、「*その他のオプション*」を選択し、「*保護*」の下にある「*SyncMirror階層を使用*」のチェックボックスをオフにしてください（次の図を参照）：

+
image:../media/SM_create_bucket_MCC.png["System Manager MetroClusterバケットの作成"]

+
*** この時点で*保存*をクリックすると、次のデフォルト設定でバケットが作成されます：
+
**** すでに有効なグループ ポリシーがないかぎり、いずれのユーザにもバケットへのアクセスは許可されません。
+

NOTE: S3のrootユーザにはオブジェクト ストアへの無制限のアクセスが付与されるため、ONTAPオブジェクト ストレージの管理や権限の共有には使用しないでください。代わりに、管理者権限を割り当てたユーザまたはグループを作成してください。

**** システムで使用できる最も高いQuality of Service（パフォーマンス）レベル。


*** バケットを構成するときに、[*その他のオプション*] をクリックしてユーザー権限とパフォーマンスレベルを構成することも、後でこれらの設定を変更することもできます。
+
**** *その他のオプション*を使用して権限を設定する前に、ユーザーとグループを作成しておく必要があります。
**** S3オブジェクトストアをFabricPool階層化に使用する場合は、パフォーマンスサービスレベルではなく、*階層化に使用*（階層化されたデータに最適なパフォーマンスを備えた低コストのメディアを使用する）を選択することを検討してください。






. S3クライアントアプリ（別のONTAPシステムまたは外部のサードパーティアプリ）で、次のように入力して新しいバケットへのアクセスを確認します：
+
** S3サーバのCA証明書。
** ユーザのアクセス キーとシークレット キー。
** S3サーバのFQDN名とバケット名。




--
====