---
permalink: s3-config/create-bucket-task.html 
sidebar: sidebar 
keywords: s3, bucket, system manager, 
summary: S3オブジェクトは_バケット_に保存されます。他のディレクトリ内のディレクトリ内にファイルとしてネストされることはありません。 
---
= ONTAP S3バケットを作成する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
S3オブジェクトは_バケット_に保存されます。他のディレクトリ内のディレクトリ内にファイルとしてネストされることはありません。

.開始する前に
S3サーバを含むStorage VMがすでに存在している必要があります。

.タスク概要
* ONTAP 9.14.1以降では、S3 FlexGroupボリューム上にバケットを作成するとサイズ自動変更が有効になります。これにより、既存および新規のFlexGroupボリューム上でのバケットの作成時に、容量が過剰に割り当てられる事態を防止できます。FlexGroupボリュームは、以下のガイドラインに基づく必要最小限のサイズに変更されます。必要最小限のサイズとは、FlexGroupボリューム内のすべてのS3バケットの合計サイズです。
+
** ONTAP 9.14.1以降では、新規バケットの作成の一環としてS3 FlexGroupボリュームが作成された場合、必要最小限のサイズになります。
** ONTAP 9.14.1より前のバージョンで作成されたS3 FlexGroupボリュームについては、ONTAP 9.14.1以降で初めてバケットが作成または削除された際に必要最小限のサイズに変更されます。
** ONTAP 9.14.1より前のバージョンでS3 FlexGroupボリュームが作成されており、すでに必要最小限のサイズに設定されている場合、ONTAP 9.14.1以降でバケットが作成または削除されてもボリュームのサイズは変更されません。


* ストレージサービスレベルは、事前定義されたアダプティブなQuality of Service（QoS）ポリシーグループで、_value_、_performance_、_extreme_のデフォルトレベルが用意されています。デフォルトのストレージサービスレベルの代わりに、カスタムQoSポリシーグループを定義してバケットに適用することもできます。ストレージサービス定義の詳細については、link:storage-service-definitions-reference.html["ストレージ サービスの定義"]を参照してください。パフォーマンス管理の詳細については、link:../performance-admin/index.html["パフォーマンス管理"]を参照してください。ONTAP 9.8以降では、ストレージをプロビジョニングする際にQoSがデフォルトで有効になっています。プロビジョニングプロセス中または後で、QoSを無効にしたり、カスタムQoSポリシーを選択したりすることができます。


* ローカルでの容量階層化を設定する場合は、S3サーバが配置されているシステムStorage VMではなく、データStorage VMにバケットとユーザを作成します。
* リモート クライアント アクセスには、S3対応のStorage VMにバケットを設定する必要があります。S3対応でないStorage VMに作成したバケットは、ローカルの階層化にしか使用できません。
* ONTAP 9.14.1以降では、link:create-bucket-mcc-task.html["MetroCluster構成内のミラーされたアグリゲートまたはミラーされていないアグリゲートにバケットを作成する"]できます。
* CLIでバケットを作成するときは、次の2つのプロビジョニング オプションから選択できます。
+
** 使用するアグリゲートとFlexGroupコンポーネントをONTAPで選択（デフォルト）
+
*** ONTAPでアグリゲートが自動的に選択され、最初のバケットのFlexGroupボリュームが作成されて設定されます。プラットフォームで使用可能な最上位のサービス レベルが自動的に選択されます。または、任意のストレージ サービス レベルを指定することもできます。以降このStorage VMに追加するすべてのバケットには同じFlexGroupボリュームが使用されます。
*** バケットを階層化に使用するかどうかを指定することもできます。指定した場合、階層化データ用に最適なパフォーマンスで低コストのメディアが選択されます。


** 基盤となるアグリゲートとFlexGroupコンポーネントを選択します（高度な権限を持つコマンドオプションが必要です）：バケットとそれを含むFlexGroupボリュームを作成するアグリゲートを手動で選択し、各アグリゲートの構成要素の数を指定することもできます。バケットを追加する場合：
+
*** 新しいバケット用のアグリゲートとコンスティチュエントを指定した場合、バケット用に新しいFlexGroupが作成されます。
*** 新しいバケットの集計と構成要素を指定しない場合、新しいバケットは既存のFlexGroupに追加されます。詳細については、xref:../flexgroup/index.html[FlexGroupボリューム管理]を参照してください。
+
バケット作成時にアグリゲートとコンスティチュエントを指定した場合、QoSポリシーグループ（デフォルトまたはカスタム）は適用されません。後から `vserver object-store-server bucket modify`コマンドを使用して適用できます。

+
 `vserver object-store-server bucket modify`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/vserver-object-store-server-show.html["ONTAPコマンド リファレンス"^]を参照してください。

+
*注：* Cloud Volumes ONTAPからバケットを提供している場合は、CLI手順を使用してください。基盤となるアグリゲートを手動で選択し、1つのノードのみを使用していることを確認することを強くお勧めします。両方のノードのアグリゲートを使用すると、ノードが地理的に離れたアベイラビリティゾーンに配置され、レイテンシの問題が発生しやすくなるため、パフォーマンスに影響する可能性があります。









== ONTAP CLIを使用したS3バケットの作成

. アグリゲートとFlexGroupコンポーネントを自分で選択する場合は、権限レベルをadvancedに設定します（それ以外の場合は、admin権限レベルで十分です）： `set -privilege advanced`
. バケットを作成します。
+
`vserver object-store-server bucket create -vserver <svm_name> -bucket <bucket_name> -size [integer{KB|MB|GB|TB|PB}] [-comment text] [additional_options]`

+
ストレージVM名は、データストレージVMまたは `Cluster`（ローカル階層化を設定する場合のシステムストレージVM名）のいずれかです。

+
パフォーマンスまたは使用量に基づいてバケットを作成する場合は、次のいずれかのオプションを使用します。

+
** サービス レベル
+
 `-storage-service-level`オプションに次のいずれかの値を指定します： `value`、 `performance`、または `extreme`。

** 階層化
+
 `-used-as-capacity-tier true`オプションを含めます。



+
使用するFlexGroupボリュームを作成するアグリゲートを指定する場合は、次のオプションを使用します。

+
**  `-aggr-list`パラメータは、FlexGroupボリュームの構成要素に使用されるアグリゲートのリストを指定します。
+
指定したエントリごとに、そのアグリゲート上にコンスティチュエントが1つ作成されます。同じアグリゲートを複数回指定すると、そのアグリゲート上に複数のコンスティチュエントを作成できます。

+
FlexGroupボリューム全体で一貫したパフォーマンスが得られるように、ディスク タイプとRAIDグループ構成をすべてのアグリゲートで同じにする必要があります。

**  `-aggr-list-multiplier`パラメータは、FlexGroupボリュームの作成時に `-aggr-list`パラメータでリストされているアグリゲートを反復処理する回数を指定します。
+
 `-aggr-list-multiplier`パラメータのデフォルト値は4です。



. 必要に応じてQoSポリシー グループを追加します。
+
`vserver object-store-server bucket modify -bucket _bucket_name_ -qos-policy-group _qos_policy_group_`

. バケットが作成されたことを確認します。
+
`vserver object-store-server bucket show [-instance]`



.例
次の例では、ストレージ VM `vs1`のサイズ `1TB`のバケットを作成し、アグリゲートを指定します：

この手順で説明されているコマンドの詳細については、link:https://docs.netapp.com/us-en/ontap-cli/["ONTAPコマンド リファレンス"^]を参照してください。

[listing]
----
cluster-1::*> vserver object-store-server bucket create -vserver svm1.example.com -bucket testbucket -aggr-list aggr1 -size 1TB
----


== System Managerを使用したS3バケットの作成

. S3対応Storage VMに新しいバケットを追加します。
+
.. *Storage > Buckets*をクリックし、*Add*をクリックします。
.. 名前を入力し、Storage VMを選択してサイズを入力します。
+
*** この時点で*保存*をクリックすると、次のデフォルト設定でバケットが作成されます：
+
**** すでに有効なグループ ポリシーがないかぎり、いずれのユーザにもバケットへのアクセスは許可されません。
+

NOTE: S3のrootユーザにはオブジェクト ストアへの無制限のアクセスが付与されるため、ONTAPオブジェクト ストレージの管理や権限の共有には使用しないでください。代わりに、管理者権限を割り当てたユーザまたはグループを作成してください。

**** システムで使用できる最も高いQuality of Service（パフォーマンス）レベル。


*** これらのデフォルト値でバケットを作成するには、*保存*をクリックします。








=== 追加の権限と制限の設定

バケットを構成するときに、[*その他のオプション*] をクリックしてオブジェクトのロック、ユーザー権限、パフォーマンスレベルの設定を構成することも、後でこれらの設定を変更することもできます。

S3オブジェクトストアをFabricPool階層化に使用する場合は、パフォーマンスサービスレベルではなく、*階層化に使用*（階層化されたデータに最適なパフォーマンスを備えた低コストのメディアを使用する）を選択することを検討してください。

バケットでバージョン管理が有効になっている場合、S3 クライアントを使用して、オブジェクトの特定のバージョンに Object Lock 保持期間を設定できます。オブジェクトの特定のバージョンをロックしても、オブジェクトの他のバージョンが削除されることは防止されません。後でリカバリできるようにオブジェクトのバージョン管理を有効にする場合は、*Enable Versioning* を選択します。バケットでオブジェクトロックを有効にすると、バージョン管理はデフォルトで有効になります。オブジェクトのバージョン管理の詳細については、 https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html["AmazonのS3バケットでバージョニングを使用する"]を参照してください。

9.14.1以降、S3バケットでオブジェクトロックがサポートされます。S3 Object Lockは、バケットの作成時に有効にする必要があります。既存のバケットではObject Lockを有効にできません。Object Lockは、ネイティブS3ユースケースでのみ使用できます。S3プロトコルを使用するように設定されたマルチプロトコルNASボリュームでは、SnapLockを使用してデータをWORMストレージにコミットする必要があります。S3オブジェクトロックには標準のSnapLockライセンスが必要です。このライセンスはlink:../system-admin/manage-licenses-concept.html["ONTAP One"]に含まれています。

ONTAP Oneより前は、SnapLockライセンスはSecurity and Complianceバンドルに含まれていました。Security and Complianceバンドルは現在提供されていませんが、引き続き有効です。現在は必須ではありませんが、既存のお客様はlink:../system-admin/download-nlf-task.html["ONTAP Oneにアップグレード"]を選択できます。バケットでオブジェクトロックを有効にする場合は、link:../system-admin/manage-license-task.html["SnapLockライセンスがインストールされていることを確認する"]が必要です。SnapLockライセンスがインストールされていない場合は、オブジェクトロックを有効にする前にlink:../system-admin/install-license-task.html["インストール"]する必要があります。

SnapLockライセンスがインストールされていることを確認したら、バケット内のオブジェクトが削除または上書きされるのを防ぐため、*オブジェクトのロックを有効にする*を選択します。ロックは、すべてのオブジェクトまたは特定のバージョンのオブジェクトに対して有効にできます。また、SnapLockコンプライアンスクロックがクラスタノードに対して初期化されている場合にのみ有効にできます。以下の手順に従ってください：

. SnapLockコンプライアンス クロックがクラスタ内のどのノードでも初期化されていない場合は、*Initialize SnapLock Compliance Clock*ボタンが表示されます。*Initialize SnapLock Compliance Clock*をクリックして、クラスタ ノードでSnapLockコンプライアンス クロックを初期化します。
. *ガバナンス*モードを選択すると、時間ベースのロックが有効になり、オブジェクトに対して_Write Once, Read Many (WORM)_権限が許可されます。_ガバナンス_モードでも、特定の権限を持つ管理者ユーザーはオブジェクトを削除できます。
. オブジェクトの削除と更新に関してより厳格なルールを適用する場合は、*Compliance*モードを選択してください。このオブジェクトロックモードでは、指定された保持期間の経過後にのみオブジェクトが期限切れになります。保持期間が指定されていない場合、オブジェクトは無期限にロックされたままになります。
. ロックを一定の期間だけ有効にする場合は、ロックの保持期間を日単位または年単位で指定します。
+

NOTE: ロックは、バージョン管理に対応しているS3バケットとバージョン管理に対応していないS3バケットに適用されます。オブジェクト ロックは、NASオブジェクトには適用されません。



バケットの保護と権限の設定、およびパフォーマンス サービス レベルを設定できます。


NOTE: 権限を設定するには、事前にユーザとグループを作成しておく必要があります。

詳細については、link:../s3-snapmirror/create-remote-mirror-new-bucket-task.html["新規バケット用ミラーの作成"]を参照してください。



=== バケットへのアクセスの確認

S3クライアント アプリケーション（ONTAP S3または外部のサードパーティ アプリケーション）では、以下を入力して、新しく作成したバケットへのアクセスを確認できます。

* S3サーバのCA証明書。
* ユーザのアクセス キーとシークレット キー。
* S3サーバのFQDN名とバケット名。

