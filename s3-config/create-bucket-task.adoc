---
permalink: s3-config/create-bucket-task.html 
sidebar: sidebar 
keywords: s3, bucket, system manager, 
summary: S3オブジェクトは_Buckets_に保持されます。他のディレクトリ内のディレクトリ内にファイルとしてネストされることはありません。 
---
= ONTAP S3バケットを作成する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
S3オブジェクトは_Buckets_に保持されます。他のディレクトリ内のディレクトリ内にファイルとしてネストされることはありません。

.開始する前に
S3サーバを含むStorage VMがすでに存在している必要があります。

.タスクの内容
* ONTAP 9 14.1以降では、S3 FlexGroupボリュームでバケットが作成されたときに、ボリュームの自動サイズ変更が有効になりました。これにより、既存および新規のFlexGroupボリュームでバケットを作成する際の過剰な容量割り当てが解消されます。FlexGroupボリュームのサイズは、次のガイドラインに基づいて、必要な最小サイズに変更されます。必要な最小サイズは、FlexGroupボリューム内のすべてのS3バケットの合計サイズです。
+
** ONTAP 9 14.1以降では、新しいバケットの作成時にS3 FlexGroupボリュームが作成されると、必要な最小サイズでFlexGroupボリュームが作成されます。
** S3 FlexGroupボリュームがONTAP 9 .14.1より前に作成された場合は、ONTAP 9のあとに最初に作成または削除されたバケットが表示されます。14.1では、FlexGroupボリュームのサイズが必要な最小サイズに変更されます。
** S3 FlexGroupボリュームがONTAP 9 .14.1より前に作成されたボリュームで、必要な最小サイズがすでに設定されている場合は、ONTAP 9 .14.1以降のバケットの作成または削除によってS3 FlexGroupボリュームのサイズが維持されます。


* ストレージサービスレベルは、事前定義されたアダプティブ QoS ポリシーグループで、 _value_、 _performion_、 _extreme デフォルトレベルがあります。デフォルトのストレージサービスレベルの代わりに、カスタムのQoSポリシーグループを定義してバケットに適用することもできます。ストレージサービス定義の詳細については、を参照してくださいlink:storage-service-definitions-reference.html["ストレージサービスの定義"]。パフォーマンス管理の詳細については、を参照してくださいlink:../performance-admin/index.html["パフォーマンス管理"]。ONTAP 9 8以降では、ストレージのプロビジョニング時にデフォルトでQoSが有効になります。プロビジョニングプロセス中またはあとで、QoSを無効にしたり、カスタムのQoSポリシーを選択したりできます。


* ローカルの容量階層化を設定する場合は、S3サーバが配置されているシステムStorage VMではなく、データStorage VMにバケットとユーザを作成します。
* リモートクライアントアクセスの場合は、S3対応Storage VMにバケットを設定する必要があります。S3対応でないStorage VMにバケットを作成した場合、そのバケットはローカルの階層化にのみ使用できます。
* ONTAP 9 .14.1以降では、この機能をlink:create-bucket-mcc-task.html["MetroCluster構成のミラーされたアグリゲートまたはミラーされていないアグリゲートにバケットを作成する"]使用できます。
* CLIでバケットを作成する場合は、次の2つのプロビジョニングオプションがあります。
+
** ONTAP Selectを基盤となるアグリゲートとFlexGroupコンポーネントにする（デフォルト）
+
*** ONTAPでは、アグリゲートが自動的に選択されることで、最初のバケットのFlexGroupボリュームが作成および設定されます。プラットフォームで使用可能な最も高いサービスレベルが自動的に選択されます。または、ストレージサービスレベルを指定できます。あとでStorage VMに追加するバケットには、同じFlexGroupボリュームが使用されます。
*** バケットを階層化に使用するかどうかを指定することもできます。その場合、ONTAPは階層化されたデータに最適なパフォーマンスを備えた低コストのメディアを選択しようとします。


** 使用するアグリゲートとFlexGroupコンポーネントを選択します（advanced権限のコマンドオプションが必要です）。バケットと包含FlexGroupボリュームを作成するアグリゲートを手動で選択し、各アグリゲートのコンスティチュエントの数を指定できます。バケットを追加する場合：
+
*** 新しいバケット用のアグリゲートとコンスティチュエントを指定すると、そのバケット用に新しいFlexGroupが作成されます。
*** 新しいバケット用のアグリゲートとコンスティチュエントを指定しない場合、新しいバケットは既存のFlexGroupに追加されます。詳細については、を参照してください xref:../flexgroup/index.html[FlexGroupホリユウムノカンリ] 。
+
バケットの作成時にアグリゲートとコンスティチュエントを指定した場合、デフォルトまたはカスタムのQoSポリシーグループは適用されません。これは、コマンドを使用してあとで実行できます `vserver object-store-server bucket modify`。

+
の詳細については `vserver object-store-server bucket modify`、をlink:https://docs.netapp.com/us-en/ontap-cli/vserver-object-store-server-show.html["ONTAPコマンド リファレンス"^]参照してください。

+
*注：* Cloud Volumes ONTAP からバケットを処理する場合は、CLI手順 を使用してください。使用するノードが1つだけになるように、基盤となるアグリゲートを手動で選択することを強く推奨します。両方のノードのアグリゲートを使用すると、ノードが地理的に離れたアベイラビリティゾーンに配置され、レイテンシの問題の影響を受けやすくなるため、パフォーマンスに影響を与える可能性があります。









== ONTAP CLIを使用したS3バケットの作成

. アグリゲートとFlexGroupコンポーネントを自分で選択する場合は、権限レベルをadvancedに設定します（それ以外の場合はadmin権限レベルで十分です）。 `set -privilege advanced`
. バケットを作成します。
+
`vserver object-store-server bucket create -vserver _svm_name_ -bucket _bucket_name_ [-size integer[KB|MB|GB|TB|PB]] [-comment text] [additional_options]`

+
ローカルでの階層化を設定する場合は、Storage VMの名前にデータStorage VMまたは（システムStorage VMの名前）を指定できます `Cluster`。

+
パフォーマンスまたは使用量に基づいてバケットを作成する場合は、次のいずれかのオプションを使用します。

+
** サービスレベル
+
オプションに `-storage-service-level`、 `performance`、またはの `extreme`いずれかの値を指定します `value`。

** 階層化
+
オプションを含め `-used-as-capacity-tier true`ます。



+
基盤となるFlexGroupボリュームを作成するアグリゲートを指定する場合は、次のオプションを使用します。

+
** パラメータは `-aggr-list`、FlexGroupボリュームのコンスティチュエントに使用するアグリゲートのリストを指定します。
+
リスト内の各エントリによって、指定したアグリゲート上にコンスティチュエントが1つ作成されます。同じアグリゲートを複数回指定すると、そのアグリゲート上に複数のコンスティチュエントを作成できます。

+
FlexGroupボリューム全体で一貫したパフォーマンスが得られるように、ディスク タイプとRAIDグループ構成をすべてのアグリゲートで同じにする必要があります。

** パラメータは `-aggr-list-multiplier`、FlexGroupボリュームの作成時にパラメータで指定したアグリゲートを繰り返し実行する回数を指定します `-aggr-list`。
+
パラメータのデフォルト値 `-aggr-list-multiplier`は4です。



. 必要に応じてQoSポリシーグループを追加します。
+
`vserver object-store-server bucket modify -bucket _bucket_name_ -qos-policy-group _qos_policy_group_`

. バケットの作成を確認します。
+
`vserver object-store-server bucket show [-instance]`



.例
次の例では、Storage VM用のサイズの `1TB`バケットを作成し `vs1`、アグリゲートを指定しています。

この手順で説明されているコマンドの詳細については、をlink:https://docs.netapp.com/us-en/ontap-cli/["ONTAPコマンド リファレンス"^]参照してください。

[listing]
----
cluster-1::*> vserver object-store-server bucket create -vserver svm1.example.com -bucket testbucket -aggr-list aggr1 -size 1TB
----


== System Managerを使用したS3バケットの作成

. S3対応Storage VMに新しいバケットを追加する。
+
.. [ * ストレージ ] 、 [ バケット ] の順にクリックし、 [ * 追加 ] をクリックします。
.. 名前を入力し、Storage VMを選択してサイズを入力します。
+
*** この時点で * Save * をクリックすると、次のデフォルト設定でバケットが作成されます。
+
**** グループポリシーがすでに有効になっていないかぎり、バケットへのアクセスはユーザに許可されません。
+

NOTE: オブジェクトストレージへのアクセスが無制限になるため、S3 rootユーザを使用してONTAPオブジェクトストレージの管理と権限の共有を行わないでください。代わりに、管理Privilegesを割り当てたユーザまたはグループを作成します。

**** システムで使用可能な最高のサービス品質（パフォーマンス）レベル。


*** [保存]*をクリックして、これらのデフォルト値でバケットを作成します。








=== 追加の権限と制限を設定する

バケットの設定時に*[その他のオプション]*をクリックすると、オブジェクトロック、ユーザ権限、パフォーマンスレベルを設定できます。設定はあとで変更することもできます。

S3 オブジェクトストアを FabricPool の階層化に使用する場合は、パフォーマンスサービスレベルではなく、階層化に * 使用（階層化データのパフォーマンスが最適な低コストのメディアを使用）を選択することを検討してください。

バケットでバージョン管理が有効になっている場合は、S3クライアントを使用してオブジェクトの特定のバージョンにオブジェクトロックの保持期限を設定できます。オブジェクトの特定のバージョンをロックしても、そのオブジェクトの他のバージョンが削除されることはありません。後でリカバリするためにオブジェクトのバージョン管理を有効にする場合は、*バージョン管理を有効にする*を選択します。バケットでオブジェクトのロックを有効にすると、バージョン管理がデフォルトで有効になります。オブジェクトのバージョン管理の詳細については、を参照して https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html["AmazonのS3バケットでのバージョン管理の使用"]ください。

9.14.1以降では、S3バケットでオブジェクトロックがサポートされます。バケットの作成時にS3オブジェクトロックを有効にする必要があります。オブジェクトロックは既存のバケットでは有効にできません。オブジェクトロックはS3ネイティブのユースケースでのみ使用できます。S3プロトコルを使用するように設定されたマルチプロトコルNASボリュームでは、SnapLockを使用してWORMストレージにデータをコミットする必要があります。S3オブジェクトロックには標準のSnapLockライセンスが必要です。このライセンスはに含まれていlink:../system-admin/manage-licenses-concept.html["ONTAP One"]ます。

ONTAP Oneより前のバージョンでは、 SnapLockライセンスはセキュリティおよびコンプライアンスバンドルに含まれていました。セキュリティおよびコンプライアンスバンドルは現在提供されていませんが、引き続き有効です。現在は必須ではありませんが、既存のお客様は選択できますlink:../system-admin/download-nlf-task.html["ONTAP Oneへのアップグレード"]。、link:../system-admin/install-license-task.html["インストール"]オブジェクトのロックを有効にする前に、これを実行してください。

SnapLockライセンスがインストールされていることを確認したら、バケット内のオブジェクトが削除または上書きされないように保護するには、*[オブジェクトのロックを有効にする]*を選択します。ロックは、すべてのバージョンまたは特定のバージョンのオブジェクトで有効にできます。また、クラスタノードのSnapLock Complianceクロックが初期化されている場合にのみ有効にできます。次の手順を実行します。

. クラスタのいずれのノードでもSnapLockコンプライアンスクロックが初期化されていない場合は、*[Initialize SnapLock Compliance Clock]*ボタンが表示されます。クラスタノードのSnapLockコンプライアンスクロックを初期化するには、*[ SnapLockコンプライアンスクロックの初期化]*をクリックします。
. オブジェクトに対して_ Write Once、Read Many（WORM）_権限を許可する時間ベースのロックを有効にするには、* Governance *モードを選択します。Governance_modeであっても、特定の権限を持つ管理者ユーザがオブジェクトを削除できます。
. オブジェクトに対してより厳密な削除ルールと更新ルールを割り当てる場合は、*準拠*モードを選択します。このモードのオブジェクトロックでは、指定した保持期間が終了した時点でのみオブジェクトを期限切れにできます。保持期間を指定しないかぎり、オブジェクトは無期限にロックされたままになります。
. 一定期間ロックを有効にする場合は、ロックの保持期間を日単位または年単位で指定します。
+

NOTE: ロックは、バージョン管理に対応しているS3バケットとバージョン管理に対応していないS3バケットに適用されます。オブジェクト ロックは、NASオブジェクトには適用されません。



バケットの保護と権限の設定、およびパフォーマンス サービス レベルを設定できます。


NOTE: 権限を設定するには、事前にユーザとグループを作成しておく必要があります。

詳細については、を参照してください link:../s3-snapmirror/create-remote-mirror-new-bucket-task.html["新しいバケットのミラーを作成"]。



=== バケットへのアクセスを確認

S3クライアントアプリケーション（ONTAP S3または外部のサードパーティアプリケーション）では、次のように入力して、新しく作成したバケットへのアクセスを確認できます。

* S3サーバのCA証明書。
* ユーザのアクセスキーとシークレットキー。
* S3サーバのFQDN名とバケット名。

