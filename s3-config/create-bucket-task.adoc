---
permalink: s3-config/create-bucket-task.html 
sidebar: sidebar 
keywords: s3, bucket, system manager, 
summary: S3オブジェクトは_Buckets_に保持されます。他のディレクトリ内のディレクトリ内にファイルとしてネストされることはありません。 
---
= バケットを作成する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
S3オブジェクトは_Buckets_に保持されます。他のディレクトリ内のディレクトリ内にファイルとしてネストされることはありません。

.作業を開始する前に
S3サーバを含むStorage VMがすでに存在している必要があります。

.このタスクについて
* ONTAP 9.14.1以降では、S3 FlexGroupボリュームでバケットが作成されたときに自動サイズ変更が有効になりました。これにより、既存および新規のFlexGroupボリュームでバケットを作成する際の過剰な容量割り当てが解消されます。FlexGroupボリュームのサイズは、次のガイドラインに基づいて、必要な最小サイズに変更されます。必要な最小サイズは、FlexGroupボリューム内のすべてのS3バケットの合計サイズです。
+
** ONTAP 9.14.1以降では、新しいバケットの作成時にS3 FlexGroupボリュームを作成すると、必要な最小サイズでFlexGroupボリュームが作成されます。
** S3 FlexGroupボリュームがONTAP 9.14.1より前に作成された場合は、ONTAP 9.14.1のあとに最初に作成または削除されたバケットによって、FlexGroupボリュームのサイズが必要な最小サイズに変更されます。
** ONTAP 9.14.1より前に作成されたS3 FlexGroupボリュームに必要な最小サイズがすでに設定されている場合は、ONTAP 9.14.1以降のバケットの作成または削除でS3 FlexGroupボリュームのサイズが維持されます。


* ストレージサービスレベルは、事前定義されたアダプティブ QoS ポリシーグループで、 _value_、 _performion_、 _extreme デフォルトレベルがあります。デフォルトのストレージサービスレベルの代わりに、カスタムのQoSポリシーグループを定義してバケットに適用することもできます。ストレージサービス定義の詳細については、を参照してくださいlink:storage-service-definitions-reference.html["ストレージサービスの定義"]。パフォーマンス管理の詳細については、を参照してくださいlink:../performance-admin/index.html["パフォーマンス管理"]。ONTAP 9 8以降では、ストレージのプロビジョニング時にデフォルトでQoSが有効になります。プロビジョニングプロセス中またはあとで、QoSを無効にしたり、カスタムのQoSポリシーを選択したりできます。


* ローカルの容量階層化を設定する場合は、S3サーバが配置されているシステムStorage VMではなく、データStorage VMにバケットとユーザを作成します。
* リモートクライアントアクセスの場合は、 S3 対応の Storage VM でバケットを設定する必要があります。S3 対応でない Storage VM にバケットを作成した場合、そのバケットはローカル階層化にのみ使用できます。
* ONTAP 9.14.1以降では、次のことが可能です。 link:create-bucket-mcc-task.html["MetroCluster構成のミラーされたアグリゲートまたはミラーされていないアグリゲートにバケットを作成する"]。
* CLIでは、バケットを作成する際に、次の2つのプロビジョニングオプションを選択できます。
+
** 基盤となるアグリゲートと FlexGroup コンポーネントを ONTAP Select に提供（デフォルト）
+
*** ONTAP は、アグリゲートを自動的に選択することで、最初のバケット用の FlexGroup ボリュームを作成して設定します。プラットフォームに使用できる最も高いサービスレベルが自動的に選択されるほか、ストレージサービスレベルを指定することもできます。あとでStorage VMに追加するバケットには、同じFlexGroupボリュームが使用されます。
*** また、バケットを階層化に使用するかどうかを指定することもできます。この場合、 ONTAP は階層化データのパフォーマンスが最適な低コストのメディアを選択しようとします。


** 使用するアグリゲートとFlexGroupコンポーネントを選択します（advanced権限のコマンドオプションが必要です）。バケットと包含FlexGroupボリュームを作成するアグリゲートを手動で選択し、各アグリゲートのコンスティチュエントの数を指定できます。バケットを追加する場合：
+
*** 新しいバケットにアグリゲートとコンスティチュエントを指定すると、新しいバケット用の新しい FlexGroup が作成されます。
*** 新しいバケットにアグリゲートとコンスティチュエントを指定しない場合、新しいバケットが既存の FlexGroup に追加されます。
を参照してください xref:../flexgroup/index.html[FlexGroup ボリューム管理] を参照してください。
+
バケットの作成時にアグリゲートとコンスティチュエントを指定した場合、デフォルトまたはカスタムの QoS ポリシーグループは適用されません。これは、を使用してあとで実行できます `vserver object-store-server bucket modify` コマンドを実行します

+
を参照してください  を参照してください。

+
*注：* Cloud Volumes ONTAP からバケットを処理する場合は、CLI手順 を使用してください。基盤となるアグリゲートを手動で選択し、いずれかのノードだけを使用することを強く推奨します。両方のノードのアグリゲートを使用すると、ノードが地理的に分離された可用性ゾーンに配置されるため、レイテンシの問題の影響を受けやすくなるため、パフォーマンスに影響を及ぼす可能性があります。









== ONTAP CLIを使用したS3バケットの作成

. アグリゲートとFlexGroup コンポーネントを自分で選択する場合は、権限レベルをadvancedに設定します（それ以外の場合はadmin権限レベルで十分です）。 `set -privilege advanced`
. バケットを作成します。
+
`vserver object-store-server bucket create -vserver _svm_name_ -bucket _bucket_name_ [-size integer[KB|MB|GB|TB|PB]] [-comment text] [additional_options]`

+
Storage VM名には、データStorage VMまたは `Cluster` （システムStorage VM名）（ローカルの階層化を設定する場合）。

+
オプションを指定しない場合、ONTAPは800GBのバケットを作成し、サービスレベルをシステムで使用可能な最も高いレベルに設定します。

+
パフォーマンスまたは使用量に基づいて ONTAP でバケットを作成する場合は、次のいずれかのオプションを使用します。

+
** サービスレベル
+
を含めます `-storage-service-level` オプションに次のいずれかの値を指定します。 `value`、 `performance`または `extreme`。

** 階層化
+
を含めます `-used-as-capacity-tier true` オプション



+
基盤となる FlexGroup ボリュームを作成するアグリゲートを指定する場合は、次のオプションを使用します。

+
** 。 `-aggr-list` パラメータは、FlexGroup ボリュームのコンスティチュエントに使用するアグリゲートのリストを指定します。
+
指定したエントリごとに、そのアグリゲート上にコンスティチュエントが 1 つ作成されます。同じアグリゲートを複数回指定すると、そのアグリゲート上に複数のコンスティチュエントを作成できます。

+
FlexGroup 全体で一貫したパフォーマンスが得られるように、すべてのアグリゲートで同じディスクタイプと RAID グループ構成を使用する必要があります。

** 。 `-aggr-list-multiplier` パラメータは、に表示されるアグリゲートを反復する回数を指定します `-aggr-list` FlexGroup ボリューム作成時のパラメータ。
+
のデフォルト値 `-aggr-list-multiplier` パラメータは4です。



. 必要に応じて QoS ポリシーグループを追加します。
+
`vserver object-store-server bucket modify -bucket _bucket_name_ -qos-policy-group _qos_policy_group_`

. バケットの作成を確認します。
+
`vserver object-store-server bucket show [-instance]`



.例
次の例は、Storage VMのバケットを作成します。 `vs1` サイズ `1TB` アグリゲートを指定する場合

[listing]
----
cluster-1::*> vserver object-store-server bucket create -vserver svm1.example.com -bucket testbucket -aggr-list aggr1 -size 1TB
----


== System Managerを使用したS3バケットの作成

. S3 対応 Storage VM に新しいバケットを追加
+
.. [ * ストレージ ] 、 [ バケット ] の順にクリックし、 [ * 追加 ] をクリックします。
.. 名前を入力し、 Storage VM を選択してサイズを入力します。
+
*** この時点で * Save * をクリックすると、次のデフォルト設定でバケットが作成されます。
+
**** どのグループポリシーも有効になっていないかぎり、バケットへのアクセスはユーザに許可されません。
+

NOTE: S3 root ユーザを使用して ONTAP オブジェクトストレージを管理したり権限を共有したりしないでください。オブジェクトストアに無制限にアクセスできます。代わりに、割り当てた管理者権限を持つユーザまたはグループを作成してください。

**** システムで最も利用可能なサービス品質（パフォーマンス）レベル。


*** [保存]*をクリックして、これらのデフォルト値でバケットを作成します。








=== 追加の権限と制限を設定する

バケットの設定時に*[その他のオプション]*をクリックすると、オブジェクトロック、ユーザ権限、パフォーマンスレベルを設定できます。設定はあとで変更することもできます。

S3 オブジェクトストアを FabricPool の階層化に使用する場合は、パフォーマンスサービスレベルではなく、階層化に * 使用（階層化データのパフォーマンスが最適な低コストのメディアを使用）を選択することを検討してください。

後でリカバリするためにオブジェクトのバージョン管理を有効にする場合は、*バージョン管理を有効にする*を選択します。バケットでオブジェクトのロックを有効にすると、バージョン管理がデフォルトで有効になります。オブジェクトのバージョン管理の詳細については、を参照してください。 https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html["AmazonのS3バケットでのバージョン管理の使用"]。

9.14.1以降では、S3バケットでオブジェクトロックがサポートされます。S3オブジェクトロックには標準のSnapLockライセンスが必要です。このライセンスはに含まれていlink:../system-admin/manage-licenses-concept.html["ONTAP One"]ます。ONTAP Oneよりも前のリリースでは、SnapLockライセンスはSecurity and Compliance Bundleに含まれていました。Security and Compliance Bundleの提供は終了しましたが、引き続き有効です。現在は必須ではありませんが、既存のお客様は選択できます https://docs.netapp.com/us-en/ontap/system-admin/download-nlf-task.html["ONTAP Oneへのアップグレード"]。バケットでオブジェクトのロックを有効にする場合は、を実行して https://docs.netapp.com/us-en/ontap/system-admin/manage-license-task.html["SnapLockライセンスがインストールされていることの確認"]ください。SnapLockライセンスがインストールされていない場合は https://docs.netapp.com/us-en/ontap/system-admin/install-license-task.html["をインストールします"]、オブジェクトロックを有効にする前にライセンスが必要です。SnapLockライセンスがインストールされていることを確認したら、バケット内のオブジェクトが削除または上書きされないように保護するには、*[オブジェクトのロックを有効にする]*を選択します。ロックは、すべてのバージョンまたは特定のバージョンのオブジェクトで有効にできます。また、クラスタノードのSnapLock Complianceクロックが初期化されている場合にのみ有効にできます。次の手順を実行します。

. クラスタのいずれのノードでもSnapLockコンプライアンスクロックが初期化されていない場合は、*[Initialize SnapLock Compliance Clock]*ボタンが表示されます。クラスタノードのSnapLockコンプライアンスクロックを初期化するには、*[ SnapLockコンプライアンスクロックの初期化]*をクリックします。
. オブジェクトに対して_ Write Once、Read Many（WORM）_権限を許可する時間ベースのロックを有効にするには、* Governance *モードを選択します。Governance_modeであっても、特定の権限を持つ管理者ユーザがオブジェクトを削除できます。
. オブジェクトに対してより厳密な削除ルールと更新ルールを割り当てる場合は、*準拠*モードを選択します。このモードのオブジェクトロックでは、指定した保持期間が終了した時点でのみオブジェクトを期限切れにできます。保持期間を指定しないかぎり、オブジェクトは無期限にロックされたままになります。
. 一定期間ロックを有効にする場合は、ロックの保持期間を日単位または年単位で指定します。
+

NOTE: ロックは、バージョン管理に対応しているS3バケットとバージョン管理に対応していないS3バケットに適用されます。オブジェクトのロックは、NASオブジェクトには適用されません。



バケットの保護と権限の設定、およびパフォーマンスサービスレベルを設定できます。


NOTE: 権限を設定する前に、ユーザとグループを作成しておく必要があります。

詳細については、を参照してください link:../s3-snapmirror/create-remote-mirror-new-bucket-task.html["新しいバケット用のミラーを作成します"]。



=== バケットへのアクセスを確認

S3クライアントアプリケーション（ONTAP S3または外部のサードパーティアプリケーション）では、次のように入力して、新しく作成したバケットへのアクセスを確認できます。

* S3 サーバの CA 証明書。
* ユーザのアクセスキーとシークレットキー。
* S3 サーバの FQDN 名とバケット名。

