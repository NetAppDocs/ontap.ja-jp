---
permalink: s3-multiprotocol/enable-access-nas-data-task.html 
sidebar: sidebar 
keywords: tr-4814, s3, svm, nfs, smb, dns, authentication, protocol, configuration, nas, certificate, authority, installation, lifs 
summary: S3プロトコル アクセスを有効にするには、NAS対応のSVMがS3対応のサーバと同じ要件を満たしていることを確認する必要があります。具体的には、オブジェクト ストア サーバを追加し、ネットワークと認証の要件を確認します。 
---
= ONTAP SVM上のNASデータへのS3プロトコル アクセスを有効にする
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
S3プロトコル アクセスを有効にするには、NAS対応のSVMがS3対応のサーバと同じ要件を満たしていることを確認する必要があります。具体的には、オブジェクト ストア サーバを追加し、ネットワークと認証の要件を確認します。

ONTAPを新規にインストールした場合は、クライアントにNASデータを提供するようにSVMを設定してから、SVMへのS3プロトコル アクセスを有効にすることを推奨します。NASプロトコルの設定については、以下を参照してください。

* link:../nfs-config/index.html["NFSの設定"]
* link:../smb-config/index.html["SMB設定"]


.開始する前に
S3プロトコルを有効にする前に、次の設定について確認する必要があります。

* S3プロトコルおよび希望するNASプロトコル（NFS、SMB、またはその両方）のライセンスが有効になっている。
* SVMに希望するプロトコルが設定されている。
* NFSサーバ、SMBサーバ、またはその両方が存在している。
* DNSおよびその他の必要なサービスが設定されている。
* NASデータがクライアント システムにエクスポートまたは共有されている。


.タスク概要
S3クライアントからS3対応SVMへのHTTPSトラフィックを有効にするには、認証局（CA）証明書が必要です。次の3種類のCA証明書を使用できます。

* SVM上の新しいONTAP自己署名証明書。
* SVM上の既存のONTAP自己署名証明書。
* サードパーティの証明書。


S3/NASバケットには、NASデータの提供に使用するものと同じデータLIFを使用できます。特定のIPアドレスが必要な場合は、link:../s3-config/create-data-lifs-task.html["データLIFの作成"]を参照してください。LIFでS3データトラフィックを有効にするには、S3サービスデータポリシーが必要です。SVMの既存のサービスポリシーを変更して、S3を含めることができます。

S3オブジェクト サーバを作成するときは、S3サーバ名の完全修飾ドメイン名（FQDN）を確認しておきます。クライアントはFQDNでS3にアクセスします。S3サーバのFQDNをバケット名で始めることはできません。

[role="tabbed-block"]
====
.System Manager
--
. NASプロトコルが設定されているStorage VMでS3を有効にします。
+
.. *ストレージ > ストレージ VM* をクリックし、NAS 対応のストレージ VM を選択して、設定をクリックし、S3 の下の image:icon_gear.gif["アクションアイコン"] をクリックします。
.. 証明書タイプを選択します。システムで生成された証明書と独自の証明書のどちらを選択した場合も、その証明書がクライアント アクセスで必要になります。
.. ネットワーク インターフェイスを入力します。


. システム生成の証明書を選択した場合は、新しいストレージVMの作成が確認されると証明書情報が表示されます。*Download*をクリックし、クライアントがアクセスできるように保存してください。
+
** 今後シークレット キーは表示されません。
** 証明書情報が再度必要になった場合は、*ストレージ > ストレージ VM* をクリックし、ストレージ VM を選択して、*設定* をクリックします。




--
.CLI
--
. SVM で S3 プロトコルが許可されていることを確認します：+
`vserver show -fields allowed-protocols`
. この SVM の公開キー証明書を記録します。+ 新しい ONTAP 自己署名証明書が必要な場合は、link:../s3-config/create-install-ca-certificate-svm-task.html["CA証明書の作成とSVMへのインストール"]を参照してください。
. サービス データ ポリシーを更新します。
+
.. SVMのサービス データ ポリシーを表示する +
`network interface service-policy show -vserver _svm_name_`
+
 `network interface service-policy show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-service-policy-show.html["ONTAPコマンド リファレンス"^]を参照してください。

..  `data-core`および `data-s3-server services`が存在しない場合は追加します。+
`network interface service-policy add-service -vserver _svm_name_ -policy _policy_name_ -service data-core,data-s3-server`


. SVM 上のデータ LIF が要件を満たしていることを確認します。+
`network interface show -vserver _svm_name_`
+
 `network interface show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-show.html["ONTAPコマンド リファレンス"^]を参照してください。

. S3 サーバーを作成します：+
`vserver object-store-server create -vserver _svm_name_ -object-store-server _s3_server_fqdn_ -certificate-name _ca_cert_name_ -comment text [additional_options]`


追加のオプションは、S3サーバの作成時または作成後いつでも指定できます。

* HTTPSはデフォルトでポート443で有効になっています。ポート番号は-secure-listener-portオプションで変更できます。+ HTTPSを有効にすると、SSL/TLSとの適切な統合にCA証明書が必要になります。ONTAP 9.15.1以降、S3オブジェクトストレージでTLS 1.3がサポートされます。
* HTTP はデフォルトで無効になっています。有効にすると、サーバーはポート 80 でリッスンします。-is-http-enabled オプションを使用して有効にするか、-listener-port オプションを使用してポート番号を変更できます。+ HTTP が有効になっている場合、すべての要求と応答はネットワーク経由でクリアテキストで送信されます。


. S3 が希望どおりに設定されていることを確認します：+
`vserver object-store-server show`


*例* + 次のコマンドは、すべてのオブジェクト ストレージ サーバーの構成値を確認します：+
`cluster1::> vserver object-store-server show`

[listing]
----
Vserver: vs1

                      Object Store Server Name: s3.example.com
                          Administrative State: up
                        Listener Port For HTTP: 80
                Secure Listener Port For HTTPS: 443
                                  HTTP Enabled: false
                                 HTTPS Enabled: true
             Certificate for HTTPS Connections: svm1_ca
                                       Comment: Server comment
----
--
====
.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/network-interface-service-policy-add-service.html["network interface service-policy add-service"^]

