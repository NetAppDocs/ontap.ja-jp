---
permalink: s3-multiprotocol/index.html 
sidebar: sidebar 
keywords: multiprotocol, s3, configuration, overview, nfs, smb 
summary: ONTAP 9.12.1以降では、S3プロトコルを実行するクライアントが、NFSプロトコルおよびSMBプロトコルを使用するクライアントに提供されているデータに再フォーマットせずにアクセスできるようにすることができます。 
---
= S3マルチプロトコルの概要
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.12.1以降では、S3プロトコルを実行するクライアントが、NFSプロトコルおよびSMBプロトコルを使用するクライアントに提供されているデータに再フォーマットせずにアクセスできるようにすることができます。この機能により、NASデータは引き続きNASクライアントに提供され、S3アプリケーション（データマイニングや人工知能など）を実行するS3クライアントにオブジェクトデータが提供されます。

S3マルチプロトコル機能は次の2つのユースケースに対応します。

. S3クライアントを使用した既存のNASデータへのアクセス
+
既存のデータが従来のNASクライアント（NFSまたはSMB）を使用して作成され、NASボリューム（FlexVol またはFlexGroup ボリューム）にある場合、S3クライアント上の分析ツールを使用してこのデータにアクセスできるようになりました。

. NASとS3の両方のプロトコルを使用したI/O処理に対応できる、最新のクライアント用のバックエンドストレージです
+
NASプロトコルとS3プロトコルの両方を使用して同じデータの読み取りと書き込みが可能なSparkやKafkaなどのアプリケーションに、統合アクセスを提供できるようになりました。





== S3マルチプロトコルの仕組み

ONTAP マルチプロトコルを使用すると、同じデータセットをファイル階層またはバケット内のオブジェクトとして表示できます。そのために、ONTAP はS3オブジェクト要求を使用してNASストレージ内のファイルの作成、読み取り、削除、および列挙をS3クライアントに許可する「S3 NASバケット」を作成します。このマッピングは、NASセキュリティ設定に準拠しており、ファイルおよびディレクトリのアクセス権限を監視し、必要に応じてセキュリティ監査証跡に書き込みます。

このマッピングは、指定されたNASディレクトリ階層をS3バケットとして提供することで実現されます。ディレクトリ階層内の各ファイルは、マップされたディレクトリから下の位置に相対的な名前を持つS3オブジェクトとして表され、ディレクトリ境界はスラッシュ文字（/）で表されます。

ONTAPで定義された通常のS3ユーザは、このストレージにアクセスできます。このストレージは、NASディレクトリにマッピングされるバケットに定義されたバケットポリシーで管理されます。これを可能にするには、S3ユーザとSMB / NFSユーザ間にマッピングを定義する必要があります。SMB / NFSユーザのクレデンシャルはNAS権限のチェックに使用され、これらのアクセスから発生する監査レコードに含まれます。

SMBクライアントまたはNFSクライアントが作成すると、ファイルはすぐにディレクトリに配置され、クライアントからはデータが書き込まれる前に参照できます。S3クライアントはセマンティクスが異なることを要求します。セマンティクスでは、新しいオブジェクトはすべてのデータが書き込まれるまでネームスペースに表示されません。S3からNASストレージへのマッピングではS3のセマンティクスを使用してファイルが作成され、S3の作成コマンドが完了するまでファイルは外部には表示されません。



== S3 NASバケットのデータ保護

S3 NASの「バケット」は、S3クライアントのNASデータの単なるマッピングであり、標準のS3バケットではありません。そのため、NetApp SnapMirror S3機能を使用してS3 NASバケットを保護する必要はありません。代わりに、SnapMirrorの非同期ボリュームレプリケーションを使用して、S3 NASバケットを含むボリュームを保護できます。SnapMirror同期およびSVMディザスタリカバリはサポートされません。

ONTAP 9.14.1以降では、MetroCluster IPおよびFC構成のミラーされたアグリゲートとミラーされていないアグリゲートでS3 NASバケットがサポートされます。

詳細はこちらをご覧ください link:../data-protection/snapmirror-disaster-recovery-concept.html#data-protection-relationships["SnapMirror非同期"]。



== S3 NASバケットの監査

S3 NASバケットは従来のS3バケットではないため、S3監査を設定してアクセスを監査することはできません。の詳細を確認してください link:../s3-audit/index.html["S3監査"]。

ただし、S3 NASバケットにマッピングされているNASファイルとディレクトリは、従来のONTAP 監査手順を使用してアクセスイベントを監査できます。したがって、S3処理ではNAS監査イベントがトリガーされますが、次の例外があります。

* S3ポリシーの設定（グループまたはバケットポリシー）によってS3クライアントアクセスが拒否された場合、イベントのNAS監査は開始されません。これは、SVMの監査チェックの前にS3権限がチェックされるためです。
* S3 GET要求のターゲットファイルのサイズが0の場合、GET要求には0個のコンテンツが返され、読み取りアクセスはログに記録されません。
* S3 GET要求のターゲットファイルがユーザにトラバース権限のないフォルダにある場合は、アクセスの試行が失敗し、イベントはログに記録されません。


詳細はこちら link:../nas-audit/index.html["SVMでNASイベントを監査する"]。



== S3およびNASの相互運用性

ONTAP S3 NASバケットは、ここに記載されている点を除いて、NASとS3の標準機能をサポートします。



=== NAS機能は、現在S3 NASバケットではサポートされていません

FabricPool の大容量階層:: S3 NASバケットをFabricPool の大容量階層として設定することはできません。




=== S3 NASバケットでは現在、S3機能はサポートされていません

AWSユーザメタデータ::
+
--
* S3ユーザメタデータの一部として受信したキーと値のペアは、現在のリリースのオブジェクトデータと一緒にディスクに格納されません。
* プレフィックスが「x-amz-meta」の要求ヘッダーは無視されます。


--
AWSタグ::
+
--
* PUT Object要求とMultipart Initiate要求では、プレフィックスが「x-amz-tagging」のヘッダーは無視されます。
* 既存のファイル（つまり、「tagging」クエリー文字列を持つPUT、GET、Deleteの各要求）でタグを更新する要求は、エラーで拒否されます。


--
バージョン管理:: バージョン管理をバケットのマッピング設定で指定することはできません。
+
--
* バージョンがnullでない仕様（versionId=xyzクエリ文字列）を含む要求は、エラー応答を受信します。
* バケットのバージョン管理状態に影響する要求は拒否され、エラーが発生します。


--
マルチパート処理:: 次の操作はサポートされません。
+
--
* AbortMultipartUpload の略
* CompleteMultipartUpload
* CreateMultipartUpload を実行します
* ListMultipartUpload の略


--

