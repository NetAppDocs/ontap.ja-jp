---
sidebar: sidebar 
permalink: s3-snapmirror/create-cloud-backup-new-bucket-task.html 
keywords: create, backup, relationship, new, bucket 
summary: 新しい S3 バケットを作成すると、SnapMirror S3 ターゲット バケットにすぐにバックアップできます。このターゲット バケットは、オブジェクト ストア プロバイダー（StorageGRID システムまたは Amazon S3 デプロイメント）上にあります。 
---
= 新しいONTAP S3バケットのクラウドバックアップ関係を作成する
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
新しい S3 バケットを作成すると、SnapMirror S3 ターゲット バケットにすぐにバックアップできます。このターゲット バケットは、オブジェクト ストア プロバイダー（StorageGRID システムまたは Amazon S3 デプロイメント）上にあります。

.開始する前に
* オブジェクト ストア プロバイダの有効なアカウント クレデンシャルと設定情報が必要です。
* ソース システムにクラスタ間ネットワーク インターフェイスとIPspaceが設定されている必要があります。
* • ソース ストレージ VM の DNS 構成は、ターゲットの FQDN を解決できる必要があります。


[role="tabbed-block"]
====
.System Manager
--
. Storage VMを編集してユーザを追加し、グループにユーザを追加します。
+
.. *ストレージ > ストレージ VM* をクリックし、ストレージ VM をクリックして、*設定* をクリックし、*S3* の下の image:icon_pencil.gif["編集アイコン"] をクリックします。
+
詳細については、link:../task_object_provision_add_s3_users_groups.html["S3のユーザとグループの追加"]を参照してください。



. ソース システムにクラウド オブジェクト ストアを追加します。
+
.. *保護 > 概要*をクリックし、*クラウドオブジェクトストア*を選択します。
.. *追加*をクリックし、*Amazon S3*または*StorageGRID*を選択します。
.. 次の値を入力します。
+
*** クラウド オブジェクト ストアの名前
*** URLの形式（パスまたは仮想ホスト）
*** Storage VM（S3対応）
*** オブジェクト ストアのサーバ名（FQDN）
*** オブジェクト ストアの証明書
*** アクセス キー
*** シークレット キー
*** コンテナ（バケット）の名前




. 既存のSnapMirror S3ポリシーがなく、デフォルトポリシーを使用したくない場合は、SnapMirror S3ポリシーを作成してください：
+
.. *Protection > Overview* をクリックし、*Local Policy Settings* をクリックします。
.. *Protection Policies*の横にあるimage:../media/icon_arrow.gif["矢印アイコン"]をクリックし、*Add*をクリックします。
+
*** ポリシーの名前と説明を入力します。
*** ポリシーの対象として、クラスタまたはSVMを選択します。
*** SnapMirror S3 関係には *継続* を選択します。
*** *Throttle*と*Recovery Point Objective*の値を入力します。




. SnapMirror保護を適用してバケットを作成します。
+
.. *Storage > Buckets*をクリックし、*Add*をクリックします。
.. 名前を入力し、ストレージ VM を選択し、サイズを入力して、*その他のオプション*をクリックします。
.. *権限*で、*追加*をクリックします。権限の確認は任意ですが、推奨されます。
+
*** *Principal* および *Effect*：ユーザーグループ設定に対応する値を選択するか、デフォルトを受け入れます。
*** *Actions*：次の値が表示されていることを確認します。
+
[listing]
----
GetObject,PutObject,DeleteObject,ListBucket,GetBucketAcl,GetObjectAcl,ListBucketMultipartUploads,ListMultipartUploadParts
----
*** *リソース*：デフォルト値 `_(bucketname, bucketname/*)`または必要なその他の値を使用します。
+
これらのフィールドの詳細については、link:../task_object_provision_manage_bucket_access.html["バケットへのユーザ アクセスの管理"]を参照してください。



.. *保護*で、*SnapMirrorを有効化（ONTAPまたはクラウド）*をチェックし、*クラウドストレージ*を選択してから、*クラウドオブジェクトストア*を選択します。




*保存*をクリックすると、ソースストレージVMに新しいバケットが作成され、クラウドオブジェクトストアにバックアップされます。

--
.CLI
--
. このSVMで最初のSnapMirror S3関係を作成する場合は、ソースSVMとデスティネーションSVMの両方にルートユーザキーが存在することを確認し、存在しない場合は再生成します：
`vserver object-store-server user show` + ルートユーザのアクセスキーが存在することを確認します。存在しない場合は、次のように入力します：
`vserver object-store-server user regenerate-keys -vserver svm_name -user _root_` + キーがすでに存在する場合は、再生成しないでください。
. ソース SVM にバケットを作成します（
`vserver object-store-server bucket create -vserver _svm_name_ -bucket _bucket_name_ [-size _integer_[KB|MB|GB|TB|PB]] [-comment _text_] [_additional_options_]`
. デフォルトのバケットポリシーにアクセスルールを追加します：
`vserver object-store-server bucket policy add-statement -vserver _svm_name_ -bucket _bucket_name_ -effect {allow|deny} -action _object_store_actions_ -principal _user_and_group_names_ -resource _object_store_resources_ [-sid _text_] [-index _integer_]`
+
.例
[listing]
----
clusterA::> vserver object-store-server bucket policy add-statement -bucket test-bucket -effect allow -action GetObject,PutObject,DeleteObject,ListBucket,GetBucketAcl,GetObjectAcl,ListBucketMultipartUploads,ListMultipartUploadParts -principal - -resource test-bucket, test-bucket /*
----
. 既存のSnapMirror S3ポリシーがなく、デフォルトポリシーを使用したくない場合は、SnapMirror S3ポリシーを作成してください：
`snapmirror policy create -vserver svm_name -policy policy_name -type continuous [-rpo _integer_] [-throttle _throttle_type_] [-comment _text_] [_additional_options_]`
+
パラメータ：* `type continuous` – SnapMirror S3関係の唯一のポリシータイプ（必須）。* `-rpo` – リカバリポイント目標の時間を秒単位で指定します（オプション）。* `-throttle` – スループット/帯域幅の上限をキロバイト/秒単位で指定します（オプション）。

+
.例
[listing]
----
clusterA::> snapmirror policy create -vserver vs0 -type continuous -rpo 0 -policy test-policy
----
. ターゲットが StorageGRID システムの場合は、ソース クラスタの管理 SVM に StorageGRID CA サーバ証明書をインストールします。
`security certificate install -type server-ca -vserver _src_admin_svm_ -cert-name _storage_grid_server_certificate_`
+
 `security certificate install`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/security-certificate-install.html["ONTAPコマンド リファレンス"^]をご覧ください。

. SnapMirror S3宛先オブジェクトストアを定義します：
`snapmirror object-store config create -vserver _svm_name_ -object-store-name _target_store_name_ -usage data -provider-type {AWS_S3|SGWS} -server _target_FQDN_ -container-name _remote_bucket_name_ -is-ssl-enabled true -port _port_number_ -access-key target_access_key -secret-password _target_secret_key_`
+
パラメータ：* `-object-store-name` – ローカル ONTAP システム上のオブジェクトストアターゲットの名前。* `-usage` – このワークフローには `data`を使用します。* `-provider-type` –  `AWS_S3`および `SGWS`（StorageGRID）ターゲットがサポートされています。* `-server` – ターゲットサーバの FQDN または IP アドレス。* `-is-ssl-enabled` – SSL の有効化はオプションですが、推奨されます。+  `snapmirror object-store config create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-object-store-config-create.html["ONTAPコマンド リファレンス"^]を参照してください。

+
.例
[listing]
----
src_cluster::> snapmirror object-store config create -vserver vs0 -object-store-name sgws-store -usage data -provider-type SGWS -server sgws.example.com -container-name target-test-bucket -is-ssl-enabled true -port 443 -access-key abc123 -secret-password xyz890
----
. SnapMirror S3 関係を作成します：
`snapmirror create -source-path _svm_name_:/bucket/_bucket_name_ -destination-path _object_store_name_:/objstore -policy _policy_name_`
+
パラメータ：* `-destination-path` - 前の手順で作成したオブジェクト ストア名と固定値 `objstore`。+ 作成したポリシーを使用することも、デフォルトを受け入れることもできます。

+
.例
[listing]
----
src_cluster::> snapmirror create -source-path vs0:/bucket/test-bucket -destination-path sgws-store:/objstore -policy test-policy
----
. ミラーリングがアクティブであることを確認します：
`snapmirror show -policy-type continuous -fields status`


--
====
.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-create.html["snapmirror create"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-create.html["snapmirror policy create"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-show.html["snapmirror show"^]

