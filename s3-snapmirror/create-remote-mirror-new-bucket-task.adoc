---
sidebar: sidebar 
permalink: s3-snapmirror/create-remote-mirror-new-bucket-task.html 
keywords: Create a mirror relationship for a new ONTAP S3 bucket on the remote cluster, protect new s3 buckets, remote cluster, mirror relationship, new buckets, new bucket requirements, mirror data to a remote cluster, snapmirror buckets, snapmirror relationship storage vm, new buckets in storage vm, destination clusters, source cluster, mirror data, peering, storage vm add users, snapmirror protection bucket, create snapmirror policy 
summary: 新しい S3 バケットを作成すると、リモート クラスター上の SnapMirror S3 デスティネーションにすぐに保護できます。 
---
= リモート クラスタ上の新しいONTAP S3バケットのミラー関係を作成します
:allow-uri-read: 


[role="lead"]
新しい S3 バケットを作成すると、リモート クラスター上の SnapMirror S3 デスティネーションにすぐに保護できます。

.タスク概要
このタスクはソースとデスティネーションの両方のシステムで実行する必要があります。

.開始する前に
* ONTAPのバージョン、ライセンス、S3サーバの設定に関する要件を満たしている必要があります。
* ソースとデスティネーションのクラスタ間にピア関係が、ソースとデスティネーションのStorage VM間にピア関係がそれぞれ確立されている必要があります。
* ソースとデスティネーションのVMのCA証明書が必要です。自己署名CA証明書または外部CAベンダーが署名した証明書を使用できます。


[role="tabbed-block"]
====
.System Manager
--
. このStorage VMに対する最初のSnapMirror S3関係を作成する場合は、ソースとデスティネーションの両方のStorage VMに対するrootユーザのキーがあることを確認し、ない場合は再生成します。
+
.. *Storage > Storage VMs* をクリックし、Storage VMを選択します。
.. *設定*タブで、*S3*タイルのimage:icon_pencil.gif["編集アイコン"]をクリックします。
.. *ユーザー*タブで、rootユーザーのアクセスキーがあることを確認します。
.. 存在しない場合は、*root*の横にあるimage:icon_kabob.gif["メニューオプションアイコン"]をクリックし、*キーの再生成*をクリックします。既にキーが存在する場合は、再生成しないでください。


. ソースとデスティネーションの両方のStorage VMで、Storage VMを編集してユーザを追加し、グループにユーザを追加します。
+
*ストレージ > ストレージ VM* をクリックし、ストレージ VM をクリックして、*設定* をクリックし、S3 の下の image:icon_pencil.gif["編集アイコン"] をクリックします。

+
詳細については、link:../task_object_provision_add_s3_users_groups.html["S3のユーザとグループの追加"]を参照してください。

. ソースクラスタで、既存のものがなくデフォルトポリシーを使用したくない場合は、SnapMirror S3ポリシーを作成してください：
+
.. *Protection > Overview*をクリックし、*Local Policy Settings*をクリックします。
.. *Protection Policies*の横にあるimage:../media/icon_arrow.gif["矢印アイコン"]をクリックし、*Add*をクリックします。
+
*** ポリシーの名前と説明を入力します。
*** ポリシーの対象として、クラスタまたはSVMを選択します。
*** SnapMirror S3 関係には *継続* を選択します。
*** *Throttle*と*Recovery Point Objective*の値を入力します。




. SnapMirror保護を適用してバケットを作成します。
+
.. *ストレージ > バケット*をクリックし、*追加*をクリックします。権限の確認は任意ですが、推奨されます。
.. 名前を入力し、ストレージ VM を選択し、サイズを入力して、*その他のオプション*をクリックします。
.. *権限*で*追加*をクリックします。
+
*** *Principal* と *Effect* - ユーザーグループ設定に対応する値を選択するか、デフォルトを受け入れます。
*** *Actions* - 次の値が表示されていることを確認します：
+
[listing]
----
GetObject,PutObject,DeleteObject,ListBucket,GetBucketAcl,GetObjectAcl,ListBucketMultipartUploads,ListMultipartUploadParts
----
*** *Resources* - デフォルト値 `(_bucketname, bucketname_/*)`または必要なその他の値を使用します。
+
これらのフィールドの詳細については、link:../task_object_provision_manage_bucket_access.html["バケットへのユーザ アクセスの管理"]を参照してください。



.. *保護*で、*SnapMirrorを有効にする（ONTAPまたはCloud）*にチェックを入れます。次に、以下の値を入力します：
+
*** デスティネーション
+
**** *ターゲット：ONTAPシステム*
**** *CLUSTER*：リモート クラスターを選択します。
**** *STORAGE VM*：リモートクラスタ上のストレージVMを選択します。
**** *S3 SERVER CA CERTIFICATE*：_source_ 証明書の内容をコピーして貼り付けます。


*** ソース
+
**** *S3 サーバー CA 証明書：* _デスティネーション_ 証明書の内容をコピーして貼り付けます。






. 外部 CA ベンダーによって署名された証明書を使用している場合は、* 宛先で同じ証明書を使用する * をオンにします。
. *宛先設定*をクリックすると、バケット名、容量、パフォーマンスサービスレベルのデフォルトの代わりに独自の値を入力することもできます。
. *保存*をクリックします。ソースストレージVMに新しいバケットが作成され、デスティネーションストレージVMに作成された新しいバケットにミラーリングされます。


.ロックされたバケットのバックアップ
ONTAP 9.14.1以降では、ロックされたS3バケットをバックアップし、必要に応じてリストアできます。

新規または既存のバケットの保護設定を定義する際に、ソース クラスタとデスティネーション クラスタがONTAP 9.14.1以降を実行し、ソース バケットでオブジェクト ロックが有効になっている場合、デスティネーション バケットでオブジェクト ロックを有効にできます。ソース バケットのオブジェクト ロック モードとロック保持期間は、デスティネーション バケットにレプリケートされたオブジェクトに適用されます。また、*デスティネーション設定*セクションで、デスティネーション バケットに異なるロック保持期間を定義することもできます。この保持期間は、ソース バケットとS3インターフェースからレプリケートされた、ロックされていないオブジェクトにも適用されます。

バケットでオブジェクト ロックを有効にする方法については、link:../s3-config/create-bucket-task.html["バケットの作成"]を参照してください。

--
.CLI
--
. このSVMに対する最初のSnapMirror S3関係を作成する場合は、ソースとデスティネーションの両方のSVMに対するrootユーザのキーがあることを確認し、ない場合は再生成します。
+
`vserver object-store-server user show`

+
rootユーザのアクセス キーがあることを確認します。キーがない場合は次のように入力します。

+
`vserver object-store-server user regenerate-keys -vserver svm_name -user _root_`

+
キーがすでにある場合は再生成しないでください。

. ソースとデスティネーションの両方のSVMにバケットを作成します。
+
`vserver object-store-server bucket create -vserver svm_name -bucket bucket_name [-size _integer_[KB|MB|GB|TB|PB]] [-comment _text_] [_additional_options_]`

. ソースとデスティネーションの両方のSVMで、デフォルトのバケット ポリシーにアクセス ルールを追加します。
+
`vserver object-store-server bucket policy add-statement -vserver _svm_name_ -bucket _bucket_name_ -effect {allow|deny} -action _object_store_actions_ -principal _user_and_group_names_ -resource _object_store_resources_ [-sid _text_] [-index _integer_]`

+
.例
[listing]
----
src_cluster::> vserver object-store-server bucket policy add-statement -bucket test-bucket -effect allow -action GetObject,PutObject,DeleteObject,ListBucket,GetBucketAcl,GetObjectAcl,ListBucketMultipartUploads,ListMultipartUploadParts -principal - -resource test-bucket, test-bucket /*
----
. ソースSVMで、既存のものがなくデフォルトのポリシーを使用したくない場合は、SnapMirror S3ポリシーを作成します：
`snapmirror policy create -vserver _svm_name_ -policy policy_name -type continuous [-rpo _integer_] [-throttle _throttle_type_] [-comment _text_] [_additional_options_]`
+
パラメータ：

+
** type `continuous` - SnapMirror S3関係の唯一のポリシー タイプ（必須）。
** `-rpo` - 回復ポイント目標の時間を秒単位で指定します（オプション）。
** `-throttle` - スループット/帯域幅の上限をキロバイト/秒単位で指定します（オプション）。
+
.例
[listing]
----
src_cluster::> snapmirror policy create -vserver vs0 -type continuous -rpo 0 -policy test-policy
----


. ソースとデスティネーションのクラスタの管理SVMに、CAサーバ証明書をインストールします。
+
.. ソース クラスタで、_デスティネーション_ S3サーバ証明書に署名したCA証明書をインストールします：
`security certificate install -type server-ca -vserver _src_admin_svm_ -cert-name _dest_server_certificate_`
.. デスティネーション クラスタに、_ソース_ S3 サーバー証明書に署名した CA 証明書をインストールします：
`security certificate install -type server-ca -vserver _dest_admin_svm_ -cert-name _src_server_certificate_`
+
外部CAベンダーが署名した証明書を使用する場合は、ソースとデスティネーションの管理SVMに同じ証明書をインストールします。

+
 `security certificate install`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/security-certificate-install.html["ONTAPコマンド リファレンス"^]をご覧ください。



. ソース SVM で、SnapMirror S3 関係を作成します：
+
`snapmirror create -source-path _src_svm_name_:/bucket/_bucket_name_ -destination-path _dest_peer_svm_name_:/bucket/_bucket_name_, ...} [-policy policy_name]`

+
作成したポリシーを使用することも、デフォルトのポリシーをそのまま使用することもできます。

+
.例
[listing]
----
src_cluster::> snapmirror create -source-path vs0-src:/bucket/test-bucket -destination-path vs1-dest:bucket/test-bucket-mirror -policy test-policy
----
. ミラーリングがアクティブであることを確認します：
`snapmirror show -policy-type continuous -fields status`


--
====
.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-create.html["snapmirror create"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-create.html["snapmirror policy create"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-show.html["snapmirror show"^]

