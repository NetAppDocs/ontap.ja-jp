---
sidebar: sidebar 
permalink: s3-snapshots/index.html 
keywords: s3 snapshots, S3 Snapshot copy overview, what is S3 snapshot, can you create S3 snapshots 
summary: S3 Snapshotテクノロジを使用して、S3バケットのポイントインタイムバックアップを作成します。 
---
= S3 Snapshotの概要
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAP 9 .16.1以降では、ONTAP Snapshotテクノロジを使用して、ONTAP S3バケットの読み取り専用のポイントインタイムイメージを生成できます。

S3のSnapshot機能を使用すると、Snapshotを手動で作成することも、Snapshotポリシーを使用して自動的に生成することもできます。S3 SnapshotはS3バケットとしてS3クライアントに提供されます。S3クライアントを使用して、Snapshotのコンテンツを参照し、リストアできます。

ONTAP 9 .16.1では、S3 SnapshotはS3バケット内のオブジェクトの現在のバージョンのみをキャプチャします。バージョン管理されたバケットの最新以外のバージョンはS3 Snapshotにキャプチャされません。また、Snapshotの作成後にオブジェクトタグが変更された場合、ポイントインタイムのオブジェクトタグはSnapshotにキャプチャされません。


TIP: S3 Snapshotはクラスタ時間に依存します。時刻を同期するには、クラスタ内のNTPサーバを設定する必要があります。詳細については、を参照してください link:../system-admin/manage-cluster-time-concept.html["クラスタ時間を管理します。"]。

.クォータとスペース使用量
クォータは、S3バケットで使用されているオブジェクトの数と論理サイズを追跡します。S3 Snapshotが作成されると、S3 Snapshotにキャプチャされたオブジェクトは、ファイルシステムからSnapshotが削除されるまで、バケットのオブジェクト数と使用サイズにカウントされます。

.マルチパートオブジェクト
マルチパートオブジェクトの場合、最後のオブジェクトのみがスナップショットにキャプチャされます。マルチパートオブジェクトの部分的なアップロードはSnapshotにキャプチャされません。



== バージョン管理に対応しているバケットとバージョン管理に対応していないバケット上のSnapshot

バージョン管理に対応しているバケットとバージョン管理に対応していないバケットの両方にSnapshotを作成できます。スナップショットには、スナップショットがキャプチャされた時点での現在のオブジェクトバージョンのみが含まれます。

.バージョン管理されたバケットとスナップショット
オブジェクトのバージョン管理が有効になっているバケットでは、Snapshotの作成後に最新のオブジェクトバージョンのコンテンツが保持されます。バケット内の最新でないバージョンは除外されます。

次の例を考えてみましょう。オブジェクトのバージョン管理が有効になっているバケットで、オブジェクト `obj1`のバージョンはv1、v2、v3、v4、v5です。v3（キャプチャ時点の最新バージョン）から `obj1`スナップショットを作成した `snap1`。閲覧すると `snap1`、 `obj1`はv3で作成されたコンテンツを含むオブジェクトとして表示されます。以前のバージョンのコンテンツは返されません。


NOTE: 最新でないバージョンは、Snapshotが削除されるまでファイルシステムに保持されます。

.バージョン管理に対応していないバケットとスナップショット
バージョン管理に対応していないバケットでは、S3 SnapshotはSnapshotの作成前に最新のコミットの内容を保持します。

次の例を考えてみましょう。オブジェクトのバージョン管理を利用できないバケットで、でオブジェクトが `obj1`数回上書きされています（T1、T2、T3、T4、T5）。T3とT4の間にS3 Snapshotを作成しました `snap1`。閲覧すると `snap1`、 `obj1`T3で作成されたコンテンツと一緒に表示されます。



== オブジェクトの有効期限とSnapshot

ONTAP S3オブジェクトの有効期限とS3 Snapshot機能は、互いに独立して機能します。ONTAPオブジェクトの有効期限機能は、S3バケットに対して定義されたライフサイクル管理ルールに従ってオブジェクトバージョンの期限が切れます。S3 Snapshotは、Snapshotが作成された時点のバケットオブジェクトの静的なコピーです。

バケットでオブジェクトのバージョン管理が有効になっている場合、そのバケットに定義された有効期限ルールによってオブジェクトの特定のバージョンが削除されたときに、そのバージョンが1つ以上のS3 Snapshotに現在のバージョンとしてキャプチャされていれば、そのバージョンのコンテンツはファイルシステムに残ります。そのオブジェクトバージョンは、そのSnapshotが削除された場合にのみファイルシステムに存在しなくなります。

同様に、バージョン管理が無効になっているバケットでは、有効期限ルールに基づいてオブジェクトが削除されても、そのオブジェクトが既存のS3 Snapshotにキャプチャされたままの場合、オブジェクトはファイルシステムに保持されます。オブジェクトをキャプチャしているSnapshotが削除されると、オブジェクトはファイルシステムから完全に削除されます。

S3オブジェクトの有効期限とライフサイクルの管理については、を参照してくださいlink:../s3-config/create-bucket-lifecycle-rule-task.html["バケットライフサイクル管理ルールを作成する"]。



== S3 Snapshotニカンスルセイケンシコウ

ONTAP 9 .16.1では、次の機能の除外とシナリオに注意してください。

* S3バケットに対して生成できるSnapshotは最大1023個です。
* クラスタをONTAP 9より前のバージョンのONTAPにリバートする前に、クラスタ内のすべてのバケットからS3 Snapshotとメタデータをすべて削除する必要があります。16.1
* Snapshotを含むオブジェクトを含むS3バケットを削除する必要がある場合は、そのバケット内のすべてのオブジェクトに対応するSnapshotをすべて削除しておく必要があります。
* S3 Snapshotは、次の構成ではサポートされません。
+
** SnapMirror関係のバケット
** オブジェクトロックが有効になっているバケット
** NetApp BlueXP  の場合
** System Manager
** ONTAP MetroClusterコウセイ



