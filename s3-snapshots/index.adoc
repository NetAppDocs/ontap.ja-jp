---
sidebar: sidebar 
permalink: s3-snapshots/index.html 
keywords: s3 snapshots, S3 Snapshot copy overview, what is S3 snapshot, can you create S3 snapshots 
summary: S3 スナップショット テクノロジーを使用して、S3 バケットのポイントインタイム バックアップを作成します。 
---
= ONTAP S3スナップショットについて学ぶ
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAP 9.16.1以降では、ONTAP Snapshotテクノロジを使用して、ONTAP S3バケットの読み取り専用ポイントインタイム イメージを生成できます。

S3 Snapshot機能を使用すると、Snapshotを手動で作成したり、Snapshotポリシーを通じて自動的に生成したりできます。S3 Snapshotは、S3バケットとしてS3クライアントに提供されます。S3クライアントを介して、Snapshotのコンテンツの参照やリストアを行えます。

ONTAP 9.16.1では、S3バケット内の現在のバージョンのオブジェクトのみが、S3 Snapshotによってキャプチャされます。バージョン管理されたバケットの最新ではないバージョンは、S3 Snapshotにキャプチャされません。また、Snapshotの作成後にオブジェクト タグが変更された場合には、ポイントインタイムのオブジェクト タグは、Snapshotにキャプチャされません。


TIP: S3 スナップショットはクラスタの時刻に依存します。時刻を同期するには、クラスタ内の NTP サーバーを設定する必要があります。詳細については、link:../system-admin/manage-cluster-time-concept.html["クラスター時間を管理する"]を参照してください。

.クォータとスペース使用量
クォータは、S3バケット内のオブジェクトの数と使用済み論理サイズを追跡します。S3 Snapshotが作成されると、S3 Snapshotにキャプチャされたオブジェクトは、Snapshotがファイルシステムから削除されるまで、バケットのオブジェクト数と使用済みサイズにカウントされます。

.マルチパート オブジェクト
マルチパート オブジェクトについては、最終的なオブジェクトのみがSnapshotにキャプチャされます。部分的にアップロードされたマルチパート オブジェクトは、Snapshotにキャプチャされません。



== バージョン管理されたバケットとバージョン管理されていないバケット上のSnapshot

Snapshotは、バージョン管理されたバケットとバージョン管理されていないバケットのどちらにも作成できます。Snapshotには、Snapshotがキャプチャされた時点での最新バージョンのオブジェクトのみが含まれます。

.バージョン管理されたバケットとSnapshot
オブジェクトのバージョン管理が有効になっているバケットでは、Snapshot作成後の最新バージョンのオブジェクトのコンテンツがSnapshotに保持されます。バケット内の最新でないバージョンは除外されます。

次の例を考えてみましょう。オブジェクトのバージョニングが有効になっているバケットで、オブジェクト `obj1`のバージョンがv1、v2、v3、v4、v5であるとします。 `obj1`v3（キャプチャ時点の最新バージョン）から `snap1`スナップショットを作成しました。 `snap1`を参照すると、 `obj1`はv3で作成されたコンテンツを持つオブジェクトとして表示されます。以前のバージョンのコンテンツは返されません。


NOTE: 最新でないバージョンは、Snapshotが削除されるまでファイルシステムに保持されます。

.バージョン管理されていないバケットとSnapshot
バージョン管理されていないバケットでは、Snapshot作成前の最新コミットのコンテンツがS3 Snapshotに保持されます。

次の例を考えてみましょう：オブジェクトのバージョン管理が利用できないバケットで、オブジェクト `obj1`が（t1、t2、t3、t4、t5）に複数回上書きされています。t3とt4の間にS3スナップショット `snap1`を作成しました。 `snap1`を参照すると、 `obj1`にはt3で作成されたコンテンツが表示されます。



== オブジェクトの有効期限とSnapshot

ONTAP S3オブジェクトの有効期限とS3 Snapshot機能は、別々に機能します。ONTAPオブジェクトの有効期限は、S3バケットに定義されたライフサイクル管理ルールに従って各バージョンのオブジェクトを期限切れにする機能です。S3 Snapshotは、Snapshotが作成された時点のバケット オブジェクトの静的コピーです。

バケットでオブジェクトのバージョン管理が有効になっていて、そのバケットに定義された有効期限ルールに基づいて特定のバージョンのオブジェクトが削除された場合、そのバージョンが現在のバージョンとして1つ以上のS3 Snapshotにキャプチャされていれば、そのバージョンのコンテンツはファイルシステムに残ります。当該バージョンのオブジェクトは、そのSnapshotが削除された場合にのみファイルシステムに存在しなくなります。

同様に、バージョン管理が無効になっているバケットでは、有効期限ルールに基づいてオブジェクトが削除された場合でも、そのオブジェクトがいずれかのS3 Snapshotにキャプチャされているかぎり、オブジェクトはファイルシステムに保持されます。オブジェクトがキャプチャされているSnapshotが削除されると、オブジェクトはファイルシステムから完全に削除されます。

S3 オブジェクトの有効期限とライフサイクル管理の詳細については、link:../s3-config/create-bucket-lifecycle-rule-task.html["バケット ライフサイクル管理ルールの作成"]を参照してください。



== S3 Snapshotの制限事項

ONTAP 9.16.1では、以下の機能の除外とシナリオに注意してください。

* 1つのS3バケットで生成できるSnapshotは、最大1,023個です。
* クラスタをONTAP 9.16.1より前のバージョンのONTAPにリバートする前に、クラスタ内のすべてのバケットからS3 Snapshotとメタデータをすべて削除する必要があります。
* Snapshotがあるオブジェクトを含むS3バケットを削除する必要がある場合は、そのバケット内のすべてのオブジェクトに対応するSnapshotを、すべて削除しておく必要があります。
* S3 Snapshotは、以下の構成ではサポートされません。
+
** SnapMirror関係にあるバケット
** オブジェクトロックが有効になっているバケット
** NetApp Console上
** System Manager
** ONTAP MetroCluster構成


* ローカルまたはリモートのFabricPool容量階層として使用されているバケットでは、S3スナップショットは推奨されません。

