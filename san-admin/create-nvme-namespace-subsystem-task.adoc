---
permalink: san-admin/create-nvme-namespace-subsystem-task.html 
sidebar: sidebar 
keywords: create, nvme, namespace, subsystem 
summary: NVMeプロトコルを使用するシステムでは、NVMeのネームスペースとサブシステムを1つ以上作成する必要があります。各ネームスペースをNVMeサブシステムにマッピングして、ホスト システムからのデータ アクセスを許可することができます。 
---
= NVMeストレージのプロビジョニング
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
次の手順に従って、既存のStorage VMでNVMe対応ホスト用のネームスペースを作成し、ストレージをプロビジョニングします。

.タスク概要
この手順は、FAS、AFF、およびASAシステムに適用されます。ASA r2システム（ASA A1K、ASA A90、ASA A70、ASA A50、ASA A30、ASA A20、またはASA C30）をご利用の場合は、link:https://docs.netapp.com/us-en/asa-r2/manage-data/provision-san-storage.html["これらの手順"^]に従ってストレージをプロビジョニングしてください。ASA r2システムは、SANのみをご利用のお客様向けに、簡素化されたONTAPエクスペリエンスを提供します。

ONTAP 9.8以降では、QoSはストレージのプロビジョニング時にデフォルトで有効になります。プロビジョニング時またはあとでQoSを無効にしたり、カスタムのQoSポリシーを選択したりすることができます。

.開始する前に
Storage VMがNVMe用に設定されていて、FCまたはTCP転送のセットアップが完了していることを前提としています。

[role="tabbed-block"]
====
.System Manager
--
ONTAP System Manager（9.7以降）で、NVMeプロトコルを使用してストレージを提供するネームスペースを作成します。

.手順
. System Managerで、*ストレージ > NVMe Namespaces*をクリックし、*追加*をクリックします。
+
新しいサブシステムを作成する必要がある場合は、*More Options* をクリックします。

. ONTAP 9.8 以降を実行していて、QoS を無効にするか、カスタム QoS ポリシーを選択する場合は、[*その他のオプション*] をクリックし、[*ストレージと最適化*] の下で [*パフォーマンス サービス レベル*] を選択します。
. FCスイッチをWWPNでゾーニングします。イニシエータごとに1つのゾーンを使用し、各ゾーンにすべてのターゲット ポートを配置します。
. ホストで、新しいネームスペースを検出します。
. ネームスペースを初期化し、ファイルシステムでフォーマットします。
. ホストからネームスペースのデータの読み取りと書き込みができることを確認します。


--
.CLI
--
ONTAP CLIで、NVMeプロトコルを使用してストレージを提供するネームスペースを作成します。

この手順では、すでにNVMeプロトコル用に設定されている既存のStorage VMにNVMeネームスペースとサブシステムを作成し、ネームスペースをサブシステムにマッピングしてホスト システムからのデータ アクセスを許可します。

NVMe 用にストレージ VM を構成する必要がある場合は、link:configure-svm-nvme-task.html["NVMe用のSVMの設定"]を参照してください。

.手順
. SVMがNVMe用に設定されていることを確認します。
+
[source, cli]
----
vserver show -vserver <svm_name> -fields allowed-protocols
----
+
`NVMe`は `allowed-protocols`列の下に表示されます。

. NVMeネームスペースを作成します。
+

NOTE:  `-path`パラメータで参照するボリュームがすでに存在している必要があります。存在しない場合は、このコマンドを実行する前にボリュームを作成する必要があります。

+
[source, cli]
----
vserver nvme namespace create -vserver <svm_name> -path <path> -size <size_of_namespace> -ostype <OS_type>
----
. NVMeサブシステムを作成します。
+
[source, cli]
----
vserver nvme subsystem create -vserver <svm_name> -subsystem <name_of_subsystem> -ostype <OS_type>
----
+
NVMeサブシステムの名前では大文字と小文字が区別されます。1～96文字にする必要があります。特殊文字も使用できます。

. サブシステムが作成されたことを確認します。
+
[source, cli]
----
vserver nvme subsystem show -vserver <svm_name>
----
+
 `nvme`サブシステムは `Subsystem`列の下に表示される必要があります。

. ホストからNQNを取得します。
. ホストのNQNをサブシステムに追加します。
+
[source, cli]
----
vserver nvme subsystem host add -vserver <svm_name> -subsystem <subsystem_name> -host-nqn <Host_NQN>
----
. ネームスペースをサブシステムにマッピングします。
+
[source, cli]
----
vserver nvme subsystem map add -vserver <svm_name> -subsystem <subsystem_name> -path <path>
----
+
ネームスペースは、1つのサブシステムにしかマッピングできません。

. ネームスペースがサブシステムにマッピングされていることを確認します。
+
[source, cli]
----
vserver nvme namespace show -vserver <svm_name> -instance
----
+
サブシステムは `Attached subsystem`としてリストされる必要があります。



--
====