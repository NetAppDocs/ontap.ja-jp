---
permalink: san-admin/enable-space-allocation.html 
sidebar: sidebar 
keywords: enable, space allocation, space reclamation, unmap 
summary: space-allocation オプションを enabled に設定すると、ボリュームがスペース不足になってボリューム内の LUN にデータを書き込めなくなった時点で、 ONTAP からホストに通知が届きます。また、このオプションで ONTAP 、ホストでデータが削除された時点での自動スペース再生も有効になります。 
---
= SANのスペース割り当てを有効にする
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
FCホストまたはiSCSIホストでSCSIシンプロビジョニングがサポートされている場合は、スペース割り当てを有効にすることができます。  スペース割り当てを有効にしてボリュームのスペースが不足しても、ボリューム内のLUNはオンラインのままで読み取り専用モードに設定されます。  LUNが書き込みを受け付けられなくなったことがホストに通知されます。  ホストでスペース割り当てがサポートされていない場合、または有効になっていない場合、ボリュームのスペースが不足して自動的に拡張できないときに、ONTAPはLUNをオフラインにします。

また、スペース割り当てを有効にすると、ホスト側のスペース管理によって、ホストファイルシステムで削除されたデータブロックが特定され、1つ以上のデータが自動的に実行されます。 `SCSI UNMAP` ストレージシステム上の対応するブロックを解放し、ONTAPがスペースを再生できるようにするコマンド。

.作業を開始する前に
スペース割り当てを有効にするには、SCSIシンプロビジョニングがホストでサポートされている必要があります。SCSIシンプロビジョニングは、SCSI SBC-3標準で定義されている論理ブロックプロビジョニングを使用します。この標準をサポートするホストだけが、 ONTAP の SCSI シンプロビジョニングを使用できます。

現在、スペース割り当てを有効にした場合の SCSI シンプロビジョニングに対応しているホストは次のとおりです。

* Citrix XenServer 6.5 以降
* ESXi 5.0以降
* Oracle Linux 6.2 UEKカーネル以降
* Red Hat Enterprise Linux 6.2 以降
* SUSE Linux Enterprise Server 11以降
* Solaris 11.1以降
* Windows の場合


スペースの割り当てはNVMeホストではサポートされません。

.このタスクについて
ONTAP 9.15.1以降では、新しく作成したVMware LUNおよびHyper-V LUNに対してスペース割り当てがデフォルトで有効になり、新しく作成したVMwareおよびHyper-Vで使用されないLUNに対しては無効になります。


NOTE: クラスタをONTAP 9.15.1にアップグレードした場合、ソフトウェアのアップグレード前に作成されたすべてのLUNのスペース割り当て設定は、ホストタイプに関係なく、アップグレード後も変更されません。  たとえば、スペース割り当てが無効になっているVMwareホスト用にONTAP 9.13.1でLUNが作成された場合、ONTAP 9.15.1へのアップグレード後も、そのLUNでのスペース割り当ては無効なままです。

LUNをオフラインにしてスペース割り当てを有効にしてから、ホストがスペース割り当てが有効になったことを認識するには、ホストで検出を実行する必要があります。

.手順
. LUN をオフラインにします。
+
[source, cli]
----
lun modify -vserver vserver_name -volume volume_name -lun lun_name -state offline
----
. スペース割り当てを有効にします。
+
[source, cli]
----
lun modify -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -space-allocation enabled
----
. スペース割り当てが有効になっていることを確認します。
+
[source, cli]
----
lun show -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -fields space-allocation
----
. LUN をオンラインにします。
+
[source, cli]
----
lun modify -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -state online
----
. ホストですべてのディスクを再スキャンして、が変更されたことを確認します `-space-allocation` オプションが正しく検出されました。

