---
permalink: san-admin/improve-vmware-vaai-performance-esx-hosts-concept.html 
sidebar: sidebar 
keywords: improve, vmware, vaai, performance, esx, hosts 
summary: ONTAPは、ESXホストがESX 4.1以降を実行している場合、特定のVMware vStorage APIs for Array Integration（VAAI）機能をサポートします。これらの機能は、ESXホストからストレージ システムへの処理のオフロードとネットワーク スループットの向上に役立ちます。ESXホストは、適切な環境でこれらの機能を自動的に有効化します。 
---
= ESXホストのVMware VAAIパフォーマンスの向上
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAPは、ESXホストがESX 4.1以降を実行している場合、特定のVMware vStorage APIs for Array Integration（VAAI）機能をサポートします。これらの機能は、ESXホストからストレージ システムへの処理のオフロードとネットワーク スループットの向上に役立ちます。ESXホストは、適切な環境でこれらの機能を自動的に有効化します。

VAAI 機能は、次の SCSI コマンドをサポートします：

* `EXTENDED_COPY`
+
この機能により、ホストはデータ転送に関与することなく、LUN間またはLUN内でのデータ転送を開始できます。これにより、ESXのCPUサイクルが節約され、ネットワークスループットが向上します。拡張コピー機能（「コピー オフロード」とも呼ばれます）は、仮想マシンのクローン作成などのシナリオで使用されます。ESXホストによって呼び出されると、コピー オフロード機能はホストネットワークを経由せずにストレージシステム内でデータをコピーします。コピー オフロードは、以下の方法でデータを転送します：

+
** LUN内
** ボリューム内のLUN間
** ストレージ仮想マシン（SVM）内の異なるボリューム上のLUN間
** クラスタ内の異なるSVM上のLUN間 この機能を呼び出すことができない場合は、ESXホストはコピー操作に標準のREADコマンドとWRITEコマンドを自動的に使用します。


* `WRITE_SAME`
+
この機能は、すべてゼロなどの繰り返しパターンをストレージ アレイに書き込む作業をオフロードします。ESXホストは、ファイルのゼロフィルなどの操作でこの機能を使用します。

* `COMPARE_AND_WRITE`
+
この機能は、特定のファイル アクセスの同時実行制限をバイパスし、仮想マシンの起動などの操作を高速化します。





== VAAI環境を使用するための要件

VAAI機能はESXオペレーティング システムの一部であり、適切な環境を設定するとESXホストによって自動的に呼び出されます。

環境要件は次のとおりです：

* ESXホストはESX 4.1以降を実行している必要があります。
* VMwareデータストアをホストするNetAppストレージ システムでONTAPを実行する。
* （コピー オフロードのみ）VMware コピー操作のソースと宛先は、同じクラスタ内の同じストレージ システムでホストされている必要があります。
+
[NOTE]
====
コピー オフロード機能は現在、異なるストレージ システムでホストされているVMwareデータストア間でのデータのコピーをサポートしていません。

====




== VAAI機能がESXでサポートされているかどうかの確認

ESX オペレーティング システムが VAAI 機能をサポートしているかどうかを確認するには、vSphere Client を確認するか、ホストにアクセスする他の手段を使用します。ONTAP はデフォルトで SCSI コマンドをサポートしています。

ESXホスト詳細設定を確認することで、VAAI機能が有効になっているかどうかを確認できます。表は、ESX制御名に対応するSCSIコマンドを示しています。

[cols="2*"]
|===
| SCSIコマンド | ESXコントロール名（VAAI機能） 


 a| 
EXTENDED_COPY
 a| 
`HardwareAcceleratedMove`



 a| 
WRITE_SAME
 a| 
`HardwareAcceleratedInit`



 a| 
COMPARE_AND_WRITE
 a| 
`HardwareAcceleratedLocking`

|===