---
permalink: san-admin/microsoft-offloaded-data-transfer-odx-concept.html 
sidebar: sidebar 
keywords: microsoft, offloaded, data, transfer, odx 
summary: Microsoft Offloaded Data Transfer （ ODX ；オフロードデータ転送）はコピーオフロードとも呼ばれ、この機能を使用すると、ストレージデバイス内または互換性があるストレージデバイス間で、ホストコンピュータを介さずにデータを直接転送できます。 
---
= Microsoftオフロードデータ転送（ODX）
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Microsoft Offloaded Data Transfer （ ODX ；オフロードデータ転送）は _ コピーオフロード _ とも呼ばれ、この機能を使用すると、ストレージデバイス内または互換性があるストレージデバイス間で、ホストコンピュータを介さずにデータを直接転送できます。

ONTAPでは、SMBプロトコルとSANプロトコルの両方でODXがサポートされます。

ODX以外のファイル転送では、ソースからデータが読み取られ、ネットワーク経由でホストに転送されます。ホストは、データをネットワーク経由でデスティネーションに転送します。ODXファイル転送では、ホストを経由せずに、データがソースからデスティネーションに直接コピーされます。

ODXオフロードコピーはソースとデスティネーションの間で直接実行されるため、同じボリューム内でコピーを実行するとパフォーマンスが大幅に向上します。たとえば、同じボリュームコピーのコピー時間の短縮、クライアントでのCPUとメモリの使用量の削減、ネットワークI/O帯域幅の使用量の削減などが挙げられます。複数のボリュームにコピーが存在する場合は、ホストベースのコピーに比べてパフォーマンスが大幅に向上することはありません。

SAN環境でODXを使用できるのは、ホストとストレージシステムの両方でODXがサポートされている場合のみです。ODXをサポートしていてODXが有効になっているクライアントコンピュータでは、ファイルの移動またはコピー時にオフロードされたファイル転送が自動的かつ透過的に使用されます。ODXは、ファイルをエクスプローラでドラッグアンドドロップしたか、コマンドラインのファイルコピーコマンドを使用したか、クライアントアプリケーションによってファイルコピー要求が開始されたかに関係なく使用されます。



== ODXの使用要件

コピーオフロードにODXを使用する場合は、ボリュームのサポートに関する考慮事項、システム要件、およびソフトウェア機能の要件を理解しておく必要があります。

ODXを使用するには、システムが次の要件を満たしている必要があります。

* ONTAP
+
サポート対象のバージョンのONTAPでは、ODXが自動的に有効になります。

* 最小ソースボリューム：2GB
+
最適なパフォーマンスを得るには、ソースボリュームが260GBを超えている必要があります。

* WindowsクライアントでのODXのサポート
+
ODXは、Windows Server 2012以降およびWindows 8以降でサポートされます。サポートされているWindowsクライアントの最新情報については、Interoperability Matrixを参照してください。

+
https://mysupport.netapp.com/matrix["NetApp Interoperability Matrix Tool"^]

* コピーアプリケーションによるODXのサポート
+
データ転送を実行するアプリケーションでODXがサポートされている必要があります。ODXをサポートするアプリケーションの処理は次のとおりです。

+
** 仮想ハードディスク（VHD）の作成と変換、スナップショットの管理、仮想マシン間でのファイルのコピーなど、Hyper-Vの管理操作
** エクスプローラでの操作
** Windows PowerShell の copy コマンド
** Windows コマンドプロンプトのコピーコマンド Microsoft TechNet ライブラリに、 Windows サーバおよびクライアントでサポートされている ODX アプリケーションの詳細が記載されている。


* 圧縮されたボリュームを使用する場合は、圧縮グループサイズを8Kにする必要があります。
+
32Kの圧縮グループサイズはサポートされていません。



ODXは、次のボリュームタイプでは機能しません。

* 容量が2GB未満のソースボリューム
* 読み取り専用ボリューム
* link:../flexcache/supported-unsupported-features-concept.html["FlexCacheホリユウム"]
+

NOTE: ODXはFlexCache元のボリュームでサポートされます。

* link:../san-admin/san-volumes-concept.html#semi-thick-provisioning-for-volumes["セミシックプロビジョニングされたボリューム"]




== 特殊なシステムファイル要件

qtreeで見つかったODXファイルを削除できます。テクニカルサポートから指示がないかぎり、他のODXシステムファイルは削除または変更しないでください。

ODX機能を使用すると、システムのすべてのボリュームにODXシステムファイルが存在します。これらのファイルを使用すると、ODX転送中に使用されるデータのポイントインタイム表示が可能になります。次のシステムファイルは、データのオフロード先のLUNまたはファイルを含む各ボリュームのルートレベルにあります。

* `.copy-offload`（非表示のディレクトリ）
* `.tokens`（非表示ディレクトリの下にあるファイル `.copy-offload`）


コマンドを使用すると、ODXファイルを含むqtreeを削除できます `copy-offload delete-tokens -path dir_path -node _node_name_`。



== ODXのユースケース

SVMでODXを使用する前に、どのような場合にパフォーマンスを向上できるかを判断できるようにユースケースについて確認しておく必要があります。

ODXをサポートするWindowsサーバおよびクライアントでは、リモートサーバ間でデータをコピーするデフォルトの方法として、コピーオフロードが使用されます。WindowsサーバまたはクライアントでODXがサポートされていない場合や、ODXコピーオフロードがいずれかの時点で失敗した場合、コピー処理または移動処理は、その処理の従来の読み取りと書き込みにフォールバックされます。

ODXコピーと移動の使用は次のユースケースでサポートされます。

* ボリューム内
+
ソースとデスティネーションのファイルまたはLUNは、同じボリューム内にあります。

* ボリュームが異なり、ノードとSVMは同じ
+
ソースとデスティネーションのファイルまたはLUNは、同じノード上の異なるボリュームにあります。データは同じSVMに所有されます。

* ボリュームとノードが異なり、SVMは同じ
+
ソースとデスティネーションのファイルまたはLUNは、異なるノード上の異なるボリュームにあります。データは同じSVMに所有されます。

* SVMが異なり、ノードは同じ
+
ソースとデスティネーションのファイルまたはLUNは、同じノード上の異なるボリュームにあります。データは複数のSVMに所有されます。

* SVMとノードが異なる
+
ソースとデスティネーションのファイルまたはLUNは、異なるノード上の異なるボリュームにあります。データは複数のSVMに所有されます。

* クラスタ間
+
ソースLUNとデスティネーションLUNは、クラスタの異なるノードにある異なるボリュームにあります。これはSANでのみサポートされ、SMBでは機能しません。



その他にも、次のような特殊なユースケースがあります。

* ONTAP ODXの実装では、ODXを使用して、SMB共有とFCまたはiSCSIで接続された仮想ドライブの間でファイルをコピーできます。
+
Windowsエクスプローラ、Windows CLI（PowerShell）、Hyper-V、またはODXをサポートするその他のアプリケーションでODXコピーオフロードを使用すると、SMB共有と接続されたLUNが同じクラスタにある場合に、それらの間でシームレスにファイルをコピーまたは移動できます。

* Hyper-Vでは、その他にもODXコピーオフロードのユースケースがいくつか用意されています。
+
** Hyper-VでODXコピーオフロードのパススルーを使用すると、仮想ハードディスク（VHD）ファイル内またはVHDファイル間でデータをコピーしたり、同じクラスタ内のマッピングされたSMB共有と接続されたiSCSI LUNの間でデータをコピーしたりできます。
+
これにより、ゲストオペレーティングシステムからのコピーを基盤となるストレージに渡すことができます。

** 容量固定VHDを作成する場合、ODXを使用してディスクを初期化します。初期化された既知のトークンを使用してディスクを初期化します。
** ソースとデスティネーションのストレージが同じクラスタにある場合、ODXコピーオフロードを使用して仮想マシンのストレージを移行します。


+
[NOTE]
====
Hyper-VでのODXコピーオフロードのパススルーのユースケースを利用するには、ゲストオペレーティングシステムでODXがサポートされている必要があります。また、ゲストオペレーティングシステムのディスクが、ODXをサポートするストレージ（SMBまたはSAN）から作成されたSCSIディスクである必要があります。ゲストオペレーティングシステムのIDEディスクは、ODXパススルーをサポートしていません。

====

