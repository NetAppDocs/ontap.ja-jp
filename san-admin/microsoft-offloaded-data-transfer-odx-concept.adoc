---
permalink: san-admin/microsoft-offloaded-data-transfer-odx-concept.html 
sidebar: sidebar 
keywords: microsoft, offloaded, data, transfer, odx 
summary: Microsoft Offloaded Data Transfer （ ODX ；オフロードデータ転送）はコピーオフロードとも呼ばれ、この機能を使用すると、ストレージデバイス内または互換性があるストレージデバイス間で、ホストコンピュータを介さずにデータを直接転送できます。 
---
= Microsoft オフロードデータ転送（ ODX ）
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Microsoft Offloaded Data Transfer （ ODX ；オフロードデータ転送）は _ コピーオフロード _ とも呼ばれ、この機能を使用すると、ストレージデバイス内または互換性があるストレージデバイス間で、ホストコンピュータを介さずにデータを直接転送できます。

ONTAPでは、SMBプロトコルとSANプロトコルの両方でODXがサポートされます。

ODX 以外のファイル転送では、ソースからデータが読み取られ、ネットワーク経由でホストに転送されます。ホストは、データをネットワーク経由でデスティネーションに転送します。ODX ファイル転送では、ホストを経由せずに、データがソースからデスティネーションに直接コピーされます。

ODX オフロードコピーはソースとデスティネーションの間で直接実行されるため、パフォーマンスが大幅に向上します。実現するパフォーマンスの向上には、コピー時間の短縮、クライアントでの CPU とメモリの使用量の削減、ネットワーク I/O 帯域幅の使用量の削減などが挙げられます。

SAN 環境で ODX を使用できるのは、ホストとストレージシステムの両方で ODX がサポートされている場合のみです。ODX がサポートされていて有効になっているクライアントコンピュータでは、ファイルの移動やコピーを行う際に、オフロードファイル転送が自動的かつ透過的に使用されます。ODX は、ファイルをエクスプローラでドラッグアンドドロップしたか、コマンドラインのファイルコピーコマンドを使用したか、クライアントアプリケーションによってファイルコピー要求が開始されたかに関係なく使用されます。



== ODX を使用するための要件

コピーオフロードに ODX を使用する場合は、ボリュームのサポートに関する考慮事項、システム要件、およびソフトウェア機能の要件について理解しておく必要があります。

ODX を使用するためのシステム要件は次のとおりです。

* ONTAP
+
サポート対象のバージョンの ONTAP では、 ODX が自動的に有効になります。

* ソースボリュームの最小サイズは 2GB です
+
最適なパフォーマンスを確保するには、 260GB 以上のソースボリュームが必要です。

* Windows クライアントでの ODX のサポート
+
ODX は、 Windows Server 2012 以降および Windows 8 以降でサポートされます。サポート対象の Windows クライアントの最新情報については、 Interoperability Matrix を参照してください。

+
https://mysupport.netapp.com/matrix["NetApp Interoperability Matrix Tool で確認できます"^]

* コピーアプリケーションによる ODX のサポート
+
データ転送を実行するアプリケーションが ODX をサポートする必要があります。ODX がサポートされるアプリケーション処理は次のとおりです。

+
** Virtual Hard Disk （ VHD ；仮想ハードディスク）の作成および変換、 Snapshot コピーの管理、仮想マシン間でのファイルのコピーなど、 Hyper-V の管理処理
** エクスプローラでの操作
** Windows PowerShell の copy コマンド
** Windows コマンドプロンプトの copy コマンド
WindowsサーバおよびクライアントでサポートされるODXアプリケーションの詳細については、Microsoft TechNetライブラリを参照してください。


* 圧縮されたボリュームを使用する場合は、圧縮グループサイズを 8K にする必要があります。
+
32K の圧縮グループサイズはサポートされていません。



ODX を次のタイプのボリュームで使用することはできません。

* 容量が 2GB 未満のソースボリューム
* 読み取り専用ボリューム
* link:../flexcache/supported-unsupported-features-concept.html["FlexCache ボリューム"]
+

NOTE:  ODXはFlexCache元のボリュームでサポートされます。

* link:../san-admin/san-volumes-concept.html#semi-thick-provisioning-for-volumes["セミシックプロビジョニングされたボリューム"]




== 特別なシステムファイルの要件

qtree で見つかった ODX ファイルを削除できます。テクニカルサポートから指示されないかぎり、他の ODX システムファイルは削除または変更しないでください。

ODX 機能を使用する場合、システムのすべてのボリュームに ODX システムファイルが存在します。これらのファイルによって、 ODX 転送時に使用されるデータのポイントインタイムビューが有効になります。次のシステムファイルは、データのオフロード先となる LUN またはファイルがある各ボリュームのルートレベルにあります。

* `.copy-offload` （非表示のディレクトリ）
* `.tokens` （非表示の下のファイル `.copy-offload` ディレクトリ）


を使用できます `copy-offload delete-tokens -path dir_path -node _node_name_` ODXファイルを含むqtreeを削除するコマンド。



== ODX のユースケース

SVM で ODX を使用する前に、どのような場合にパフォーマンスを向上できるかを判断できるようにユースケースについて確認しておく必要があります。

ODX をサポートする Windows サーバおよびクライアントでは、リモートサーバ間でデータをコピーする際に、デフォルトでコピーオフロードが使用されます。Windows サーバまたはクライアントで ODX がサポートされていない場合や、 ODX コピーオフロードが任意の時点で失敗した場合は、コピーまたは移動処理が従来の読み取りと書き込みの処理を使用して実行されます。

ODX コピーおよび移動の使用は、以下のユースケースでサポートされます。

* ボリューム内
+
ソースとデスティネーションのファイルまたは LUN は、同じボリューム内にあります。

* ボリュームが異なり、ノードと SVM は同じです
+
ソースとデスティネーションのファイルまたは LUN は、同じノード上の異なるボリュームにあります。データは同じ SVM に所有されます。

* ボリュームとノードが異なり、 SVM は同じです
+
ソースとデスティネーションのファイルまたは LUN は、異なるノード上の異なるボリュームにあります。データは同じ SVM に所有されます。

* SVM が異なり、ノードは同じです
+
ソースとデスティネーションのファイルまたは LUN は、同じノード上の異なるボリュームにあります。データは異なる SVM に所有されます。

* SVM とノードが異なります
+
ソースとデスティネーションのファイルまたは LUN は、異なるノード上の異なるボリュームにあります。データは異なる SVM に所有されます。

* クラスタ間
+
ソース LUN とデスティネーション LUN は、異なるクラスタの異なるノード上の異なるボリュームにあります。これはSANでのみサポートされ、SMBでは機能しません。



その他にも、いくつかの特殊なユースケースがあります。

* ONTAP の ODX の実装で ODX を使用すると、 SMB 共有と FC / iSCSI で接続された仮想ドライブとの間でファイルをコピーできます。
+
SMB 共有と LUN が同じクラスタにある場合は、 Windows エクスプローラ、 Windows CLI または PowerShell 、 Hyper-V 、または ODX をサポートするその他のアプリケーションを使用して、 SMB 共有と接続された LUN 間の ODX コピーオフロードを使用してファイルをシームレスにコピーまたは移動できます。

* Hyper-V では、さらに次のようなユースケースでも ODX コピーオフロードが使用されます。
+
** Hyper-V で ODX コピーオフロードのパススルーを使用して、仮想ハードディスク（ VHD ）ファイル内および VHD ファイル間でのデータのコピー、または同じクラスタ内のマッピングされた SMB 共有と接続された iSCSI LUN の間でのデータのコピーを実行できます。
+
これにより、ゲストオペレーティングシステムからのコピーを基盤となるストレージに渡すことができます。

** 容量固定 VHD を作成する際に、 ODX を使用して、既知の初期化済みトークンによってディスクを初期化します。
** ソースとデスティネーションのストレージが同じクラスタにある場合に、 ODX コピーオフロードを使用して、仮想マシンのストレージを移行します。


+
[NOTE]
====
Hyper-V での ODX コピーオフロードのパススルーの用途を活用するには、ゲストオペレーティングシステムで ODX がサポートされている必要があります。また、ゲストオペレーティングシステムのディスクが、 ODX をサポートするストレージ（ SMB または SAN ）から作成された SCSI ディスクである必要があります。ゲストオペレーティングシステムのディスクが IDE ディスクの場合、 ODX のパススルーはサポートされません。

====

