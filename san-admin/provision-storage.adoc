---
sidebar: sidebar 
permalink: san-admin/provision-storage.html 
keywords: netapp, ontap, san, provisioning, linux, servers, provision, storage, create lun, fc, iscsi, zone switches, scsi disk, iscsi 
summary: FC または iSCSI SAN プロトコルを使用して、ホストにストレージを提供する LUN を作成します。LUN はホストに対してディスクとして表示されます。 
---
= SANストレージのプロビジョニング
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
この手順では、すでにFCプロトコルまたはiSCSIプロトコルが設定されている既存のStorage VMに新しいLUNを作成します。

.タスク概要
この手順は、FAS、AFF、およびASAシステムに適用されます。ASA r2システム（ASA A1K、ASA A90、ASA A70、ASA A50、ASA A30、ASA A20、またはASA C30）をご利用の場合は、link:https://docs.netapp.com/us-en/asa-r2/manage-data/provision-san-storage.html["これらの手順"^]に従ってストレージをプロビジョニングしてください。ASA r2システムは、SANのみをご利用のお客様向けに、簡素化されたONTAPエクスペリエンスを提供します。

新しいストレージ VM を作成し、FC または iSCSI プロトコルを構成する必要がある場合は、link:configure-svm-fc-task.html["FC用のSVMの設定"]またはlink:configure-svm-iscsi-task.html["iSCSI用のSVMの設定"]を参照してください。

FCライセンスが有効になっていない場合、LIFとSVMはオンラインとして表示されますが、動作ステータスはdownになります。

LUNは、ホストにはディスク デバイスとして表示されます。


NOTE: LUNの作成時、Asymmetric Logical Unit Access（ALUA）は常に有効になります。ALUAの設定は変更できません。

イニシエータをホストするには、SVM内のすべてのFC LIFで単一イニシエータ ゾーニングを使用する必要があります。

ONTAP 9.8以降では、QoSはストレージのプロビジョニング時にデフォルトで有効になります。プロビジョニング時またはあとでQoSを無効にしたり、カスタムのQoSポリシーを選択したりすることができます。

.手順
[role="tabbed-block"]
====
.System Manager
--
ONTAP System Manager（9.7以降）で、FCまたはiSCSIプロトコルを使用してSANホスト用のストレージを提供するLUNを作成します。

System Manager Classic（9.7以前で利用可能）を使用してこのタスクを完了するには、 https://docs.netapp.com/us-en/ontap-system-manager-classic/iscsi-config-rhel/index.html["Red Hat Enterprise Linux向けのiSCSIの設定"^]を参照してください。

.手順
. ホストに適切なlink:https://docs.netapp.com/us-en/ontap-sanhost/["SAN ホスト ユーティリティ"^]をインストールします。
. System Managerで、*ストレージ > LUN*をクリックし、*追加*をクリックします。
. LUNの作成に必要な情報を入力します。
. ONTAPのバージョンに応じて、*その他のオプション*をクリックして次のいずれかを実行できます。
+
[cols="80,20"]
|===


| オプション | 追加されたリリース 


 a| 
** 親ボリュームではなくLUNにQoSポリシーを割り当てる
+
*** *その他のオプション > ストレージと最適化*
*** *Performance Service Level*を選択します。
*** ボリューム全体ではなく個々のLUNにQoSポリシーを適用するには、*これらのパフォーマンス制限の適用を各LUNに適用する*を選択します。
+
デフォルトでは、パフォーマンス制限はボリューム レベルで適用されます。




| ONTAP 9.10.1 


 a| 
** 既存のイニシエータ グループを使用して新しいイニシエータ グループを作成する
+
*** *その他のオプション＞ホスト情報*
*** *既存のイニシエータグループを使用した新しいイニシエータグループ*を選択します。
+

NOTE: 他のigroupを含むigroupは、作成後にOSタイプを変更することはできません。




| ONTAP 9.9.1 


 a| 
** igroupまたはホスト イニシエータに説明を追加する
+
この説明は、igroupまたはホスト イニシエータのエイリアスとなります。

+
*** *その他のオプション＞ホスト情報*



| ONTAP 9.9.1 


 a| 
** 既存のボリュームにLUNを作成する
+
デフォルトでは、新しいLUNは新しいボリュームに作成されます。

+
*** *その他のオプション > LUNの追加*
*** *関連する LUN をグループ化* を選択します。



| ONTAP 9.9.1 


 a| 
** QoSを無効にするか、カスタムのQoSポリシーを選択する
+
*** *その他のオプション > ストレージと最適化*
*** *Performance Service Level*を選択します。
+

NOTE: ONTAP 9.9.1以降では、カスタムのQoSポリシーを選択した場合、指定したローカル階層への手動配置を選択することもできます。




| ONTAP 9.8 
|===


. FCの場合は、FCスイッチをWWPNでゾーニングします。イニシエータごとに1つのゾーンを使用し、各ゾーンにすべてのターゲット ポートを配置します。
. ホストでLUNを検出します。
+
VMware vSphereでは、Virtual Storage Console（VSC）を使用してLUNを検出、初期化してください。

. LUNを初期化し、必要に応じてファイルシステムを作成します。
. ホストからLUNのデータの読み取りと書き込みができることを確認します。


--
.CLI
--
ONTAP CLIで、FCまたはiSCSIプロトコルを使用してSANサーバ用のストレージを提供するLUNを作成します。

. FCまたはiSCSIのライセンスがあることを確認します。
+
[source, cli]
----
system license show
----
+
[listing]
----

Package           Type    Description           Expiration
 ----------------- ------- --------------------- --------------------
 Base              site    Cluster Base License  -
 NFS               site    NFS License           -
 CIFS              site    CIFS License          -
 iSCSI             site    iSCSI License         -
 FCP               site    FCP License           -
----
. FC または iSCSI のライセンスがない場合は、 `license add` コマンドを使用します。
+
[source, cli]
----
license add -license-code <your_license_code>
----
. SVMでプロトコル サービスを有効にします。
+
*iSCSIの場合：*

+
[source, cli]
----
vserver iscsi create -vserver <svm_name> -target-alias <svm_name>
----
+
*FCの場合：*

+
[source, cli]
----
vserver fcp create -vserver <svm_name> -status-admin up
----
. 各ノードにSVM用のLIFを2つ作成します。
+
[source, cli]
----
network interface create -vserver <svm_name> -lif <lif_name> -role data -data-protocol <iscsi|fc> -home-node <node_name> -home-port <port_name> -address <ip_address> -netmask <netmask>
----
+
データを提供する各SVMで、ノードごとにiSCSIまたはFC LIFが少なくとも1つ必要です。ただし、冗長性を確保するためにはノードごとにLIFが2つ必要です。iSCSIでは、ノードごとに少なくとも2つのLIFを別々のイーサネット ネットワークに設定することを推奨します。

. LIF が作成され、動作ステータスが `online`であることを確認します：
+
[source, cli]
----
network interface show -vserver <svm_name> <lif_name>
----
. LUNを作成します。
+
[source, cli]
----
lun create -vserver <svm_name> -volume <volume_name> -lun <lun_name> -size <lun_size> -ostype linux -space-reserve <enabled|disabled>
----
+
LUN名は255文字以内で指定し、スペースは使用できません。

+

NOTE: NVFAILオプションは、ボリュームでLUNが作成されると、自動的に有効になります。

. igroupを作成します。
+
[source, cli]
----
igroup create -vserver <svm_name> -igroup <igroup_name> -protocol <fcp|iscsi|mixed> -ostype linux -initiator <initiator_name>
----
. LUNをigroupにマッピングします。
+
[source, cli]
----
lun mapping create -vserver <svm_name> -volume <volume_name> -lun <lun_name> -igroup <igroup_name>
----
. LUNが正しく設定されていることを確認します。
+
[source, cli]
----
lun show -vserver <svm_name>
----
. オプションで、link:create-port-sets-binding-igroups-task.html["ポートセットを作成し、igroupにバインドする"]。
. ホストのマニュアルに記載されている手順に従って、特定のホストでブロック アクセスを有効にします。
. Host Utilitiesを使用して、FCまたはiSCSIマッピングを完了し、ホスト上のLUNを検出します。


--
====
.関連情報
* link:index.html["SANの管理 - 概要"]
* https://docs.netapp.com/us-en/ontap-sanhost/index.html["ONTAP SAN Host Configuration"]
* link:../san-admin/manage-san-initiators-task.html["System ManagerでのSANイニシエータ グループの表示と管理"]
* https://www.netapp.com/pdf.html?item=/media/19680-tr-4017.pdf["NetAppテクニカル レポート4017：『ファイバチャネルSANのベストプラクティス』"^]

