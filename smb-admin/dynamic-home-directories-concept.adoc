---
permalink: smb-admin/dynamic-home-directories-concept.html 
sidebar: sidebar 
keywords: ontap, home, directories, directory, configure, smb, share, map, base, connect, set, variable, creating, create, separate, share, user, define, home, relationship, entry, point, svm, how ontap enables dynamic home directories 
summary: ONTAPホーム ディレクトリを使用すると、接続するユーザと一連の変数に基づいて異なるディレクトリにマッピングするSMB共有を設定できます。ユーザごとに個別の共有を作成する代わりに、いくつかのホーム ディレクトリ パラメータを使用して1つの共有を設定し、エントリ ポイント（共有）とホーム ディレクトリ（SVM上のディレクトリ）間のユーザの関係を定義できます。 
---
= ONTAP SMB サーバ上で動的ホーム ディレクトリを有効にする方法について学習します。
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAPホーム ディレクトリを使用すると、接続するユーザと一連の変数に基づいて異なるディレクトリにマッピングするSMB共有を設定できます。ユーザごとに個別の共有を作成する代わりに、いくつかのホーム ディレクトリ パラメータを使用して1つの共有を設定し、エントリ ポイント（共有）とホーム ディレクトリ（SVM上のディレクトリ）間のユーザの関係を定義できます。

ゲスト ユーザーとしてログインしているユーザーにはホーム ディレクトリ パスがないため、他のユーザーのホーム ディレクトリ パスにアクセスできません。ユーザーがディレクトリにマッピングされる方法は、以下の 4 つの変数によって決定されます：

* *共有名*
+
これは、ユーザーが接続する共有の名前です。この共有のホーム ディレクトリ プロパティを設定する必要があります。

+
共有名には次の動的な名前を使用できます：

+
** `%w` (ユーザーの Windows ユーザー名)
** `%d`（ユーザーの Windows ドメイン名）
**  `%u`（ユーザーにマッピングされたUNIXユーザー名）共有名をすべてのホーム ディレクトリ パス間で一意にするには、共有名に/`%w`または `%u`変数のいずれかを含める必要があります。共有名には `%d`と/`%w`変数の両方を含めること（例： `%d`/`%w`）も、固定部分と可変部分を含めることもできます（例：home_/`%w`）。


* *共有パス*
+
これは、共有によって定義され、共有名のいずれかに関連付けられた相対パスです。この相対パスが各検索パスに追加され、SVMのルートからユーザーのホーム ディレクトリ パス全体が生成されます。このパスは、静的（例： `home`）、動的（例： `%w`）、または静的と動的の両方の組み合わせ（例： `eng/%w`）のいずれかになります。

* *検索パス*
+
これは、指定した SVM のルートからの絶対パスのセットで、ONTAP がホーム ディレクトリを検索する際の指示となります。 `vserver cifs home-directory search-path add`コマンドを使用して、1つ以上の検索パスを指定できます。複数の検索パスを指定した場合、ONTAP は有効なパスが見つかるまで、指定された順序でパスを試行します。link:https://docs.netapp.com/us-en/ontap-cli/vserver-cifs-home-directory-search-path-add.html["ONTAPコマンド リファレンス"^]の `vserver cifs home-directory search-path add`の詳細をご覧ください。

* *ディレクトリ*
+
これは、ユーザーのために作成するホーム ディレクトリです。ディレクトリ名は通常、ユーザー名です。ホーム ディレクトリは、検索パスで定義されているディレクトリのいずれかに作成する必要があります。



例として、次の設定を考えてみましょう。

* ユーザー：John Smith
* ユーザー ドメイン：acme
* ユーザー名：jsmith
* SVM名：vs1
* ホーム ディレクトリ共有名 #1：home_ `%w` - 共有パス： `%w`
* ホーム ディレクトリ共有名 #2： `%w` - 共有パス： `%d/%w`
* 検索パス #1： `/vol0home/home`
* 検索パス #2： `/vol1home/home`
* 検索パス #3： `/vol2home/home`
* ホーム ディレクトリ： `/vol1home/home/jsmith`


シナリオ1：ユーザーは `\\vs1\home_jsmith`に接続します。これは最初のホーム ディレクトリ共有名と一致し、相対パス `jsmith`を生成します。ONTAPは、各検索パスを順にチェックすることで、 `jsmith`という名前のディレクトリを検索します：

* `/vol0home/home/jsmith` は存在しません。検索パス #2 に進みます。
* `/vol1home/home/jsmith`が存在するため、検索パス #3 はチェックされず、ユーザーはホーム ディレクトリに接続されます。


シナリオ2：ユーザーは `\\vs1\jsmith`に接続します。これは2番目のホーム ディレクトリ共有名と一致し、相対パス `acme/jsmith`を生成します。ONTAPは、各検索パスを順にチェックすることで、 `acme/jsmith`という名前のディレクトリを検索します：

* `/vol0home/home/acme/jsmith` は存在しません。検索パス #2 に進みます。
* `/vol1home/home/acme/jsmith` は存在しません。検索パス #3 に進みます。
* `/vol2home/home/acme/jsmith`が存在しません。ホーム ディレクトリが存在しないため、接続は失敗します。

