---
permalink: smb-admin/local-user-authentication-concept.html 
sidebar: sidebar 
keywords: local, user, access, data, cifs, server, create, authenticate, session, how local user authentication works 
summary: CIFS サーバのデータにアクセスする前に、ローカルユーザは認証されたセッションを作成する必要があります。 
---
= ローカルユーザ認証の仕組み
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
CIFS サーバのデータにアクセスする前に、ローカルユーザは認証されたセッションを作成する必要があります。

SMB はセッションベースであるため、ユーザの ID は、最初にセッションがセットアップされたときに一度だけ確認できます。CIFS サーバでは、ローカルユーザの認証時に NTLM ベースの認証が使用されます。NTLMv1 と NTLMv2 の両方がサポートされています。

ONTAP では、 3 つの事例でローカル認証が使用されます。各事例は、ユーザ名のドメイン部分（ DOMAIN\user 形式）が CIFS サーバのローカルドメイン名（ CIFS サーバ名）と一致するかどうかによって異なります。

* ドメイン部分が一致します
+
データへのアクセスを要求するときにローカルユーザクレデンシャルを指定したユーザが、 CIFS サーバでローカルに認証されます。

* ドメイン部分が一致しません
+
ONTAP は、 CIFS サーバが属しているドメインのドメインコントローラで NTLM 認証を試行します。認証に成功した場合は、ログインが完了します。成功しなかった場合は、認証が失敗した理由によって次の動作が異なります。

+
たとえば、ユーザは Active Directory 内に存在するが、パスワードが無効であるか期限切れになっている場合は、 ONTAP は CIFS サーバ上の対応するローカルユーザアカウントの使用を試みません。代わりに、認証は失敗します。その他にも、 ONTAP が CIFS サーバ上の対応するローカルアカウントを使用している場合、そのアカウントが存在するときは、 NetBIOS ドメイン名が一致していなくても認証に使用するケースがあります。たとえば、一致するドメインアカウントが存在するが無効になっている場合、 ONTAP は、 CIFS サーバ上の対応するローカルアカウントを認証に使用します。

* ドメイン部分は指定されません
+
ONTAP はまず、ローカルユーザとしての認証を試行します。ローカルユーザとしての認証に失敗した場合は、 ONTAP が、 CIFS サーバが属しているドメインのドメインコントローラでユーザを認証します。



ローカルユーザまたはドメインユーザの認証が完了したら、 ONTAP でローカルグループメンバーシップおよび権限が考慮される完全なユーザアクセストークンが構成されます。

ローカルユーザの NTLM 認証の詳細については、 Microsoft Windows のマニュアルを参照してください。

.関連情報
xref:enable-disable-local-user-authentication-task.adoc[ローカルユーザ認証の有効化と無効化]
