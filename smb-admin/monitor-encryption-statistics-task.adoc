---
permalink: smb-admin/monitor-encryption-statistics-task.html 
sidebar: sidebar 
keywords: monitor, smb, encryption, statistics, determine, establish, session, share, connection, encrypt, monitor smb encryption statistics 
summary: SMB暗号化の統計を監視し、確立されたセッションおよび共有接続のうち、暗号化されたものと暗号化されていないものを区別できます。 
---
= ONTAP SMB暗号化統計を監視する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SMB暗号化の統計を監視し、確立されたセッションおよび共有接続のうち、暗号化されたものと暗号化されていないものを区別できます。

.タスク概要
 `statistics`コマンドは、advanced権限レベルで、暗号化されたSMBセッションと共有接続の数を監視するために使用できる次のカウンターを提供します：

|===
| カウンタ名 | 説明 


 a| 
`encrypted_sessions`
 a| 
暗号化されたSMB 3.0セッション数



 a| 
`encrypted_share_connections`
 a| 
ツリー接続によって暗号化された共有数



 a| 
`rejected_unencrypted_sessions`
 a| 
クライアントに暗号化機能がないために拒否されたセッション セットアップ数



 a| 
`rejected_unencrypted_shares`
 a| 
クライアントに暗号化機能がないために拒否された共有マッピング数

|===
これらのカウンタでは、次の統計オブジェクトを利用できます。

* `cifs`を使用すると、すべての SMB 3.0 セッションの SMB 暗号化を監視できます。
+
SMB 3.0 の統計情報は、 `cifs` オブジェクトの出力に含まれています。暗号化されたセッション数とセッションの総数を比較したい場合は、 `encrypted_sessions` カウンタの出力と `established_sessions` カウンタの出力を比較してください。

+
暗号化された共有接続の数を共有接続の合計数と比較する場合は、 `encrypted_share_connections`カウンターの出力を `connected_shares`カウンターの出力と比較できます。

* `rejected_unencrypted_sessions`は、SMB暗号化をサポートしていないクライアントから、暗号化を必要とするSMBセッションを確立しようとした回数を示します。
* `rejected_unencrypted_shares`は、SMB 暗号化をサポートしていないクライアントから、暗号化を必要とする SMB 共有への接続を試行した回数を示します。


データを取得して表示するには、統計サンプルの収集を開始する必要があります。データ収集を停止しなければ、サンプルからデータを表示できます。データ収集を停止すると、固定のサンプル データが表示されます。データ収集を停止しなければ、以前のクエリとの比較に使用できる更新されたデータを入手できます。この比較は、パフォーマンスの傾向を確認するのに役立ちます。

.手順
. 権限レベルを詳細に設定します：+
`set -privilege advanced`
. データ収集を開始する：+
`statistics start -object {cifs|smb1|smb2} -instance _instance_ -sample-id _sample_ID_ [-node _node_name_]`
+
 `-sample-id`パラメータを指定しない場合、コマンドはサンプル識別子を生成し、このサンプルをCLIセッションのデフォルト サンプルとして定義します。 `-sample-id`の値はテキスト文字列です。同じCLIセッション中にこのコマンドを実行し、 `-sample-id`パラメータを指定しない場合、コマンドは以前のデフォルト サンプルを上書きします。

+
オプションで、統計情報を収集するノードを指定できます。ノードを指定しない場合、サンプルは、クラスタ内のすべてのノードについて統計情報を収集します。

+
 `statistics start`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/statistics-start.html["ONTAPコマンド リファレンス"^]を参照してください。

.  `statistics stop`コマンドを使用して、サンプルのデータ収集を停止します。
+
 `statistics stop`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/statistics-stop.html["ONTAPコマンド リファレンス"^]を参照してください。

. SMB暗号化統計情報を表示します。
+
|===
| ...の情報を表示する場合は | 入力する内容 


 a| 
暗号化されたセッション
 a| 
`show -sample-id _sample_ID_ -counter encrypted_sessions|_node_name_ [-node _node_name_]`



 a| 
暗号化されたセッションと確立されたセッション
 a| 
`show -sample-id _sample_ID_ -counter encrypted_sessions|established_sessions|_node_name_ [-node _node_name_]`



 a| 
暗号化された共有接続
 a| 
`show -sample-id _sample_ID_ -counter encrypted_share_connections|_node_name_ [-node _node_name_]`



 a| 
暗号化された共有接続と接続された共有
 a| 
`show -sample-id _sample_ID_ -counter encrypted_share_connections|connected_shares|_node_name_ [-node _node_name_]`



 a| 
拒否された暗号化されていないセッション
 a| 
`show -sample-id _sample_ID_ -counter rejected_unencrypted_sessions|_node_name_ [-node _node_name_]`



 a| 
拒否された暗号化されていない共有接続
 a| 
`show -sample-id _sample_ID_ -counter rejected_unencrypted_share|_node_name_ [-node _node_name_]`

|===
+
単一のノードの情報のみを表示する場合は、オプションの `-node`パラメータを指定します。

+
 `statistics show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/statistics-show.html["ONTAPコマンド リファレンス"^]をご覧ください。

. admin権限レベルに戻ります：+
`set -privilege admin`


.例
[%collapsible]
====
次の例は、「vs1」というStorage Virtual Machine（SVM）について、SMB 3.0の暗号化統計情報を監視する方法を示します。

次のコマンドは、advanced権限レベルへの変更を行います。

[listing]
----
cluster1::> set -privilege advanced

Warning: These advanced commands are potentially dangerous; use them only when directed to do so by support personnel.
Do you want to continue? {y|n}: y
----
次のコマンドは、新しいサンプルのデータ収集を開始します。

[listing]
----
cluster1::*> statistics start -object cifs -sample-id smbencryption_sample -vserver vs1
Statistics collection is being started for Sample-id: smbencryption_sample
----
次のコマンドは、サンプルのデータ収集を停止します。

[listing]
----
cluster1::*> statistics stop -sample-id smbencryption_sample
Statistics collection is being stopped for Sample-id: smbencryption_sample
----
次のコマンドは、指定したノードについて、暗号化されたSMBセッション数と確立されたセッション数をサンプルから表示します。

[listing]
----
cluster2::*> statistics show -object cifs -counter established_sessions|encrypted_sessions|node_name –node node_name

Object: cifs
Instance: [proto_ctx:003]
Start-time: 4/12/2016 11:17:45
End-time: 4/12/2016 11:21:45
Scope: vsim2

    Counter                               Value
    ----------------------------  ----------------------
    established_sessions                     1
    encrypted_sessions                       1

2 entries were displayed
----
次のコマンドは、指定したノードについて、拒否された暗号化されていないSMBセッション数をサンプルから表示します。

[listing]
----
clus-2::*> statistics show -object cifs -counter rejected_unencrypted_sessions –node node_name

Object: cifs
Instance: [proto_ctx:003]
Start-time: 4/12/2016 11:17:45
End-time: 4/12/2016 11:21:51
Scope: vsim2

    Counter                                    Value
    ----------------------------    ----------------------
    rejected_unencrypted_sessions                1

1 entry was displayed.
----
次のコマンドは、指定したノードについて、接続されたSMB共有数と暗号化されたSMB共有数をサンプルから表示します。

[listing]
----
clus-2::*> statistics show -object cifs -counter connected_shares|encrypted_share_connections|node_name –node node_name

Object: cifs
Instance: [proto_ctx:003]
Start-time: 4/12/2016 10:41:38
End-time: 4/12/2016 10:41:43
Scope: vsim2

    Counter                                     Value
    ----------------------------    ----------------------
    connected_shares                              2
    encrypted_share_connections                   1

2 entries were displayed.
----
次のコマンドは、指定したノードについて、拒否された暗号化されていないSMB共有接続数をサンプルから表示します。

[listing]
----
clus-2::*> statistics show -object cifs -counter rejected_unencrypted_shares –node node_name

Object: cifs
Instance: [proto_ctx:003]
Start-time: 4/12/2016 10:41:38
End-time: 4/12/2016 10:42:06
Scope: vsim2

    Counter                                     Value
    --------------------------------    ----------------------
    rejected_unencrypted_shares                   1

1 entry was displayed.
----
====
.関連情報
* xref:determine-statistics-objects-counters-available-task.adoc[サーバー上で利用可能な統計、オブジェクト、カウンターを決定する]
* link:../performance-admin/index.html["パフォーマンスの監視と管理 - 概要"]

