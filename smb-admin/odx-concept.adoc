---
permalink: smb-admin/odx-concept.html 
sidebar: sidebar 
keywords: odx, copy, offload, token-based, mechanism, read, write, writing, cifs, server, routing, route, data, client, destination, how odx works 
summary: ODXのコピー オフロードでは、トークンベースのメカニズムを使用して、ODX対応のCIFSサーバ内、またはODX対応のCIFSサーバ間でデータの読み取りと書き込みを行います。CIFSサーバは、ホスト経由でデータをルーティングする代わりに、データを表す小さなトークンをクライアントに送信します。そのトークンをODXクライアントがデスティネーション サーバに提示することで、デスティネーション サーバはそのトークンで表されるデータをソースからデスティネーションに転送できます。 
---
= ONTAP SMBサーバ上のODXについて学ぶ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ODXのコピー オフロードでは、トークンベースのメカニズムを使用して、ODX対応のCIFSサーバ内、またはODX対応のCIFSサーバ間でデータの読み取りと書き込みを行います。CIFSサーバは、ホスト経由でデータをルーティングする代わりに、データを表す小さなトークンをクライアントに送信します。そのトークンをODXクライアントがデスティネーション サーバに提示することで、デスティネーション サーバはそのトークンで表されるデータをソースからデスティネーションに転送できます。

ODXクライアントは、CIFSサーバがODX対応であることを確認すると、ソース ファイルを開き、CIFSサーバからのトークンを要求します。デスティネーション ファイルを開いたあと、クライアントはトークンを使用して、ソースからデスティネーションにデータを直接コピーするようサーバに指示します。

[NOTE]
====
ソースとデスティネーションは、コピー処理の範囲に応じて、同じStorage Virtual Machine（SVM）上か異なるSVM上にあるものを使用できます。

====
トークンは、データのポイントインタイムの状態を表します。たとえば、データを異なるストレージ間でコピーする場合、データ セグメントを表すトークンが要求元クライアントに返されます。このトークンをクライアントがデスティネーションにコピーすることにより、基盤となるデータをクライアント経由でコピーする必要がなくなります。

ONTAPは、8MB分のデータを表すトークンをサポートしています。8MBを超えるODXコピーは、それぞれが8MBのデータを表す複数のトークンを使用して実行されます。

次の図は、ODXコピー処理の手順を示しています。

image:how-odx-copy-offload-works.gif["ODXコピー操作に関連する手順"]

. Windowsエクスプローラやコマンドライン インターフェイスを使用して、または仮想マシン移行の一環として、ユーザがファイルのコピーまたは移動を行います。または、アプリケーションによってファイルのコピーまたは移動が開始されます。
. ODX対応のクライアントによって、この転送要求が自動的にODX要求に変換されます。
+
CIFSサーバに送信されるODX要求には、トークンに対する要求が含まれています。

. CIFSサーバでODXが有効になっていて、SMB 3.0経由で接続されている場合は、CIFSサーバによってソースのデータを論理的に表すトークンが生成されます。
. クライアントは、データを表すトークンを受信すると、そのトークンに書き込み要求を追加してデスティネーションCIFSサーバに送信します。
+
このデータが、ネットワーク経由でソースからクライアントにコピーされ、クライアントからデスティネーションにコピーされる唯一のデータです。

. トークンがストレージ サブシステムに配信されます。
. SVMによってコピーまたは移動が内部的に実行されます。
+
コピーまたは移動されるファイルが8MBを超える場合、実行には複数のトークンが必要です。コピーが完了するまで、手順2～6が繰り返し実行されます。



[NOTE]
====
ODXのオフロード コピーで障害が発生すると、コピーまたは移動の処理は、従来の読み取りと書き込みの処理を使用して実行されます。同様に、デスティネーションCIFSサーバでODXがサポートされていない場合や、ODXが無効になっている場合は、コピーまたは移動の処理は従来の読み取りと書き込みの処理を使用して実行されます。

====