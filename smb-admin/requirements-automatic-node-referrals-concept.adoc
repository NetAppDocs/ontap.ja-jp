---
permalink: smb-admin/requirements-automatic-node-referrals-concept.html 
sidebar: sidebar 
keywords: smb, automatic, node, referral, autolocation, aware, requirement, version, ontap, feature, support, guideline, requirement, requirements and guidelines for using automatic node referrals 
summary: SMB 自動ノードリファーラル（オートロケーションとも呼ばれます）を使用する前に、この機能をサポートする ONTAP のバージョンなど、一定の要件について確認しておく必要があります。サポートされる SMB プロトコルのバージョンやその他の特別なガイドラインについても確認しておく必要があります。 
---
= 自動ノードリファーラルの使用に関する要件とガイドライン
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SMB 自動ノードリファーラル（別名 _autolocation _ ）を使用する前に、この機能をサポートする ONTAP のバージョンなど、一定の要件について理解しておく必要があります。サポートされる SMB プロトコルのバージョンやその他の特別なガイドラインについても確認しておく必要があります。



== ONTAP のバージョンとライセンスの要件

* クラスタ内のすべてのノードで、自動ノードリファーラルがサポートされているバージョンの ONTAP が実行されている必要があります。
* オートロケーションを使用する SMB 共有でワイドリンクが有効になっている必要があります。
* CIFS のライセンスが有効になっていて、 SVM に SMB サーバが配置されている必要があります。




== SMB プロトコルのバージョン

* SVM について ONTAP は、すべてのバージョンの SMB で自動ノードリファーラルがサポートされます。




== SMB クライアントの要件

SMB 自動ノードリファーラルは、 ONTAP でサポートされるすべての Microsoft クライアントでサポートされます。

ONTAP でサポートされる Windows クライアントの最新情報については、 Interoperability Matrix を参照してください。

link:http://mysupport.netapp.com/matrix["NetApp Interoperability Matrix Tool で確認できます"^]



== データ LIF の要件

データ LIF を SMB クライアントのリファーラルとして使用する可能性がある場合は、 NFS と CIFS の両方を有効にしたデータ LIF を作成する必要があります。

自動ノードリファーラルは、ターゲットノードのデータ LIF で NFS プロトコルまたは SMB プロトコルのどちらかが有効になっていない場合は機能しないことがあります。

この要件が満たされない場合でも、データアクセスには影響しません。SMB クライアントは、 SVM への接続に使用した元の LIF を使用して共有をマッピングします。



== 参照された SMB 接続を確立する際の NTLM 認証の要件

CIFS サーバを含むドメインと自動ノードリファーラルを使用するクライアントを含むドメインで、 NTLM 認証が許可されている必要があります。

リファーラルを作成する際には、 SMB サーバから Windows クライアントに参照先の IP アドレスが渡されます。IP アドレスを使用した接続には NTLM 認証が使用されるため、参照された接続に対しては Kerberos 認証は実行されません。

これは、WindowsクライアントがKerberosで使用されるサービスプリンシパル名（の形式）を作成できないためです `service/NetBIOS name` および `service/FQDN`）。これは、クライアントがサービスにKerberosチケットを要求できないことを意味します。



== 自動ノードリファーラルでホームディレクトリ機能を使用する場合のガイドラインを次に示します

ホームディレクトリ共有プロパティを有効にして共有を設定した場合、ホームディレクトリの設定で 1 つ以上のホームディレクトリ検索パスを設定できます。この検索パスで、 SVM のボリュームを含む各ノードに格納されているボリュームを指定できます。クライアントはリファーラルを受け取り、使用できるアクティブなローカルデータ LIF があれば、ホームユーザのホームディレクトリに対してローカルな、参照された LIF を介して接続します。

SMB 1.0 クライアントで自動ノードリファーラルを有効にして動的ホームディレクトリにアクセスする場合は注意が必要です。SMB 1.0 クライアントでは、認証を行う前、つまり SMB サーバに対してユーザの名前が指定されていない段階で自動ノードリファーラルが必要になるからです。SMB 1.0 クライアントで SMB ホームディレクトリへのアクセスが正常に機能するのは、次の条件に該当する場合です。

* SMB ホームディレクトリは、「 %w 」（ Windows ユーザ名）または「 %u 」（マッピングされた UNIX ユーザ名）のような単純な名前を使用するように設定されており、「 %d\%w 」（ドメイン名 \ ユーザ名）のようなドメイン名形式の名前では使用されません。
* ホーム・ディレクトリ共有を作成するときに、 CIFS ホーム・ディレクトリ共有名は変数（「 %w 」または「 %u 」）で設定され、「 home 」などの静的な名前では設定されません。


SMB 2.x クライアントと SMB 3.0 クライアントの場合は、自動ノードリファーラルを使用してホームディレクトリにアクセスする際に特別なガイドラインはありません。



== 参照接続が確立されている CIFS サーバで自動ノードリファーラルを無効にする場合のガイドラインを次に示します

オプションを有効にしたあとに自動ノードリファーラルを無効にした場合、参照 LIF に現在接続されているクライアントでは参照接続が維持されます。ONTAP では SMB 自動ノードリファーラルのメカニズムとして DFS リファーラルを使用しているため、オプションを無効にしたあとも、参照接続用にクライアントにキャッシュされている DFS リファーラルがタイムアウトするまでは参照 LIF に再接続できます。これは、自動ノードリファーラルがサポートされないバージョンの ONTAP にリバートした場合も同様です。クライアントは、クライアントのキャッシュから DFS リファーラルがタイムアウトするまで、引き続きリファーラルを使用します。

オートロケーションは、 SMB 自動ノードリファーラルを使用してクライアントに SVM のデータボリュームを所有しているノード上の LIF を参照させることで、 SMB クライアントのパフォーマンスを向上させます。SMB クライアントが SVM 上でホストされている SMB 共有に接続するときに、要求されたデータを所有しておらず、クラスタインターコネクトネットワークを使用してデータを取得しているノード上の LIF を使用して接続することがあります。SMB 接続が要求されたデータを含むノード上にある LIF を使用している場合、クライアントへの応答時間が短縮されます。

ONTAP では、 Microsoft の分散ファイルシステム（ DFS ）リファーラルを使用して、要求されたファイルやフォルダがネームスペース内の別の場所でホストされていることを SMB クライアントに通知することで、この機能を実現します。ノードがリファーラルを作成するのは、データを含むノード上に SVM の LIF があることを特定した場合です。リファーラルは、クライアントの接続に使用されている共有のルートの場所に基づいて作成されます。

リファーラルは SMB ネゴシエーション中に発生します。リファーラルは、接続が確立される前に作成されます。ONTAP がターゲットノードに参照先の SMB クライアントを通知したあと、接続が確立され、それ以降、クライアントはその参照先 LIF パスを介してデータにアクセスします。これにより、クライアントにはより高速なデータアクセスが提供され、クラスタの余分な通信も回避されます。



== Mac OS クライアントで自動ノードリファーラルを使用する際のガイドラインを次に示します

Mac OS では Microsoft の Distributed File System （ DFS ；分散ファイルシステム）がサポートされていますが、 Mac OS X クライアントは SMB 自動ノードリファーラルをサポートしていません。Windows クライアントは、 SMB 共有に接続する前に DFS リファーラル要求を行います。ONTAP は、要求されたデータをホストしているノード上で見つかったデータ LIF へのリファーラルを提供します。これにより、クライアントの応答時間が短縮されます。Mac OS でも DFS はサポートされますが、 Mac OS クライアントの動作は Windows クライアントとまったく同じではありません。

.関連情報
xref:dynamic-home-directories-concept.html[ONTAP で動的ホームディレクトリを有効にする方法]

link:../networking/index.html["Network Management の略"]

https://mysupport.netapp.com/NOW/products/interoperability["NetApp Interoperability Matrix Tool で確認できます"^]
