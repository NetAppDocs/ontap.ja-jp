---
permalink: smb-admin/requirements-automatic-node-referrals-concept.html 
sidebar: sidebar 
keywords: smb, automatic, node, referral, autolocation, aware, requirement, version, ontap, feature, support, guideline, requirement, requirements and guidelines for using automatic node referrals 
summary: SMB 自動ノードリファーラル（オートロケーションとも呼ばれます）を使用する前に、この機能をサポートする ONTAP のバージョンなど、一定の要件について確認しておく必要があります。また、サポートされるSMBプロトコルのバージョンやその他の特別なガイドラインについても確認しておく必要があります。 
---
= 自動ノードリファーラルの使用に関する要件とガイドライン
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SMB 自動ノードリファーラル（別名 _autolocation _ ）を使用する前に、この機能をサポートする ONTAP のバージョンなど、一定の要件について理解しておく必要があります。また、サポートされるSMBプロトコルのバージョンやその他の特別なガイドラインについても確認しておく必要があります。



== ONTAPのバージョンとライセンスの要件

* クラスタ内のすべてのノードで、自動ノードリファーラルがサポートされているバージョンのONTAPが実行されている必要があります。
* オートロケーションを使用するには、SMB共有でワイドリンクが有効になっている必要があります。
* CIFSのライセンスが有効になっていて、SVMにSMBサーバが配置されている必要があります。SMBライセンスはに含まれていlink:../system-admin/manage-licenses-concept.html#licenses-included-with-ontap-one["ONTAP One"]ます。ONTAP Oneをお持ちでなく、ライセンスがインストールされていない場合は、営業担当者にお問い合わせください。




== SMBプロトコルのバージョン

* SVMについては、すべてのバージョンのSMBで自動ノード リファーラルがサポートされます。




== SMBクライアントの要件

SMB自動ノード リファーラルは、ONTAPでサポートされるすべてのMicrosoftクライアントでサポートされます。

ONTAPでサポートされるWindowsクライアントの最新情報については、Interoperability Matrixを参照してください。

link:http://mysupport.netapp.com/matrix["NetApp Interoperability Matrix Tool"^]



== データLIFの要件

データLIFをSMBクライアントのリファーラルとして使用する可能性がある場合は、NFSとCIFSの両方を有効にしたデータLIFを作成する必要があります。

自動ノードリファーラルは、ターゲットノードのデータLIFでNFSプロトコルまたはSMBプロトコルのみが有効になっている場合は機能しないことがあります。

この要件が満たされていない場合でも、データアクセスには影響しません。SMBクライアントは、SVMへの接続に使用した元のLIFを使用して共有をマッピングします。



== 参照されたSMB接続を確立する際のNTLM認証の要件

CIFSサーバが含まれているドメイン、および自動ノードリファーラルを使用するクライアントが含まれているドメインで、NTLM認証が許可されている必要があります。

リファーラルを作成する際には、SMBサーバからWindowsクライアントに参照先のIPアドレスが渡されます。IPアドレスを使用した接続ではNTLM認証が使用されるため、参照された接続ではKerberos認証は実行されません。

これは、WindowsクライアントがKerberosで使用されるサービスプリンシパル名（および `service/FQDN`の形式）を作成できず、クライアントがサービスにKerberosチケットを要求できないためです `service/NetBIOS name`。



== 自動ノードリファーラルでホームディレクトリ機能を使用する場合のガイドライン

ホームディレクトリ共有プロパティを有効にして共有を設定すると、ホームディレクトリ設定用に1つ以上のホームディレクトリ検索パスを設定できます。この検索パスで、SVMのボリュームを含む各ノードに格納されているボリュームを指定できます。クライアントはリファーラルを受け取り、使用可能なアクティブなローカルデータLIFがある場合は、ホームユーザのホームディレクトリに対してローカルな参照されたLIFを介して接続します。

SMB 1.0クライアントで自動ノードリファーラルを有効にして動的ホームディレクトリにアクセスする場合は注意が必要です。SMB 1.0クライアントでは、認証を行う前、つまりSMBサーバでユーザの名前が指定されていない前に自動ノードリファーラルが必要になるためです。ただし、次の条件に該当する場合、SMB 1.0クライアントでSMBホームディレクトリへのアクセスは正しく機能します。

* SMB ホームディレクトリは、「 %w 」（ Windows ユーザ名）または「 %u 」（マッピングされた UNIX ユーザ名）のような単純な名前を使用するように設定されており、「 %d\%w 」（ドメイン名 \ ユーザ名）のようなドメイン名形式の名前では使用されません。
* ホーム・ディレクトリ共有を作成するときに、 CIFS ホーム・ディレクトリ共有名は変数（「 %w 」または「 %u 」）で設定され、「 home 」などの静的な名前では設定されません。


SMB 2.xクライアントとSMB 3.0クライアントの場合、自動ノードリファーラルを使用してホームディレクトリにアクセスする際に特別なガイドラインはありません。



== 参照接続が確立されているCIFSサーバで自動ノードリファーラルを無効にする場合のガイドライン

オプションを有効にしたあとに自動ノードリファーラルを無効にした場合、参照LIFに現在接続されているクライアントでは参照接続が維持されます。ONTAPではSMB自動ノードリファーラルのメカニズムとしてDFSリファーラルを使用するため、オプションを無効にしたあとも、参照接続用にクライアントにキャッシュされているDFSリファーラルがタイムアウトするまでは参照LIFに再接続できます。これは、自動ノードリファーラルがサポートされないバージョンのONTAPにリバートした場合も同様です。クライアントは、DFSリファーラルがクライアントのキャッシュからタイムアウトするまで、リファーラルを使用し続けます。

オートロケーションでは、SMB自動ノードリファーラルを使用して、SVMのデータボリュームを所有するノード上のLIFをクライアントに参照させることで、SMBクライアントのパフォーマンスを向上させます。SMBクライアントがSVM上でホストされているSMB共有に接続するときに、要求されたデータを所有しておらず、クラスタインターコネクトネットワークを使用してデータを取得しているノード上のLIFを使用して接続することがあります。SMB接続で要求されたデータを含むノード上のLIFを使用している場合、クライアントへの応答時間が短縮されます。

ONTAPでは、Microsoftの分散ファイルシステム（DFS）リファーラルを使用して、要求されたファイルやフォルダがネームスペース内の別の場所でホストされていることをSMBクライアントに通知することで、この機能を実現します。ノードがリファーラルを作成するのは、データを含むノード上にSVMのLIFがあることを特定した場合です。リファーラルは、クライアントの接続に使用する共有のルートの場所に基づいて作成されます。

リファーラルはSMBネゴシエーション中に発生します。リファーラルは、接続が確立される前に作成されます。ONTAPがターゲット ノードに参照先のSMBクライアントを通知したあと、接続が確立され、それ以降、クライアントはその参照先LIFパスを介してデータにアクセスします。これにより、クライアントにはより高速なデータ アクセスが提供され、クラスタの余分な通信も回避されます。



== Mac OSクライアントで自動ノード リファーラルを使用する際のガイドライン

Mac OSはMicrosoftのDistributed File System（DFS;分散ファイルシステム）をサポートしていますが、Mac OS XクライアントはSMB自動ノード リファーラルをサポートしていません。Windowsクライアントは、SMB共有に接続する前にDFSリファーラル要求を行います。ONTAPは、要求されたデータをホストしているノード上で見つかったデータLIFへのリファーラルを提供します。これによって、クライアントの応答時間が短縮されます。Mac OSでもDFSはサポートされますが、Mac OSクライアントの動作はWindowsクライアントとまったく同じではありません。

.関連情報
xref:dynamic-home-directories-concept.html[ONTAPニオケルドウテキホームディレクトリノシクミ]

link:../networking/networking_reference.html["ネットワーク管理"]

https://mysupport.netapp.com/NOW/products/interoperability["NetApp Interoperability Matrix Tool"^]
