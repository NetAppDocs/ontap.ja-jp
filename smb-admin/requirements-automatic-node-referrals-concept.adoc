---
permalink: smb-admin/requirements-automatic-node-referrals-concept.html 
sidebar: sidebar 
keywords: smb, automatic, node, referral, autolocation, aware, requirement, version, ontap, feature, support, guideline, requirement, requirements and guidelines for using automatic node referrals 
summary: SMB自動ノード リファーラル（オートロケーションとも呼ばれます）を使用する前に、この機能をサポートするONTAPのバージョンなど、特定の要件を理解しておく必要があります。また、サポートされるSMBプロトコルのバージョンやその他の特別なガイドラインについても知っておく必要があります。 
---
= ONTAP SMBサーバで自動ノードリファーラルを使用するための要件とガイドライン
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SMB自動ノード リファーラル（_オートロケーション_とも呼ばれます）を使用する前に、この機能をサポートするONTAPのバージョンなど、特定の要件を理解しておく必要があります。また、サポートされるSMBプロトコルのバージョンやその他の特別なガイドラインについても知っておく必要があります。



== ONTAPのバージョンとライセンスの要件

* クラスタ内のすべてのノードで、自動ノード リファーラルがサポートされているバージョンのONTAPが実行されている必要があります。
* オートロケーションを使用するSMB共有でワイドリンクが有効になっている必要があります。
* CIFSのライセンスが必要であり、SVM上にSMBサーバが存在している必要があります。SMBライセンスはlink:../system-admin/manage-licenses-concept.html#licenses-included-with-ontap-one["ONTAP One"]に含まれています。ONTAP Oneをお持ちでなく、ライセンスがインストールされていない場合は、営業担当者にお問い合わせください。




== SMBプロトコルのバージョン

* SVMについては、すべてのバージョンのSMBで自動ノード リファーラルがサポートされます。




== SMBクライアントの要件

SMB自動ノード リファーラルは、ONTAPでサポートされるすべてのMicrosoftクライアントでサポートされます。

ONTAPでサポートされるWindowsクライアントの最新情報については、Interoperability Matrixを参照してください。

link:http://mysupport.netapp.com/matrix["NetApp Interoperability Matrix Tool"^]



== データLIFの要件

データLIFをSMBクライアントのリファーラルとして使用する可能性がある場合は、NFSとCIFSの両方を有効にしたデータLIFを作成する必要があります。

自動ノード リファーラルは、ターゲット ノードのデータLIFでNFSプロトコルまたはSMBプロトコルのどちらかが有効になっていない場合は機能しないことがあります。

この要件が満たされない場合でも、データ アクセスには影響がありません。SMBクライアントは、SVMへの接続に使用した元のLIFを使用して共有をマッピングします。



== 参照されたSMB接続を確立する際のNTLM認証の要件

CIFSサーバを含むドメインと自動ノード リファーラルを使用するクライアントを含むドメインで、NTLM認証が許可されている必要があります。

リファーラルを作成する際には、SMBサーバからWindowsクライアントに参照先のIPアドレスが渡されます。IPアドレスを使用した接続にはNTLM認証が使用されるため、参照された接続に対してはKerberos認証は実行されません。

これは、Windowsクライアントが、Kerberosで使用されるサービスプリンシパル名（形式は `service/NetBIOS name`および `service/FQDN`）を作成できないために発生します。つまり、クライアントはサービスへのKerberosチケットを要求できません。



== 自動ノード リファーラルでホーム ディレクトリ機能を使用する場合のガイドライン

ホーム ディレクトリ共有プロパティを有効にして共有を設定した場合、ホーム ディレクトリ設定で1つ以上のホーム ディレクトリ検索パスを設定できます。この検索パスで、SVMのボリュームを含む各ノードに格納されているボリュームを指定できます。クライアントはリファーラルを受け取り、使用できるアクティブなローカル データLIFがあれば、ホーム ユーザのホーム ディレクトリに対してローカルな、参照されたLIFを介して接続します。

SMB 1.0クライアントで自動ノード リファーラルを有効にして動的ホーム ディレクトリにアクセスする場合は注意が必要です。SMB 1.0クライアントでは、認証を行う前、すなわちSMBサーバに対してユーザの名前が指定されていない段階で自動ノード リファーラルが必要になるからです。SMB 1.0クライアントでSMBホーム ディレクトリへのアクセスが正常に機能するのは、以下に該当する場合です。

* SMBホーム ディレクトリは、「`%w`」（Windowsユーザー名）や「`%u`」（マッピングされたUNIXユーザー名）などの単純な名前を使用するように設定されており、「`%d\%w `」（ドメイン名\ユーザー名）などのドメイン名形式の名前は使用されていません。
* ホーム ディレクトリ共有を作成する場合、CIFSホーム ディレクトリ共有名は、「`HOME`」などの静的な名前ではなく、変数（「`%w`」または「`%u`」）で構成されます。


SMB 2.xクライアントとSMB 3.0クライアントの場合は、自動ノード リファーラルを使用してホーム ディレクトリにアクセスする際に特別なガイドラインはありません。



== 参照接続が確立されているCIFSサーバで自動ノード リファーラルを無効にする場合のガイドライン

自動ノード リファーラルのオプションを有効から無効に切り替えた場合、参照LIFに現在接続されているクライアントでは参照接続が維持されます。ONTAPではSMB自動ノード リファーラルのメカニズムとしてDFSリファーラルを使用しているため、オプションを無効にしたあとも、参照接続用にクライアントにキャッシュされているDFSリファーラルがタイムアウトするまでは参照LIFに再接続できます。これは、自動ノード リファーラルがサポートされないバージョンのONTAPにリバートした場合も同様です。クライアントは、クライアントのキャッシュからDFSリファーラルがタイムアウトするまで、引き続きリファーラルを使用します。

オートロケーションは、SMB自動ノード リファーラルを使用してクライアントにSVMのデータ ボリュームを所有しているノード上のLIFを参照させることで、SMBクライアントのパフォーマンスを向上させます。SMBクライアントがSVM上でホストされているSMB共有に接続するときに、要求されたデータを所有していない、クラスタ インターコネクト ネットワークを使用してデータを取得しているノード上のLIFを使用して接続することがあります。SMB接続が要求されたデータを含むノード上にあるLIFを使用している場合、クライアントへの応答時間が短縮されます。

ONTAPでは、Microsoftの分散ファイルシステム（DFS）リファーラルを使用して、要求されたファイルやフォルダがネームスペース内の別の場所でホストされていることをSMBクライアントに通知することで、この機能を実現します。ノードがリファーラルを作成するのは、データを含むノード上にSVMのLIFがあることを特定した場合です。リファーラルは、クライアント接続が経由する、共有のルートの場所に基づいて作成されます。

リファーラルは、SMBネゴシエーション中に発生します。リファーラルは、接続が確立される前に作成されます。ONTAPがターゲット ノードに参照先のSMBクライアントを通知したあと、接続が確立され、それ以降、クライアントはその参照先LIFパスを介してデータにアクセスします。これにより、クライアントにはより高速なデータ アクセスが提供され、クラスタの余分な通信も回避されます。



== Mac OSクライアントで自動ノード リファーラルを使用する際のガイドライン

Mac OSはMicrosoftのDistributed File System（DFS;分散ファイルシステム）をサポートしていますが、Mac OS XクライアントはSMB自動ノード リファーラルをサポートしていません。Windowsクライアントは、SMB共有に接続する前にDFSリファーラル要求を行います。ONTAPは、要求されたデータをホストしているノード上で見つかったデータLIFへのリファーラルを提供します。これによって、クライアントの応答時間が短縮されます。Mac OSでもDFSはサポートされますが、Mac OSクライアントの動作はWindowsクライアントとまったく同じではありません。

.関連情報
* xref:dynamic-home-directories-concept.html[サーバーで動的ホームディレクトリを有効にする方法について説明します]
* link:../networking/networking_reference.html["ネットワーク管理"]
* https://mysupport.netapp.com/NOW/products/interoperability["NetApp Interoperability Matrix Tool"^]

