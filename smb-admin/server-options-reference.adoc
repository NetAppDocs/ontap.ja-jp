---
permalink: smb-admin/server-options-reference.html 
sidebar: sidebar 
keywords: useful, option, available, consider, customize, smb, cifs, server, general, enable, configure, functionality, vserver, modify, available smb server options 
summary: SMB サーバのカスタマイズ方法について検討する場合は、使用できるオプションを把握しておくと便利です。一部のオプションは汎用的なものですが、 SMB の特定の機能を有効にして設定するためのオプションも複数あります。SMB サーバのオプションは、 vserver cifs options modify オプションで制御されます。 
---
= 使用できる SMB サーバオプション
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SMB サーバのカスタマイズ方法について検討する場合は、使用できるオプションを把握しておくと便利です。一部のオプションは汎用的なものですが、 SMB の特定の機能を有効にして設定するためのオプションも複数あります。SMB サーバ・オプションは 'vserver cifs options modify オプションで制御されます

以下に、 admin 権限レベルで使用できる SMB サーバオプションについて説明します。

* * SMB セッションタイムアウト値の設定 *
+
このオプションでは、 SMB セッションが切断されるまでのアイドル時間を秒数で指定できます。アイドルセッションとは、ユーザがクライアントでファイルもディレクトリも開いていないセッションのことです。デフォルト値は 900 秒です。

* * デフォルトの UNIX ユーザーの構成 *
+
このオプションでは、 SMB サーバで使用されるデフォルトの UNIX ユーザを指定できます。ONTAP はデフォルトユーザ「 pcuser 」（ UID は 65534 ）を自動的に作成し、グループ「 pcuser 」（ GID は 65534 ）を作成して、デフォルトユーザを「 pcuser 」グループに追加します。SMB サーバを作成すると、 ONTAP は自動的に「 pcuser 」をデフォルトの UNIX ユーザとして設定します。

* * ゲスト UNIX ユーザの設定 *
+
このオプションでは、信頼されていないドメインからログインしたユーザをマッピングする UNIX ユーザの名前を指定できます。これにより、信頼されていないドメインのユーザが SMB サーバに接続できるようになります。デフォルトでは、このオプションは設定されていません（デフォルト値はありません）。このため、信頼されていないドメインのユーザは SMB サーバへの接続を許可されません。

* * モードビットの読み取り権限付与の実行の有効化または無効化 *
+
このオプションを有効または無効にすると、 UNIX 実行可能ビットが設定されていない場合でも、 UNIX モードビットが設定された実行可能ファイルの実行を、ファイルへの読み取り権限を持つ SMB クライアントに許可するかどうかを指定できます。このオプションは、デフォルトでは無効になっています。

* * NFS クライアントからの読み取り専用ファイルの削除機能の有効化または無効化 *
+
このオプションを有効または無効にすると、読み取り専用属性が設定されたファイルやフォルダの削除を NFS クライアントに許可するかどうかを指定できます。NTFS の削除では、読み取り専用属性が設定されたファイルやフォルダの削除は許可されません。UNIX の削除では読み取り専用ビットが無視され、ファイルやフォルダを削除できるかどうかは親ディレクトリの権限によって判断されます。デフォルトの設定は「 disabled 」で、 NTFS の削除が適用されます。

* * Windows Internet Name Service サーバーアドレスの設定 *
+
このオプションでは、複数の Windows Internet Name Service （ WINS ）サーバアドレスをカンマで区切って指定できます。IPv4 アドレスを指定する必要があります。IPv6 アドレスはサポートされません。デフォルト値はありません。



以下に、 advanced 権限レベルで使用できる SMB サーバオプションについて説明します。

* * CIFS ユーザーへの UNIX グループ権限の付与 *
+
このオプションは、ファイルの所有者ではない CIFS ユーザにグループ権限を付与するかどうかを指定します。CIFS ユーザが UNIX セキュリティ形式のファイルの所有者ではなく、このパラメータが「 true 」に設定されている場合、そのファイルに対するグループ権限が付与されます。CIFS ユーザが UNIX セキュリティ形式のファイルの所有者ではなく、このパラメータが「 false 」に設定されている場合、通常の UNIX ルールに従ってファイル権限が付与されます。このパラメータは、権限が「 m ode bits 」として設定された UNIX セキュリティ形式のファイルに適用され、 NTFS または NFSv4 セキュリティモードのファイルには適用されません。デフォルト設定は 'false' です

* * SMB 1.0 の有効化または無効化 *
+
ONTAP 9.3 で SMB サーバが作成された SVM では、 SMB 1.0 がデフォルトで無効になります。

+
[NOTE]
====
ONTAP 9.3 以降では、 ONTAP 9.3 で新しく作成された SMB サーバについては SMB 1.0 がデフォルトで無効になります。できるだけ早く最新の SMB バージョンに移行して、セキュリティとコンプライアンスを強化してください。詳細については、ネットアップの担当者にお問い合わせください。

====
* * SMB 2.x の有効化または無効化 *
+
SMB 2.0 は、 LIF フェイルオーバーをサポートする SMB の最小バージョンです。SMB 2.x を無効にした場合、 ONTAP では SMB 3.x も自動的に無効になります

+
SMB 2.0 は SVM でのみサポートされます。このオプションは、 SVM ではデフォルトで有効になります

* * SMB 3.0 の有効化または無効化 *
+
SMB 3.0 は、継続的可用性を備えた共有をサポートする SMB の最小バージョンです。Windows Server 2012 および Windows 8 は、 SMB 3.0 をサポートする Windows の最小バージョンです。

+
SMB 3.0 は SVM でのみサポートされます。このオプションは、 SVM ではデフォルトで有効になります

* * SMB 3.1 を有効または無効にします
+
Windows 10 は、 SMB 3.1 をサポートする Windows の唯一のバージョンです。

+
SMB 3.1 は SVM でのみサポートされます。このオプションは、 SVM ではデフォルトで有効になります

* * ODX コピーオフロードの有効化または無効化 *
+
ODX コピーオフロードは、対応する Windows クライアントで自動的に使用されます。このオプションはデフォルトで有効になっています。

* * ODX コピーオフロードの直接コピーメカニズムの有効化または無効化 *
+
直接コピーメカニズムは、コピー中のファイル変更を禁止するモードで Windows クライアントがコピー元のファイルを開こうとした場合に、コピーオフロード処理のパフォーマンスを向上させます。デフォルトでは、直接コピーメカニズムは有効になっています。

* * 自動ノードリファーラルの有効化または無効化 *
+
自動ノードリファーラルでは、 SMB サーバはクライアントに対して、要求した共有を介してアクセスするデータのホストノードに対してローカルなデータ LIF を自動的に参照することになります。

* * SMB * のエクスポート・ポリシーの有効化または無効化
+
このオプションは、デフォルトでは無効になっています。

* * ジャンクションポイントのリパースポイントとしての使用の有効化または無効化 *
+
このオプションを有効にすると、 SMB サーバはジャンクションポイントをリパースポイントとして SMB クライアントに公開します。このオプションは、 SMB 2.x 接続または SMB 3.0 接続のみで有効です。このオプションはデフォルトで有効になっています。

+
このオプションは SVM でのみサポートされます。このオプションは、 SVM ではデフォルトで有効になります

* * TCP 接続ごとの最大同時操作数の設定 *
+
デフォルト値は 255. です。

* * ローカルの Windows ユーザーとグループ機能の有効化または無効化 *
+
このオプションはデフォルトで有効になっています。

* * ローカル Windows ユーザー認証の有効化または無効化 *
+
このオプションはデフォルトで有効になっています。

* * VSS シャドウ・コピー機能の有効化または無効化 *
+
ONTAP では、シャドウコピー機能によって、 Hyper-V over SMB 解決策を使用して格納されたデータのリモートバックアップを実行します。

+
このオプションは、 SVM 、および Hyper-V over SMB 構成でのみサポートされます。このオプションは、 SVM ではデフォルトで有効になります

* * シャドウ・コピーのディレクトリ階層の設定 *
+
このオプションでは、シャドウコピー機能を使用するときに、シャドウコピーを作成するディレクトリの最大階層を定義できます。

+
このオプションは、 SVM 、および Hyper-V over SMB 構成でのみサポートされます。このオプションは、 SVM ではデフォルトで有効になります

* * マルチドメインネームマッピングの検索機能の有効化または無効化 *
+
有効にすると、 UNIX ユーザが Windows ユーザ名のドメイン部分にワイルドカード（ * ）を使用して Windows ドメインユーザにマッピングされている場合に（ * \joe など）、 ONTAP はホームドメインと双方向の信頼関係が確立されたすべてのドメインで、指定したユーザを検索します。ホームドメインとは、 SMB サーバのコンピュータアカウントが含まれるドメインです。

+
双方向の信頼関係が確立されたすべてのドメインを検索する代わりに、信頼できるドメインのリストを設定することもできます。このオプションを有効にして、優先リストを設定すると、マルチドメインネームマッピングの検索を実行するために優先リストが使用されます。

+
デフォルトでは、マルチドメインネームマッピングの検索は有効になります。

* * ファイルシステムセクターサイズの設定 *
+
このオプションでは、 ONTAP から SMB クライアントに報告されるファイルシステムセクターサイズをバイト単位で設定できます。このオプションには '4096' と '512' の 2 つの有効な値がありますデフォルト値は「 4096 」です。Windows アプリケーションが 512 バイトのセクターサイズのみをサポートしている場合は、この値を「 512 」に設定する必要があります。

* * ダイナミックアクセス制御の有効化または無効化 *
+
このオプションを有効にすると、監査を使用した集約型アクセスポリシーのステージングや、グループポリシーオブジェクトを使用した集約型アクセスポリシーの実装を含めて、ダイナミックアクセス制御を使用して SMB サーバのオブジェクトを保護できます。このオプションは、デフォルトでは無効になっています。

+
このオプションは SVM でのみサポートされます。

* * 認証されていないセッションのアクセス制限の設定（ restrict anonymous ） *
+
このオプションでは、認証されていないセッションのアクセス制限を指定します。制限は匿名ユーザに適用されます。デフォルトでは、匿名ユーザに対するアクセス制限はありません。

* * UNIX 対応のセキュリティを使用するボリューム（ UNIX セキュリティ形式のボリューム、または UNIX 対応のセキュリティを使用する mixed セキュリティ形式のボリューム）での NTFS ACL の提供を有効または無効にする *
+
このオプションを有効または無効にして、 UNIX セキュリティ形式のファイルやフォルダのファイルセキュリティが SMB クライアントに表示される方法を指定します。有効 ONTAP にすると、 UNIX セキュリティ形式のボリューム内のファイルやフォルダは、 NTFS ACL を使用する NTFS ファイルセキュリティが設定されたファイルやフォルダとして SMB クライアントに表示されます。無効 ONTAP にすると、 UNIX セキュリティ形式のボリュームは、ファイルセキュリティのない FAT ボリュームとして表示されます。デフォルトでは、ボリュームは NTFS ACL を使用する NTFS ファイルセキュリティが設定されたボリュームとして表示されます。

* * SMB 擬似オープン機能の有効化または無効化 *
+
この機能を有効にすると、 ONTAP がファイルやディレクトリの属性情報を照会する際のオープン要求とクローズ要求の方法が最適化されて、 SMB 2.x および SMB 3.0 のパフォーマンスが向上します。デフォルトでは、 SMB 擬似オープン機能は有効になっています。このオプションは、 SMB 2.x 以降を使用する接続にのみ有効です。

* * UNIX 拡張の有効化または無効化 *
+
このオプションを有効にすると、 SMB サーバで UNIX 拡張が有効になります。UNIX 拡張を使用すると、 SMB プロトコルを介して POSIX/UNIX 形式のセキュリティを表示できます。デフォルトでは、このオプションは無効になっています。

+
Mac OSX クライアントなど、 UNIX ベースの SMB クライアントが環境内にある場合は、 UNIX 拡張を有効にしてください。UNIX 拡張を有効にすると、 SMB サーバは POSIX/UNIX セキュリティ情報を SMB 経由で UNIX ベースのクライアントに送信できるようになります。クライアントは、受け取ったセキュリティ情報を POSIX/UNIX セキュリティに変換します。

* * 略称を使用した検索のサポートの有効化または無効化 *
+
このオプションを有効にすると、 SMB サーバは短縮名に対して検索を実行できます。このオプションを有効にした場合の検索では、長いファイル名に加えて 8.3 形式のファイル名も照合されます。このパラメータのデフォルト値は 'false' です

* * DFS 対応の自動通知のサポートの有効化または無効化 *
+
このオプションを有効または無効にして、共有に接続する SMB 2.x および SMB 3.0 クライアントに SMB サーバから DFS 対応を自動的に通知するかどうかを指定します。ONTAP では、 SMB アクセス用のシンボリックリンクの実装で DFS リファーラルが使用されます。有効にすると、シンボリックリンクアクセスが有効かどうかに関係なく、 SMB サーバは常に DFS 対応を通知します。無効にすると、シンボリックリンクアクセスが有効になっている共有にクライアントが接続する場合にのみ、 SMB サーバは DFS 対応を通知します。

* * SMB クレジットの最大数の設定 *
+
ONTAP 9.4 以降では、クライアントとサーバが SMB バージョン 2 以降を実行している場合に、「 -max-credits 」オプションを設定して SMB 接続に付与するクレジット数を制限できます。デフォルト値は 128. です。

* * SMB マルチチャネルのサポートの有効化または無効化 *
+
ONTAP 9.4 以降のリリースで「 -is-multichannel-enabled 」オプションを有効にすると、クラスタとクライアントに適切な NIC が搭載されている場合、 SMB サーバは単一の SMB セッションに対して複数の接続を確立できます。これにより、スループットとフォールトトレランスが向上します。このパラメータのデフォルト値は 'false' です

+
SMB マルチチャネルが有効な場合、次のパラメータも指定できます。

+
** 各マルチチャネルセッションに許可される最大接続数。このパラメータのデフォルト値は 32 です。
** 各マルチチャネルセッションで通知されるネットワークインターフェイスの最大数。このパラメータのデフォルト値は 256 です。



