---
sidebar: sidebar 
permalink: smb-admin/windows-backup-symlinks.html 
keywords: windows, windows server, backup, backup application, symbolic link, symlink, unix, unix-style 
summary: Windows上で実行されているバックアップ アプリケーションがUnix形式のシンボリック リンク（symlink）に遭遇すると、リンクをたどり、データがバックアップされます。ONTAP 9.15.1以降では、データではなくシンボリック リンクをバックアップするオプションが追加されました。この機能はONTAP FlexGroupボリュームおよびFlexVolsで完全にサポートされています。 
---
= ONTAP SMB サーバー上の Windows バックアップ アプリケーションと Unix スタイルのシンボリック リンク
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Windows上で実行されているバックアップ アプリケーションがUnix形式のシンボリック リンク（symlink）に遭遇すると、リンクをたどり、データがバックアップされます。ONTAP 9.15.1以降では、データではなくシンボリック リンクをバックアップするオプションが追加されました。この機能はONTAP FlexGroupボリュームおよびFlexVolsで完全にサポートされています。



== 概要

Windowsバックアップ処理中のONTAPによるシンボリック リンクの処理方法を変更する前に、メリット、主要な概念、設定オプションを十分に理解しておく必要があります。



=== メリット

この機能が無効になっている、または使用できない場合には、各シンボリック リンクがトラバースされ、リンク先のデータがバックアップされます。これが原因で、不要なデータがバックアップされることがあり、状況によってはアプリケーションがループに陥る可能性もあります。代わりにシンボリック リンクをバックアップすることで、これらの問題を回避できます。また、ほとんどの場合、シンボリック リンク ファイルはデータと比べて非常に小さいため、バックアップにかかる時間が短縮されます。IO処理が減るので、クラスタの全体的なパフォーマンスも向上します。



=== Windowsサーバ環境

この機能は、Windowsで実行されているバックアップ アプリケーションでサポートされています。機能を使用する前に、この環境に関連する技術的側面を理解しておく必要があります。

.拡張属性
Windowsは拡張属性（EA）をサポートしています。EAは、ファイルにオプションで関連付けられる追加のメタデータをまとめて形成します。これらの属性は、Windows Subsystem for Linuxなどのさまざまなアプリケーションで使用されます（ https://learn.microsoft.com/en-us/windows/wsl/file-permissions["WSL のファイル権限"^]を参照）。アプリケーションは、ONTAPからデータを読み取るときに、各ファイルの拡張属性を要求できます。

シンボリック リンクは、機能が有効になっていると拡張属性で返されます。そのため、バックアップ アプリケーションは、メタデータの格納に使用される標準的な拡張属性をサポートしている必要があります。一部のWindowsユーティリティでは、拡張属性がサポートされ、保持されます。ただし、バックアップ ソフトウェアで拡張属性のバックアップとリストアがサポートされていないと、各ファイルに関連付けられているメタデータが保持されず、シンボリック リンクが適切に処理されません。

.Windows構成
Microsoft Windows Server上で実行されているバックアップ アプリケーションに特別な権限を付与して、通常のファイル セキュリティをバイパスさせることができます。これは通常、アプリケーションをBackup Operatorsグループに追加することで行われます。アプリケーションは、必要に応じてファイルのバックアップやリストアを行ったり、その他の関連するシステム操作を実行したりできます。バックアップ アプリケーションで使用されるSMBプロトコルに加えられた軽微な変更が、データの読み取りと書き込みの際にONTAPによって検出される可能性があります。



=== 要件

シンボリック リンク バックアップ機能には、以下のいくつかの要件があります。

* クラスタでONTAP 9.15.1以降が実行されている必要があります。
* 特別なバックアップ権限が付与されたWindowsバックアップ アプリケーションが必要です。
* バックアップ アプリケーションが拡張属性もサポートしていて、バックアップ処理中に拡張属性を要求する必要があります。
* 該当するデータSVMでONTAPのシンボリック リンク バックアップ機能が有効になっている必要があります。




=== 構成オプション

ONTAP CLIに加えて、REST APIを使用してこの機能を管理することもできます。詳細については、 https://docs.netapp.com/us-en/ontap-automation/whats-new.html["ONTAP REST APIと自動化の新機能"^]を参照してください。ONTAPがUnix形式のシンボリック リンクを処理する方法を決定する設定は、SVMごとに個別に実行する必要があります。



== ONTAPのシンボリック リンク バックアップ機能の有効化

ONTAP 9.15.1では、既存のCLIコマンドに設定オプションが追加されています。このオプションを使用すると、UNIX形式のシンボリック リンク処理の有効と無効を切り替えられます。

.開始する前に
基本的な<<要件>>を確認してください。さらに：

* CLI権限をadvancedレベルに昇格できるようにします。
* 変更するデータSVMを決定します。SVM `vs1`はサンプルコマンドで使用されています。


.手順
. 権限レベルをadvancedに設定します。
+
[source, cli]
----
set privilege advanced
----
. シンボリック リンク ファイルのバックアップを有効にします。
+
[source, cli]
----
vserver cifs options modify -vserver vs1 -is-backup-symlink-enabled true
----

