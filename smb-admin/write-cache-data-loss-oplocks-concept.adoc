---
permalink: smb-admin/write-cache-data-loss-oplocks-concept.html 
sidebar: sidebar 
keywords: circumstance, process, exclusive, oplock, file, flush, cache, data, write, lock, relinquish, network, failure, write cache data-loss considerations when using oplocks 
summary: 状況によっては、あるプロセスがファイルに対して排他的なoplockを持っていて、別のプロセスがそのファイルを開こうとすると、最初のプロセスがキャッシュされたデータを無効にし、書き込みとロックをフラッシュしなければならないことがあります。その後、クライアントはoplockを放棄してファイルにアクセスする必要があります。このフラッシュ中にネットワーク障害が発生すると、キャッシュされた書き込みデータが失われる可能性があります。 
---
= oplockを使用する場合の書き込みキャッシュデータ損失に関する考慮事項
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
状況によっては、あるプロセスがファイルに対して排他的なoplockを持っていて、別のプロセスがそのファイルを開こうとすると、最初のプロセスがキャッシュされたデータを無効にし、書き込みとロックをフラッシュしなければならないことがあります。その後、クライアントはoplockを放棄してファイルにアクセスする必要があります。このフラッシュ中にネットワーク障害が発生すると、キャッシュされた書き込みデータが失われる可能性があります。

* データ損失の可能性
+
データの書き込みがキャッシュされるアプリケーションでは、次の場合にそのデータを失う可能性があります。

+
** 接続は SMB 1.0 を使用して確立されます。
** ファイルに対して排他的な oplock を使用している場合
** oplock を解除するか、ファイルを閉じるように指示された場合
** 書き込みキャッシュをフラッシュするプロセスで、ネットワークまたはターゲットシステムにエラーが発生した場合


* エラー処理および書き込みの完了
+
キャッシュ自体にエラー処理機能はなく、アプリケーションがエラー処理を行います。アプリケーションがキャッシュへの書き込みを行う場合、書き込みは必ず完了します。キャッシュがネットワークを介してターゲットシステムに書き込みを行う場合、書き込みが完了していないとデータが失われるため、書き込みが完了したと想定する必要があります。


