---
permalink: smb-admin/write-cache-data-loss-oplocks-concept.html 
sidebar: sidebar 
keywords: circumstance, process, exclusive, oplock, file, flush, cache, data, write, lock, relinquish, network, failure, write cache data-loss considerations when using oplocks 
summary: 状況によっては、あるプロセスがファイルに対して排他的な oplock を保持している場合に、別のプロセスがそのファイルを開こうとすると、最初のプロセスはキャッシュされたデータを無効にし、書き込みとロックをフラッシュする必要があります。クライアントは oplock を放棄し、ファイルにアクセスする必要があります。このフラッシュ時にネットワーク障害が発生すると、キャッシュされた書き込みデータが失われる可能性があります。 
---
= oplock を使用するときの書き込みキャッシュデータ消失に関する考慮事項
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
状況によっては、あるプロセスがファイルに対して排他的な oplock を保持している場合に、別のプロセスがそのファイルを開こうとすると、最初のプロセスはキャッシュされたデータを無効にし、書き込みとロックをフラッシュする必要があります。クライアントは oplock を放棄し、ファイルにアクセスする必要があります。このフラッシュ時にネットワーク障害が発生すると、キャッシュされた書き込みデータが失われる可能性があります。

* データ損失の可能性
+
データの書き込みがキャッシュされるアプリケーションでは、次の場合にそのデータを失う可能性があります。

+
** 接続は SMB 1.0 を使用して確立されます。
** ファイルに対して排他的な oplock を使用している場合
** oplock を解除するか、ファイルを閉じるように指示された場合
** 書き込みキャッシュをフラッシュするプロセスで、ネットワークまたはターゲットシステムにエラーが発生した場合


* エラー処理および書き込みの完了
+
キャッシュ自体にはエラー処理がありません。アプリケーションがエラー処理を行います。アプリケーションがキャッシュへの書き込みを行うと、書き込みは常に完了します。キャッシュがネットワーク経由でターゲットシステムに書き込みを行う場合、書き込みは完了していると仮定する必要があります。これは、完了していない場合、データが失われるためです。


