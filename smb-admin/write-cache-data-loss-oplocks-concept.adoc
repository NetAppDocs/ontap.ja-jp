---
permalink: smb-admin/write-cache-data-loss-oplocks-concept.html 
sidebar: sidebar 
keywords: circumstance, process, exclusive, oplock, file, flush, cache, data, write, lock, relinquish, network, failure, write cache data-loss considerations when using oplocks 
summary: 状況によっては、あるプロセスがファイルに対して排他的なoplockを保持している場合に、別のプロセスがそのファイルを開こうとすると、最初のプロセスは、キャッシュされたデータを無効にし、書き込みとロックをフラッシュする必要があります。クライアントはoplockを放棄し、ファイルにアクセスする必要があります。このフラッシュ時にネットワーク障害が発生すると、キャッシュされた書き込みデータが失われることがあります。 
---
= oplock 使用時の ONTAP SMB キャッシュ データ損失に関する考慮事項について学習します
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
状況によっては、あるプロセスがファイルに対して排他的なoplockを保持している場合に、別のプロセスがそのファイルを開こうとすると、最初のプロセスは、キャッシュされたデータを無効にし、書き込みとロックをフラッシュする必要があります。クライアントはoplockを放棄し、ファイルにアクセスする必要があります。このフラッシュ時にネットワーク障害が発生すると、キャッシュされた書き込みデータが失われることがあります。

* データ損失の可能性
+
書き込みキャッシュされたデータを持つアプリケーションは、次のような状況下ではそのデータを失う可能性があります：

+
** 接続は SMB 1.0 を使用して行われます。
** ファイルに対して排他的 oplock が存在します。
** そのoplockを解除するか、ファイルを閉じるように指示されます。
** 書き込みキャッシュをフラッシュするプロセス中に、ネットワークまたはターゲット システムでエラーが発生します。


* エラー処理と書き込み完了
+
キャッシュ自体にエラー処理機能はなく、アプリケーションがエラー処理を行います。アプリケーションがキャッシュへの書き込みを行う場合、書き込みは必ず完了します。反対にキャッシュがネットワーク経由でターゲット システムに書き込みを行う場合、書き込みが完了したものとみなす必要があります。そうでないと、データが失われます。


