---
permalink: smb-hyper-v-sql/configure-smb-multichannel-performance-task.html 
sidebar: sidebar 
keywords: configure, smb, multichannel, performance, redundancy, session, fault, tolerance, hyper, v, sql 
summary: SMB マルチチャネルを構成すると、単一の SMB セッションで ONTAP とクライアント間の複数の接続が可能になり、SMB 構成上の Hyper-V および SQL Server のスループットとフォールト トレランスが向上します。 
---
= パフォーマンスと冗長性を高めるためのSMBマルチチャネルの設定
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.4以降では、SMBマルチチャネルを設定して、1つのSMBセッションでONTAPとクライアントの間に複数の接続を確立することができます。これにより、Hyper-VおよびSQL Server over SMB構成のスループットとフォールト トレランスが向上します。

.開始する前に
SMBマルチチャネル機能は、クライアントがSMB 3.0以降のバージョンでネゴシエートする場合にのみ使用できます。ONTAPのSMBサーバでは、SMB 3.0以降がデフォルトで有効になっています。

.タスク概要
SMBクライアントは、ONTAPクラスタで適切な設定が見つかると、複数のネットワーク接続を自動的に検出して使用します。

SMBセッションあたりの同時接続数は、導入しているNICによって異なります。

* *クライアントとONTAPクラスタ上の1G NIC*
+
クライアントから確立される接続数はNICごとに1つで、すべての接続にセッションがバインドされます。

* *クライアントおよびONTAPクラスタ上の10G以上の容量のNIC*
+
クライアントから確立される接続数はNICごとに最大4つで、すべての接続にセッションがバインドされます。クライアントは10G以上の複数のNICで接続を確立することができます。



さらに、次のパラメータを変更することができます（advanced権限）。

* `-max-connections-per-session`
+
各マルチチャネル セッションに許可される最大接続数。デフォルトの接続数は32です。

+
デフォルトよりも多くの接続を許可する場合は、クライアントの設定も調整する必要があります（クライアントもデフォルトの接続数は32です）。

* `-max-lifs-per-session`
+
各マルチチャネル セッションで通知されるネットワーク インターフェイスの最大数。デフォルトのネットワーク インターフェイス数は256です。



.手順
. 権限レベルをadvancedに設定します。
+
[listing]
----
set -privilege advanced
----
. SMBサーバでSMBマルチチャネルを有効にします。
+
[listing]
----
vserver cifs options modify -vserver <vserver_name> -is-multichannel-enabled true
----
. SMBマルチチャネル セッションがONTAPのレポート対象になっていることを確認します。
+
[listing]
----
vserver cifs session show
----
. admin権限レベルに戻ります。
+
[listing]
----
set -privilege admin
----


.例
次の例は、すべてのSMBセッションに関する情報を表示します。1つのセッションに対して複数の接続が表示されています。

[listing]
----
cluster1::> vserver cifs session show
Node:    node1
Vserver: vs1
Connection Session                                        Open            Idle
IDs        ID      Workstation      Windows User         Files            Time
---------- ------- ---------------- ---------------- --------- ---------------
138683,
138684,
138685     1       10.1.1.1         DOMAIN\                   0              4s
                                    Administrator
----
次の例は、セッションID 1が割り当てられたSMBセッションに関する詳細情報を表示します。

[listing]
----
cluster1::> vserver cifs session show -session-id 1 -instance

Vserver: vs1
                           Node: node1
                     Session ID: 1
                 Connection IDs: 138683,138684,138685
               Connection Count: 3
   Incoming Data LIF IP Address: 192.1.1.1
         Workstation IP Address: 10.1.1.1
       Authentication Mechanism: NTLMv1
          User Authenticated as: domain-user
                   Windows User: DOMAIN\administrator
                      UNIX User: root
                    Open Shares: 2
                     Open Files: 5
                     Open Other: 0
                 Connected Time: 5s
                      Idle Time: 5s
               Protocol Version: SMB3
         Continuously Available: No
              Is Session Signed: false
                   NetBIOS Name: -
----