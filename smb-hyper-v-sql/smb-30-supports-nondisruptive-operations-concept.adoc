---
permalink: smb-hyper-v-sql/smb-30-supports-nondisruptive-operations-concept.html 
sidebar: sidebar 
keywords: smb, functionality, support, nondisruptive, operations, shares, clients, hyper, v, sql, server 
summary: SMB 3.0は、SMB共有を介したHyper-VおよびSQL Serverの無停止運用をサポートする重要な機能を提供します。これには、継続的に利用可能な共有プロパティと、SMBクライアントがファイルのオープン状態を回復し、SMB接続を透過的に再確立することを可能にする永続ハンドルと呼ばれるファイルハンドルが含まれます。 
---
= SMB 3.0の機能がSMB共有を介したノンストップ オペレーションをサポートする仕組み
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SMB 3.0は、SMB共有を介したHyper-VおよびSQL Serverの無停止運用を可能にする重要な機能を提供します。これには `continuously-available`共有プロパティと、_永続ハンドル_と呼ばれるファイルハンドルの一種が含まれます。これにより、SMBクライアントはファイルのオープン状態を回復し、SMB接続を透過的に再確立できます。

永続的ハンドルは、継続的可用性が設定された共有プロパティが設定された共有に接続するSMB 3.0対応クライアントに付与できます。SMBセッションが切断された場合、CIFSサーバは永続的ハンドルの状態に関する情報を保持します。CIFSサーバは、クライアントが再接続できる60秒間、他のクライアントからの要求をブロックします。これにより、永続的ハンドルを持つクライアントは、ネットワークが切断された後にハンドルを再利用できるようになります。永続的ハンドルを持つクライアントは、ストレージ仮想マシン（SVM）上のデータLIFの1つを使用して、同じLIFまたは別のLIFを介して再接続できます。

アグリゲートの再配置、テイクオーバー、ギブバックはすべてSFOペア間で行われます。永続ハンドルを持つファイルとのセッションの切断と再接続をシームレスに管理するために、パートナーノードはすべての永続ハンドルのロック情報のコピーを保持しています。計画的なイベントか計画外のイベントかにかかわらず、SFOパートナーは永続ハンドルの再接続を無停止で管理できます。この新機能により、CIFSサーバへのSMB 3.0接続は、従来はシステム停止を伴っていたイベントでも、SVMに割り当てられた別のデータLIFに透過的かつ無停止でフェイルオーバーできます。

永続的なハンドルを使用することで、CIFSサーバーはSMB 3.0接続を透過的にフェイルオーバーできますが、障害によってHyper-VアプリケーションがWindows Serverクラスター内の別のノードにフェイルオーバーした場合、クライアントはこれらの切断されたハンドルのファイルハンドルを再利用できません。このシナリオでは、切断状態のファイルハンドルが、別のノードでHyper-Vアプリケーションを再起動する際にアクセスをブロックする可能性があります。「フェイルオーバークラスタリング」は、SMB 3.0の機能であり、古くなった競合するハンドルを無効にするメカニズムを提供することで、このシナリオに対処します。このメカニズムを使用することで、Hyper-Vクラスターは、Hyper-Vクラスターノードに障害が発生した場合でも迅速に復旧できます。
