---
permalink: smb-hyper-v-sql/verify-domain-accounts-map-default-unix-user-task.html 
sidebar: sidebar 
keywords: verfiy, domain, account, default, unix, server, smb, share, user 
summary: Hyper-V と SQL Server では、SMB アクセスのためにドメイン コンピュータ アカウントを UNIX ユーザーにマッピングする必要があります。最も簡単な方法は、デフォルトの UNIX ユーザーにマッピングすることです。 
---
= ドメイン アカウントがONTAPのデフォルトUNIXユーザにマッピングされていることを確認します
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Hyper-V と SQL Server は、継続的に利用可能な共有への SMB 接続を確立するためにドメインアカウントを使用します。接続を正常に確立するには、コンピューターアカウントを UNIX ユーザーに正しくマッピングする必要があります。これを実現する最も簡単な方法は、コンピューターアカウントをデフォルトの UNIX ユーザーにマッピングすることです。

.タスク概要
Hyper-V と SQL Server は、SMB 接続を作成するためにドメイン コンピュータ アカウントを使用します。さらに、SQL Server は、SMB 接続を作成するサービス アカウントとしてドメイン ユーザー アカウントも使用します。

ストレージ仮想マシン（SVM）を作成すると、ONTAPは自動的に `pcuser`という名前のデフォルトユーザ（UIDは `65534`）と `pcuser`という名前のグループ（GIDは `65534`）を作成し、そのデフォルトユーザを `pcuser`グループに追加します。クラスタをData ONTAP 8.2にアップグレードする前から存在していたSVM上でHyper-V over SMBソリューションを設定する場合、デフォルトユーザとデフォルトグループが存在しない可能性があります。存在しない場合は、CIFSサーバのデフォルトUNIXユーザを設定する前に、これらを作成する必要があります。

.手順
. デフォルトの UNIX ユーザーが存在するかどうかを確認します：
+
[source, cli]
----
vserver cifs options show -vserver <vserver_name>
----
. デフォルト ユーザー オプションが設定されていない場合は、デフォルト UNIX ユーザーとして指定できる UNIX ユーザーが存在するかどうかを確認します：
+
[source, cli]
----
vserver services unix-user show -vserver <vserver_name>
----
. デフォルト ユーザー オプションが設定されておらず、デフォルト UNIX ユーザーとして指定できる UNIX ユーザーがいない場合は、デフォルト グループとデフォルト UNIX ユーザーを作成し、デフォルト ユーザーをグループに追加します。
+
通常、デフォルトユーザーにはユーザー名「pcuser」が与えられ、UIDは `65534`に割り当てられます。通常、デフォルトグループにはグループ名「pcuser」が与えられます。グループに割り当てられるGIDは `65534`である必要があります。

+
.. デフォルト グループを作成します：
+
[source, cli]
----
vserver services unix-group create -vserver <vserver_name> -name pcuser -id 65534
----
.. デフォルト ユーザーを作成し、デフォルト ユーザーをデフォルト グループに追加します：
+
[source, cli]
----
vserver services unix-user create -vserver <vserver_name> -user pcuser -id 65534 -primary-gid 65534
----
.. デフォルトのユーザーとデフォルトのグループが正しく構成されていることを確認します：
+
[source, cli]
----
vserver services unix-user show -vserver <vserver_name>
----
+
[source, cli]
----
vserver services unix-group show -vserver <vserver_name> -members
----


. CIFS サーバーのデフォルト ユーザーが設定されていない場合は、次の手順を実行します：
+
.. デフォルトのユーザを設定します。
+
[source, cli]
----
vserver cifs options modify -vserver <vserver_name> -default-unix-user pcuser
----
.. デフォルトの UNIX ユーザーが正しく設定されていることを確認します：
+
[source, cli]
----
vserver cifs options show -vserver <vserver_name>
----


. アプリケーション サーバーのコンピュータ アカウントがデフォルト ユーザーに正しくマッピングされていることを確認するには、SVM 上にある共有にドライブをマッピングし、 `vserver cifs session show`コマンドを使用して Windows ユーザーと UNIX ユーザーのマッピングを確認します。
+
 `vserver cifs options`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=vserver+cifs+options["ONTAPコマンド リファレンス"^]をご覧ください。



.例
次のコマンドは、CIFSサーバのデフォルト ユーザが設定されていないことを確認し、 `pcuser`ユーザと `pcuser`グループが存在することを確認します。 `pcuser`ユーザは、SVM vs1上のCIFSサーバのデフォルト ユーザとして割り当てられています。

[listing]
----
cluster1::> vserver cifs options show

Vserver: vs1

  Client Session Timeout : 900
  Default Unix Group     : -
  Default Unix User      : -
  Guest Unix User        : -
  Read Grants Exec       : disabled
  Read Only Delete       : disabled
  WINS Servers           : -



cluster1::> vserver services unix-user show
          User            User   Group  Full
Vserver   Name            ID     ID     Name
--------- --------------- ------ ------ ----------------
vs1       nobody          65535  65535  -
vs1       pcuser          65534  65534  -
vs1       root            0      1      -

cluster1::> vserver services unix-group show -members
Vserver        Name                ID
vs1            daemon              1
       Users: -
vs1            nobody              65535
       Users: -
vs1            pcuser              65534
       Users: -
vs1            root                0
       Users: -

cluster1::> vserver cifs options modify -vserver vs1 -default-unix-user pcuser

cluster1::> vserver cifs options show

Vserver: vs1

  Client Session Timeout : 900
  Default Unix Group     : -
  Default Unix User      : pcuser
  Guest Unix User        : -
  Read Grants Exec       : disabled
  Read Only Delete       : disabled
  WINS Servers           : -
----