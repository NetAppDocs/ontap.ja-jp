---
permalink: smb-hyper-v-sql/witness-protocol-concept.html 
sidebar: sidebar 
keywords: witness, protocol, node, sfo, partner, failure, smb, client 
summary: ONTAPは、ノードのSFOパートナーを監視（Witness）として使用することで、Witnessプロトコルを実装します。障害が発生した場合、パートナーは迅速に障害を検出し、SMBクライアントに通知します。 
---
= 監視プロトコルの仕組み
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAPでは、ノードのSFOパートナーを監視役として使用して、監視プロトコルが実装されます。障害発生時には、パートナーが障害を迅速に検出し、SMBクライアントに通知します。

監視プロトコルでは、次のプロセスを使用してフェイルオーバーが強化されます。

. アプリケーション サーバがノード1への継続的可用性を備えたSMB接続を確立すると、CIFSサーバからアプリケーション サーバに監視が利用可能であることが通知されます。
. アプリケーション サーバは、ノード1に監視サーバのIPアドレスを要求し、Storage Virtual Machine（SVM）に割り当てられたノード2（SFOパートナー）のデータLIFのIPアドレス リストを受け取ります。
. アプリケーション サーバは、いずれかのIPアドレスを選択し、ノード2への監視接続を作成して、ノード1の継続的可用性を備えた接続を移行する必要がある場合に通知されるように登録します。
. ノード1でフェイルオーバーが発生した場合、監視によってフェイルオーバーが容易になりますが、ギブバックには影響しません。
. 監視によってフェイルオーバー イベントが検出され、監視接続を介してアプリケーション サーバに、SMB接続をノード2に移行する必要があることが通知されます。
. アプリケーション サーバは、SMBセッションをノード2に移行し、クライアント アクセスを中断することなく接続をリカバリします。


image:how-witness-works.gif["監視プロトコル"]
