---
permalink: smb-hyper-v-sql/witness-protocol-concept.html 
sidebar: sidebar 
keywords: witness, protocol, node, sfo, partner, failure, smb, client 
summary: ONTAP では、ノードの SFO パートナーを監視役として使用して、監視プロトコルを実装します。障害が発生した場合、パートナーは障害を迅速に検出し、SMBクライアントに通知します。 
---
= 監視プロトコルの仕組み
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAPは、ノードのSFOパートナーを監視として使用して、監視プロトコルを実装します。障害が発生した場合、パートナーは障害を迅速に検出し、SMBクライアントに通知します。

監視プロトコルでは、次のプロセスを使用してフェイルオーバーが強化されます。

. アプリケーションサーバがノード1への継続的可用性を備えたSMB接続を確立すると、CIFSサーバからアプリケーションサーバに監視が利用可能であることが通知されます。
. アプリケーションサーバは、ノード 1 に監視サーバの IP アドレスを要求し、 Storage Virtual Machine （ SVM ）に割り当てられたノード 2 （ SFO パートナー）のデータ LIF の IP アドレスリストを受け取ります。
. アプリケーションサーバは、いずれかのIPアドレスを選択し、ノード2への監視接続を作成して、ノード1の継続的可用性を備えた接続を移行する必要がある場合に通知されるように登録します。
. ノード 1 でフェイルオーバーが発生した場合、監視によってフェイルオーバーが容易になりますが、ギブバックには影響しません。
. 監視によってフェイルオーバーイベントが検出され、監視接続を介してアプリケーションサーバに、SMB接続をノード2に移行する必要があることが通知されます。
. アプリケーションサーバは、 SMB セッションをノード 2 に移行し、クライアントアクセスを中断することなく接続をリカバリします。


image:how-witness-works.gif["カンシフロトコル"]
