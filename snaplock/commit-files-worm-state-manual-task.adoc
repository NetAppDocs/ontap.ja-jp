---
permalink: snaplock/commit-files-worm-state-manual-task.html 
sidebar: sidebar 
keywords: commit, file, worm, manually, nfs, cifs, read, only, automatically, program, appendable, nfs, cifs, chunk, vam 
summary: 手動で、または自動コミットによって、ファイルをWORM状態（Write Once、Read Many）にコミットできます。追記可能WORMファイルを作成することもできます。 
---
= ファイルを WORM 状態にコミット
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
手動で、または自動コミットによって、ファイルをWORM状態（Write Once、Read Many）にコミットできます。追記可能WORMファイルを作成することもできます。



== ファイルを手動で WORM 状態にコミット

ファイルを手動で WORM 状態にコミットするには、ファイルを読み取り専用にします。ファイルの読み書き属性は、 NFS または CIFS で適切なコマンドやプログラムを使用して読み取り専用に変更できます。

.必要なもの
* コミットするファイルが SnapLock ボリュームに格納されている必要があります。
* ファイルが書き込み可能である必要があります。


.このタスクについて
コマンドまたはプログラムを実行すると、ファイルの「 ctime 」フィールドにボリューム ComplianceClock 時間が書き込まれます。ComplianceClock 時間に基づいて、ファイルが保持期限に達する時点が特定されます。

.手順
. 適切なコマンドまたはプログラムを使用して、ファイルの読み書き属性を読み取り専用に変更します。
+
UNIX シェルでは、次のコマンドを使用して、「 Document .txt 」という名前のファイルを読み取り専用にします。

+
[listing]
----
chmod -w document.txt
----
+
Windows シェルでは、次のコマンドを使用して、「 Document .txt 」という名前のファイルを読み取り専用にします。

+
[listing]
----
attrib +r document.txt
----




== ファイルを自動的にWORM状態にコミット

SnapLock の自動コミット機能を使用して、ファイルを WORM 状態に自動的にコミットできます。

.必要なもの
* 自動コミットするファイルが SnapLock ボリュームに格納されている必要があります。
* SnapLock ボリュームはオンラインである必要があります。
* SnapLock ボリュームが読み書き可能ボリュームである必要があります。


[NOTE]
====
SnapLock の自動コミット機能は、ボリューム内のすべてのファイルをスキャンし、自動コミットの要件を満たすファイルをコミットします。ファイルが自動コミットできる状態になってから、 SnapLock の自動コミットスキャナによって実際にコミットされるまでに、時間が空くことがあります。ただし、ファイルは自動コミットの対象になった時点からファイルシステムによる削除や変更から保護されます。

====
.このタスクについて
_autocommit_period _ は、ファイルが自動コミットされるまでに、ファイルに変更がないようにする期間を指定します。この期間が経過する前にファイルが変更された場合、自動コミット期間はもう一度最初からカウントされます。

自動コミット期間に指定できる値は次のとおりです。

|===
| 価値 | 単位 | 注： 


 a| 
なし
 a| 
-
 a| 
デフォルト。



 a| 
5 ~ 5256000
 a| 
分
 a| 
-



 a| 
1 ~ 87600
 a| 
時間
 a| 
-



 a| 
1 ~ 3650
 a| 
日
 a| 
-



 a| 
1 ~ 120
 a| 
月
 a| 
-



 a| 
1 ~ 10
 a| 
年
 a| 
-

|===
[NOTE]
====
最小値は 5 分、最大値は 10 年です。

====
.手順
. SnapLock ボリュームのファイルを WORM 状態に自動コミットします。
+
'*volume SnapLock modify -vserver_svm_name_-volume_name_autocommit-period_autocommit_period *

+
すべてのオプションの一覧については、コマンドのマニュアルページを参照してください。

+
次のコマンドは、 5 時間変更がなかった場合に SVM vs1 のボリューム「 vol1 」にあるファイルを自動コミットします。

+
[listing]
----
cluster1::>volume snaplock modify -vserver vs1 -volume vol1 -autocommit-period 5hours
----




== 追記可能 WORM ファイルを作成します

追記可能 WORM ファイルには、ログエントリのように段階的に書き込まれるデータが格納されます。追記可能 WORM ファイルは、適切なコマンドやプログラムを使用して作成するか、 SnapLock のボリュームアペンドモード機能を使用してデフォルトで作成できます。



== コマンドまたはプログラムを使用して、追記可能 WORM ファイルを作成します

追記可能 WORM ファイルは、 NFS または CIFS で適切なコマンドやプログラムを使用して作成できます。追記可能 WORM ファイルには、ログエントリのように段階的に書き込まれるデータが格納されます。データは 256KB のチャンク単位でファイルに追加されます。チャンクが書き込まれるたびに、前のチャンクが WORM 方式で保護されます。このファイルは保持期間が経過するまで削除できません。

.必要なもの
追記可能 WORM ファイルは SnapLock ボリュームに格納する必要があります。

.このタスクについて
データは、アクティブな 256KB のチャンクに順番に書き込まれる必要はありません。ファイルの n * 256KB+1 バイトにデータが書き込まれると、 1 つ前の 256KB セグメントが WORM 方式で保護されます。

.手順
. 適切なコマンドまたはプログラムを使用して、必要な保持期限を指定した空のファイルを作成します。
+
UNIX シェルで、次のコマンドを使用して、保持期限を 2020 年 11 月 21 日の午前 6 時に設定します「 documentent.txt 」という名前の長さがゼロのファイルの場合：

+
[listing]
----
touch -a -t 202011210600 document.txt
----
. 適切なコマンドまたはプログラムを使用して、ファイルの読み書き属性を読み取り専用に変更します。
+
UNIX シェルでは、次のコマンドを使用して、「 Document .txt 」という名前のファイルを読み取り専用にします。

+
[listing]
----
chmod 444 document.txt
----
. 適切なコマンドまたはプログラムを使用して、ファイルの読み書き属性を書き込み可能に戻します。
+
[NOTE]
====
ファイルにデータがないため、この手順はコンプライアンスリスクとはみなされません。

====
+
UNIX シェルでは、次のコマンドを使用して、「 Document .txt 」という名前のファイルを書き込み可能にします。

+
[listing]
----
chmod 777 document.txt
----
. 適切なコマンドまたはプログラムを使用して、ファイルへのデータの書き込みを開始します。
+
UNIX シェルでは、次のコマンドを使用して「 Document 」 .txt にデータを書き込みます。

+
[listing]
----
echo test data >> document.txt
----
+
[NOTE]
====
ファイルにデータを追加する必要がなくなったら、ファイル権限を読み取り専用に戻してください。

====




== ボリュームアペンドモードを使用して追記可能 WORM ファイルを作成します

ONTAP 9.3 以降では、 SnapLock のボリュームアペンドモード（ VAM ）機能を使用して、追記可能 WORM ファイルをデフォルトで作成できます。追記可能 WORM ファイルには、ログエントリのように段階的に書き込まれるデータが格納されます。データは 256KB のチャンク単位でファイルに追加されます。チャンクが書き込まれるたびに、前のチャンクが WORM 方式で保護されます。このファイルは保持期間が経過するまで削除できません。

.必要なもの
* 追記可能 WORM ファイルは SnapLock ボリュームに格納する必要があります。
* SnapLock ボリュームは、アンマウントされていて、 Snapshot コピーやユーザが作成したファイルが含まれていない必要があります。


.このタスクについて
データは、アクティブな 256KB のチャンクに順番に書き込まれる必要はありません。ファイルの n * 256KB+1 バイトにデータが書き込まれると、 1 つ前の 256KB セグメントが WORM 方式で保護されます。

ボリュームに自動コミット期間を指定している場合、追記可能 WORM ファイルに変更がなかった期間が自動コミット期間を超えると、そのファイルは WORM 状態にコミットされます。

[NOTE]
====
VAM は SnapLock 監査ログボリュームではサポートされません。

====
.手順
. VAM を有効にします。
+
「 * volume SnapLock modify -vserver _svm_name_-is-volume_name_-is-volume-append-mode -enabled true | false * 」

+
すべてのオプションの一覧については、コマンドのマニュアルページを参照してください。

+
次のコマンドは、 SVM 「 vs1 」のボリューム「 vol1 」で VAM を有効にします。

+
[listing]
----
cluster1::>volume snaplock modify -vserver vs1 -volume vol1 -is-volume-append-mode-enabled true
----
. 適切なコマンドまたはプログラムを使用して、書き込み権限を持つファイルを作成します。
+
ファイルはデフォルトで追記可能 WORM ファイルになります。


