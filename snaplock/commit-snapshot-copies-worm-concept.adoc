---
permalink: snaplock/commit-snapshot-copies-worm-concept.html 
sidebar: sidebar 
keywords: snaplock, commit, snapshot, copy, worm, snapvault, protect, snapmirror, clone, snaplock type 
summary: セカンダリストレージ上のスナップショットをWORM保護するために、SnapLock for SnapVaultを使用できます。すべての基本的なSnapLockタスクは、ボールトのデスティネーションで実行します。 
---
= ONTAPヴォールト デスティネーションでSnapshotをWORMにコミットする
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
セカンダリストレージ上のスナップショットをWORM保護するために、SnapLock for SnapVaultを使用できます。すべての基本的なSnapLockタスクは、ボールトのデスティネーションで実行します。デスティネーションボリュームは自動的に読み取り専用でマウントされるため、スナップショットを明示的にWORMにコミットする必要はありません。

.開始する前に
* System Managerを使用して関係を設定する場合は、ソースとデスティネーションの両方のクラスタでONTAP 9.15.1以降が実行されている必要があります。
* デスティネーション クラスタ：
+
** link:../system-admin/install-license-task.html["SnapLockライセンスをインストールする"]。
** link:initialize-complianceclock-task.html["コンプライアンス クロックの初期化"]。
** ONTAP 9.10.1より前のONTAPリリースでCLIを使用している場合は、link:create-snaplock-aggregate-task.html["SnapLockアグリゲートを作成する"]。


* 保護ポリシーのタイプは「vault」であることが必要です。
* ソース アグリゲートとデスティネーション アグリゲートはどちらも64ビットである必要があります。
* ソース ボリュームにSnapLockボリュームを使用することはできません。
* ONTAP CLIを使用している場合は、ソース ボリュームとデスティネーション ボリュームをlink:../peering/create-cluster-relationship-93-later-task.html["ピア クラスタ"]およびlink:../peering/create-intercluster-svm-peer-relationship-93-later-task.html["SVM"]に作成する必要があります。


.タスク概要
ソース ボリュームで使用するストレージは、NetAppのストレージでもNetApp以外のストレージでもかまいません。


NOTE: WORM状態にコミットされたSnapshotの名前を変更することはできません。

SnapLockボリュームはクローニングできますが、SnapLockボリュームのファイルはクローニングできません。


NOTE: LUNはSnapLockボリュームではサポートされません。LUNは、非SnapLockボリューム上で作成されたスナップショットがSnapLockヴォールト関係の一部として保護のためにSnapLockボリュームに転送される場合にのみ、SnapLockボリュームでサポートされます。LUNは読み取り / 書き込みSnapLockボリュームではサポートされません。ただし、改ざん防止スナップショットは、LUNを含むSnapMirrorソースボリュームとデスティネーション ボリュームの両方でサポートされます。

ONTAP 9.10.1以降では、SnapLockボリュームと非SnapLockボリュームを同じアグリゲートに配置できるため、ONTAP 9.10.1を使用している場合はSnapLockアグリゲートを別々に作成する必要はありません。ボリュームの「-snaplock-type」オプションを使用して、SnapLockボリューム タイプ（ComplianceまたはEnterprise）を指定します。ONTAP 9.10.1より前のリリースでは、SnapLockモード（ComplianceまたはEnterprise）はアグリゲートから継承されます。バージョンに依存しないデスティネーション ボリュームはサポートされません。デスティネーション ボリュームの言語設定とソース ボリュームの言語設定が一致している必要があります。

ボールトのデスティネーションであるSnapLockボリュームには、デフォルトの保持期間が割り当てられています。この期間の値は、SnapLock Enterpriseボリュームの場合は最小0年、SnapLock Complianceボリュームの場合は最大30年に最初に設定されます。各NetAppスナップショットは、最初にこのデフォルトの保持期間でコミットされます。必要に応じて、保持期間は後から延長することができます。詳細については、link:set-retention-period-task.html["保持時間の設定の概要"]を参照してください。

ONTAP 9.14.1以降では、SnapMirror関係のSnapMirrorポリシーで特定のSnapMirrorラベルの保持期間を指定できるようになりました。これにより、ソースボリュームからデスティネーションボリュームにレプリケートされたスナップショットは、ルールで指定された保持期間の間保持されます。保持期間が指定されていない場合は、デスティネーションボリュームのデフォルトの保持期間が使用されます。

ONTAP 9.13.1から、SnapLockボルト関係のデスティネーションSnapLockボリューム上でロックされたスナップショットを、FlexCloneを作成し、 `snaplock-type`オプションを `non-snaplock`に設定し、ボリュームクローン作成操作を実行する際にスナップショットを「parent-snapshot」として指定することで、即座にリストアできます。link:../volumes/create-flexclone-task.html?q=volume+clone["SnapLockタイプのFlexCloneボリュームを作成する"]について詳しくはこちら。

MetroCluster構成の場合は、次の点に注意してください。

* SnapVault関係は、同期元のSVM間でのみ作成できます。同期元のSVMと同期先のSVMの間では作成できません。
* 同期元のSVMのボリュームからデータ提供用のSVMへのSnapVault関係を作成できます。
* データ提供用のSVMのボリュームから同期元のSVMのDPボリュームへのSnapVault関係を作成できます。


次の図は、SnapLockバックアップ関係を初期化する手順を示しています。

image:snapvault-steps-clustered.gif["この図は、SnapLockボールト関係を初期化する手順を示しています：デスティネーション クラスタの特定、デスティネーション ボリュームの作成、ポリシーの作成、ポリシーへのルールの追加、ボリューム間のボールト関係の作成と関係への保護ポリシーの割り当て、および関係の初期化によるベースライン転送の開始。"]

.手順
ONTAP CLIを使用して、SnapLockバックアップ関係を作成できます。また、ONTAP 9.15.1以降では、System Managerを使用して、SnapLockバックアップ関係を作成できます。

[role="tabbed-block"]
====
.System Manager
--
. ボリュームがまだ存在しない場合は、ソース クラスタで*[ストレージ] > [ボリューム]*に移動し、*[追加]*を選択します。
. *ボリュームの追加*ウィンドウで、*その他のオプション*を選択します。
. ボリュームの名前、サイズ、エクスポート ポリシー、および共有名を入力します。
. 変更を保存します。
. デスティネーション クラスタで、*保護 > 関係*に移動します。
. *ソース*列の上で、*保護*を選択し、メニューから*ボリューム*を選択します。
. *ボリュームの保護* ウィンドウで、保護ポリシーとして *Vault* を選択します。
. *ソース*セクションで、保護するクラスタ、Storage VM、ボリュームを選択します。
. *宛先*セクションの*構成の詳細*で、*宛先スナップショットをロック*を選択し、ロック方法として*SnapLock for SnapVault*を選択します。選択したポリシータイプがタイプ `vault`ではない場合、SnapLockライセンスがインストールされていない場合、またはCompliance Clockが初期化されていない場合、*ロック方法*は表示されません。
. まだ有効になっていない場合は、*SnapLock Complianceクロックの初期化*を選択します。
. 変更を保存します。


--
--
.CLI
. デスティネーション クラスタで、SnapLockデスティネーション ボリュームのタイプを `DP`ソース ボリュームと同じかそれより大きいサイズで作成します：
+
[source, cli]
----
volume create -vserver <SVM_name> -volume <volume_name> -aggregate <aggregate_name> -snaplock-type <compliance|enterprise> -type DP -size <size>
----
+
次のコマンドは、アグリゲート `node01_aggr`上の `SVM2`に `dstvolB`という名前の2GBのSnapLock Complianceボリュームを作成します：

+
[listing]
----
cluster2::> volume create -vserver SVM2 -volume dstvolB -aggregate node01_aggr -snaplock-type compliance -type DP -size 2GB
----
. デスティネーション クラスタで、link:set-retention-period-task.html["デフォルトの保存期間を設定する"]。
. link:../data-protection/create-replication-relationship-task.html["新しいレプリケーション関係を作成する"]非SnapLockソースと作成した新しいSnapLockデスティネーションの間。
+
この例では、SnapMirrorのデスティネーションSnapLockボリューム `dstvolB`との新しい関係を、 `XDPDefault`のポリシーを使用して作成します。このポリシーでは、dailyおよびweeklyのラベルが付けられたSnapshotを時間単位のスケジュールでバックアップします。

+
[listing]
----
cluster2::> snapmirror create -source-path SVM1:srcvolA -destination-path SVM2:dstvolB -vserver SVM2 -policy XDPDefault -schedule hourly
----
+

NOTE: link:../data-protection/create-custom-replication-policy-concept.html["カスタム レプリケーション ポリシーの作成"]または、使用可能なデフォルトが適切でない場合はlink:../data-protection/create-replication-job-schedule-task.html["カスタムスケジュール"]になります。

. デスティネーションSVMで、作成したSnapVault関係を初期化します。
+
[source, cli]
----
snapmirror initialize -destination-path <destination_path>
----
+
次のコマンドは、 `SVM1`のソース ボリューム `srcvolA`と `SVM2`のデスティネーション ボリューム `dstvolB`間の関係を初期化します：

+
[listing]
----
cluster2::> snapmirror initialize -destination-path SVM2:dstvolB
----
. 関係が初期化されアイドル状態になったら、デスティネーションで `snapshot show`コマンドを使用して、複製されたSnapshotに適用されたSnapLock有効期限を確認します。
+
この例では、SnapMirrorラベルとSnapLock有効期限を持つボリューム `dstvolB`上のSnapshotを表示します：

+
[listing]
----
cluster2::> snapshot show -vserver SVM2 -volume dstvolB -fields snapmirror-label, snaplock-expiry-time
----


--
====
.関連情報
* https://docs.netapp.com/us-en/ontap-system-manager-classic/peering/index.html["クラスタとSVMのピアリング"^]
* https://docs.netapp.com/us-en/ontap-system-manager-classic/volume-backup-snapvault/index.html["SnapVaultを使用したボリュームのバックアップ"]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-initialize.html["snapmirror initialize"^]

