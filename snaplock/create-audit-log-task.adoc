---
permalink: snaplock/create-audit-log-task.html 
sidebar: sidebar 
keywords: create, audit, log, snaplock, protected, administrator, accounts 
summary: privileged deleteまたはSnapLockボリュームの移動を実行する前に、SnapLockで保護された監査ログを作成しておく必要があります。この監査ログには、SnapLock管理者アカウントの作成と削除、ログ ボリュームに対する変更、privileged deleteが有効になっているかどうか、privileged delete処理、およびSnapLockボリューム移動処理に関する情報が記録されます。 
---
= ONTAP SnapLockで保護された監査ログを作成する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.9.1以前を使用している場合は、まずSnapLockアグリゲートを作成したうえで、privileged deleteまたはSnapLockボリュームの移動を実行する前に、SnapLockで保護された監査ログを作成しておく必要があります。この監査ログには、SnapLock管理者アカウントの作成と削除、ログ ボリュームに対する変更、privileged deleteが有効になっているかどうか、privileged delete処理、およびSnapLockボリューム移動処理に関する情報が記録されます。

ONTAP 9.10.1以降では、SnapLockアグリゲートを作成しなくなりました。-snaplock-typeオプションを使用して、SnapLockタイプとしてComplianceまたはEnterpriseを指定することでlink:../snaplock/create-snaplock-volume-task.html["明示的にSnapLockボリュームを作成する"]する必要があります。

.開始する前に
ONTAP 9.9.1以前を使用している場合、SnapLockアグリゲートを作成するにはクラスタ管理者になる必要があります。

.タスク概要
監査ログは、ログ ファイルの保持期間が経過するまで削除できません。保持期間が経過したあとも、監査ログを変更することはできません。これは、SnapLockのComplianceモードとEnterpriseモードの両方に該当します。

[NOTE]
====
ONTAP 9.4以前では、監査ログにSnapLock Enterpriseボリュームは使用できません。SnapLock Complianceボリュームを使用する必要があります。ONTAP 9.5以降では、監査ログにSnapLock EnterpriseボリュームまたはSnapLock Complianceボリュームのいずれかを使用できます。いずれの場合も、監査ログボリュームはジャンクションパス `/snaplock_audit_log`にマウントする必要があります。他のボリュームはこのジャンクションパスを使用できません。

====
SnapLock監査ログは、監査ログボリュームのルート下の `/snaplock_log`ディレクトリにあり、 `privdel_log`（特権削除操作）および `system_log`（その他すべて）という名前のサブディレクトリに格納されています。監査ログファイル名には、最初に記録された操作のタイムスタンプが含まれるため、操作が実行されたおおよその時刻でレコードを簡単に検索できます。

*  `snaplock log file show`コマンドを使用して、監査ログ ボリューム上のログ ファイルを表示できます。
*  `snaplock log file archive`コマンドを使用すると、現在のログ ファイルをアーカイブし、新しいログ ファイルを作成できます。これは、監査ログ情報を別のファイルに記録する必要がある場合に便利です。


 `snaplock log file show`および `snaplock log file archive`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=snaplock+log+file["ONTAPコマンド リファレンス"^]を参照してください。

[NOTE]
====
データ保護ボリュームは、SnapLock監査ログ ボリュームとしては使用できません。

====
.手順
. SnapLockアグリゲートを作成します。
+
xref:create-snaplock-aggregate-task.adoc[SnapLockアグリゲートの作成]

. 監査ログを設定するSVMにSnapLockボリュームを作成します。
+
xref:create-snaplock-volume-task.adoc[SnapLockボリュームの作成]

. SVMに監査ログを設定します。
+
`snaplock log create -vserver _SVM_name_ -volume _snaplock_volume_name_ -max-log-size _size_ -retention-period _default_retention_period_`

+
[NOTE]
====
監査ログファイルのデフォルトの最小保持期間は6か月です。影響を受けるファイルの保持期間が監査ログの保持期間よりも長い場合、監査ログの保持期間はファイルの保持期間を継承します。したがって、特権削除を使用して削除されたファイルの保持期間が10か月で、監査ログの保持期間が8か月の場合、監査ログの保持期間は10か月に延長されます。保持期間とデフォルトの保持期間の詳細については、link:../snaplock/set-retention-period-task.html["保持期限の設定"]を参照してください。

====
+
次のコマンドは、SnapLockボリューム `logVol`を使用して `SVM1`の監査ログを設定します。監査ログの最大サイズは20 GBで、8か月間保持されます。

+
[listing]
----
SVM1::> snaplock log create -vserver SVM1 -volume logVol -max-log-size 20GB -retention-period 8months
----
+
 `snaplock log create`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snaplock-log-create.html["ONTAPコマンド リファレンス"^]を参照してください。

. 監査ログ用に設定したSVMで、SnapLockボリュームをジャンクション パスにマウントします `/snaplock_audit_log`。
+
xref:mount-snaplock-volume-task.adoc[SnapLockボリュームのマウント]


