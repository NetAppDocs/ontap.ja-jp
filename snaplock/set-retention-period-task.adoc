---
permalink: snaplock/set-retention-period-task.html 
sidebar: sidebar 
keywords: snaplock, set, retention, time, default, explicit, file, modify, volume, period, ebr, event, based 
summary: 保持期限の設定については、ファイルに対して明示的に設定する方法と、ボリュームのデフォルトの保持期間から自動的に設定する方法があります。保持期限を明示的に設定しない場合は、デフォルトの保持期間に基づいて保持期限が計算されます。イベント後にファイルの保持期限を設定することもできます。 
---
= ONTAP SnapLock保持期間を設定する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
保持期限の設定については、ファイルに対して明示的に設定する方法と、ボリュームのデフォルトの保持期間から自動的に設定する方法があります。保持期限を明示的に設定しない場合は、デフォルトの保持期間に基づいて保持期限が計算されます。イベント後にファイルの保持期限を設定することもできます。

.保持期間と保持期限について
WORMファイルの_保持期間_は、ファイルがWORM状態にコミットされた後、保持する必要がある期間を指定します。WORMファイルの_保持時間_は、そのファイルを保持する必要がなくなるまでの時間です。例えば、2020年11月10日午前6：00にWORM状態にコミットされたファイルの保持期間が20年の場合、保持時間は2040年11月10日午前6：00になります。

image:retention.gif["保存期間の例"]

[NOTE]
====
ONTAP 9.10.1以降では、最長で保持期限を3058年10月26日、保持期間を100年に設定できます。保持期限を延長すると、古いポリシーは自動的に変換されます。ONTAP 9.9.1以前のリリースでは、デフォルトの保持期間を無期限に設定した場合を除き、サポートされる最も遅い保持期限は2071年1月19日（GMT）です。

====
.レプリケーションに関する重要な考慮事項
保持期限を2071年1月19日（GMT）よりもあとに設定してSnapLockソース ボリュームとのSnapMirror関係を確立する場合は、デスティネーション クラスタでONTAP 9.10.1以降が実行されている必要があります。そうでない場合、SnapMirror転送が失敗します。

.リバートに関する重要な考慮事項
ONTAPでは、保持期間が「2071年1月19日午前8時44分7秒」以降のファイルがある場合、クラスタをONTAP 9.10.1から以前のONTAPバージョンにリバートすることはできません。

.保持期間について
SnapLock ComplianceまたはSnapLock Enterpriseボリュームには、次の4種類の保持期間があります。

* 最小保存期間(`min`）、デフォルトは0
* 最大保存期間(`max`）、デフォルトは30年
* デフォルトの保持期間。ONTAP 9.10.1以降では、コンプライアンスモードとエンタープライズモードの両方でデフォルトが `min`になります。ONTAP 9.10.1より前のONTAPリリースでは、デフォルトの保持期間はモードによって異なります：
+
** コンプライアンス モードの場合、デフォルトは `max`になります。
** エンタープライズ モードの場合、デフォルトは `min`になります。


* 未指定の保持期間。
+

IMPORTANT: ONTAP 9.10.1より前のリリースでは、コンプライアンスモードのファイルをWORM状態にコミットする前に明示的に保持期間を設定せず、デフォルトも変更していない場合、ファイルは30年間保持されます。この変更は元に戻すことが_できません_。同様に、ONTAP 9.10.1以降では、エンタープライズモードのファイルをWORM状態にコミットする前に明示的に保持期間を設定せず、デフォルトも変更していない場合、ファイルは0年間保持され、実質的に全く保持されないことになります。

+
ONTAP 9.8以降では、ボリューム内のファイルの保持期間を `unspecified`に設定することで、絶対保持期間を設定するまでファイルを保持できるようになりました。絶対保持期間が設定されているファイルを、無指定の保持期間に設定し、新しい絶対保持期間が以前に設定した絶対保持期間よりも後であれば、絶対保持期間に戻すことができます。

+
ONTAP 9.12.1以降、保持期間が `unspecified`に設定されているWORMファイルは、SnapLockボリュームに設定されている最小保持期間に設定されることが保証されます。ファイルの保持期間を `unspecified`から絶対保持時間に変更する場合、指定する新しい保持時間は、ファイルに既に設定されている最小保持時間よりも長くする必要があります。





== デフォルトの保持期間の設定

 `volume snaplock modify`コマンドを使用して、SnapLockボリューム上のファイルのデフォルトの保持期間を設定できます。

.開始する前に
SnapLockがオンラインである必要があります。

.タスク概要
次の表に、デフォルトの保持期間に指定できる値を示します。

[NOTE]
====
デフォルトの保持期間は、最小保持期間以上、最大保持期間以下にする必要があります。

====
|===
| Value | 単位 | 注記 


 a| 
0 - 65535
 a| 
seconds
 a| 



 a| 
0 - 24
 a| 
hours
 a| 



 a| 
0 - 365
 a| 
days
 a| 



 a| 
0 - 12
 a| 
months
 a| 



 a| 
0 - 100
 a| 
years
 a| 
ONTAP 9.10.1以降。以前のリリースのONTAPの場合、値は0 - 70です。



 a| 
max
 a| 
-
 a| 
最大保持期間を使用します。



 a| 
min
 a| 
-
 a| 
最小保持期間を使用します。



 a| 
infinite
 a| 
-
 a| 
ファイルを無期限に保持します。



 a| 
unspecified
 a| 
-
 a| 
明確な保持期間が設定されるまでファイルを保持します。

|===
最大保存期間と最小保存期間の値と範囲は、 `max`と `min`を除き同一です。ただし、これらは適用されません。このタスクの詳細については、link:set-retention-period-task.html["保持期限の設定 - 概要"]を参照してください。

 `volume snaplock show`コマンドを使用して、ボリュームの保持期間設定を表示できます。link:https://docs.netapp.com/us-en/ontap-cli/volume-snaplock-show.html["ONTAPコマンド リファレンス"^]の `volume snaplock show`の詳細をご覧ください。

[NOTE]
====
ファイルがWORM状態にコミットされたあとは、保持期間を延長することはできますが短縮することはできません。

====
.手順
. SnapLockボリューム上のファイルにデフォルトの保持期間を設定します。
+
`*volume snaplock modify -vserver _SVM_name_ -volume _volume_name_ -default-retention-period _default_retention_period_ -minimum-retention-period _min_retention_period_ -maximum-retention-period _max_retention_period_*`

+
 `volume snaplock modify`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/volume-snaplock-modify.html["ONTAPコマンド リファレンス"^]を参照してください。

+
[NOTE]
====
以下の例は、最大保持期間と最小保持期間が過去に変更されていないことを想定しています。

====
+
次のコマンドは、ComplianceボリュームまたはEnterpriseボリュームのデフォルトの保持期間を20日に設定します。

+
[listing]
----
cluster1::> volume snaplock modify -vserver vs1 -volume vol1 -default-retention-period 20days
----
+
次のコマンドは、Complianceボリュームのデフォルトの保持期間を70年に設定します。

+
[listing]
----
cluster1::> volume snaplock modify -vserver vs1 -volume vol1 -maximum-retention-period 70years
----
+
次のコマンドは、Enterpriseボリュームのデフォルトの保持期間を10年に設定します。

+
[listing]
----
cluster1::> volume snaplock modify -vserver vs1 -volume vol1 -default-retention-period max -maximum-retention-period 10years
----
+
次のコマンドは、Enterpriseボリュームのデフォルトの保持期間を10日に設定します。

+
[listing]
----
cluster1::> volume snaplock modify -vserver vs1 -volume vol1 -minimum-retention-period 10days
cluster1::> volume snaplock modify -vserver vs1 -volume vol1 -default-retention-period min
----
+
次のコマンドは、Complianceボリュームのデフォルトの保持期間を無期限に設定します。

+
[listing]
----
cluster1::> volume snaplock modify -vserver vs1 -volume vol1 -default-retention-period infinite -maximum-retention-period infinite
----




== ファイルに対する保持期限の明示的な設定

ファイルに対して保持期限を明示的に設定するには、最終アクセス時刻を変更します。最終アクセス時刻は、NFSまたはCIFSで適切なコマンドやプログラムを使用して変更できます。

.タスク概要
ファイルがWORMモードにコミットされた後、保持期間を延長することはできますが、短縮することはできません。保持期間はファイルの `atime`フィールドに保存されます。

[NOTE]
====
ファイルの保持期間を明示的に `infinite`に設定することはできません。この値は、デフォルトの保持期間を使用して保持期間を計算する場合にのみ使用できます。

====
.手順
. 適切なコマンドまたはプログラムを使用して、保持期限を設定するファイルの最終アクセス時刻を変更します。
+
UNIXシェルで、次のコマンドを使用して、 `document.txt`という名前のファイルの保持時間を2020年11月21日午前6：00に設定します：

+
[listing]
----
touch -a -t 202011210600 document.txt
----
+
[NOTE]
====
Windowsでは、任意の適切なコマンドまたはプログラムを使用して最終アクセス時刻を変更できます。

====




== イベント発生後のファイル保持期間の設定

ONTAP 9.3 以降では、SnapLock _Event Based Retention（EBR）_機能を使用して、イベント発生後にファイルを保持する期間を定義できます。

.開始する前に
* このタスクを実行するには、SnapLock管理者である必要があります。
+
link:create-compliance-administrator-account-task.html["SnapLock管理者アカウントの作成"]

* セキュアな接続（SSH、コンソール、またはZAPI）でログインする必要があります。


.タスク概要
_イベント保持ポリシー_は、イベント発生後のファイルの保持期間を定義します。このポリシーは、単一のファイルまたはディレクトリ内のすべてのファイルに適用できます。

* WORMファイル以外のファイルの場合、ポリシーで定義された保持期間にわたってWORM状態にコミットされます。
* WORMファイルまたは追記可能WORMファイルの場合、保持期間がポリシーで定義された保持期間まで延長されます。


ComplianceモードまたはEnterpriseモードのボリュームを使用できます。

[NOTE]
====
EBRポリシーは、リーガル ホールド中のファイルには適用できません。

====
高度な使用方法については、link:https://www.netapp.com/pdf.html?item=/media/6158-tr4526pdf.pdf["NetApp SnapLockを使用した準拠WORMストレージ"^]を参照してください。

|===


| *_EBRを使用して既存のWORMファイルの保持期間を延長する_* 


 a| 
EBRは、既存のWORMファイルの保持期間を延長する場合に便利です。たとえば、会社の規定で、従業員が源泉徴収の選択を変更した場合に、変更後3年間は従業員のW-4レコードを変更不可能な状態で保管するように定められているとします。さらに、従業員の退職後はW-4レコードを5年間保管するように定めた規定もあります。

このような状況では、5年間の保持期間を設定したEBRポリシーを作成できます。従業員が退職した後（「`event`」）、EBRポリシーを従業員のW-4レコードに適用し、保持期間を延長します。これは通常、手動で保持期間を延長するよりも簡単で、特に大量のファイルが関係する場合は効果的です。

|===
.手順
. EBRポリシーを作成します。
+
`snaplock event-retention policy create -vserver _SVM_name_ -name _policy_name_ -retention-period _retention_period_`

+
次のコマンドは、 `vs1`上に保持期間が10年のEBRポリシー `employee_exit`を作成します：

+
[listing]
----
cluster1::>snaplock event-retention policy create -vserver vs1 -name employee_exit -retention-period 10years
----
. EBRポリシーを適用します。
+
`snaplock event-retention apply -vserver _SVM_name_ -name _policy_name_ -volume _volume_name_ -path _path_name_`

+
次のコマンドは、 `vs1`上の `d1`ディレクトリ内のすべてのファイルにEBRポリシー `employee_exit`を適用します：

+
[listing]
----
cluster1::>snaplock event-retention apply -vserver vs1 -name employee_exit -volume vol1 -path /d1
----


.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snaplock-event-retention-policy-create.html["SnapLockイベント保持ポリシーの作成"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snaplock-event-retention-apply.html["SnapLockイベント保持適用"^]

