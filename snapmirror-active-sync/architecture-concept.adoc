---
sidebar: sidebar 
permalink: snapmirror-active-sync/architecture-concept.html 
keywords: SM-BC, SMBC, snapmirror active sync 
summary: SnapMirrorアクティブ同期のアーキテクチャを理解して、アプリケーションの保護を適切に設定できるようにします。 
---
= ONTAP SnapMirror アクティブ同期アーキテクチャ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
SnapMirror Active Syncアーキテクチャは、両方のクラスタでアクティブなワークロードを可能にし、プライマリワークロードを両方のクラスタから同時に処理できます。一部の国では、金融機関の規制により、セカンダリ データ センターからも定期的にサービスを提供すること（「Tick-Tock」デプロイメントと呼ばれる）が求められており、SnapMirror Active Syncによってこれが可能になります。

ビジネス継続性を確保するためのデータ保護関係は、ソース ストレージ システムとデスティネーション ストレージ システムの間に作成されます。これは、ストレージ仮想マシン（SVM）内の異なるボリュームからアプリケーション固有のLUNまたはNVMeネームスペースをコンシステンシーグループに追加することで実現されます。通常の運用では、エンタープライズアプリケーションはプライマリコンシステンシーグループに書き込みを行い、プライマリコンシステンシーグループはこのI/Oをミラーコンシステンシーグループに同期的に複製します。

image:snapmirror-active-sync-architecture.png["SnapMirrorアクティブのアーキテクチャ"]

データ保護関係にはデータの2つの個別のコピーが存在するにもかかわらず、SnapMirror active syncは同じLUNまたはNVMeネームスペースIDを維持するため、アプリケーション ホストはこれを複数のパスを持つ共有仮想デバイスと認識し、一度に1つのLUNまたはNVMeネームスペース コピーのみに書き込みます。障害によってプライマリ ストレージ システムがオフラインになると、ONTAPはこの障害を検出し、Mediatorを使用して再確認を行います。ONTAPとMediatorのどちらもプライマリ サイトにpingを送信できない場合、ONTAPは自動フェイルオーバー処理を実行します。このプロセスにより、以前はフェイルオーバーのために必要だった手動による介入やスクリプト作成が不要になり、特定のアプリケーションのみをフェイルオーバーできます。

その他の考慮事項：

* ビジネス継続性を目的とする保護の対象から外れた、ミラーされていないボリュームがサポートされる
* ビジネス継続性を目的として保護されているボリュームでは、他のSnapMirror非同期関係は1つのみサポートされる
* ビジネス継続性を目的とする保護では、カスケード トポロジはサポートされない




== 仲介者の役割

SnapMirror active syncは、メディエーターを使用してSnapMirror active syncコピーの受動的な監視を行います。ネットワークが分断された場合、または一方のコピーが使用できなくなった場合、SnapMirror active syncはメディエーターを使用して、どちらのコピーがI/O処理を継続するかを決定し、もう一方のコピーのI/O処理を停止します。オンプレミスONTAP Mediatorに加えて、ONTAP 9.17.1以降では、ONTAP Cloud Mediatorをインストールすることで、クラウド環境で同様の機能を提供できます。ONTAP MediatorとONTAP Cloud Mediatorのどちらか一方を使用できますが、両方を同時に使用することはできません。

Mediatorは、SnapMirrorアクティブ同期構成においてパッシブ クォーラム監視として重要な役割を果たし、クォーラムの維持を確保し、障害発生時のデータ アクセスを容易にします。コントローラのpingプロキシとして機能し、ピア コントローラの稼働状態を確認します。Mediatorはスイッチオーバー処理を積極的にトリガーすることはありませんが、ネットワーク通信に問題が発生した場合に、正常なノードがパートナーのステータスを確認できるようにするという重要な機能を提供します。クォーラム監視としての役割において、ONTAP Mediatorはピア クラスタへの代替パス（実質的にはプロキシとして機能）を提供します。

さらに、クラスタがクォーラム プロセスの一部としてこの情報を取得できるようにします。通信には、ノード管理 LIF とクラスタ管理 LIF を使用します。サイト障害とInterSwitch Link（ISL）障害を区別するために、複数のパスを介して冗長接続を確立します。イベントが原因でクラスタが Mediator ソフトウェアおよびそのすべてのノードとの接続を失うと、到達不能とみなされます。これによりアラートがトリガーされ、セカンダリ サイトのミラー コンシステンシ グループへの自動フェイルオーバーが有効になり、クライアントの中断のない I/O が保証されます。レプリケーション データ パスはハートビート メカニズムに依存しており、ネットワークの障害またはイベントが一定期間を超えて継続すると、ハートビート障害が発生し、関係が同期されなくなる可能性があります。ただし、別のポートへの LIF フェイルオーバーなどの冗長パスが存在すると、ハートビートが維持され、このような中断を防ぐことができます。

.ONTAP Mediator
ONTAP Mediatorは、監視対象の2つのONTAPクラスタとは別の3番目の障害ドメインにインストールされます。このセットアップには、3つの主要コンポーネントがあります：

* SnapMirrorアクティブ同期プライマリ整合性グループをホストするプライマリONTAPクラスタ
* ミラー整合性グループをホストするセカンダリONTAPクラスタ
* ONTAP Mediator


ONTAP Mediator は次の目的で使用されます：

* クォーラムの確立
* 自動フェイルオーバー（AUFO）による継続的可用性
* 計画的フェイルオーバー（PFO）



NOTE: ONTAP Mediator 1.7 は、ビジネス継続性のために 10 個のクラスタ ペアを管理できます。


NOTE: ONTAP Mediatorが利用できない場合、計画的フェイルオーバーや自動フェイルオーバーは実行できません。アプリケーション データは中断することなく同期的にレプリケーションを継続し、データ損失は発生しません。

.ONTAP Cloud Mediator
ONTAP 9.17.1以降、ONTAP Cloud MediatorはNetApp Consoleでクラウドベースのサービスとして利用可能になり、SnapMirror Active Syncと連携して使用できます。ONTAP Mediatorと同様に、ONTAP Cloud MediatorはSnapMirror Active Sync関係において以下の機能を提供します：

* HAまたはSnapMirrorアクティブ同期メタデータ用の永続的かつ隔離されたストアを提供します。
* コントローラの稼働を確認するpingプロキシとして機能します。
* クォーラムを判定するために、ノードの健全性を同期的に照会します。


ONTAP Cloud Mediatorは、SnapMirror Active Syncの導入を簡素化します。NetApp Consoleクラウド サービスを、管理が不要な第3サイトとして使用します。ONTAP Cloud Mediatorサービスは、オンプレミスのONTAP Mediatorと同じ機能を提供しますが、ONTAP Cloud Mediatorは第3サイトの維持に伴う運用上の複雑さを軽減します。一方、ONTAP Mediatorはパッケージとして提供されており、独立した電源とネットワーク インフラを備えた第3サイトで稼働するLinuxホストにインストールする必要があります。



== SnapMirrorアクティブ同期操作ワークフロー

次の図は、SnapMirrorアクティブ同期の設計の概要を表しています。

image:workflow_san_snapmirror_business_continuity.png["SnapMirrorアクティブ同期の高レベル設計"]

この図は、プライマリ データセンターのStorage VM（SVM）でホストされているエンタープライズ アプリケーションを示しています。SVMには5つのボリュームがあり、そのうちの3つは整合性グループに属しています。整合性グループ内の3つのボリュームはセカンダリ データセンターにミラーリングされています。通常は、書き込み処理がいずれもプライマリ データセンターに対して実行されます。つまり、そのデータセンターがI/O処理のソースとして機能し、セカンダリ データセンターがデスティネーションとして機能します。

プライマリ データ センターで災害が発生した場合、ONTAPはセカンダリ データ センターをプライマリとして動作させ、すべてのI/O操作を処理します。処理対象となるのは、コンシステンシ グループ内でミラーリングされているボリュームのみです。SVM上の他の2つのボリュームに関連する操作は、災害の影響を受けます。



== 対称アクティブ / アクティブ

SnapMirrorアクティブ同期は、非対称ソリューションと対称ソリューションを提供します。

_非対称構成_では、プライマリ ストレージ コピーはアクティブ最適化パスを公開し、クライアントI/Oをアクティブに処理します。セカンダリ サイトはI/Oにリモート パスを使用します。セカンダリ サイトのストレージ パスはアクティブ非最適化パスとみなされます。書き込みLUNへのアクセスはセカンダリ サイトからプロキシされます。NVMeプロトコルは非対称構成ではサポートされません。

_対称アクティブ / アクティブ構成_では、アクティブに最適化されたパスは両方のサイトで公開され、ホスト固有であり、構成可能であるため、どちらの側のホストもアクティブ I/O のローカルストレージにアクセスできます。ONTAP 9.16.1 以降、対称アクティブ / アクティブは 2 ノードクラスターと 4 ノードクラスターでサポートされます。SnapMirror Active Sync は、2 ノードクラスターから 2 ノードクラスターの構成と、4 ノードクラスターから 4 ノードクラスターの構成をサポートします。4 ノードクラスターから 2 ノードクラスターの構成、または 2 ノードクラスターから 4 ノードクラスターの構成はサポートされていません。ONTAP 9.17.1 以降、対称アクティブ / アクティブ構成は、2 ノードクラスターで NVMe プロトコルをサポートします。

image:snapmirror-active-sync-symmetric.png["対称アクティブ構成"]

対称アクティブ / アクティブは、VMware Metro Storage Cluster、Oracle RAC、SQLを使用したWindowsフェイルオーバー クラスタリングなどのクラスタ アプリケーションを対象としています。
