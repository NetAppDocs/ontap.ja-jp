---
sidebar: sidebar 
permalink: snapmirror-active-sync/architecture-concept.html 
keywords: SM-BC, SMBC, snapmirror active sync 
summary: SnapMirror Active Syncのアーキテクチャを理解し、アプリケーションの保護を適切に設定します。 
---
= SnapMirror Active Syncアーキテクチャ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
SnapMirrorのアクティブ同期アーキテクチャにより、両方のクラスタでアクティブなワークロードが可能になり、両方のクラスタからプライマリワークロードを同時に処理できます。一部の国の金融機関の規制では、企業はセカンダリデータセンターから定期的にサービスを提供できるようにする必要があります。これは「Tick-Tock」導入と呼ばれ、SnapMirrorアクティブ同期によって実現されます。

ビジネス継続性を確保するためのデータ保護関係は、Storage Virtual Machine（SVM）内の異なるボリュームのアプリケーション固有のLUNを整合グループに追加することで、ソースストレージシステムとデスティネーションストレージシステムの間で作成されます。通常の運用では、エンタープライズアプリケーションからプライマリ整合グループに書き込みが行われ、プライマリ整合グループがこのI/Oをミラー整合グループに同期的にレプリケートします。

image:snapmirror-active-sync-architecture.png["SnapMirrorアクティブ構成のアーキテクチャ"]

データ保護関係にはデータのコピーが2つ存在しますが、SnapMirrorのアクティブな同期では同じLUN IDが維持されるため、アプリケーションホストはこれを複数のパスを持つ共有仮想デバイスと見なしますが、一度に書き込まれるLUNコピーは1つだけです。障害が発生してプライマリストレージシステムがオフラインになると、ONTAPはこの障害を検出し、メディエーターを使用して再確認します。ONTAPもメディエーターもプライマリサイトにpingを送信できない場合、ONTAPは自動フェイルオーバー処理を実行します。このプロセスにより、特定のアプリケーションのみがフェイルオーバーされ、以前はフェイルオーバーのために必要だった手動操作やスクリプト作成は不要になります。

その他の考慮事項：

* ビジネス継続性を目的とする保護の対象から外れた、ミラーされていないボリュームがサポートされる
* ビジネス継続性を目的として保護されているボリュームでは、他のSnapMirror非同期関係は1つのみサポートされる
* ビジネス継続性を目的とする保護では、カスケード トポロジはサポートされない




== ONTAP Mediator

ONTAP Mediatorは、2つのONTAPクラスタとは別の第3の障害ドメインにインストールします。その重要な役割は、SnapMirrorアクティブ同期コピーのパッシブ監視を行うことです。ネットワークにパーティションが作成された場合や、一方のコピーが使用できない場合、SnapMirrorアクティブ同期ではMediatorを使用して、どちらのコピーでI/O処理を継続するかを決定し、もう一方のコピーでのI/Oを中断します。この環境には、次の3つの主要コンポーネントがあります。

* SnapMirrorアクティブ同期プライマリ整合性グループをホストしているプライマリONTAPクラスタ
* ミラー整合性グループをホストしているセカンダリONTAPクラスタ
* ONTAP Mediator


ONTAPメディエーターは、SnapMirrorアクティブ同期構成でパッシブクォーラム監視として重要な役割を果たし、クォーラムのメンテナンスを確保し、障害発生時のデータアクセスを促進します。コントローラのpingプロキシとして機能し、ピアコントローラの稼働状況を判断します。Mediatorはスイッチオーバー処理をアクティブにトリガーしませんが、ネットワーク通信の問題が発生したときに稼働しているノードがパートナーのステータスを確認できるため、重要な機能を提供します。ONTAPメディエーターは、クォーラム監視としての役割において、ピアクラスタへの代替パスを提供します（実質的にはプロキシとして機能します）。

さらに、クラスタはクォーラムプロセスの一部としてこの情報を取得できます。通信目的でノード管理LIFとクラスタ管理LIFを利用します。サイト障害とスイッチ間リンク（ISL）障害を区別するために、複数のパスを介した冗長接続が確立されます。イベントが原因でONTAPメディエーターソフトウェアおよびそのすべてのノードとの接続が失われたクラスタは到達不能とみなされます。これによりアラートがトリガーされ、セカンダリサイトのミラー整合性グループへの自動フェイルオーバーが有効になり、クライアントのI/Oが中断されなくなります。レプリケーションデータパスはハートビートメカニズムに依存しており、ネットワークの不具合やイベントが一定期間以上続くとハートビート障害が発生し、関係が非同期状態になる可能性があります。ただし、LIFの別のポートへのフェイルオーバーなど、冗長パスがあるとハートビートが維持され、そのような中断を防ぐことができます。

要約すると、ONTAPメディエーターは次の目的で使用されます。

* クォーラムを確立する
* 自動フェイルオーバー（AUFO）による継続的可用性
* 計画的フェイルオーバー（PFO）



NOTE: ONTAP Mediator 1.7では、ビジネス継続性を目的として10個のクラスタ ペアを管理できます。


NOTE: ONTAP Mediatorを使用できない場合は、計画的フェイルオーバーや自動フェイルオーバーを実行できません。アプリケーション データは、中断することなく、継続して同期的にレプリケートされ、データ損失ゼロを実現します。



== 処理

次の図は、SnapMirrorアクティブ同期の設計の概要を表しています。

image:workflow_san_snapmirror_business_continuity.png["SnapMirrorアクティブ同期の概要設計"]

次の図は、プライマリデータセンターのStorage VM（SVM）でホストされているエンタープライズアプリケーションを示しています。SVMには5つのボリュームがあり、そのうちの3つは整合グループに属しています。整合グループ内の3つのボリュームがセカンダリデータセンターにミラーリングされます。通常、すべての書き込み処理はプライマリデータセンターに対して実行されます。つまり、このデータセンターがI/O処理のソースとして機能し、セカンダリデータセンターがデスティネーションとして機能します。

プライマリデータセンターで災害が発生した場合、ONTAPはプライマリデータセンターとして機能し、すべてのI/O処理を実行するようにセカンダリデータセンターに指示します。整合性グループでミラーされたボリュームのみが提供されます。SVM上の他の2つのボリュームに関する処理は、すべて災害の影響を受けます。



== 対称アクティブ/アクティブ

SnapMirror Active Syncは、非対称ソリューションと対称ソリューションを提供します。

非対称構成_では、プライマリストレージコピーがアクティブな最適化パスを公開し、クライアントI/Oをアクティブに処理します。セカンダリサイトはI/Oにリモートパスを使用します。セカンダリサイトのストレージパスはアクティブで最適化されていないとみなされます。書き込みLUNへのアクセスは、セカンダリサイトからプロキシされます。

in_symmetric active/active configurations_では、アクティブな最適化パスが両方のサイトで公開され、ホストに固有で設定可能です。つまり、どちらの側のホストもアクティブなI/Oのためにローカルストレージにアクセスできます。ONTAP 9.16.1以降では、最大4ノードのクラスタで対称アクティブ/アクティブがサポートされます。

image:snapmirror-active-sync-symmetric.png["対称アクティブ構成"]

対称アクティブ/アクティブ構成は、VMware Metro Storage Cluster、Oracle RAC、SQLを使用したWindowsフェイルオーバークラスタリングなどのクラスタ化されたアプリケーションを対象としています。
