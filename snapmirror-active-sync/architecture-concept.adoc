---
sidebar: sidebar 
permalink: snapmirror-active-sync/architecture-concept.html 
keywords: SM-BC, SMBC, snapmirror active sync 
summary: SnapMirror Active Syncのアーキテクチャを理解し、アプリケーションの保護を適切に設定します。 
---
= ONTAP SnapMirrorアクティブ同期アーキテクチャ
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
SnapMirrorのアクティブ同期アーキテクチャにより、両方のクラスタでアクティブなワークロードが可能になり、両方のクラスタからプライマリワークロードを同時に処理できます。一部の国の金融機関の規制では、企業はセカンダリデータセンターから定期的にサービスを提供できるようにする必要があります。これは「Tick-Tock」導入と呼ばれ、SnapMirrorアクティブ同期によって実現されます。

ストレージ仮想マシン (SVM) 内の異なるボリュームからアプリケーション固有の LUN または NVMe 名前空間を整合性グループに追加することにより、ソース ストレージ システムと宛先ストレージ システム間にビジネス継続性を保護するためのデータ保護関係が作成されます。通常の運用時には、エンタープライズ アプリケーションによってプライマリ整合グループに書き込みが行われ、そのI/Oがミラー整合グループに同期的にレプリケートされます。

image:snapmirror-active-sync-architecture.png["SnapMirrorアクティブ構成のアーキテクチャ"]

データ保護関係にはデータの 2 つの個別のコピーが存在するにもかかわらず、 SnapMirrorアクティブ同期は同じ LUN または NVMe 名前空間 ID を維持するため、アプリケーション ホストはこれを複数のパスを持つ共有仮想デバイスとして認識し、一度に書き込まれる LUN または NVMe 名前空間コピーは 1 つだけです。障害が発生してプライマリ ストレージ システムがオフラインになると、ONTAPはこの障害を検出し、Mediatorを使用して再確認します。ONTAPもMediatorもプライマリ サイトにpingを送信できない場合、ONTAPは自動フェイルオーバー処理を実行します。このプロセスでは、特定のアプリケーションのみがフェイルオーバーすることになり、フェイルオーバーに以前は必要だった手動操作やスクリプト作成が不要になります。

その他の考慮事項：

* ビジネス継続性を目的とする保護の対象から外れた、ミラーされていないボリュームがサポートされる
* ビジネス継続性を目的として保護されているボリュームでは、他のSnapMirror非同期関係は1つのみサポートされる
* ビジネス継続性を目的とする保護では、カスケード トポロジはサポートされない




== 仲介者の役割

SnapMirror Active Syncは、メディエーターを使用して、 SnapMirror Active Syncコピーの受動的な監視役として機能します。ネットワークが分断された場合、または一方のコピーが使用できなくなった場合、 SnapMirror Active Syncはメディエーターを使用して、どちらのコピーがI/O処理を継続するかを決定し、もう一方のコピーのI/O処理を停止します。オンプレミスのONTAPメディエーターに加えて、 ONTAP 9.17.1以降では、 ONTAP Cloud Mediatorをインストールすることで、クラウド環境で同様の機能を提供できます。ONTAPONTAPとONTAP Cloud Mediatorのどちらかを使用できますが、両方を同時に使用することはできません。

Mediator は、パッシブ クォーラム ウィットネスとしてSnapMirrorアクティブ同期構成で重要な役割を果たし、クォーラムの維持を保証し、障害発生時のデータ アクセスを容易にします。コントローラがピア コントローラの稼働状況を確認するためのpingプロキシとして機能します。Mediatorは、スイッチオーバー処理をアクティブにトリガーしませんが、重要な機能を提供するために、ネットワーク通信の問題が発生したときに稼働しているノードがパートナーのステータスを確認できるようにします。ONTAP Mediatorは、クォーラム監視という役割の中で、ピア クラスタへの代替パスを提供します（実質的にはプロキシとして機能します）。

さらに、クォーラム プロセスの一環として、クラスタがこの情報を取得できるようにします。通信にはノード管理LIFとクラスタ管理LIFを使用します。サイト障害とインタースイッチ リンク（ISL）障害を区別するために、複数のパスを経由する冗長な接続を確立します。イベントによりクラスタがMediatorソフトウェアおよびその全ノードとの接続を失うと、そのクラスタは到達不能とみなされます。これによりアラートがトリガーされ、セカンダリサイトのミラーコンシステンシグループへの自動フェイルオーバーが有効になり、クライアントのI/Oが中断されないようになります。レプリケーション データ パスはハートビート メカニズムに依存しているため、ネットワークの不具合やイベントが一定期間以上続くと、ハートビート障害が発生し、関係が非同期状態になる可能性があります。ただし、LIFの別のポートへのフェイルオーバーなど、冗長パスがあると、ハートビートが維持され、そのような中断を防ぐことができます。

.ONTAP Mediator
ONTAP Mediator は、監視対象の 2 つのONTAPクラスタとは別の 3 番目の障害ドメインにインストールされます。この環境には、次の3つの主要コンポーネントがあります。

* SnapMirrorアクティブ同期プライマリ整合性グループをホストしているプライマリONTAPクラスタ
* ミラー整合性グループをホストしているセカンダリONTAPクラスタ
* ONTAP Mediator


ONTAP Mediator は次の目的で使用されます。

* クォーラムを確立する
* 自動フェイルオーバー（AUFO）による継続的可用性
* 計画的フェイルオーバー（PFO）



NOTE: ONTAP Mediator 1.7では、ビジネス継続性を目的として10個のクラスタ ペアを管理できます。


NOTE: ONTAP Mediatorを使用できない場合は、計画的フェイルオーバーや自動フェイルオーバーを実行できません。アプリケーション データは、中断することなく、継続して同期的にレプリケートされ、データ損失ゼロを実現します。

.ONTAPクラウドメディエーター
ONTAP 9.17.1以降、 ONTAP Cloud MediatorはBlueXPのクラウドベースサービスとして提供され、 SnapMirror Active Syncと連携して使用できます。ONTAPMediatorと同様に、 ONTAP Cloud MediatorはSnapMirror Active Sync関係において以下の機能を提供します。

* HA またはSnapMirrorアクティブ同期メタデータ用の永続的かつ隔離されたストアを提供します。
* コントローラーの活性状態を確認するための ping プロキシとして機能します。
* クォーラムの決定に役立つ同期ノード健全性クエリ機能を提供します。


ONTAP Cloud Mediatorは、 BlueXPクラウドサービスをお客様が管理する必要のない第3サイトとして使用することで、 SnapMirror Active Syncの導入を簡素化します。ONTAPCloud MediatorサービスはオンプレミスのONTAP Mediatorと同じ機能を提供しますが、第3サイトの維持に伴う運用上の複雑ONTAPを軽減します。ONTAP、 ONTAP Mediatorはパッケージとして提供されており、独立した電源とネットワークインフラを備えた第3サイトで稼働するLinuxホストにインストールする必要があります。



== SnapMirrorアクティブ同期操作ワークフロー

次の図は、SnapMirrorアクティブ同期の設計の概要を表しています。

image:workflow_san_snapmirror_business_continuity.png["SnapMirrorアクティブ同期の概要設計"]

次の図は、プライマリデータセンターのStorage VM（SVM）でホストされているエンタープライズアプリケーションを示しています。SVMには5つのボリュームがあり、そのうちの3つは整合グループに属しています。整合グループ内の3つのボリュームがセカンダリデータセンターにミラーリングされます。通常、すべての書き込み処理はプライマリデータセンターに対して実行されます。つまり、このデータセンターがI/O処理のソースとして機能し、セカンダリデータセンターがデスティネーションとして機能します。

プライマリデータセンターで災害が発生した場合、ONTAPはプライマリデータセンターとして機能し、すべてのI/O処理を実行するようにセカンダリデータセンターに指示します。整合性グループでミラーされたボリュームのみが提供されます。SVM上の他の2つのボリュームに関する処理は、すべて災害の影響を受けます。



== 対称アクティブ/アクティブ

SnapMirror Active Syncは、非対称ソリューションと対称ソリューションを提供します。

_非対称構成_ では、プライマリ ストレージ コピーはアクティブに最適化されたパスを公開し、クライアント I/O をアクティブに提供します。NVMeセカンダリ サイトはI/Oにリモート パスを使用します。セカンダリ サイトのストレージ パスはアクティブ / 非最適化とみなされます。書き込みLUNへのアクセスは、セカンダリ サイトからプロキシされます。プロトコルは非対称構成ではサポートされません。

_対称アクティブ/アクティブ構成_では、アクティブ最適化パスが両サイトに公開され、ホスト固有で設定可能です。つまり、どちらの側のホストもアクティブI/Oのためにローカルストレージにアクセスできます。ONTAPONTAP以降、対称アクティブ/アクティブは最大4ノードのクラスタでサポートされます。ONTAP9.17.1以降、対称アクティブ/アクティブ構成は2ノードクラスタでNVMeプロトコルをサポートします。

image:snapmirror-active-sync-symmetric.png["対称アクティブ構成"]

対称アクティブ/アクティブ構成は、VMware Metro Storage Cluster、Oracle RAC、SQLを使用したWindowsフェイルオーバークラスタリングなどのクラスタ化されたアプリケーションを対象としています。
