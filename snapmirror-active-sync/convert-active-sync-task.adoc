---
sidebar: sidebar 
permalink: snapmirror-active-sync/convert-active-sync-task.html 
keywords: SM-BC, SMBC, convert, SnapMirror synchronous, existing, snapmirror active sync 
summary: SnapMirror 関係を SnapMirror アクティブ同期に変換します。 
---
= 既存の ONTAP SnapMirror 関係を SnapMirror アクティブ同期関係に変換する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
SnapMirror保護を設定している場合は、関係をSnapMirrorアクティブ同期に変換できます。ONTAP 9.15.1以降では、対称アクティブ / アクティブ保護を使用するように関係を変換できます。



== 既存の iSCSI または FC SnapMirror 関係を非対称 SnapMirror アクティブ同期関係に変換する

ソース クラスタとデスティネーション クラスタ間に既存の iSCSI または FC SnapMirror 同期関係がある場合は、それを非対称 SnapMirror アクティブ同期関係に変換できます。これにより、ミラー ボリュームを整合性グループに関連付けることができ、マルチ ボリューム ワークロード全体で RPO ゼロを確保できます。さらに、SnapMirror アクティブ同期関係を確立する前の時点に戻す必要がある場合は、既存の SnapMirror Snapshot を保持できます。

.タスク概要
* プライマリ クラスタとセカンダリ クラスタのクラスタ管理者およびSVM管理者である必要があります。
* SnapMirrorポリシーを変更してRPOゼロの同期をRTOゼロの同期に変換することはできません。
*  `snapmirror create`コマンドを発行する前に、LUN のマッピングが解除されていることを確認する必要があります。
+
セカンダリ ボリューム上の既存の LUN がマップされ、 `AutomatedFailover`ポリシーが設定されている場合、 `snapmirror create`コマンドによってエラーが発生します。



.開始する前に
* プライマリ クラスタとセカンダリ クラスタの間には、ゼロ RPO SnapMirror 同期関係が存在する必要があります。
* RTOゼロのSnapMirror関係を作成する前に、デスティネーション ボリュームのすべてのLUNのマッピングを解除する必要があります。
* SnapMirrorアクティブ同期ではSANプロトコルのみサポートされます（NFS / CIFSはサポートされません）。NASアクセス用に整合性グループのコンスティチュエントがマウントされていないことを確認します。
* link:mediator-install-task.html["ONTAP Mediator"] SnapMirror アクティブ同期用に設定する必要があります。


.手順
. セカンダリ クラスタから、既存の関係に対してSnapMirror更新を実行します。
+
`SiteB::>snapmirror update -destination-path vs1_dst:vol1`

. SnapMirrorの更新が正常に完了したことを確認します。
+
`SiteB::>snapmirror show`

. RPOゼロの各同期関係を一時停止します。
+
`SiteB::>snapmirror quiesce -destination-path vs1_dst:vol1`

+
`SiteB::>snapmirror quiesce -destination-path vs1_dst:vol2`

. RPOゼロの各同期関係を削除します。
+
`SiteB::>snapmirror delete -destination-path vs1_dst:vol1`

+
`SiteB::>snapmirror delete -destination-path vs1_dst:vol2`

. ソース SnapMirror 関係を解放しますが、共通のスナップショットは保持します：
+
`SiteA::>snapmirror release -relationship-info-only true -destination-path vs1_dst:vol1`

+
`SiteA::>snapmirror release -relationship-info-only true -destination-path vs1_dst:vol2`

. RTOゼロのSnapMirror同期関係を作成します。
+
`SiteB::> snapmirror create -source-path vs1_src:/cg/cg_src -destination-path vs1_dst:/cg/cg_dst -cg-item-mappings vol1:@vol1,vol2:@vol2 -policy AutomatedFailover`

. 整合性グループを再同期します。
+
`SiteB::> snapmirror resync -destination-path vs1_dst:/cg/cg_dst`

. ホストのLUN I/Oパスを再スキャンして、LUNへのすべてのパスをリストアします。




== 既存の iSCSI または FC SnapMirror 関係を対称アクティブ / アクティブに変換する

ONTAP 9.15.1 以降では、既存の iSCSI または FC SnapMirror 関係を SnapMirror アクティブ同期対称アクティブ / アクティブ関係に変換できます。

.開始する前に
* ONTAP 9.15.1以降が実行されている必要があります。
* プライマリ クラスタとセカンダリ クラスタの間にRPOゼロのSnapMirror同期関係が存在している必要があります。
* RTOゼロのSnapMirror関係を作成する前に、デスティネーション ボリュームのすべてのLUNのマッピングを解除する必要があります。
* SnapMirrorアクティブ同期ではSANプロトコルのみサポートされます（NFS / CIFSはサポートされません）。NASアクセス用に整合性グループのコンスティチュエントがマウントされていないことを確認します。
* link:mediator-install-task.html["ONTAP Mediator"] SnapMirror アクティブ同期用に設定する必要があります。


.手順
. セカンダリ クラスタから、既存の関係に対してSnapMirror更新を実行します。
+
`SiteB::>snapmirror update -destination-path vs1_dst:vol1`

. SnapMirrorの更新が正常に完了したことを確認します。
+
`SiteB::>snapmirror show`

. RPOゼロの各同期関係を一時停止します。
+
`SiteB::>snapmirror quiesce -destination-path vs1_dst:vol1`

+
`SiteB::>snapmirror quiesce -destination-path vs1_dst:vol2`

. RPOゼロの各同期関係を削除します。
+
`SiteB::>snapmirror delete -destination-path vs1_dst:vol1`

+
`SiteB::>snapmirror delete -destination-path vs1_dst:vol2`

. ソース SnapMirror 関係を解放しますが、共通のスナップショットは保持します：
+
`SiteA::>snapmirror release -relationship-info-only true -destination-path vs1_dst:vol1`

+
`SiteA::>snapmirror release -relationship-info-only true -destination-path vs1_dst:vol2`

. AutomatedFailoverDuplexポリシーを使用して、RTOゼロのSnapMirror同期関係を作成します。
+
`SiteB::> snapmirror create -source-path vs1_src:/cg/cg_src -destination-path vs1_dst:/cg/cg_dst -cg-item-mappings vol1:@vol1,vol2:@vol2 -policy AutomatedFailoverDuplex`

. 既存のホストがプライマリ クラスタに対してローカルである場合は、ホストをセカンダリ クラスタに追加し、各クラスタにそれぞれアクセスできるよう接続を確立します。
. セカンダリ サイトで、リモート ホストに関連付けられているigroupのLUNマップを削除します。
+

NOTE: レプリケートされていないLUNのマッピングがigroupに含まれていないことを確認します。

+
`SiteB::> lun mapping delete -vserver <svm_name> -igroup <igroup> -path <>`

. プライマリ サイトで、既存のホストのイニシエータ設定を変更して、ローカル クラスタのイニシエータの近接パスを設定します。
+
`SiteA::> igroup initiator add-proximal-vserver -vserver <svm_name> -initiator <host> -proximal-vserver <server>`

. 新しいホスト用の新しいigroupとイニシエータを追加し、ホストの近接性を設定してローカル サイトに対するホスト アフィニティを確立します。igroupレプリケーションを有効にして、設定をレプリケートし、リモート クラスタのホストのローカル性を反転させます。
+
``
SiteA::> igroup modify -vserver vsA -igroup ig1 -replication-peer vsB
SiteA::> igroup initiator add-proximal-vserver -vserver vsA -initiator host2 -proximal-vserver vsB
``

. ホスト上のパスを検出し、優先クラスタからストレージLUNへのアクティブ / 最適化パスがホストに設定されていることを確認します。
. アプリケーションを導入し、VMワークロードをクラスタ間に分散します。
. 整合性グループを再同期します。
+
`SiteB::> snapmirror resync -destination-path vs1_dst:/cg/cg_dst`

. ホストのLUN I/Oパスを再スキャンして、LUNへのすべてのパスをリストアします。


.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-create.html["snapmirror create"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-delete.html["snapmirror delete"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-quiesce.html["snapmirror quiesce"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-release.html["snapmirror release"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-resync.html["snapmirror resync"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-show.html["snapmirror show"^]

