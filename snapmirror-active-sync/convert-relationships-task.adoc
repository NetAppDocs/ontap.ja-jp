---
sidebar: sidebar 
permalink: snapmirror-active-sync/convert-relationships-task.html 
keywords: SM-BC, SMBC, convert, SnapMirror synchronous, zero RPO, zero recovery time objective, zero RTO, existing, snapmirror active sync 
summary: SnapMirrorアクティブ同期構成で対称保護と非対称保護を変換します。 
---
= ONTAP SnapMirrorアクティブ同期関係タイプを変換する
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAP 9.15.1以降では、SnapMirrorアクティブ同期保護のタイプを非対称から対称アクティブ / アクティブに変換できます。その逆も可能です



== 対称アクティブ / アクティブ関係への変換

iSCSI または FC SnapMirror アクティブ同期関係を非対称保護から対称アクティブ / アクティブに変換できます。

.開始する前に
* どちらのクラスタでも、ONTAP 9.15.1以降が実行されている必要があります。
* 対称アクティブ / アクティブ構成には `AutomatedFailoverDuplex`保護ポリシーが必要です。または、 `-type`が `automated-failover-duplex`である場合は、xref:../data-protection/create-custom-replication-policy-concept.html[カスタムSnapMirrorポリシーを作成する]を指定することもできます。


[role="tabbed-block"]
====
.System Manager
--
.均一な構成の手順
. デスティネーションigroupを削除します。
+
.. デスティネーション クラスタで、[**ホスト**] > [**SAN イニシエーター グループ**] に移動します。
.. SnapMirror関係のあるigroupを選択し、**削除**します。
.. ダイアログ ボックスで、[**関連付けられている LUN のマップを解除**] ボックスを選択し、[**削除**] を選択します。


. SnapMirrorアクティブ同期関係を編集します。
+
.. **保護** > **関係**に移動します。
.. 変更する関係の横にあるケバブ メニューを選択し、**編集**を選択します。
.. **保護ポリシー**をAutomatedFailoverDuplexに変更します。
..  `AutoMatedFailoverDuplex`を選択すると、ホストの近接設定を変更するためのダイアログボックスが表示されます。イニシエーターの場合は、**Initiator proximal to**で適切なオプションを選択し、**Save**をクリックします。
.. **保存**を選択します。


. **保護**メニューで、関係が `InSync`と表示されたら操作が成功したことを確認します。


.不均一な構成の手順
. デスティネーションigroupを削除します。
+
.. セカンダリ サイトで、**ホスト** > **SAN イニシエーター グループ**に移動します。
.. SnapMirror関係のあるigroupを選択し、**削除**します。
.. ダイアログ ボックスで、[**関連付けられている LUN のマップを解除**] ボックスを選択し、[**削除**] を選択します。


. 新しいigroupを作成します。
+
.. デスティネーション サイトの **SAN イニシエーター グループ** メニューで、**追加** を選択します。
.. **名前** を入力し、**ホスト オペレーティング システム** を選択して、**イニシエーター グループ メンバー** を選択します。
.. **保存**を選択します。


. 新しいigroupをデスティネーションLUNにマッピングします。
+
.. **Storage** > **LUN** に移動します。
.. igroupにマッピングするLUNをすべて選択します。
.. **詳細**を選択し、**イニシエーター グループにマップ**を選択します。


. SnapMirrorアクティブ同期関係を編集します。
+
.. **保護** > **関係**に移動します。
.. 変更する関係の横にあるケバブ メニューを選択し、**編集**を選択します。
.. **保護ポリシー**をAutomatedFailoverDuplexに変更します。
.. AutoMatedFailoverDuplexを選択すると、ホストの近接設定を変更するオプションが起動します。イニシエーターの場合は、**Initiator proximal to**で適切なオプションを選択し、**Save**をクリックします。
.. **保存**を選択します。


. **保護**メニューで、関係が `InSync`と表示されたら操作が成功したことを確認します。


--
.CLI
--
.均一な構成の手順
. SnapMirrorポリシーを `AutomatedFailover`から `AutomatedFailoverDuplex`に変更します：
+
`snapmirror modify -destination-path <destination_path> -policy AutomatedFailoverDuplex`

. ポリシーを変更すると再同期が実行されます。再同期が完了するまで待ち、関係が `Insync`であることを確認します：
+
`snapmirror show -destination-path <destination_path>`

. 既存のホストがプライマリ クラスタに対してローカルである場合は、ホストをセカンダリ クラスタに追加し、各クラスタにそれぞれアクセスできるよう接続を確立します。
. セカンダリ サイトで、リモート ホストに関連付けられているigroupのLUNマップを削除します。
+

NOTE: レプリケートされていないLUNのマッピングがigroupに含まれていないことを確認します。

+
`SiteB::> lun mapping delete -vserver <svm_name> -igroup <igroup> -path <>`

. プライマリサイトで、権限レベルを `advanced`に設定します：
+
`SiteA::> set -privilege advanced`

. 既存のホストのイニシエーター構成を変更して、ローカル クラスタ上のイニシエーターの近位パスを設定します。
+
`SiteA::*> igroup initiator add-proximal-vserver -vserver <svm_name> -initiator <host> -proximal-vserver <server>`

+

NOTE: この手順を完了したら、権限レベルを admin に戻すことができます。

. 新しいホスト用の新しいigroupとイニシエータを追加し、ホストの近接性を設定してローカル サイトに対するホスト アフィニティを確立します。igroupレプリケーションを有効にして、設定をレプリケートし、リモート クラスタのホストのローカル性を反転させます。
+
``
SiteA::> igroup modify -vserver vsA -igroup ig1 -replication-peer vsB
SiteA::> igroup initiator add-proximal-vserver -vserver vsA -initiator host2 -proximal-vserver vsB
``

. ホスト上のパスを検出し、優先クラスタからストレージLUNへのアクティブ / 最適化パスがホストに設定されていることを確認します。
. アプリケーションを導入し、VMワークロードをクラスタ間に分散します。


.不均一な構成の手順
. SnapMirrorポリシーを `AutomatedFailover`から `AutomatedFailoverDuplex`に変更します：
+
`snapmirror modify -destination-path <destination_path> -policy AutomatedFailoverDuplex`

. ポリシーを変更すると再同期が実行されます。再同期が完了するまで待ち、関係が `Insync`であることを確認します：
+
`snapmirror show -destination-path <destination_path>`

. 既存のホストがプライマリ クラスタに対してローカルである場合は、ホストをセカンダリ クラスタに追加し、各クラスタにそれぞれアクセスできるよう接続を確立します。
. セカンダリ サイトで、新しいホスト用の新しいigroupとイニシエータを追加し、ホストの近接性を設定してローカル サイトに対するホスト アフィニティを確立します。LUNをigroupにマッピングします。
+
``
SiteB::> igroup create -vserver <svm_name> -igroup <igroup>
SiteB::> igroup add -vserver <svm_name> -igroup  <igroup> -initiator <host_name>
SiteB::> lun mapping create -igroup  <igroup> -path <path_name>
``

. ホスト上のパスを検出し、優先クラスタからストレージLUNへのアクティブ / 最適化パスがホストに設定されていることを確認します。
. アプリケーションを導入し、VMワークロードをクラスタ間に分散します。


--
====


== 対称アクティブ / アクティブから非対称iSCSIまたはFC関係に変換する

iSCSI または FC を使用して対称アクティブ / アクティブ保護を構成した場合は、ONTAP CLI を使用して関係を非対称保護に変換できます。

.手順
. すべてのVMワークロードを、ソース クラスタのローカル ホストに移動します。
. VM インスタンスを管理していないホストの igroup 構成を削除し、igroup 構成を変更して igroup レプリケーションを終了します。
+
`igroup modify -vserver <svm_name> -igroup <igroup> -replication-peer -`

. セカンダリ サイトで、LUNのマッピングを解除します。
+
`SiteB::> lun mapping delete -vserver <svm_name> -igroup <igroup> -path <>`

. セカンダリ サイトで、対称アクティブ / アクティブ関係を削除します。
+
`SiteB::> snapmirror delete -destination-path <destination_path>`

. プライマリ サイトで、対称アクティブ / アクティブ関係を解除します。
`SiteA::> snapmirror release -destination-path <destination_path> -relationship-info-only true`
. セカンダリ サイトから、 `AutomatedFailover`ポリシーを使用して同じボリューム セットへの関係を作成し、関係を再同期します。
+
``
SiteB::> snapmirror create -source-path <source_path> -destination-path <destination_path> -cg-item-mappings <source:@destination> -policy AutomatedFailover
SiteB::> snapmirror resync -destination-path vs1:/cg/cg1_dst -policy <policy_type>
``

+

NOTE: 関係を再作成する前に、セカンダリ サイトの整合性グループにlink:../consistency-groups/delete-task.html["削除される"]が必要です。デスティネーション ボリュームlink:https://kb.netapp.com/onprem/ontap/dp/SnapMirror/How_to_change_a_volume_type_from_RW_to_DP["DP型に変換する必要がある"^]。ボリュームをDPに変換するには、-`AutomatedFailover`以外のポリシー（ `MirrorAndVault`、 `MirrorAllSnapshots`、または `Sync`）を使用して `snapmirror resync`コマンドを実行します。

. 関係ミラー状態が `Snapmirrored`であり、関係ステータスが `Insync`であることを確認します。
+
`snapmirror show -destination-path _destination_path_`

. ホストからパスを再検出します。


.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-delete.html["snapmirror delete"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-modify.html["snapmirror modify"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-release.html["snapmirror release"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-resync.html["snapmirror resync"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-show.html["snapmirror show"^]

