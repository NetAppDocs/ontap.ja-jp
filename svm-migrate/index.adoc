---
permalink: svm-migrate/index.html 
sidebar: sidebar 
keywords: svm, migrate, workflow, relocate, prerequisites, data mobility 
summary: ONTAP 9.10.1以降、クラスタ管理者は、容量とロード バランシングを管理したり、機器のアップグレードやデータセンターの統合を実現するために、SVMをソース クラスタからデスティネーション クラスタに無停止で再配置できるようになりました。ONTAP 9.12.1以降、この機能はFASおよびAFFシステム、そしてハイブリッド アグリゲートでサポートされます。 
---
= ONTAP SVMデータモビリティについて学ぶ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.10.1以降では、クラスタ管理者がSVMをソース クラスタからデスティネーション クラスタに無停止で再配置して、容量や負荷を分散したり、機器のアップグレードやデータセンターの統合を実施したりすることができます。

無停止SVM再配置は、ONTAP 9.10.1および9.11.1のAFFシステムでサポートされています。ONTAP 9.12.1以降では、この機能はFASシステムとAFFシステムの両方、およびハイブリッドアグリゲートでサポートされます。

SVMの名前とUUIDは移行後も変わらず、データLIF名、IPアドレス、オブジェクト名（ボリューム名など）もそのままです。SVM内のオブジェクトのUUIDは変わります。

ONTAP 9.18.1以降、ASAストレージシステムからASA r2ストレージシステムへのSVMの移行がサポートされます。ASA r2ストレージシステム（ASA A1K、ASA A90、ASA A70、ASA A50、ASA A30、ASA A20、またはASA C30）をお持ちで、ASAシステムからASA r2システムにSVMを移行する場合は、link:https://docs.netapp.com/us-en/asa-r2/manage-data/migrate-svm.html["これらの手順"^]に従ってください。



== SVMの移行ワークフロー

次の図はSVMの移行の一般的なワークフローを示しています。SVMの移行はデスティネーション クラスタから開始します。移行の進捗は、ソースとデスティネーションどちらからでも監視できます。カットオーバーは手動または自動で実行できます。デフォルトでは自動カットオーバーが実行されます。

image:workflow_svm_migrate.gif["SVM 移行のワークフロー。このワークフローに従う手順の概要を示します。"]



== SVMマイグレーション システムのサポート

[cols="1,1"]
|===


| コントローラ ファミリー | サポートされている ONTAP バージョン 


| ASA | ONTAP 9.18.1 以降、ASA から ASA r2 システムへの SVM 移行については、link:https://docs.netapp.com/us-en/asa-r2/manage-data/migrate-svm.html["これらの手順"^]に従ってください。 


| AFF Cシリーズ | ONTAP 9.12.1パッチ4以降 


| FAS | ONTAP 9.12.1以降 


| AFF Aシリーズ | ONTAP 9.10.1以降 
|===

NOTE: AFFクラスタからハイブリッドアグリゲートを持つFASクラスタに移行する場合、自動ボリューム配置機能は、同種アグリゲートのマッチングを試みます。たとえば、ソース クラスタに60個のボリュームがある場合、ボリューム配置機能は、ボリュームを配置するデスティネーション クラスタ上のAFFアグリゲートを検索します。AFFアグリゲートに十分なスペースがない場合は、ボリュームは非フラッシュディスクを備えたアグリゲートに配置されます。



== ONTAPバージョン別の拡張性サポート

[cols="1,1"]
|===


| ONTAPのバージョン | ソースとデスティネーションのHAペア 


| ONTAP 9.14.1以降 | 12 


| ONTAP 9.13.1 | 6 


| ONTAP 9.11.1 | 3 


| ONTAP 9.10.1 | 1 
|===


== ソース クラスタとデスティネーション クラスタ間のTCPラウンド トリップ タイム（RTT）に関するネットワーク インフラのパフォーマンス要件

クラスタにインストールされているONTAPバージョンごとに、ソース クラスタとデスティネーション クラスタを接続するネットワークの最大ラウンド トリップ タイムを次に示します。

|===


| ONTAPのバージョン | 最大RTT 


| ONTAP 9.12.1以降 | 10ms 


| ONTAP 9.11.1以前 | 2ms 
|===


== SVMあたりのサポートされる最大ボリューム数


NOTE: 混合クラスタまたはハイブリッド クラスタ内の SVM ごとに移行できるボリュームの最大数は、より少ない数のボリュームをサポートするクラスタ メンバーによって決まります。

[cols="1,1,1,1,1,1"]
|===


| ソース | デスティネーション | ONTAP 9.14.1以降 | ONTAP 9.13.1 | ONTAP 9.12.1 | ONTAP 9.11.1以前 


| AFF | AFF | 400 | 200 | 100 | 100 


| FAS | FAS | 80 | 80 | 80 | 該当なし 


| FAS | AFF | 80 | 80 | 80 | 該当なし 


| AFF | FAS | 80 | 80 | 80 | 該当なし 
|===


== 前提条件

SVMの移行を開始する前に、次の前提条件を満たす必要があります。

* マニュアルの利用者はクラスタ管理者である。
* link:../peering/create-cluster-relationship-93-later-task.html["ソース クラスタとデスティネーション クラスタ間にピア関係が設定されている"]。
* ソースクラスタとデスティネーションクラスタにはSnapMirror同期link:../system-admin/install-license-task.html["ライセンスがインストールされている"]が存在します。このライセンスはlink:../system-admin/manage-licenses-concept.html#licenses-included-with-ontap-one["ONTAP One"]に含まれています。
* ソース クラスタ内のすべてのノードで ONTAP 9.10.1 以降が実行されています。特定の ONTAP アレイ コントローラのサポートについては、link:https://hwu.netapp.com/["Hardware Universe"^]を参照してください。
* ソース クラスタ内のすべてのノードは同じ ONTAP バージョンを実行しています。
* デスティネーション クラスタ内のすべてのノードが同じONTAPバージョンを実行しています。
* デスティネーション クラスタ ONTAP バージョンは、ソース クラスタと同じか、2 つ以内の新しいメジャー バージョンです。
* ソース クラスタとデスティネーション クラスタは、データ LIF アクセス用に同じ IP サブネットをサポートします。
* ソース クラスタとデスティネーション クラスタの両方に、移行するすべての SVM ネットワークにアクセスできるインターフェイスが少なくとも 1 つ必要です。そうでない場合、移行の事前チェックは失敗します。
* ソース SVM に含まれる数が xref:Maximum supported volumes per SVM[リリースでサポートされるデータ ボリュームの最大数] より少なくなっています。
* デスティネーションにボリュームを配置するための十分なスペースがあります。
* ソース SVM に暗号化されたボリュームがある場合、Onboard Key Manager または外部キー管理はデスティネーション クラスタ レベルで設定されます。
+
** この場合、ソースのSVMレベルで設定されたキー マネージャはデスティネーションに移行されません。デスティネーションではクラスタ レベルのキー マネージャが使用されます。


* ソースに暗号化されたボリュームがあり、NetApp Aggregate Encryption（NAE）用に構成されている場合は、デスティネーションもNAE用に構成する必要があります。
* 非MetroCluster構成とMetroCluster構成の間、または2つのMetroCluster構成間でSVMを移行する場合は、構成が次の要件を満たしていることを確認します：
+

NOTE: MetroCluster構成内のローカル クラスタとパートナー クラスタ間での SVM の移行はサポートされていません。

+
** ソースクラスタとデスティネーションMetroClusterクラスタは「正常」状態です。つまり、スイッチオーバーモードや「スイッチバック待機中」状態であってはなりません。
** ソース クラスタとデスティネーション クラスタのMetroClusterは、FC から IP への移行またはハードウェア更新の処理中ではありません。
** ソース クラスタとデスティネーション クラスタの両方でONTAP 9.16.1以降が実行されている必要があります。
** ソースがMetroClusterクラスタの場合、SVMサブタイプは「sync-source」（「sync-destination」ではありません）になります。
+

NOTE: デスティネーションがMetroClusterクラスタの場合、デスティネーションに作成されるSVMは常に「sync-source」になります。デスティネーションがMetroClusterクラスタ以外の場合、SVMのサブタイプは常に「default」になります。







== ベストプラクティス

SVM移行を実行するときは、CPUワークロードが実行されるように、ソース クラスタとデスティネーション クラスタの両方にCPUヘッドルームを30%確保しておくことを推奨します。



== SVMの処理

SVM の移行と競合する可能性のある処理を確認します：

* フェイルオーバー処理
* wafliron
* フィンガープリント処理
* ボリュームの移動、再ホスト、クローン、作成、変換、または分析が実行されていません
* デスティネーション クラスタで実行されている SVM 移行はありません。一度に許可される SVM 移行は 1 つだけです。




== サポート対象の機能とサポート対象外の機能

次の表に、SVMのデータ移動でサポートされるONTAP機能とサポートが利用可能なONTAPリリースを示します。

SVM 移行におけるソースとデスティネーション間の ONTAP バージョンの相互運用性については、link:../data-protection/compatible-ontap-versions-snapmirror-concept.html#snapmirror-svm-disaster-recovery-relationships["SnapMirror関係に対応したONTAPバージョン"]を参照してください。

[cols="3,1,4"]
|===


| 機能 | 最初にサポートされたリリース | コメント 


| 監査ログ（NFS および SMB） | ONTAP 9.13.1  a| 
[NOTE]
====
オンプレミスのSVM移行で監査が有効になっている場合、ソースSVMで監査を無効にしてから移行を実行する必要があります。

====
SVMの移行要件は次のとおりです。

* link:../nas-audit/enable-disable-auditing-svms-task.html["デスティネーション クラスタで監査ログを有効にする必要があります"]。
* link:../nas-audit/commands-modify-auditing-config-reference.html?q=audit+log+destination+path["ソースSVMからの監査ログのデスティネーション パスは、デスティネーション クラスタで作成する必要があります"]。




| 自律型ランサムウェア対策 | ONTAP 9.12.1 |  


| クラウド インスタンス | サポート対象外  a| 
オンプレミス インスタンスとクラウド間での SVM の移行はサポートされていません。



| Cloud Volumes ONTAP | サポート対象外 |  


| 外部キー管理ツール | ONTAP 9.11.1 |  


| FabricPool | サポート対象外 |  


| ファンアウト関係（移行するソースに複数のデスティネーションを持つSnapMirrorソース ボリュームがある） | ONTAP 9.11.1 |  


| FC SAN | サポート対象外 |  


| Flash Pool | ONTAP 9.12.1 |  


| FlexCacheボリューム | サポート対象外 |  


| FlexGroupボリューム | サポート対象外 |  


| IPSecポリシー | サポート対象外 |  


| IPv6 LIF | サポート対象外 |  


| iSCSI SAN | サポート対象外 |  


| ジョブ スケジュールのレプリケーション | ONTAP 9.11.1 | ONTAP 9.10.1では、ジョブ スケジュールは移行時にレプリケートされないため、デスティネーションで手動で作成する必要があります。ONTAP 9.11.1以降では、ソースで使用されているジョブ スケジュールが移行時に自動的にレプリケートされます。 


| 負荷共有ミラー | サポート対象外 |  


| MetroCluster SVM | ONTAP 9.16.1  a| 
ONTAP 9.16.1 以降では、次のMetroCluster SVM 移行がサポートされます：

* 非MetroCluster構成とMetroCluster IP構成間でのSVMの移行
* 2つのMetroCluster IP構成間でのSVMの移行
* MetroCluster FC構成とMetroCluster IP構成間でのSVMの移行


注：SVM の移行をサポートするには、ソース クラスタとデスティネーション クラスタの両方で ONTAP 9.16.1 以降が実行されている必要があります。

次のMetroCluster SVM移行は、すべてのONTAPバージョンでサポートされているわけではありません：

* 2つのMetroCluster FC構成間でのSVMの移行
* 非MetroCluster構成とMetroCluster FC構成間でのSVMの移行
* 同じMetroCluster構成内のローカル クラスタとパートナー クラスタ間でSVMを移行します。


MetroCluster構成内のSVMを移行するには、<<前提条件,前提条件>>を参照してください。



| NetApp Aggregate Encryption（NAE） | ONTAP 9.11.1 | NAEボリュームはNAEをサポートするデスティネーションに配置する必要があります。NAEデスティネーションが利用できない場合、移行処理は失敗します。 


| NDMPの構成 | サポート対象外 |  


| NetApp Volume Encryption（NVE） | ONTAP 9.10.1 | NVE ボリュームは、デスティネーション上の NVE ボリュームとして移行されます。 


| NFS v3、NFS v4.1、NFS v4.2 | ONTAP 9.10.1 |  


| NFS v4.0 | ONTAP 9.12.1 |  


| pNFSを含むNFSv4.1 | ONTAP 9.14.1 |  


| NVMe over Fabrics | サポート対象外 |  


| ソース クラスタ上のCommon Criteriaモードを有効にしたオンボード キー マネージャ（OKM） | サポート対象外 |  


| ONTAP Select | サポート対象外 | SVMのONTAP Selectインスタンスへの移行、またはONTAP SelectインスタンスからのSVMの移行はサポートされていません。 


| qtree | ONTAP 9.14.1 |  


| クォータ | ONTAP 9.14.1 |  


| S3 | サポート対象外 |  


| SMBプロトコル | ONTAP 9.12.1 ただし、SMB1 プロトコルはサポートされていません。  a| 
SMB の移行は中断を伴い、移行後にクライアントの更新が必要になります。



| SnapMirrorクラウド関係 | ONTAP 9.12.1 | ONTAP 9.12.1 以降では、SnapMirror クラウド関係を持つオンプレミスの SVM を移行する場合、デスティネーション クラスタにlink:../data-protection/snapmirror-licensing-concept.html#snapmirror-cloud-license["SnapMirrorクラウド ライセンス"]がインストールされ、クラウドにミラーリングされるボリューム内の容量の移動をサポートするのに十分な容量が確保されている必要があります。 


| SnapMirrorの非同期デスティネーション | ONTAP 9.12.1 |  


| SnapMirrorの非同期ソース | ONTAP 9.11.1  a| 
* FlexVol SnapMirror関係では、ほとんどの場合、移行中も通常どおり転送を続行できます。
* カットオーバー中は進行中の転送はすべてキャンセルされ、新規の転送はカットオーバー中に失敗します。移行が完了するまで、転送を再開することはできません。
* スケジュールされた転送が移行中にキャンセルされるか失敗した場合、それらの転送は移行が完了しても自動で開始されません。
+
[NOTE]
====
SnapMirrorソースを移行した場合、SnapMirrorの更新が実行されるまで、ONTAPではボリュームの削除が防止されません。これは、移行したSnapMirrorソース ボリュームのSnapMirror関連情報を利用できるのが、移行の完了後、最初の更新が実行されたあとに限られるためです。

====




| SMTape設定 | サポート対象外 |  


| SnapLock | サポート対象外 |  


| SnapMirrorアクティブ同期 | サポート対象外 |  


| SnapMirror SVMピア関係 | ONTAP 9.12.1 |  


| SnapMirror SVMディザスタ リカバリ | サポート対象外 |  


| SnapMirror Synchronous | サポート対象外 |  


| Snapshot 数 | ONTAP 9.10.1 |  


| Snapshotロックによる改ざん防止 | ONTAP 9.14.1 | Snapshotロックによる改ざん防止は、SnapLockとは異なります。SnapLock EnterpriseとSnapLock Complianceは、引き続きサポート対象外です。 


| 仮想IP LIF / BGP | サポート対象外 |  


| Virtual Storage Console 7.0以降 | サポート対象外 |  


| ボリューム クローン | サポート対象外 |  


| Vscan | サポート対象外 | Vscan 対応 SVM の移行はサポートされていません。 


| vStorage | サポート対象外 | vStorageが有効になっている場合、移行は実行できません。移行を実行するには、vStorageオプションを無効にし、移行が完了してから再度有効にします。 
|===


== 移行中にサポートされる処理

次の表は、移行中のSVMにおけるボリュームの各種処理がサポートされるかどうかを、移行状態別に示したものです。

[cols="2,1,1,1"]
|===


| ボリューム処理 3+| SVM 移行状態 


|  | *進行中* | *一時停止* | *カットオーバー* 


| 作成 | 不可 | 許容 | サポート対象外 


| 削除 | 不可 | 許容 | サポート対象外 


| ファイルシステム分析の無効化 | 許容 | 許容 | サポート対象外 


| ファイルシステム分析の有効化 | 不可 | 許容 | サポート対象外 


| 変更 | 許容 | 許容 | サポート対象外 


| オフライン / オンライン | 不可 | 許容 | サポート対象外 


| 移動 / リホスト | 不可 | 許容 | サポート対象外 


| qtreeの作成 / 変更 | 不可 | 許容 | サポート対象外 


| クォータの作成 / 変更 | 不可 | 許容 | サポート対象外 


| 名前変更 | 不可 | 許容 | サポート対象外 


| サイズ変更 | 許容 | 許容 | サポート対象外 


| 制限 | 不可 | 許容 | サポート対象外 


| Snapshot属性の変更 | 許容 | 許容 | サポート対象外 


| Snapshotの自動削除の変更 | 許容 | 許容 | サポート対象外 


| Snapshotの作成 | 許容 | 許容 | サポート対象外 


| Snapshotの削除 | 許容 | 許容 | サポート対象外 


| Snapshotからのファイルのリストア | 許容 | 許容 | サポート対象外 
|===


== 移行後の情報

* 移行後、ローカルスナップショットポリシーに拡張子-MIGが付加され、一部の自動化機能が動作しなくなる可能性があります。この拡張子を検索し、必要に応じてポリシー名を変更してください。
* 移行されたヴォールト デスティネーション SnapMirror ボリュームは、保護を再有効化するために再同期を実行する必要があります。ヴォールトの再同期が必要なのは、移行によって移行SVM間に、ヴォールトの以前のベースラインよりも新しい新しいベースラインが作成されるためです。再同期を実行するとヴォールトが再有効化されますが、現在のヴォールト ベースラインよりも新しいデータ、具体的には移行中に生成されたスナップショットが削除されます。

