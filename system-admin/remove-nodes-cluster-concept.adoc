---
permalink: system-admin/remove-nodes-cluster-concept.html 
sidebar: sidebar 
keywords: remove, node, cluster, failover, partner, erase, inaccessible 
summary: クラスタから不要なノードを一度に1つずつ削除できます。ノードを削除した場合は、フェイルオーバー パートナーも削除する必要があります。ノードを削除すると、そのノードのデータはアクセスできなくなるか、消去されます。 
---
= ONTAPクラスタからノードを削除する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
クラスタから不要なノードを一度に1つずつ削除できます。ノードを削除した場合は、フェイルオーバー パートナーも削除する必要があります。ノードを削除すると、そのノードのデータはアクセスできなくなるか、消去されます。

.開始する前に
クラスタからノードを削除する前に、次の条件を満たしている必要があります：

* クラスタ内のノードのうち半数を上回るノードが健全である必要があります。
* すべてのデータ、ボリューム、およびルート以外のアグリゲートをノードから再配置または削除する必要があります。
+
** 削除するノードのすべてのデータを退避しておく必要があります。これにはlink:../encryption-at-rest/secure-purge-data-encrypted-volume-concept.html["暗号化されたボリュームからデータを消去する"]が含まれる場合があります。
** ルート以外のボリュームはすべて、ノードが所有するアグリゲートからlink:../volumes/move-volume-task.html["移動した"]されています。
** ルート以外のすべてのアグリゲートがlink:../disks-aggregates/commands-manage-aggregates-reference.html["削除済み"]ノードから削除されています。


* すべてのLIFとVLANがノードから再配置または削除されました。
+
** データLIFがlink:../networking/delete_a_lif.html["削除済み"]またはlink:../networking/migrate_a_lif.html["再配置"]ノードから実行されました。
** クラスタ管理LIFがlink:../networking/migrate_a_lif.html["再配置"]ノードから削除され、ホームポートが変更されました。
** すべてのインタークラスタLIFがlink:../networking/delete_a_lif.html["取り外し"]削除されました。インタークラスタLIFを削除すると警告が表示されますが、無視してください。
** ノード上のすべての VLAN がlink:../networking/configure_vlans_over_physical_ports.html#delete-a-vlan["削除済み"]になりました。


* ノードはどのフェールオーバー関係にも参加していません。
+
** ノードに対してストレージフェイルオーバーがlink:../high-availability/ha_commands_for_enabling_and_disabling_storage_failover.html["無効"]実行されました。
** すべてのLIFフェイルオーバールールがlink:../networking/commands_for_managing_failover_groups_and_policies.html["modified"]されており、ノード上のポートが削除されています。


* ノードに連邦情報処理標準（FIPS）ディスクまたは自己暗号化ディスク（SED）がある場合は、link:../encryption-at-rest/return-seds-unprotected-mode-task.html["ディスク暗号化が削除されました"]ディスクを非保護モードに戻します。
+
** link:../encryption-at-rest/sanitize-fips-drive-sed-task.html["FIPSドライブまたはSEDをサニタイズする"]することもできます。


* 削除するノードにLUNがある場合は、ノードを削除する前にlink:../san-admin/modify-slm-reporting-nodes-task.html["Selective LUN Map（SLM）レポートノードリストを変更する"]必要があります。
+
SLMのレポート ノード リストからノードとそのHAパートナーを削除しないと、元のノードにあったLUNを含むボリュームを別のノードに移動しても、そのLUNへのアクセスが失われる可能性があります。



AutoSupportメッセージを発行して、ノードの削除が進行中であることをNetApp テクニカル サポートに通知することを推奨します。


IMPORTANT: 自動ONTAPアップグレードの進行中は、 `cluster remove-node`、 `cluster unjoin`、 `node rename`などの操作を実行しないでください。

.タスク概要
* ONTAP 9.3以降では、バージョンが混在したクラスタを実行している場合に、次のadvanced権限のコマンドを使用して低いバージョンの最後のノードを削除できます。
+
** ONTAP 9.3： `cluster unjoin -skip-last-low-version-node-check`
** ONTAP 9.4 以降： `cluster remove-node -skip-last-low-version-node-check`


* 4ノード クラスタからノードを2つ削除すると、残りの2つのノードでクラスタHAが自動的に有効になります。



NOTE: クラスタからノードを削除する前に、ノードに接続されたすべてのディスクのすべてのシステム データとユーザ データにユーザがアクセスできないようにする必要があります。ノードを誤ってクラスタから削除した場合に元に戻す方法については、NetAppサポートにお問い合わせください。

.手順
. 権限レベルをadvancedに変更します。
+
[source, cli]
----
set -privilege advanced
----
. クラスタのノードにイプシロンが設定されているかどうかを確認します。
+
[source, cli]
----
cluster show -epsilon true
----
. イプシロンが設定されているクラスタ ノードを削除する場合は、削除しないノードにイプシロンを移動します。
+
.. 削除するノードからイプシロンを移動します。
+
[source, cli]
----
cluster modify -node <name_of_node_to_be_unjoined> -epsilon false
----
.. 削除しないノードにイプシロンを移動します。
+
[source, cli]
----
cluster modify -node <node_name> -epsilon true
----


. 現在のマスター ノードを特定します。
+
[source, cli]
----
cluster ring show
----
+
マスターノードは、 `mgmt`、 `vldb`、 `vifmgr`、 `bcomd`、 `crs`などのプロセスを保持するノードです。

. 削除するノードが現在のマスター ノードである場合は、クラスタ内の別のノードがマスター ノードとして選出されるようにすることができます。
+
.. 現在のマスターノードをクラスタに参加できないようにします：
+
[source, cli]
----
cluster modify -node <node_name> -eligibility false
----
+
ノードは、資格が回復するまで、異常とマークされます。マスターノードが資格を失った場合、残りのノードの1つがクラスタクォーラムによって新しいマスターとして選出されます。

+

NOTE: HAペアの最初のノードでこの手順を実行する場合は、そのノードのみを不適格としてマークしてください。HAパートナーのステータスは変更しないでください。パートナーノードが新しいマスターとして選択された場合は、不適格にする前に、イプシロンが保持されているかどうかを確認する必要があります。これは、これらの手順を繰り返してパートナーノードを削除するときに行われます。

.. 以前のマスター ノードを再びクラスタに参加できるようにします。
+
[source, cli]
----
cluster modify -node <node_name> -eligibility true
----


. 削除するノードとは別のノードで、リモート ノード管理LIFまたはクラスタ管理LIFにログインします。
. クラスタからノードを削除します。
+
|===
| ONTAPバージョン | 使用するコマンド 


 a| 
ONTAP 9.3
 a| 
[source, cli]
----
cluster unjoin
----


 a| 
ONTAP 9.4以降
 a| 
ノード名：

[source, cli]
----
cluster remove-node -node <node_name>
----
ノード IP の場合：

[source, cli]
----
cluster remove-node -cluster_ip <node_ip>
----
|===
+
混合バージョンのクラスタがあり、最後の下位バージョンのノードを削除する場合は、これらのコマンドで `-skip-last-low-version-node-check`パラメータを使用します。

+
次の内容のメッセージが表示されます。

+
** ノードのフェイルオーバー パートナーをクラスタから削除する必要があること。
** 削除したノードをクラスタに再追加する場合、ブート メニュー オプション[(4) Clean configuration and initialize all disks]または[(9) Configure Advanced Drive Partitioning]を使用して、ノードの設定を消去し、すべてのディスクを初期化しておく必要があること。
+
ノードを削除する前に対処が必要な条件がある場合は、エラー メッセージが表示されます。メッセージの内容は、たとえば、ノードに削除が必要な共有リソースがある、あるいはノードのクラスタHA構成またはストレージ フェイルオーバー構成を無効にする必要があるなどの場合があります。

+
ノードがクォーラム マスターの場合、クラスタのクォーラムがいったん失われて、すぐに戻ります。クォーラムが失われるのは一時的であり、データの操作には影響しません。



. 失敗メッセージにエラー状態が示されている場合は、それらの状態に対処して、 `cluster remove-node`または `cluster unjoin`コマンドを再実行します。
+
クラスタからノードが削除され、ノードが自動的にリブートします。

. ノードを転用する場合は、ノードの設定を消去し、すべてのディスクを初期化します。
+
.. ブート プロセス時に、プロンプトに応じてCtrl+Cキーを押してブート メニューを表示します。
.. ブート メニュー オプション[(4) Clean configuration and initialize all disks]を選択します。


. admin権限レベルに戻ります。
+
[source, cli]
----
set -privilege admin
----
. クラスタからフェイルオーバー パートナーを削除するには、前述の手順を繰り返します。


.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/cluster-remove-node.html["クラスタ remove-node"^]

