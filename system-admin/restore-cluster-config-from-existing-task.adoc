---
permalink: system-admin/restore-cluster-config-from-existing-task.html 
sidebar: sidebar 
keywords: restore, cluster, configuration, existing, configuration, failure, recovering, node, rejoin, cluster 
summary: クラスタ障害後に既存の構成からクラスタ構成をリストアするには、クラスタ構成を選択してリカバリするノードで利用できるようにし、次にその構成を使用してクラスタを再作成し、残りのノードを新しいクラスタに再追加します。 
---
= ONTAPクラスタ構成バックアップ ファイルを使用してクラスタを復元する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
クラスタ障害後に既存の構成からクラスタ構成をリストアするには、クラスタ構成を選択してリカバリするノードで利用できるようにし、次にその構成を使用してクラスタを再作成し、残りのノードを新しいクラスタに再追加します。

.タスク概要
このタスクは、クラスタ構成の損失となる障害からリカバリする目的でのみ実行してください。

[NOTE]
====
構成バックアップ ファイルからクラスタを再作成する場合は、テクニカル サポートに問い合わせて、構成バックアップ ファイルと現在のクラスタ構成との矛盾をすべて解決しておく必要があります。

構成バックアップファイルからクラスタをリカバリする場合、バックアップの作成以降に行われた構成変更はすべて失われます。リカバリ後、構成バックアップファイルと現在の構成の不一致を解決する必要があります。トラブルシューティングのガイダンスについては、link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Software/ONTAP_OS/ONTAP_Configuration_Backup_Resolution_Guide["NetAppナレッジベース：ONTAP構成バックアップ解決ガイド"^]を参照してください。

====
.手順
. 各HAペアのストレージ フェイルオーバーを無効にします。
+
`*storage failover modify -node _node_name_ -enabled false*`

+
ストレージ フェイルオーバーを無効にするのは、各HAペアに対して1度だけです。一方のノードでストレージ フェイルオーバーを無効にすると、そのノードのパートナーでもストレージ フェイルオーバーが無効になります。

. リカバリするノード以外の各ノードを停止します。
+
`*system node halt -node _node_name_ -reason "text"*`

+
[listing]
----
cluster1::*> system node halt -node node0 -reason "recovering cluster"

Warning: Are you sure you want to halt the node? {y|n}: y
----
. 権限レベルをadvancedに設定します。
+
`*set -privilege advanced*`

. 回復ノードで、 `*system configuration recovery cluster recreate*` コマンドを使用してクラスターを再作成します。
+
この例では、リカバリ ノードに保存された構成情報を使用してクラスタを再作成します。

+
[listing]
----
cluster1::*> configuration recovery cluster recreate -from node

Warning: This command will destroy your existing cluster. It will
         rebuild a new single-node cluster consisting of this node
         and its current configuration. This feature should only be
         used to recover from a disaster. Do not perform any other
         recovery operations while this operation is in progress.
Do you want to continue? {y|n}: y
----
+
新しいクラスタはリカバリ ノードに作成されます。

. 構成バックアップ ファイルからクラスタを再作成する場合は、クラスタのリカバリがまだ進行中であることを確認します。
+
`*system configuration recovery cluster show*`

+
健全なノードからクラスタを再作成する場合、クラスタのリカバリの状態を確認する必要はありません。

+
[listing]
----
cluster1::*> system configuration recovery cluster show
 Recovery Status: in-progress
 Is Recovery Status Persisted: false
----
. 再作成したクラスタに再追加が必要な各ノードをブートします。
+
ノードは一度に1つずつリブートする必要があります。

. 再作成したクラスタに再追加が必要な各ノードで、以下を実行します。
+
.. 再作成したクラスタ上の健全なノードから、ターゲット ノードを再追加します。
+
`*system configuration recovery cluster rejoin -node _node_name_*`

+
この例では、再作成されたクラスタに「`node2`」ターゲットノードを再参加させます：

+
[listing]
----
cluster1::*> system configuration recovery cluster rejoin -node node2

Warning: This command will rejoin node "node2" into the local
         cluster, potentially overwriting critical cluster
         configuration files. This command should only be used
         to recover from a disaster. Do not perform any other
         recovery operations while this operation is in progress.
         This command will cause node "node2" to reboot.
Do you want to continue? {y|n}: y
----
+
ターゲット ノードがリブートし、クラスタに追加されます。

.. ターゲット ノードが健全であり、クラスタ内の残りのノードとクォーラムを形成していることを確認します。
+
`*cluster show -eligibility true*`

+
別のノードを再追加する前に、ターゲット ノードを再作成したクラスタに再追加する必要があります。

+
[listing]
----
cluster1::*> cluster show -eligibility true
Node                 Health  Eligibility   Epsilon
-------------------- ------- ------------  ------------
node0                true    true          false
node1                true    true          false
2 entries were displayed.
----


. 構成バックアップ ファイルからクラスタを再作成した場合は、リカバリ ステータスを「complete」に設定します。
+
`*system configuration recovery cluster modify -recovery-status complete*`

. admin権限レベルに戻ります。
+
`*set -privilege admin*`

. クラスターが 2 つのノードのみで構成されている場合は、 `*cluster ha modify*`コマンドを使用してクラスター HA を再度有効にします。
.  `*storage failover modify*`コマンドを使用して、各HAペアのストレージフェイルオーバーを再度有効にします。


.終了後の操作
クラスターにSnapMirrorピア関係がある場合は、それらの関係も再作成する必要があります。詳細については、link:../data-protection/index.html["データ保護"]を参照してください。

.関連情報
* link:https://docs.netapp.com/us-en/ontap-cli/["ONTAPコマンド リファレンス"^]
* link:https://docs.netapp.com/us-en/ontap-cli/storage-failover-modify.html["storage failover modify"^]

