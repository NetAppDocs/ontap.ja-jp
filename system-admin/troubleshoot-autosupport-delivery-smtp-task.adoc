---
permalink: system-admin/troubleshoot-autosupport-delivery-smtp-task.html 
sidebar: sidebar 
keywords: troubleshoot, autosupport, deliver, system, smtp, settings, resolve, problem 
summary: システムが SMTP 経由で AutoSupport メッセージを配信できない場合は、いくつかの設定を確認して問題を解決できます。 
---
= SMTP経由のONTAP AutoSupportメッセージ配信のトラブルシューティング
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
システムが SMTP 経由で AutoSupport メッセージを配信できない場合は、いくつかの設定を確認して問題を解決できます。

.開始する前に
基本的なネットワーク接続とDNSルックアップについて、以下の点を確認しておく必要があります。

* ノード管理LIFの動作ステータスおよび管理ステータスがupになっている。
* 同じサブネット上の機能しているホストに、（ノード上のLIFではなく）クラスタ管理LIFからpingを実行できる。
* サブネットの外部の機能しているホストに、クラスタ管理LIFからpingを実行できる。
* サブネットの外部の機能しているホストに、（IPアドレスではなく）ホストの名前を使用してクラスタ管理LIFからpingを実行できる。


.タスク概要
これらの手順は、AutoSupportがメッセージを生成できるが、SMTP経由でメッセージを配信できないことが判明した場合に適用されます。

エラーが発生したり、いずれかの手順を完了できない場合は、問題を特定し、対処してから次の手順に進んでください。

特に指定がない限り、すべてのコマンドは ONTAP コマンドライン インターフェイスで入力されます。

.手順
. ノード管理LIFのステータスを確認します。
+
`*network interface show -home-node local -role node-mgmt -fields vserver,lif,status-oper,status-admin,address,role*`

+
 `status-oper`および `status-admin`フィールドは `up`を返します。 `up`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/up.html["ONTAPコマンド リファレンス"^]をご覧ください。

. あとで使用できるように、SVM名、LIF名、およびLIFのIPアドレスを書き留めておきます。
. DNSが有効になっていて正しく設定されていることを確認します。
+
`*vserver services name-service dns show*`

. AutoSupportで使用するように設定されているすべてのサーバを表示します。
+
`*system node autosupport show -fields mail-hosts*`

+
表示されるすべてのサーバー名を記録します。

. 前の手順で表示された各サーバーと `support.netapp.com`について、ノードからサーバーまたは URL にアクセスできることを確認します：
+
`*network traceroute -node local -destination _server_name_*`

+
これらのルートのいずれかが機能していない場合は、ほとんどのサードパーティ製ネットワーククライアントに搭載されている「`traceroute`」または「`tracert`」ユーティリティを使用して、クラスタと同じサブネット上の正常に動作しているホストから同じルートを試してください。これにより、問題がネットワーク構成にあるのか、クラスタ構成にあるのかを特定するのに役立ちます。

. メール ホストとして指定されたホストにログインし、SMTP 要求を処理できることを確認します：
+
`*netstat -aAn|grep 25*`

+
`25` はリスナーの SMTP ポート番号です。

+
次のようなメッセージが表示されます。

+
[listing]
----
ff64878c tcp        0      0  *.25    *.*    LISTEN.
----
. 他のホストで、メール ホストのSMTPポートを使用してTelnetセッションを開始します。
+
`*telnet _mailhost_ 25*`

+
次のようなメッセージが表示されます。

+
[listing]
----

220 filer.yourco.com Sendmail 4.1/SMI-4.1 ready at Thu, 30 Nov 2014 10:49:04 PST
----
. Telnetのプロンプトで、メール ホストからメッセージをリレーできることを確認します。
+
`*HELO _domain_name_*`

+
`*MAIL FROM: _your_email_address_*`

+
`*RCPT TO: \autosupport@netapp.com*`

+
`domain_name` は、ネットワークのドメイン名です。

+
リレーが拒否されたというエラーが返された場合は、メール ホストでリレーが有効になっていません。システム管理者にお問い合わせください。

. Telnetのプロンプトで、テスト メッセージを送信します。
+
`*DATA*`

+
`*SUBJECT: TESTING*`
`*THIS IS A TEST*`

+
`*.*`

+
[NOTE]
====
最後のピリオド（.）は必ず単独の行に入力してください。ピリオドはメールホストにメッセージが完了したことを示します。

====
+
エラーが返された場合は、メール ホストが正しく設定されていません。システム管理者にお問い合わせください。

. ONTAPのCLIから、アクセス可能な信頼できるEメール アドレスにAutoSupportのテスト メッセージを送信します。
+
`*system node autosupport invoke -node local -type test*`

. 送信したテスト メッセージのシーケンス番号を確認します。
+
`*system node autosupport history show -node local -destination smtp*`

+
タイムスタンプに基づいて、試行のシーケンス番号を見つけます。おそらく最新の試行です。

. テスト メッセージに関するエラーを表示します。
+
`*system node autosupport history show -node local -seq-num seq_num -fields error*`

+
表示されるエラーが `Login denied`の場合、SMTPサーバーはクラスタ管理LIFからの送信要求を受け付けていません。トランスポート プロトコルとしてHTTPSを使用するように変更したくない場合は、サイトのネットワーク管理者に連絡して、この問題に対処するようSMTPゲートウェイを設定してください。

+
このテストが成功しても、同じメッセージをmailto：autosupport@netapp.comに送信しても成功しない場合は、すべてのSMTPメール ホストでSMTPリレーが有効になっていることを確認するか、トランスポート プロトコルとしてHTTPSを使用してください。

+
ローカルで管理されている電子メール アカウントへのメッセージも成功しない場合は、SMTP サーバーが次の両方の特性を持つ添付ファイルを転送するように設定されていることを確認してください：

+
** 「`7z`」サフィックス
** 「`application/x-7x-compressed`」MIMEタイプ。



