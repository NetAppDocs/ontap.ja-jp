---
permalink: tape-backup/dump-backup-concept.html 
sidebar: sidebar 
keywords: dump, backup, qtree, file, system, data 
summary: ダンプ バックアップは、定義済みのプロセスに基づいて、ディスクからテープにファイルシステムのデータを書き込みます。バックアップ対象には、ボリューム、qtree、またはボリューム全体でもqtree全体でもないサブツリーを指定できます。 
---
= ONTAP NDMPでのダンプ バックアップの仕組み
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ダンプ バックアップは、定義済みのプロセスに基づいて、ディスクからテープにファイルシステムのデータを書き込みます。バックアップ対象には、ボリューム、qtree、またはボリューム全体でもqtree全体でもないサブツリーを指定できます。

次の表は、ダンプ パスによって示されるオブジェクトをバックアップするために ONTAP が使用するプロセスを示しています：

[cols="1,4"]
|===
| 段階 | アクション 


 a| 
1
 a| 
フル ボリューム バックアップまたはフルqtreeバックアップ以外の場合、ONTAPはディレクトリをたどってバックアップ対象のファイルを特定します。ボリューム全体またはqtree全体をバックアップする場合は、段階2のプロセスから実行されます。



 a| 
2
 a| 
フル ボリューム バックアップまたはフルqtreeバックアップの場合、ONTAPはボリュームまたはqtree内のバックアップ対象のディレクトリを特定します。



 a| 
3
 a| 
ディレクトリをテープに書き出します。



 a| 
4
 a| 
ファイルをテープに書き出します。



 a| 
5
 a| 
必要に応じてACL情報をテープに書き出します。

|===
ダンプ バックアップでは、データのSnapshotを使用してバックアップを行います。そのため、バックアップを開始する前にボリュームをオフラインにする必要はありません。

ダンプ バックアップでは、作成する各Snapshotに `snapshot_for_backup.n`という名前が付けられます。 `n`は0から始まる整数です。ダンプ バックアップでSnapshotが作成されるたびに、整数が1ずつ増分されます。ストレージ システムのリブート後、整数は0にリセットされます。バックアップ処理が完了すると、ダンプ エンジンによってこのSnapshotが削除されます。

ONTAPが複数のダンプバックアップを同時に実行すると、ダンプエンジンは複数のスナップショットを作成します。例えば、ONTAPが2つのダンプバックアップを同時に実行している場合、データのバックアップ元ボリュームには、以下のスナップショットが作成されます： `snapshot_for_backup.0`および `snapshot_for_backup.1`。

[NOTE]
====
スナップショットからバックアップする場合、ダンプ エンジンは追加のスナップショットを作成しません。

====


== ダンプ エンジンでバックアップされるデータの種類

ダンプ エンジンを使用すると、災害やコントローラの障害に備えてデータをテープにバックアップできます。ファイル、ディレクトリ、qtree、ボリューム全体などのデータ オブジェクトのバックアップに加えて、ダンプ エンジンは各ファイルに関する様々な種類の情報をバックアップできます。ダンプ エンジンでバックアップできるデータの種類と考慮すべき制限事項を理解することで、災害復旧へのアプローチを計画するのに役立ちます。

ファイル内のデータのバックアップに加えて、ダンプ エンジンは、必要に応じて各ファイルに関する次の情報をバックアップできます：

* UNIX GID、所有者UID、およびファイル権限
* UNIXのアクセス時刻、作成時刻、変更時刻
* ファイル タイプ
* ファイル サイズ
* DOS名、DOS属性、作成時刻
* 1,024個のアクセス制御エントリ（ACE）を含むアクセス制御リスト（ACL）
* qtree情報
* ジャンクション パス


ジャンクション パスはシンボリック リンクとしてバックアップされます。

* LUNおよびLUNクローン
+
LUNオブジェクト全体をバックアップすることはできますが、LUNオブジェクト内の単一のファイルをバックアップすることはできません。同様に、LUNオブジェクト全体を復元することはできますが、LUN内の単一のファイルを復元することはできません。

+
[NOTE]
====
ダンプ エンジンは、LUNクローンを独立したLUNとしてバックアップします。

====
* VM整合ファイル
+
VM アラインメント ファイルのバックアップは、Data ONTAP 8.1.2 より前のリリースではサポートされていません。



[NOTE]
====
スナップショットでバックアップされたLUNクローンをData ONTAP 7-ModeからONTAPに移行すると、不整合なLUNになります。ダンプ エンジンは不整合なLUNをバックアップしません。

====
ボリュームにデータを復元する場合、復元対象のLUNに対するクライアントI/Oは制限されます。LUNの制限は、ダンプ復元操作が完了した時点で解除されます。同様に、SnapMirror単一ファイルまたはLUNの復元操作中は、復元対象のファイルとLUNの両方に対するクライアントI/Oは制限されます。この制限は、単一ファイルまたはLUNの復元操作が完了した時点で解除されます。ダンプ復元、またはSnapMirror単一ファイルまたはLUNの復元操作が行われているボリュームでダンプバックアップを実行する場合、クライアントI/O制限のあるファイルまたはLUNはバックアップに含まれません。これらのファイルまたはLUNは、クライアントI/O制限が解除された後続のバックアップ操作に含まれます。

[NOTE]
====
Data ONTAP 8.3で実行され、テープにバックアップされたLUNは、8.3以降のリリースにのみリストアでき、それ以前のリリースにはリストアできません。LUNを以前のリリースにリストアする場合、LUNはファイルとしてリストアされます。

====
SnapVaultセカンダリ ボリュームまたはボリュームSnapMirrorデスティネーションをテープにバックアップすると、ボリューム上のデータのみがバックアップされます。関連するメタデータはバックアップされません。そのため、ボリュームをリストアしようとすると、そのボリューム上のデータのみがリストアされます。ボリュームSnapMirror関係に関する情報はバックアップに含まれていないため、リストアされません。

Windows NT権限のみを持つファイルをダンプし、それをUNIXスタイルのqtreeまたはボリュームに復元すると、ファイルはそのqtreeまたはボリュームのデフォルトのUNIX権限を取得します。

UNIX権限のみを持つファイルをダンプし、それをNTFSスタイルのqtreeまたはボリュームに復元すると、ファイルはそのqtreeまたはボリュームのデフォルトのWindows権限を取得します。

その他のダンプおよび復元では権限が保持されます。

VMアラインメントされたファイルと `vm-align-sector`オプションをバックアップできます。VMアラインメントされたファイルの詳細については、link:../volumes/index.html["論理ストレージ管理"]を参照してください。
