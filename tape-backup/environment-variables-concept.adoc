---
permalink: tape-backup/environment-variables-concept.html 
sidebar: sidebar 
keywords: environment, variable, information, backup, restore, operation, ndmp, application, storage, system 
summary: 環境変数は、NDMP 対応バックアップ アプリケーションとストレージ システム間のバックアップまたはリストア操作に関する情報を伝達するために使用されます。 
---
= ONTAP NDMPでサポートされている環境変数について学習します
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
環境変数は、NDMP 対応バックアップ アプリケーションとストレージ システム間のバックアップまたはリストア操作に関する情報を伝達するために使用されます。

たとえば、ユーザーがバックアップ アプリケーションで `/vserver1/vol1/dir1`をバックアップするように指定した場合、バックアップ アプリケーションはFILESYSTEM環境変数を `/vserver1/vol1/dir1`に設定します。同様に、ユーザーがバックアップをレベル1のバックアップにするように指定した場合、バックアップ アプリケーションはLEVEL環境変数を1に設定します。

[NOTE]
====
通常、環境変数の設定と確認についてバックアップ管理者の対応は不要で、バックアップ アプリケーションによって自動的に設定されます。

====
バックアップ管理者が環境変数を指定することはまれですが、機能やパフォーマンスの問題を特定または回避するために、バックアップ アプリケーションによって設定された環境変数の値の変更が必要になる場合があります。たとえば、パフォーマンスや機能の問題が、バックアップ アプリケーションによるファイル履歴情報の処理に起因しているかどうかを調べる場合、管理者はファイル履歴の生成を一時的に無効にすることがあります。

多くのバックアップ アプリケーションでは、環境変数を無効化または変更したり、新たに環境変数を指定したりできます。詳細については、ご使用のバックアップ アプリケーションのマニュアルを参照してください。



== ONTAPでサポートされる環境変数

ONTAPは環境変数をサポートしており、環境変数にはデフォルト値が関連付けられています。ただし、これらのデフォルト値は手動で変更できます。

バックアップ アプリケーションによって設定された値を手動で変更すると、アプリケーションが予期しない動作をする可能性があります。これは、バックアップまたは復元操作がバックアップ アプリケーションの想定通りに動作しない可能性があるためです。ただし、場合によっては、適切な変更を行うことで、問題の特定や回避に役立つことがあります。

以下の表は、dumpとSMTapeで共通の動作をする環境変数と、dumpとSMTapeでのみサポートされる環境変数の一覧です。また、これらの表には、ONTAPでサポートされている環境変数を使用した場合の動作についても説明されています：

[NOTE]
====
ほとんどの場合、 `Y`という値を持つ変数は `T`も受け入れ、 `N`も `F`を受け入れます。

====


== ダンプとSMTapeでサポートされる環境変数

|===
| 環境変数 | 有効な値 | デフォルト | 概要 


 a| 
DEBUG
 a| 
`Y` または `N`
 a| 
`N`
 a| 
デバッグ情報を出力することを指定します。



 a| 
ファイルシステム
 a| 
`string`
 a| 
`none`
 a| 
バックアップするデータのルートのパス名を指定します。



 a| 
NDMP_VERSION
 a| 
`return_only`
 a| 
`none`
 a| 
NDMP_VERSION変数は変更しないでください。バックアップ操作によって作成されるNDMP_VERSION変数は、NDMPのバージョンを返します。

ONTAPは、内部使用のため、およびバックアップ アプリケーションに情報として渡すために、バックアップ中にNDMP_VERSION変数を設定します。NDMPセッションのNDMPバージョンは、この変数では設定されません。



 a| 
PATHNAME_SEPARATOR
 a| 
`return_value`
 a| 
`none`
 a| 
パス名の区切り文字を指定します。

この文字は、バックアップ対象のファイルシステムによって異なります。ONTAPの場合、この変数には文字「`/`」が割り当てられます。NDMPサーバはテープ バックアップ処理を開始する前にこの変数を設定します。



 a| 
タイプ
 a| 
`dump` または `smtape`
 a| 
`dump`
 a| 
tape backupおよび復元操作を実行するためにサポートされるバックアップの種類を指定します。



 a| 
詳細
 a| 
`Y` または `N`
 a| 
`N`
 a| 
テープ バックアップまたはリストア操作の実行中にログ メッセージを増やします。

|===


== ダンプでサポートされる環境変数

|===
| 環境変数 | 有効な値 | デフォルト | 概要 


 a| 
ACL開始
 a| 
`return_only`
 a| 
`none`
 a| 
バックアップ操作によって作成される ACL_START 変数は、ダイレクト アクセス リストアまたは再開可能な NDMP バックアップ操作で使用されるオフセット値です。

オフセット値は、ダンプファイル内のACLデータ（Pass V）の開始位置を示すバイトオフセットで、バックアップの終了時に返されます。ダイレクトアクセスリストア操作でバックアップデータを正しくリストアするには、リストア操作の開始時にACL_START値を渡す必要があります。NDMPの再開可能なバックアップ操作では、ACL_START値を使用して、バックアップストリームの再開不可能な部分の開始位置をバックアップ アプリケーションに通知します。



 a| 
BASE_DATE
 a| 
`0`、 `-1`、または `DUMP_DATE`値
 a| 
`-1`
 a| 
増分バックアップの開始日を指定します。

 `-1`に設定すると、BASE_DATE増分指定子は無効になります。レベル0のバックアップで `0`に設定すると、増分バックアップが有効になります。最初のバックアップ後、前回の増分バックアップのDUMP_DATE変数の値がBASE_DATE変数に割り当てられます。

これらの変数は、LEVEL/UPDATE ベースの増分バックアップの代替手段です。



 a| 
DIRECT
 a| 
`Y` または `N`
 a| 
`N`
 a| 
復元時にテープ全体をスキャンするのではなく、ファイル データが存在するテープ上の場所に直接早送りすることを指定します。

ダイレクトアクセスリカバリが機能するには、バックアップ アプリケーションが位置情報を提供する必要があります。この変数が `Y`に設定されている場合、バックアップ アプリケーションがファイル名またはディレクトリ名と位置情報を指定します。



 a| 
DMP_NAME
 a| 
`string`
 a| 
`none`
 a| 
複数のサブツリーのバックアップの名前を指定します。

この変数は複数のサブツリーのバックアップに必須です。



 a| 
DUMP_DATE
 a| 
`return_value`
 a| 
`none`
 a| 
この変数は直接変更しないでください。BASE_DATE変数が `-1`以外の値に設定されている場合は、バックアップによって作成されます。

DUMP_DATE変数は、32ビットのレベル値をダンプ ソフトウェアによって計算された32ビットの時刻値の前に付加することで生成されます。レベルは、BASE_DATE変数に渡された最後のレベル値から増分されます。その結果得られた値は、以降の増分バックアップのBASE_DATE値として使用されます。



 a| 
拡張DARが有効
 a| 
`Y` または `N`
 a| 
`N`
 a| 
拡張DAR機能を有効にするかどうかを指定します。拡張DAR機能は、ディレクトリDARとNT Streamsを使用したファイルのDARをサポートします。これによりパフォーマンスが向上します。

復元中の拡張 DAR は、次の条件が満たされている場合にのみ可能です：

* ONTAPは拡張DARをサポートします。
* バックアップ中にファイル履歴が有効になっています（HIST=Y）。
*  `ndmpd.offset_map.enable`オプションは `on`に設定されています。
* 復元中に ENHANCED_DAR_ENABLED 変数が `Y`に設定されます。




 a| 
EXCLUDE
 a| 
`pattern_string`
 a| 
`none`
 a| 
データのバックアップ時に除外するファイルまたはディレクトリを指定します。

除外リストは、ファイル名またはディレクトリ名をカンマで区切ったリストです。ファイル名またはディレクトリ名がリスト内のいずれかの名前と一致する場合、そのファイルはバックアップから除外されます。

除外リストに名前を指定する際には、次のルールが適用されます：

* ファイルまたはディレクトリの正確な名前を使用する必要があります。
* ワイルドカード文字であるアスタリスク (*) は、文字列の最初または最後の文字である必要があります。
+
各文字列には最大 2 つのアスタリスクを含めることができます。

* ファイル名またはディレクトリ名のカンマの前には、バックスラッシュを付ける必要があります。
* 除外リストには最大32個の名前を含めることができます。


[NOTE]
====
バックアップから除外するように指定されたファイルまたはディレクトリは、NON_QUOTA_TREE を `Y`に同時に設定した場合、除外されません。

====


 a| 
EXTRACT
 a| 
`Y`、 `N`、または `E`
 a| 
`N`
 a| 
バックアップされたデータ セットのサブツリーを復元することを指定します。

バックアップ アプリケーションは、抽出するサブツリーの名前を指定します。指定されたファイルが、バックアップされた内容を持つディレクトリと一致する場合、そのディレクトリは再帰的に抽出されます。

DAR を使用せずにリストア中にファイル、ディレクトリ、または qtree の名前を変更するには、EXTRACT 環境変数を `E`に設定する必要があります。



 a| 
EXTRACT_ACL
 a| 
`Y` または `N`
 a| 
`Y`
 a| 
復元操作時にバックアップされたファイルからのACLが復元されることを指定します。

デフォルトでは、DAR（DIRECT=Y）を除き、データを復元するときに ACL が復元されます。



 a| 
FORCE
 a| 
`Y` または `N`
 a| 
`N`
 a| 
復元操作で、デスティネーション ボリューム上のボリューム スペースと inode の可用性を確認する必要があるかどうかを決定します。

この変数を `Y`に設定すると、復元操作で、宛先パス上のボリューム スペースと inode の可用性のチェックがスキップされます。

復元先ボリュームに十分なボリューム スペースまたはinodeがない場合、復元処理では、復元先ボリューム スペースとinodeの可用性に基づいて可能な限り多くのデータが復元されます。ボリューム スペースまたはinodeが利用できなくなると、復元処理は停止します。



 a| 
HIST
 a| 
`Y` または `N`
 a| 
`N`
 a| 
ファイル履歴情報がバックアップ アプリケーションに送信されることを指定します。

ほとんどの市販バックアップ アプリケーションは、HIST変数を `Y`に設定します。バックアップ操作の速度を上げたい場合や、ファイル履歴収集に関する問題をトラブルシューティングしたい場合は、この変数を `N`に設定できます。

[NOTE]
====
バックアップ アプリケーションがファイル履歴をサポートしていない場合は、HIST 変数を `Y`に設定しないでください。

====


 a| 
IGNORE_CTIME
 a| 
`Y` または `N`
 a| 
`N`
 a| 
前回の増分バックアップ以降にファイルの ctime 値のみが変更された場合は、ファイルが増分バックアップされないことを指定します。

ウイルス スキャン ソフトウェアなどの一部のアプリケーションは、ファイル自体やその属性が変更されていないにもかかわらず、inode 内のファイルの ctime 値を変更します。その結果、増分バックアップでは変更されていないファイルがバックアップされる可能性があります。 `IGNORE_CTIME`変数は、ctime 値の変更によって増分バックアップに許容できないほどの時間と容量がかかる場合にのみ指定してください。

[NOTE]
====
 `NDMP dump`コマンドは、 `IGNORE_CTIME`をデフォルトで `false`に設定します。 `true`に設定すると、以下のデータ損失が発生する可能性があります：

.  `IGNORE_CTIME`をボリューム レベルの incremental `ndmpcopy`で true に設定すると、ソース上の qtree 間で移動されたファイルが削除されます。
.  `IGNORE_CTIME`がボリューム レベルの増分ダンプ中に true に設定されている場合、増分リストア中にソース上の qtree 間で移動されたファイルが削除されます。


この問題を回避するには、ボリューム レベル `NDMP dumps`または `ndmpcopy`中に `IGNORE_CTIME`を false に設定する必要があります。

====


 a| 
IGNORE_QTREES
 a| 
`Y` または `N`
 a| 
`N`
 a| 
復元操作で、バックアップされた qtree から qtree 情報を復元しないことを指定します。



 a| 
レベル
 a| 
`0`-`31`
 a| 
`0`
 a| 
バックアップ レベルを指定します。

レベル0はデータセット全体をコピーします。0より大きい値で指定される増分バックアップ レベルでは、前回の増分バックアップ以降のすべてのファイル（新規または変更されたファイル）がコピーされます。例えば、レベル1はレベル0のバックアップ以降の新規または変更されたファイルをバックアップし、レベル2はレベル1のバックアップ以降の新規または変更されたファイルをバックアップします。



 a| 
LIST
 a| 
`Y` または `N`
 a| 
`N`
 a| 
実際にデータを復元せずに、バックアップされたファイル名とinode番号を一覧表示します。



 a| 
qtree の一覧表示
 a| 
`Y` または `N`
 a| 
`N`
 a| 
実際にデータを復元せずに、バックアップされた qtree を一覧表示します。



 a| 
マルチサブツリー名
 a| 
`string`
 a| 
`none`
 a| 
バックアップが複数のサブツリーのバックアップであることを指定します。

文字列には複数のサブツリーが指定されます。文字列は改行で区切られ、NULLで終了するサブツリー名のリストです。サブツリーは、共通のルート ディレクトリを基準とした相対パス名で指定されます。ルート ディレクトリは、リストの最後の要素として指定する必要があります。

この変数を使用する場合は、DMP_NAME 変数も使用する必要があります。



 a| 
NDMP_UNICODE_FH
 a| 
`Y` または `N`
 a| 
`N`
 a| 
ファイル履歴情報にファイルの NFS 名に加えて Unicode 名が含まれるように指定します。

このオプションはほとんどのバックアップ アプリケーションでは使用されません。バックアップ アプリケーションがこれらの追加ファイル名を受け取るように設計されていない限り、このオプションを設定しないでください。HIST変数も設定する必要があります。



 a| 
ACLがありません
 a| 
`Y` または `N`
 a| 
`N`
 a| 
データのバックアップ時に ACL をコピーしないように指定します。



 a| 
非クォータ qtree
 a| 
`Y` または `N`
 a| 
`N`
 a| 
データをバックアップするときに、qtree 内のファイルとディレクトリを無視する必要があることを指定します。

 `Y`に設定すると、FILESYSTEM変数で指定されたデータセット内のqtree内の項目はバックアップされません。この変数は、FILESYSTEM変数でボリューム全体を指定している場合にのみ有効です。NON_QUOTA_TREE変数はレベル0のバックアップでのみ機能し、MULTI_SUBTREE_NAMES変数が指定されている場合は機能しません。

[NOTE]
====
バックアップから除外するように指定されたファイルまたはディレクトリは、NON_QUOTA_TREE を `Y`に同時に設定した場合、除外されません。

====


 a| 
NOWRITE
 a| 
`Y` または `N`
 a| 
`N`
 a| 
復元操作でディスクにデータを書き込まないように指定します。

この変数はデバッグに使用されます。



 a| 
再帰的
 a| 
`Y` または `N`
 a| 
`Y`
 a| 
DAR 復元中にディレクトリ エントリを拡張することを指定します。

DIRECTおよびENHANCED_DAR_ENABLED環境変数も有効（ `Y`に設定）にする必要があります。RECURSIVE変数が無効（ `N`に設定）の場合、元のソースパスにあるすべてのディレクトリの権限とACLのみがテープから復元され、ディレクトリの内容は復元されません。RECURSIVE変数が `N`に設定されている場合、またはRECOVER_FULL_PATHS変数が `Y`に設定されている場合、リカバリパスは元のパスで終わる必要があります。

[NOTE]
====
RECURSIVE変数が無効で、複数のリカバリ パスが存在する場合、すべてのリカバリ パスが最長のリカバリ パス内に含まれている必要があります。そうでない場合は、エラー メッセージが表示されます。

====
たとえば、次のリカバリ パスは、すべてのリカバリ パスが `foo/dir1/deepdir/myfile`内にあるため、有効です：

* `/foo`
* `/foo/dir`
* `/foo/dir1/deepdir`
* `/foo/dir1/deepdir/myfile`


次のリカバリ パスは無効です：

* `/foo`
* `/foo/dir`
* `/foo/dir1/myfile`
* `/foo/dir2`
* `/foo/dir2/myfile`




 a| 
フルパスのリカバリ
 a| 
`Y` または `N`
 a| 
`N`
 a| 
完全なリカバリ パスで、DAR 後に権限と ACL が復元されることを指定します。

DIRECTとENHANCED_DAR_ENABLEDも有効（ `Y`に設定）にする必要があります。RECOVER_FULL_PATHSが `Y`に設定されている場合、リカバリパスは元のパスで終わる必要があります。復元先ボリュームに既にディレクトリが存在する場合、それらの権限とACLはテープから復元されません。



 a| 
UPDATE
 a| 
`Y` または `N`
 a| 
`Y`
 a| 
メタデータ情報を更新して、LEVEL ベースの増分バックアップを有効にします。

|===


== SMTape でサポートされている環境変数

|===
| 環境変数 | 有効な値 | デフォルト | 概要 


 a| 
BASE_DATE
 a| 
`DUMP_DATE`
 a| 
`-1`
 a| 
増分バックアップの開始日を指定します。

 `BASE_DATE`は、参照 Snapshot 識別子の文字列表現です。SMTape は、 `BASE_DATE`文字列を使用して参照 Snapshot を特定します。

 `BASE_DATE`は、ベースライン バックアップには必要ありません。増分バックアップの場合、前回のベースラインまたは増分バックアップの `DUMP_DATE`変数の値が `BASE_DATE`変数に割り当てられます。

バックアップ アプリケーションは、以前の SMTape ベースラインまたは増分バックアップからの `DUMP_DATE`値を割り当てます。



 a| 
DUMP_DATE
 a| 
`return_value`
 a| 
`none`
 a| 
SMTapeバックアップの最後に、DUMP_DATEには、そのバックアップに使用されたSnapshotを識別する文字列識別子が含まれます。このSnapshotは、後続の増分バックアップの参照Snapshotとして使用できます。

DUMP_DATE の結果値は、後続の増分バックアップの BASE_DATE 値として使用されます。



 a| 
SMTAPE_BACKUP_SET_ID
 a| 
`string`
 a| 
`none`
 a| 
ベースライン バックアップに関連付けられた増分バックアップのシーケンスを識別します。

バックアップセットIDは、ベースラインバックアップ中に生成される128ビットの一意のIDです。バックアップ アプリケーションは、増分バックアップ中にこのIDを `SMTAPE_BACKUP_SET_ID`変数への入力として割り当てます。



 a| 
SMTAPE_SNAPSHOT_NAME
 a| 
ボリューム内で利用可能な有効な Snapshot
 a| 
`Invalid`
 a| 
SMTAPE_SNAPSHOT_NAME 変数が Snapshot に設定されている場合、その Snapshot とその古い Snapshot がテープにバックアップされます。

増分バックアップの場合、この変数は増分スナップショットを指定します。BASE_DATE 変数はベースラインスナップショットを提供します。



 a| 
SMTAPE_DELETE_SNAPSHOT
 a| 
`Y` または `N`
 a| 
`N`
 a| 
SMTapeによって自動的に作成されたスナップショットの場合、SMTAPE_DELETE_SNAPSHOT変数が `Y`に設定されている場合、バックアップ操作の完了後、SMTapeはこのスナップショットを削除します。ただし、バックアップ アプリケーションによって作成されたスナップショットは削除されません。



 a| 
SMTAPE_BREAK_MIRROR
 a| 
`Y` または `N`
 a| 
`N`
 a| 
SMTAPE_BREAK_MIRROR 変数が `Y`に設定されている場合、 `DP`タイプのボリュームは、復元が成功した後、 `RW`ボリュームに変更されます。

|===