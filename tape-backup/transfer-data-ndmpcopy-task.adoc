---
permalink: tape-backup/transfer-data-ndmpcopy-task.html 
sidebar: sidebar 
keywords: transfer, data, ndmpcopy, incremental, full, qtree, directory, files, v4, ndmp 
summary: ndmpcopyコマンドは、NDMP v4をサポートするストレージ システム間でデータを転送します。完全転送と増分転送の両方を実行できます。ボリューム、qtree、ディレクトリ、または個々のファイルの完全または一部の転送が可能です。 
---
= ndmpcopyを使用してONTAPデータを転送する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
 `ndmpcopy`nodeshellコマンドは、NDMP v4をサポートするストレージ システム間でデータを転送します。完全転送と増分転送の両方を実行できます。ボリューム、qtree、ディレクトリ、または個々のファイルの完全または一部を転送できます。

.タスク概要
ONTAP 8.x以前のリリースでは、増分転送できるのは最大2回（フル バックアップ1回と増分バックアップ最大2回）に制限されます。

ONTAP 9.0以降のリリースでは、増分転送できるのは最大9回（フル バックアップ1回と増分バックアップ最大9回）に制限されます。

 `ndmpcopy`は、ソース ストレージ システムおよびデスティネーション ストレージ システムのノードシェル コマンドラインで実行することも、データ転送のソースでもデスティネーションでもないストレージ システムで実行することもできます。また、 `ndmpcopy`は、データ転送のソースとデスティネーションの両方である単一のストレージ システムで実行することもできます。

 `ndmpcopy`コマンドでは、ソース ストレージ システムおよびデスティネーション ストレージ システムのIPv4またはIPv6アドレスを使用できます。パスの形式は `/vserver_name/volume_name \[path\]`です。



.手順
. ソース ストレージ システムとデスティネーション ストレージ システムで、NDMPサービスを有効にします。
+
|===


| ソースまたはデスティネーションでデータ転送を実行している場合... | 次のコマンドを使用します... 


 a| 
SVMを対象としたNDMPモード
 a| 
`vserver services ndmp on`

[NOTE]
====
管理SVMのNDMP認証の場合、ユーザ アカウントは `admin`、ユーザ ロールは `admin`または `backup`です。データSVMの場合、ユーザ アカウントは `vsadmin`、ユーザ ロールは `vsadmin`または `vsadmin-backup`ロールです。

====


 a| 
ノードを対象としたNDMPモード
 a| 
`system services ndmp on`

|===
. ノードシェルの `ndmpcopy`コマンドを使用して、ストレージ システム内またはストレージ システム間でデータを転送します。
+
`::> system node run -node <node_name> < ndmpcopy [options] source_IP:source_path destination_IP:destination_path [-mcs {inet|inet6}] [-mcd {inet|inet6}] [-md {inet|inet6}]`

+
[NOTE]
====
ndmpcopyでは、DNS名はサポートされません。ソースまたはデスティネーションのIPアドレスを指定する必要があります。ソースまたはデスティネーションのIPアドレスでは、ループバック アドレス（127.0.0.1）はサポートされません。

====
+
**  `ndmpcopy`コマンドは、制御接続のアドレス モードを次のように決定します。
+
*** 制御接続のアドレス モードは、提供されたIPアドレスに対応します。
***  `-mcs`および `-mcd`オプションを使用して、これらのルールを上書きできます。


** ソースまたはデスティネーションがONTAPシステムの場合は、NDMPモード（ノードスコープまたはSVMスコープ）に応じて、ターゲット ボリュームへのアクセスを許可するIPアドレスを使用します。
** `source_path`および `destination_path`は、ボリューム、qtree、ディレクトリ、またはファイルの粒度レベルまでの絶対パス名です。
** `-mcs`ソース ストレージ システムへの制御接続に優先するアドレッシング モードを指定します。
+
`inet`はIPv4アドレス モードを示し、 `inet6`はIPv6アドレス モードを示します。

** `-mcd`デスティネーション ストレージ システムへの制御接続に優先するアドレッシング モードを指定します。
+
`inet`はIPv4アドレス モードを示し、 `inet6`はIPv6アドレス モードを示します。

** `-md`ソース ストレージ システムとデスティネーション ストレージ システム間のデータ転送に優先するアドレス指定モードを指定します。
+
`inet`はIPv4アドレス モードを示し、 `inet6`はIPv6アドレス モードを示します。

+
 `-md`オプションを `ndmpcopy`コマンドで使用しない場合、データ接続のアドレス指定モードは次のように決定されます：

+
*** 制御接続に指定されたアドレスのいずれかがIPv6アドレスの場合、データ接続のアドレス モードはIPv6になります。
*** 制御接続に指定されたアドレスが両方ともIPv4アドレスの場合、 `ndmpcopy`コマンドは最初にデータ接続に対してIPv6アドレス モードを試行します。
+
IPv6アドレス モードで失敗した場合は、IPv4アドレス モードを使用します。

+
[NOTE]
====
IPv6アドレスを指定する場合は、角かっこで囲む必要があります。

====
+
このサンプル コマンドは、ソース パス(`source_path`）からデスティネーション パス(`destination_path`）にデータを移行します。

+
[listing]
----
> ndmpcopy -sa admin:<ndmp_password> -da admin:<ndmp_password>
 -st md5 -dt md5 192.0.2.129:/<src_svm>/<src_vol> 192.0.2.131:/<dst_svm>/<dst_vol>
----
+
このコマンド例では、制御接続とデータ接続でIPv6アドレス モードを使用するように明示的に設定します。

+
[listing]
----
> ndmpcopy -sa admin:<ndmp_password> -da admin:<ndmp_password> -st md5 -dt md5 -mcs inet6 -mcd inet6 -md
 inet6 [2001:0db8:1:1:209:6bff:feae:6d67]:/<src_svm>/<src_vol> [2001:0ec9:1:1:200:7cgg:gfdf:7e78]:/<dst_svm>/<dst_vol>
----






この手順で説明されているコマンドの詳細については、link:https://docs.netapp.com/us-en/ontap-cli/["ONTAPコマンド リファレンス"^]を参照してください。



== ndmpcopyコマンドのオプション

 `ndmpcopy` nodeshell コマンドで使用できるオプションを理解して、link:transfer-data-ndmpcopy-task.html["データを転送する"]を正常に実行する必要があります。

次の表は、使用可能なオプションを示しています。

|===
| オプション | 概要 


 a| 
`-sa` `username`:[`password`]
 a| 
ソース ストレージ システムに接続するための、ソース側の認証のユーザ名とパスワードを設定します。これは必須のオプションです。

管理者権限を持たないユーザは、そのユーザに対応する、システムによって生成されたNDMP固有のパスワードを指定する必要があります。システムによって生成されたパスワードは、adminユーザとadmin以外のユーザの両方に必須です。



 a| 
`-da` `username`:[`password`]
 a| 
デスティネーション ストレージ システムに接続するための、デスティネーション側の認証のユーザ名とパスワードを設定します。これは必須のオプションです。



 a| 
`-st` {`md5`|`text`}
 a| 
このオプションは、ソース ストレージ システムに接続する際に使用するソース認証タイプを設定します。これは必須オプションであるため、ユーザーは `text`または `md5`オプションのいずれかを指定する必要があります。



 a| 
`-dt` {`md5`|`text`}
 a| 
デスティネーション ストレージ システムに接続するときに使用する、デスティネーション側の認証タイプを設定します。



 a| 
`-l`
 a| 
このオプションは、転送に使用するダンプ レベルを指定されたレベルの値に設定します。有効な値は `0`、 `1`から `9`です。ここで、 `0`は完全転送を示し、 `1`から `9`は増分転送を指定します。デフォルトは `0`です。



 a| 
`-d`
 a| 
このオプションは、ndmpcopyデバッグ ログ メッセージの生成を有効にします。ndmpcopyデバッグ ログ ファイルは `/mroot/etc/log`ルート ボリュームに保存されます。ndmpcopyデバッグ ログ ファイル名は `ndmpcopy.yyyymmdd`形式になります。



 a| 
`-f`
 a| 
このオプションは強制モードを有効にします。このモードでは、7-Modeボリュームのルートにある `/etc`ディレクトリ内のシステム ファイルを上書きできます。



 a| 
`-h`
 a| 
ヘルプ メッセージが出力されます。



 a| 
`-p`
 a| 
このオプションを選択すると、ソースとデスティネーションの認証用のパスワードの入力を求められます。このパスワードは `-sa`および `-da`オプションで指定されたパスワードよりも優先されます。

[NOTE]
====
このオプションは、対話型コンソールでコマンドを実行する場合にのみ使用できます。

====


 a| 
`-exclude`
 a| 
このオプションは、データ転送用に指定されたパスから、指定されたファイルまたはディレクトリを除外します。値は `*.pst`または `*.txt`などのディレクトリ名またはファイル名のコンマ区切りのリストです。サポートされる除外パターンの最大数は32、サポートされる文字の最大数は255です。

|===