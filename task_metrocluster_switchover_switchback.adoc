---
sidebar: sidebar 
permalink: task_metrocluster_switchover_switchback.html 
keywords: system manager, switchover, switchback, switch over, switch back, metrocluster, maintenance, nvram mirroring, synchronize, mediator, healing, recover 
summary: メンテナンスを実施したり、問題からリカバリしたりするために、ある MetroCluster サイトから別のサイトにスイッチオーバーできます。 
---
= IP MetroCluster のスイッチオーバーとスイッチバックを実行
:toc: macro
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toc: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/
:toc-position: content


[role="lead"]
1 つの IP MetroCluster サイトからもう一方のサイトに制御を切り替えることで、問題のメンテナンスやリカバリを実施できます。


NOTE: スイッチオーバーとスイッチバックの手順は、 IP MetroCluster 構成でのみサポートされます。



== スイッチオーバーとスイッチバックの概要

スイッチオーバーは次の 2 つのケースで発生します。

* * 計画的スイッチオーバー *
+
このスイッチオーバーは、 System Manager を使用してシステム管理者が開始します。計画的スイッチオーバーでは、ローカルクラスタのシステム管理者が制御を切り替えて、リモートクラスタのデータサービスをローカルクラスタで処理できるようにします。その後、リモートクラスタのシステム管理者が、リモートクラスタのメンテナンスを実行できます。

* * 計画外スイッチオーバー *
+
場合によっては、 MetroCluster クラスタが停止したり、クラスタ間の接続が停止したりすると、実行中のクラスタがダウンしたクラスタのデータ処理を処理するように、 ONTAP によってスイッチオーバー手順が自動的に開始されます。

+
一方のクラスタのステータスを ONTAP が特定できない場合は、動作しているサイトのシステム管理者がスイッチオーバー手順を開始し、もう一方のサイトのデータ処理責任を引き継ぎます。



どのタイプのスイッチオーバー手順の場合も、 _switchback プロセスを使用してデータサービス機能がクラスタに返されます。

ONTAP 9.7 および 9.8 では、異なるスイッチオーバープロセスとスイッチバックプロセスを実行します。

* <<sm97-sosb,ONTAP 9.7 の System Manager を使用して、スイッチオーバーとスイッチバックを行います>>
* <<sm98-sosb,ONTAP 9.8 の System Manager を使用して、スイッチオーバーとスイッチバックを実行します>>




== ONTAP 9.7 の System Manager を使用して、スイッチオーバーとスイッチバックを行います

.手順
. ONTAP 9.7 で System Manager にログインします。
. [*]( クラシックバージョンに戻る )* をクリックします。
. [* Configuration] > [* MetroCluster * ] をクリックします。
+
System Manager はネゴシエートスイッチオーバーが可能かどうかを検証します。

. 検証プロセスが完了したら、次のいずれかの手順を実行します。
+
.. 検証が失敗し、サイト B が稼働している場合は、エラーが発生しています。たとえば、サブシステムに問題がある場合や、 NVRAM ミラーリングが同期されていない場合があります。
+
... エラーの原因となっている問題を修正し、 [* 閉じる *] をクリックして、手順 2 からもう一度開始します。
... サイト B のノードを停止し、 * 閉じる * をクリックして、の手順を実行します link:https://docs.netapp.com/us-en/ontap-sm-classic/online-help-96-97/task_performing_unplanned_switchover.html["計画外スイッチオーバーの実行"^]。


.. 検証が失敗し、サイト B が停止している場合は、接続に問題がある可能性が高くなります。サイト B が本当に停止していることを確認し、の手順を実行します link:https://docs.netapp.com/us-en/ontap-sm-classic/online-help-96-97/task_performing_unplanned_switchover.html["計画外スイッチオーバーの実行"^]。


. [ サイト B からサイト A* へのスイッチオーバー ] をクリックして、スイッチオーバープロセスを開始します。
. [ * 新しい体験に切り替える * ] をクリックします。




== ONTAP 9.8 の System Manager を使用して、スイッチオーバーとスイッチバックを実行します



=== 計画的スイッチオーバーを実行（ ONTAP 9.8 ）

.手順
. ONTAP 9.8 で System Manager にログインします。
. 「 * ダッシュボード * 」を選択します。「 * MetroCluster * 」セクションには、 2 つのクラスタが接続されています。
. ローカルクラスタ（左側）で、をクリックします image:icon_kabob.gif["kebab アイコン"]をクリックし、*リモートデータサービスをローカルサイトにスイッチオーバー*を選択します。
+
スイッチオーバー要求の検証が完了すると、リモートサイトからローカルサイトに制御が転送され、両方のクラスタに対してデータサービス要求が実行されます。

+
リモートクラスタはリブートしますが、ストレージコンポーネントはアクティブではないため、クラスタはデータ要求を処理しません。これで、計画的なメンテナンスが可能になりました。




NOTE: スイッチバックを実行するまでは、リモートクラスタをデータサービスに使用しないでください。



=== 計画外スイッチオーバーの実行（ ONTAP 9.8 ）

計画外スイッチオーバーは、 ONTAP によって自動的に開始される場合があります。スイッチバックが必要かどうかを ONTAP が判断できない場合は、実行中の MetroCluster サイトのシステム管理者が次の手順でスイッチオーバーを開始します。

.手順
. ONTAP 9.8 で System Manager にログインします。
. 「 * ダッシュボード * 」を選択します。
+
「 * MetroCluster * 」セクションでは、 2 つのクラスタ間の接続に「 X 」が表示され、接続を検出できません。接続またはクラスタが停止しています。

. ローカルクラスタ（左側）で、をクリックします image:icon_kabob.gif["kebab アイコン"]をクリックし、*リモートデータサービスをローカルサイトにスイッチオーバー*を選択します。
+
スイッチオーバーがエラーで失敗した場合は、エラーメッセージの「View details」リンクをクリックして、計画外スイッチオーバーを確認します。

+
スイッチオーバー要求の検証が完了すると、リモートサイトからローカルサイトに制御が転送され、両方のクラスタに対してデータサービス要求が実行されます。

+
クラスタをオンラインに戻す前に、クラスタを修復する必要があります。




NOTE: リモートクラスタを再びオンラインにしたあとは、スイッチバックを実行するまでデータサービスに使用しないでください。



=== スイッチバックの実行（ ONTAP 9.8 ）

.を開始する前に
リモートクラスタが計画的なメンテナンスのために停止したか災害が原因で停止したかに関係なく、稼働中でスイッチバック待ちになっている必要があります。

.手順
. ローカルクラスタで、 ONTAP 9.8 から System Manager にログインします。
. 「 * ダッシュボード * 」を選択します。
+
「 * MetroCluster * 」セクションには、 2 つのクラスタが表示されます。

. ローカルクラスタ（左側）で、をクリックします image:icon_kabob.gif["kebab アイコン"]をクリックし、 * Take back control* を選択します。
+
データは、両方のクラスタ間でデータが同期およびミラーリングされるように、最初に _ 修復 _ されます。

. データの修復が完了したら、をクリックします image:icon_kabob.gif["kebab アイコン"]をクリックし、 * Initiate switchback * を選択します。
+
スイッチバックが完了すると、両方のクラスタがアクティブになり、データ要求を処理します。また、データをミラーリングしてクラスタ間で同期しています。


