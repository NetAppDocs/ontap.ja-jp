---
sidebar: sidebar 
permalink: task_nas_provision_windows_smb.html 
keywords: nas, windows, servers, provision, cifs, share access permissions, share access properties, hyper-v over smb, sql server over smb 
summary: ONTAP 9.7以降のSystem Managerで、SMBプロトコルを使用してWindowsサーバ用のストレージを提供するボリュームを作成します。 
---
= ONTAP System ManagerでSMBを使用してWindowsサーバー用のNASストレージをプロビジョニングする
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
ONTAP 9.7以降のSystem Managerで、SMBプロトコルを使用してWindowsサーバ用のストレージを提供するボリュームを作成します。

この手順では、link:task_nas_enable_windows_smb.html["既存のSMB対応ストレージVM"]に新しいボリュームを作成し、ボリュームのルート（/）ディレクトリの共有を作成します。ボリュームの設定時には、システムのデフォルト設定を受け入れることも、カスタム設定を指定することもできます。SMBの初期設定後、追加の共有を作成し、そのプロパティを変更することもできます。

FlexVolボリュームを作成したり、高パフォーマンスが求められる大規模なファイルシステム用にFlexGroupボリュームを作成したりできます。link:./flexgroup/create-task.html["FlexGroupボリュームを作成する"]も参照してください。

このボリュームの仕様をAnsible Playbookに保存することもできます。詳細については、link:task_admin_use_ansible_playbooks_add_edit_volumes_luns.html["Ansible Playbookを使用したボリュームやLUNの追加 / 編集"]をご覧ください。

ONTAP SMB プロトコル機能の範囲の詳細については、link:smb-admin/index.html["リファレンスの概要"]を参照してください。

.開始する前に
* ONTAP 9.13.1以降では、新規ボリュームで容量分析とアクティビティトラッキングをデフォルトで有効にできます。System Managerでは、クラスタレベルまたはストレージVMレベルでデフォルト設定を管理できます。詳細については、 https://docs.netapp.com/us-en/ontap/task_nas_file_system_analytics_enable.html["ファイルシステム分析の有効化"]をご覧ください。


.手順
. SMBが有効なStorage VMに新しいボリュームを追加します。
+
.. *ストレージ > ボリューム* をクリックし、*追加* をクリックします。
.. 名前を入力し、Storage VMを選択してサイズを入力します。
+
SMBプロトコルで構成されたストレージVMのみがリストに表示されます。SMBプロトコルで構成されたストレージVMが1つしか存在しない場合、*Storage VM*フィールドは表示されません。

+
*** この時点で*保存*を選択すると、System Manager はシステムのデフォルトを使用してFlexVol volume を作成し、追加します。
*** *その他のオプション*を選択すると、ボリュームの設定をカスタマイズして、認証、サービス品質、データ保護などのサービスを有効にすることができます。<<ボリューム設定のカスタマイズ>>を参照した後、ここに戻って次の手順を完了してください。




. [[step2-compl-prov-win,Step 2 in the workflow]] Windows クライアントに切り替えて、共有にアクセスできることを確認します。
+
.. エクスプローラで、次の形式でドライブを共有にマップします： `+\\_SMB_Server_Name__Share_Name_+`
.. 新しく作成したドライブで、テスト ファイルを作成し、テキストを書き込めることを確認したら削除します。




アクセスを確認した後、共有ACLを使用してクライアントアクセスを制限し、マップされたドライブに必要なセキュリティプロパティを設定できます。詳細については、link:smb-config/create-share-task.html["共有を作成"]を参照してください。



== 共有の追加または変更

SMBの初期設定後に共有を追加できます。共有は、選択したデフォルト値とプロパティを使用して作成されます。これらはあとで変更できます。

共有の設定時には次のプロパティを指定できます。

* アクセス権限
* 共有プロパティ
+
** Hyper-VおよびSQL Server over SMBのデータを含む共有に対する継続的可用性を有効にする（ONTAP 9.10.1以降）。次のセクションも参照してください。
+
*** link:smb-hyper-v-sql/continuously-available-share-hyper-v-concept.html["Hyper-V over SMBでの継続的可用性を備えた共有の要件と考慮事項"]
*** link:smb-hyper-v-sql/continuously-available-share-sql-concept.html["SQL Server over SMBでの継続的可用性を備えた共有の要件と考慮事項"]


** この共有へのアクセス時にSMB 3.0でデータを暗号化する。




初期設定後には、以下のプロパティを変更することもできます。

* シンボリック リンク
+
** シンボリック リンクとワイドリンクを有効または無効にする


* 共有プロパティ
+
** クライアントがスナップショット ディレクトリにアクセスできるようにします。
** oplockを有効にして、クライアントがファイルをロックしてコンテンツをローカルにキャッシュできるようにする（デフォルト）。
** アクセスベースの列挙（ABE）を有効にして、ユーザのアクセス権限に基づいて共有リソースを表示する。




.手順
. SMB 対応ボリュームに新しい共有を追加するには、**ストレージ > 共有**をクリックし、**追加**をクリックして、**共有**を選択します。
. 既存の共有を変更するには、**ストレージ > 共有** をクリックし、image:icon_kabob.gif["メニューオプションアイコン"] をクリックして **編集** を選択します。




== ボリューム設定のカスタマイズ

ボリュームを追加するときに、システムのデフォルト設定を使用しないでボリューム設定をカスタマイズすることができます。

.手順
*その他のオプション*をクリックした後、必要な機能を選択し、必要な値を入力します。

* リモート ボリュームのキャッシュ。
* パフォーマンス サービス レベル（サービス品質、QoS）。
+
ONTAP 9.8以降では、デフォルト値以外のカスタムQoSポリシーを指定したり、QoSを無効にしたりできます。

+
** QoS を無効にするには、*カスタム*、*既存*、*なし* の順に選択します。
** *カスタム* を選択して既存のサービス レベルを指定すると、ローカル ティアが自動的に選択されます。
** ONTAP 9.9.1 以降では、カスタム パフォーマンス サービス レベルを作成する場合、System Manager を使用して、作成するボリュームを配置するローカル層（*手動配置*）を手動で選択できます。
+
このオプションは、リモート キャッシュまたはFlexGroupボリュームのオプションを選択した場合は使用できません。



* FlexGroupボリューム（*ボリューム データをクラスター全体に分散する*を選択）。
+
このオプションは、以前に*パフォーマンス サービス レベル*で*手動配置*を選択した場合には利用できません。それ以外の場合、追加するボリュームはデフォルトでFlexVol volumeになります。

* ボリュームに設定されるプロトコルのアクセス権限。
* SnapMirrorによるデータ保護（ローカルまたはリモート）。オプションを選択したあと、プルダウン リストからデスティネーション クラスタの保護ポリシーと設定を指定します。
* *保存*を選択してボリュームを作成し、クラスタとStorage VMに追加します。



NOTE: ボリュームを保存したら、<<step2-compl-prov-win>>に戻り、SMB を使用して Windows サーバーのプロビジョニングを完了します。



== ONTAPでこの処理を行うその他の方法

|===


| このタスクを実行するには... | 参照先 


| System Manager Classic（ONTAP 9.7以前） | link:https://docs.netapp.com/us-en/ontap-system-manager-classic/smb-config/index.html["SMB 構成の概要"^] 


| ONTAPコマンドライン インターフェイス | link:smb-config/index.html["CLIを使用したSMBの設定 - 概要"] 
|===