---
sidebar: sidebar 
permalink: task_san_provision_linux.html 
keywords: netapp, ontap, san, provisioning, linux, servers, provision, storage, create lun, fc, iscsi, zone switches, scsi disk, iscsi 
summary: FC または iSCSI SAN プロトコルを使用して Linux サーバにストレージを提供するための LUN を作成します。LUN は、 Linux では SCSI ディスクデバイスとして認識されます。 
---
= Linux サーバ用の SAN ストレージをプロビジョニング
:toc: macro
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toc: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/
:toc-position: content


[role="lead"]
この手順 では、すでにFCプロトコルまたはiSCSIプロトコルが設定されている既存のStorage VMに新しいLUNが作成されます。

新しいStorage VMを作成してFCプロトコルまたはiSCSIプロトコルを設定する必要がある場合は、を参照してください link:san-admin/configure-svm-fc-task.html["FC 用に SVM を設定"] または link:san-admin/configure-svm-iscsi-task.html["SVM を iSCSI 用に設定"]。

LUN は、 Linux では SCSI ディスクデバイスとして認識されます。


NOTE: LUN の作成時、 Asymmetric Logical Unit Access （ ALUA ；非対称論理ユニットアクセス）は常に有効になります。ALUA の設定は変更できません。

FC ライセンスが必要です。また、そのライセンスを有効にする必要があります。FCライセンスが有効になっていない場合、LIFとSVMはオンラインとして表示されますが、動作ステータスはdownになります。LIF と SVM を動作状態にするには、 FC サービスを有効にする必要があります。イニシエータをホストするには、 SVM 内のすべての FC LIF で単一イニシエータゾーニングを使用する必要があります。

Linux サーバのイニシエータ ID （ FC WWPN または iSCSI iqn ）を確認しておく必要があります。

ONTAP 9.8 以降では、ストレージをプロビジョニングすると QoS がデフォルトで有効になります。QoS を無効にするか、プロビジョニングプロセス中またはあとからカスタムの QoS ポリシーを選択できます。

.手順
[role="tabbed-block"]
====
.System Manager の略
--
ONTAP System Manager（9.7以降）でFCまたはiSCSI SANプロトコルを使用してLinuxサーバにストレージを提供するためのLUNを作成します。

System Manager Classic（9.7以前で使用可能）を使用してこのタスクを完了するには、を参照してください https://docs.netapp.com/us-en/ontap-sm-classic/iscsi-config-rhel/index.html["Red Hat Enterprise Linux 向けの iSCSI の設定"^]

. Linux サーバで、をインストールします link:https://docs.netapp.com/us-en/ontap-sanhost/hu_luhu_71.html#installing-linux-unified-host-utilities["NetApp Linux Host Utilities のこと"] パッケージ。
. System Manager で、 * Storage > LUNs * をクリックし、 * Add * をクリックします。
. LUN の作成に必要な情報を入力します。
. ONTAP のバージョンに応じて、「*その他のオプション*」をクリックすると、次のいずれかの操作を実行できます。
+
[cols="80,20"]
|===


| オプション | 以降で使用できます 


 a| 
** 親ボリュームではなく LUN に QoS ポリシーを割り当て
+
*** * その他のオプション > ストレージと最適化 *
*** パフォーマンスサービスレベル * を選択します。
*** ボリューム全体ではなく個々の LUN に QoS ポリシーを適用するには、 * これらのパフォーマンス制限を各 LUN に適用 * を選択します。
+
デフォルトでは、パフォーマンス制限がボリュームレベルで適用されます。




| ONTAP 9.10.1 


 a| 
** 既存の igroup を使用して新しいイニシエータグループを作成します
+
*** * 「その他のオプション」 > 「ホスト情報」 *
*** 既存のイニシエータグループを使用して新しいイニシエータグループを選択します * 。
+
* 注：他の igroup を含む igroup の OS タイプは、作成後に変更することはできません。




| ONTAP 9.9.1 


 a| 
** 概要を igroup またはホストイニシエータに追加します
+
概要は、 igroup またはホストイニシエータのエイリアスとして機能します。

+
*** * 「その他のオプション」 > 「ホスト情報」 *



| ONTAP 9.9.1 


 a| 
** 既存のボリュームに LUN を作成します
+
デフォルトでは、新しいボリュームに新しい LUN が作成されます。

+
*** * その他のオプション > LUN の追加 *
*** ［ * グループ関連の LUN * ］ を選択します。



| ONTAP 9.9.1 


 a| 
** QoS を無効にするか、カスタムの QoS ポリシーを選択します
+
*** * その他のオプション > ストレージと最適化 *
*** パフォーマンスサービスレベル * を選択します。
+
* 注： ONTAP 9.9.1 以降では、カスタム QoS ポリシーを選択した場合、指定したローカル階層への手動配置を選択することもできます。




| ONTAP 9.8 
|===


. FC の場合は、 FC スイッチを WWPN でゾーニングします。イニシエータごとに 1 つのゾーンを使用し、各ゾーンにすべてのターゲットポートを含めます。
. Linux サーバで、新しい LUN を検出します。
+
`/usr/bin/rescan-scsi-bus.sh`

+

NOTE: 必要に応じて、 LUN のパーティショニングとファイルシステムの作成を行います。

. Linux サーバが LUN 上のデータを読み書きできることを確認します。


--
.CLI の使用
--
ONTAP CLIでFCまたはiSCSI SANプロトコルを使用してLinuxサーバにストレージを提供するためのLUNを作成します。

. を使用します `system license show` FCまたはiSCSIのライセンスがあるかどうかを確認するコマンド。
+
`system license show`

+
[listing]
----

Package           Type    Description           Expiration
 ----------------- ------- --------------------- --------------------
 Base              site    Cluster Base License  -
 NFS               site    NFS License           -
 CIFS              site    CIFS License          -
 iSCSI             site    iSCSI License         -
 FCP               site    FCP License           -
----
. FCまたはiSCSIのライセンスがない場合は、を使用してください `license add` コマンドを実行します
+
`license add -license-code _your_license_code_`

. SVMでプロトコルサービスを有効にします。
+
* iSCSIの場合：* `vserver iscsi create -vserver _vserver_name_ -target-alias _vserver_name_`

+
* FCの場合：* `vserver fcp create -vserver _vserver_name_ -status-admin up`

. 各ノードにSVM用のLIFを2つ作成します。
+
`network interface create -vserver _vserver_name_ -lif _lif_name_ -role data -data-protocol iscsi|fc -home-node _node_name_ -home-port _port_name_ -address _ip_address_ -netmask netmask`

+
ネットアップでは、データを提供するSVMごとに、ノードごとに少なくとも1つのiSCSIまたはFC LIFをサポートしています。ただし、冗長性を確保するには、ノードごとに2つのLIFが必要です。

. LIFが作成されたこと、および動作ステータスがになっていることを確認します `online`：
+
`network interface show -vserver _vserver_name_ _lif_name_`

. LUN を作成します。
+
`lun create -vserver vserver_name -volume _volume_name_ -lun _lun_name_ -size _lun_size_ -ostype linux -space-reserve enabled|disabled`

+
LUN 名は 255 文字以内で、スペースは使用できません。

+

NOTE: NVFAIL オプションは、ボリュームで LUN が作成されると、自動的に有効になります。

. igroup を作成します。
+
`igroup create -vserver _vserver_name_ -igroup _igroup_name_ -protocol fcp|iscsi|mixed -ostype linux -initiator _initiator_name_`

. LUN を igroup にマッピングします。
+
`lun mapping create -vserver _vserver_name_ -volume _volume_name_ -lun _lun_name_ -igroup _igroup_name_`

. LUN が正しく設定されていることを確認します。
+
`lun show -vserver _vserver_name_`

. link:san-admin/create-port-sets-binding-igroups-task.html["ポートセットを作成してigroupにバインドします"] （オプション）。
. ホストのマニュアルに記載されている手順に従って、特定のホストでブロックアクセスを有効にします。
. Host Utilities を使用して FC または iSCSI マッピングを完了し、ホスト上の LUN を検出します。


--
====
.関連情報
link:./san-admin/index.html["SAN の管理の概要"]
https://docs.netapp.com/us-en/ontap-sanhost/index.html["ONTAP SAN ホスト構成"]
https://docs.netapp.com/us-en/ontap/san-admin/manage-san-initiators-task.html["System ManagerでSANイニシエータグループを表示および管理します"]
http://www.netapp.com/us/media/tr-4017.pdf["ネットアップテクニカルレポート 4017 ：『ファイバチャネル SAN のベストプラクティス』"]
