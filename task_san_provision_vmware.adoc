---
sidebar: sidebar 
permalink: task_san_provision_vmware.html 
keywords: 'netapp, ontap, SAN, provisioning, provision, vmware, datastore, add lun, create, fc, iscsi, zone switches, storage, esxi host, Virtual Storage Console (VSC), vmware, vsphere' 
summary: ONTAP System Manager （ 9.7 以降）で FC または iSCSI SAN プロトコルを使用して ESXi ホストにストレージを提供するための LUN を作成します。LUN は、 ESXi ホストではディスクとして表示されます。 
---
= VMware データストア用の SAN ストレージをプロビジョニングする
:toc: macro
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toc: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/
:toc-position: content


[role="lead"]
この手順 では、すでにFCプロトコルまたはiSCSIプロトコルが設定されている既存のStorage VMに新しいLUNが作成されます。

新しいStorage VMを作成してFCプロトコルまたはiSCSIプロトコルを設定する必要がある場合は、を参照してください link:san-admin/configure-svm-fc-task.html["FC 用に SVM を設定"] または link:san-admin/configure-svm-iscsi-task.html["SVM を iSCSI 用に設定"]。


NOTE: LUN の作成時、 Asymmetric Logical Unit Access （ ALUA ；非対称論理ユニットアクセス）は常に有効になります。ALUA の設定は変更できません。

ONTAP 9.8 以降では、ストレージをプロビジョニングすると QoS がデフォルトで有効になります。QoS を無効にするか、プロビジョニングプロセス中またはあとからカスタムの QoS ポリシーを選択できます。

この手順 が完了すると、 Virtual Storage Console （ VSC ） for VMware vSphere を使用して VMware データストアを管理できます。VSC 7.0 以降、 VSC はの一部です https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["ONTAP Tools for VMware vSphere 仮想アプライアンス"^]で、 VSC 、 vStorage APIs for Storage Awareness （ VASA ） Provider 、および Storage Replication Adapter （ SRA ） for VMware vSphere の機能を使用できます。

必ずを確認してください https://imt.netapp.com/matrix/["NetApp Interoperability Matrix を参照してください"^] 現在の ONTAP リリースと VSC リリースの互換性を確認するため。

詳細については、を参照してください https://docs.netapp.com/us-en/netapp-solutions/virtualization/vsphere_ontap_ontap_for_vsphere.html["TR-4597 ：『 VMware vSphere for ONTAP 』"^] および VSC リリースのドキュメントを参照してください。

[role="tabbed-block"]
====
.System Manager の略
--
ONTAP 9.7以降の場合は、System Managerを搭載したストレージ用のLUNを作成します。

LUN は、 ESXi ホストではディスクとして表示されます。

System Manager Classic（ONTAP 9.7以前のリリース）を使用してESXiホストからデータストアへのSANプロトコルアクセスを設定するには、次のトピックを参照してください。

* https://docs.netapp.com/us-en/ontap-sm-classic/fc-config-esxi/index.html["VSC を使用した ESXi 向けの FC の設定の概要"^]
* https://docs.netapp.com/us-en/ontap-sm-classic/iscsi-config-esxi/index.html["VSC を使用した ESXi 向けの iSCSI 設定の概要"^]



NOTE: LUN の作成時、 Asymmetric Logical Unit Access （ ALUA ；非対称論理ユニットアクセス）は常に有効になります。ALUA の設定は変更できません。

.手順
. System Manager で、 * Storage > LUNs * をクリックし、 * Add * をクリックします。
. LUN の作成に必要な情報を入力します。
. ONTAP のバージョンに応じて、「*その他のオプション*」をクリックすると、次のいずれかの操作を実行できます。
+
[cols="80,20"]
|===


| オプション | 以降で使用できます 


 a| 
** 親ボリュームではなく LUN に QoS ポリシーを割り当て
+
*** * その他のオプション > ストレージと最適化 *
*** パフォーマンスサービスレベル * を選択します。
*** ボリューム全体ではなく個々の LUN に QoS ポリシーを適用するには、 * これらのパフォーマンス制限を各 LUN に適用 * を選択します。
+
デフォルトでは、パフォーマンス制限がボリュームレベルで適用されます。




| ONTAP 9.10.1 


 a| 
** 既存の igroup を使用して新しいイニシエータグループを作成します
+
*** * 「その他のオプション」 > 「ホスト情報」 *
*** 既存のイニシエータグループを使用して新しいイニシエータグループを選択します * 。
+
* 注：他の igroup を含む igroup の OS タイプは、作成後に変更することはできません。




| ONTAP 9.9.1 


 a| 
** 概要を igroup またはホストイニシエータに追加します
+
概要は、 igroup またはホストイニシエータのエイリアスとして機能します。

+
*** * 「その他のオプション」 > 「ホスト情報」 *



| ONTAP 9.9.1 


 a| 
** 既存のボリュームに LUN を作成します
+
デフォルトでは、新しいボリュームに新しい LUN が作成されます。

+
*** * その他のオプション > LUN の追加 *
*** ［ * グループ関連の LUN * ］ を選択します。



| ONTAP 9.9.1 


 a| 
** QoS を無効にするか、カスタムの QoS ポリシーを選択します
+
*** * その他のオプション > ストレージと最適化 *
*** パフォーマンスサービスレベル * を選択します。
+
* 注： ONTAP 9.9.1 以降では、カスタム QoS ポリシーを選択した場合、指定したローカル階層への手動配置を選択することもできます。




| ONTAP 9.8 
|===


. FC の場合は、 FC スイッチを WWPN でゾーニングします。イニシエータごとに 1 つのゾーンを使用し、各ゾーンにすべてのターゲットポートを含めます。
. LUN を検出して初期化するには、 Virtual Storage Console （ VSC ） for VMware vSphere を使用します。
. ESXi ホストが LUN 上のデータの書き込みと読み取りを実行できることを確認します。


--
.CLI の使用
--
ONTAP CLIでストレージを提供するLUNを作成します。

. 'system license show ' コマンドを使用して、 FC または iSCSI のライセンスがあることを確認します。
+
「 system license show 」を参照してください

+
[listing]
----

Package           Type    Description           Expiration
 ----------------- ------- --------------------- --------------------
 Base              site    Cluster Base License  -
 NFS               site    NFS License           -
 CIFS              site    CIFS License          -
 iSCSI             site    iSCSI License         -
 FCP               site    FCP License           -
----
. FC または iSCSI のライセンスがない場合は 'license add コマンドを使用します
+
'license add-license-code_Your_license_code_`

. SVMでプロトコルサービスを有効にします。
+
* iSCSIの場合：* vserver iscsi create -vserver _vserver_name __ target-alias_vserver_name _

+
* FCの場合：* vserver fcp create -vserver _vserver_name --status-admin up`

. 各ノードにSVM用のLIFを2つ作成します。
+
「network interface create -vserver _vserver_name _-lif lif_name _ role data -data-protocol iscsi | fc-home-node node_name _-home-port port_name _-address _ip_address _netmask」という形式で指定します

+
ネットアップでは、データを提供するSVMごとに、ノードごとに少なくとも1つのiSCSIまたはFC LIFをサポートしています。ただし、冗長性を確保するには、ノードごとに2つのLIFが必要です。

. LIF が作成され、動作ステータスが「 online 」になっていることを確認します。
+
「 network interface show -vserver_vserver_name __ lif_name_` 」のように表示されます

. LUN を作成します。
+
lun create -vserver vserver_name -volume _volume_name _-lun_name_-size_lun_size_-ostype linux -space-reserve enabled|disabled

+
LUN 名は 255 文字以内で、スペースは使用できません。

+

NOTE: NVFAIL オプションは、ボリュームで LUN が作成されると、自動的に有効になります。

. igroup を作成します。
+
igroup create -vserver_name_-igroup igroup_name -protocol fcp | iscsi | mixed -ostype linux -initiator_initiator_name_`

. LUN を igroup にマッピングします。
+
lun mapping create -vserver_name_-volume_name_-lun_lun_name -igroup_igroup_name _ -igroup_igroup_name _

. LUN が正しく設定されていることを確認します。
+
「 lun show -vserver vserver_name _ 」のように表示されます

. link:san-admin/create-port-sets-binding-igroups-task.html["ポートセットを作成してigroupにバインドします"] （オプション）。
. ホストのマニュアルに記載されている手順に従って、特定のホストでブロックアクセスを有効にします。
. Host Utilities を使用して FC または iSCSI マッピングを完了し、ホスト上の LUN を検出します。


--
====
https://docs.netapp.com/us-en/ontap-sanhost/index.html["ONTAP SAN ホスト構成"]
link:./san-admin/index.html["SAN の管理の概要"]
https://docs.netapp.com/us-en/ontap/san-admin/manage-san-initiators-task.html["System ManagerでSANイニシエータグループを表示および管理します"]
http://www.netapp.com/us/media/tr-4017.pdf["ネットアップテクニカルレポート 4017 ：『ファイバチャネル SAN のベストプラクティス』"]
