---
permalink: upgrade/snapmirror-cascade-relationship-blocked.html 
sidebar: sidebar 
keywords: ontap, upgrade, 9.9.1. 9.10.1, update, cascade, LTR, long term retention, snapshots, considerations, secondary storage 
summary: クラスタにSnapMirrorカスケード関係が設定されている場合は、アップグレード前に長期保持（LTR）Snapshotを無効にしなければならないことがあります。 
---
= ONTAPのアップグレード前に長期保持のSnapshotを無効にする
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
カスケード ボリュームの関係では、 ONTAP 9 のすべてのバージョンにおいて、長期保存 (LTR) スナップショットはカスケードの最後のSnapMirror宛先ボリュームでのみサポートされます。カスケード内の中間のボリュームで LTR スナップショットを有効にすると、バックアップとスナップショットが失われます。

詳細はこちらlink:../data-protection/long-term-retention-snapshots-concept.html["長期保存スナップショット"]。

カスケードの中間ボリュームでLTRスナップショットが有効になっているサポートされていない構成の場合は、テクニカルサポートに連絡して、link:https://kb.netapp.com/on-prem/ontap/DP/SnapMirror/SnapMirror-KBs/Cascading_a_volume_with_Long-Term_Retention_(LTR)_snapshots_enabled_is_not_supported["NetAppナレッジベース: 長期保存 (LTR) スナップショットが有効になっているボリュームのカスケード接続はサポートされていません"^]援助をお願いします。

次のONTAPバージョンでは、最終的なSnapMirror宛先ボリュームを除くカスケード内のどのボリュームでも LTR スナップショットを有効にできません。

* 9.15.1以降
* 9.14.1P2およびP4からP14
* 9.13.1P9からP17
* 9.12.1 P12からP19
* 9.11.1P15からP20
* 9.10.1P18からP20
* 9.9.1P20


カスケードの中間ボリュームで LTR スナップショットを有効にできるONTAPバージョンから、それをブロックするONTAPバージョンにアップグレードする前に、バックアップとスナップショットの欠落を回避するために LTR スナップショットを無効にする必要があります。

次のような場合に対処する必要があります。

* 長期保持（LTR）Snapshotは、SnapMirrorカスケードの「B」ボリューム、または大きなカスケードの別の中間SnapMirrorデスティネーションボリュームで構成されます。
* LTR Snapshotは、SnapMirrorポリシールールに適用されるスケジュールによって定義されます。このルールでは、Snapshotはソースボリュームからはレプリケートされませんが、デスティネーションボリュームに直接作成されます。
+

NOTE: スケジュールとSnapMirrorポリシーの詳細については、link:https://kb.netapp.com/on-prem/ontap/DP/SnapMirror/SnapMirror-KBs/How_does_the_schedule_parameter_in_an_ONTAP_9_SnapMirror_policy_rule_work["NetAppナレッジベース: ONTAP 9 SnapMirrorポリシー ルールの「スケジュール」パラメータはどのように機能しますか?"^] 。



.手順
. カスケードの中間ボリュームのSnapMirrorポリシーからLTRルールを削除します。
+
[listing]
----
Secondary::> snapmirror policy remove-rule -vserver <> -policy <> -snapmirror-label <>
----
+
詳細はこちら `snapmirror policy remove-rule`の中でlink:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-remove-rule.html["ONTAPコマンド リファレンス"^] 。

. LTRスケジュールを指定せずに、SnapMirrorラベルのルールを再度追加します。
+
[listing]
----
Secondary::> snapmirror policy add-rule -vserver <> -policy <> -snapmirror-label <> -keep <>
----
+

NOTE: SnapMirrorポリシールールからLTR Snapshotを削除すると、SnapMirrorは指定されたラベルのSnapshotをソースボリュームからプルします。適切なラベルが設定されたSnapshotを作成するために、ソースボリュームのSnapshotポリシーでスケジュールの追加や変更が必要になる場合もあります。

+
の詳細については `snapmirror policy add-rule`、をlink:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-add-rule.html["ONTAPコマンド リファレンス"^]参照してください。

. 必要に応じて、ソースボリュームのSnapshotポリシーでスケジュールを変更（または作成）して、SnapMirrorラベルのSnapshotを作成できるようにします。
+
[listing]
----
Primary::> volume snapshot policy modify-schedule -vserver <> -policy <> -schedule <> -snapmirror-label <>
----
+
[listing]
----
Primary::> volume snapshot policy add-schedule -vserver <> -policy <> -schedule <> -snapmirror-label <> -count <>
----



NOTE: LTRスナップショットは、SnapMirrorカスケード構成内の最終的なSnapMirrorデスティネーションボリュームで引き続き有効にすることができます。
