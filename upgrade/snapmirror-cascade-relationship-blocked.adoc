---
permalink: upgrade/snapmirror-cascade-relationship-blocked.html 
sidebar: sidebar 
keywords: ontap, upgrade, 9.9.1. 9.10.1, update, cascade, LTR, long term retention, snapshots, considerations, secondary storage 
summary: クラスタにSnapMirrorカスケード関係が設定されている場合は、アップグレード前に長期保存スナップショットを無効にする必要がある場合があります。 
---
= ONTAPのアップグレード前に長期保持のSnapshotを無効にする
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
カスケード ボリュームの関係では、長期保存スナップショットは、 ONTAP 9 のすべてのバージョンにおいて、カスケードの最後のSnapMirrorデスティネーションボリュームでのみサポートされます。カスケード内の中間ボリュームで長期保存スナップショットを有効にすると、バックアップとスナップショットが失われます。

詳細はこちらlink:../data-protection/long-term-retention-snapshots-concept.html["長期保存スナップショット"]。

カスケードの中間ボリュームで長期保存スナップショットが有効になっているサポートされていない構成がある場合は、テクニカル サポートに連絡し、リンク: https://kb.netapp.com/on-prem/ontap/DP/SnapMirror/SnapMirror-KBs/Cascading_a_volume_with_Long-Term_Retention_(long-term retention)_snapshots_enabled_is_not_supported[NetApp Knowledge Base: Cascading a volume with Long-Term Retention (LTR) snapshots enabled is not supported^] を参照してください。

次のONTAPバージョンでは、最終的なSnapMirrorデスティネーションボリュームを除くカスケード内のどのボリュームでも長期保存スナップショットを有効にすることはできません。

* 9.15.1以降
* 9.14.1P2およびP4からP14
* 9.13.1P9からP17
* 9.12.1 P12からP19
* 9.11.1P15からP20
* 9.10.1P18からP20
* 9.9.1P20


カスケードの中間ボリュームで長期保存スナップショットを有効にできるONTAPバージョンから、それをブロックするONTAPバージョンにアップグレードする前に、バックアップとスナップショットの欠落を回避するために、長期保存スナップショットを無効にする必要があります。

次のような場合に対処する必要があります。

* 長期保存スナップショットは、「A > B > C」 SnapMirrorカスケード内の「B」ボリューム、またはより大きなカスケード内の別の中間のSnapMirrorデスティネーションボリューム上に設定されます。
* 長期保存スナップショットは、 SnapMirrorポリシー ルールに適用されるスケジュールによって定義されます。このルールは、ソース ボリュームからスナップショットを複製するのではなく、宛先ボリュームに直接スナップショットを作成します。
+

NOTE: スケジュールとSnapMirrorポリシーの詳細については、link:https://kb.netapp.com/on-prem/ontap/DP/SnapMirror/SnapMirror-KBs/How_does_the_schedule_parameter_in_an_ONTAP_9_SnapMirror_policy_rule_work["NetAppナレッジベース: ONTAP 9 SnapMirrorポリシー ルールの「スケジュール」パラメータはどのように機能しますか?"^] 。



.手順
. カスケードの中央のボリュームのSnapMirrorポリシーから長期保持ルールを削除します。
+
[listing]
----
Secondary::> snapmirror policy remove-rule -vserver <> -policy <> -snapmirror-label <>
----
+
詳細はこちら `snapmirror policy remove-rule`の中でlink:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-remove-rule.html["ONTAPコマンド リファレンス"^] 。

. 長期保存スケジュールのないSnapMirrorラベルのルールを再度追加します。
+
[listing]
----
Secondary::> snapmirror policy add-rule -vserver <> -policy <> -snapmirror-label <> -keep <>
----
+

NOTE: SnapMirrorポリシー ルールから長期保存スナップショットを削除すると、 SnapMirror は指定されたラベルのスナップショットをソース ボリュームから取得することになります。適切にラベル付けされたスナップショットを作成するには、ソース ボリュームのスナップショット ポリシーのスケジュールを追加または変更する必要がある場合もあります。

+
の詳細については `snapmirror policy add-rule`、をlink:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-add-rule.html["ONTAPコマンド リファレンス"^]参照してください。

. 必要に応じて、ソースボリュームのSnapshotポリシーでスケジュールを変更（または作成）して、SnapMirrorラベルのSnapshotを作成できるようにします。
+
[listing]
----
Primary::> volume snapshot policy modify-schedule -vserver <> -policy <> -schedule <> -snapmirror-label <>
----
+
[listing]
----
Primary::> volume snapshot policy add-schedule -vserver <> -policy <> -schedule <> -snapmirror-label <> -count <>
----



NOTE: 長期保存スナップショットは、 SnapMirrorカスケード構成内の最終的なSnapMirrorデスティネーションボリュームでも有効にできます。
