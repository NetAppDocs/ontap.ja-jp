---
permalink: upgrade/snapmirror-cascade-relationship-blocked.html 
sidebar: sidebar 
keywords: ontap, upgrade, 9.9.1. 9.10.1, update, cascade, LTR, long term retention, snapshots, considerations, secondary storage 
summary: クラスタにSnapMirrorカスケード関係が設定されている場合は、アップグレード前に長期保存Snapshotを無効にする必要がある場合があります。 
---
= ONTAPのアップグレード前に長期保持Snapshotを無効にする
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
カスケード ボリュームの関係では、ONTAP 9 のすべてのバージョンにおいて、長期保存スナップショットはカスケードの最終的な SnapMirror デスティネーション ボリュームでのみサポートされます。カスケード内の中間のボリュームで長期保存スナップショットを有効にすると、バックアップとスナップショットが失われます。

link:../data-protection/long-term-retention-snapshots-concept.html["長期保存Snapshot"]についての詳細をご覧ください。

カスケードの中間ボリュームで長期保存スナップショットが有効になっているサポートされていない構成がある場合は、テクニカル サポートに連絡し、リンクhttps://kb.netapp.com/on-prem/ontap/DP/SnapMirror/SnapMirror-KBs/Cascading_a_volume_with_Long-Term_Retention_(長期保存)_snapshots_enabled_is_not_supported[NetApp ナレッジ ベース：長期保存（LTR）スナップショットが有効になっているボリュームのカスケードはサポートされていません^]を参照してください。

次のONTAPバージョンでは、最終的なSnapMirrorデスティネーション ボリュームを除くカスケード内のどのボリュームでも長期保存Snapshotを有効にすることはできません。

* 9.15.1以降
* 9.14.1P2およびP4～P14
* 9.13.1P9～P17
* 9.12.1 P12～P19
* 9.11.1P15～P20
* 9.10.1P18～P20
* 9.9.1P20


カスケードの中間ボリュームで長期保存Snapshotを有効にできるONTAPバージョンから、それをブロックするONTAPバージョンにアップグレードする前に、バックアップとSnapshotの欠落を回避するために、長期保存Snapshotを無効にする必要があります。

以下のシナリオでは対処が必要です。

* 長期保存スナップショットは、「A > B > C」SnapMirrorカスケード内の「B」ボリューム、またはより大きなカスケード内の別の中間のSnapMirrorデスティネーションボリューム上に構成されます。
* 長期保存スナップショットは、SnapMirrorポリシールールに適用されるスケジュールによって定義されます。このルールは、ソースボリュームからスナップショットを複製するのではなく、デスティネーションボリュームに直接スナップショットを作成します。
+

NOTE: スケジュールとSnapMirrorポリシーの詳細については、link:https://kb.netapp.com/on-prem/ontap/DP/SnapMirror/SnapMirror-KBs/How_does_the_schedule_parameter_in_an_ONTAP_9_SnapMirror_policy_rule_work["NetAppナレッジベース：ONTAP 9SnapMirrorポリシー ルールの「schedule」パラメータはどのように機能しますか？"^]を参照してください。



.手順
. カスケードの中間ボリュームにあるSnapMirrorポリシーから長期保持ルールを削除します：
+
[listing]
----
Secondary::> snapmirror policy remove-rule -vserver <> -policy <> -snapmirror-label <>
----
+
 `snapmirror policy remove-rule`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-remove-rule.html["ONTAPコマンド リファレンス"^]を参照してください。

. 長期保存スケジュールのないSnapMirrorラベルにルールを再度追加します：
+
[listing]
----
Secondary::> snapmirror policy add-rule -vserver <> -policy <> -snapmirror-label <> -keep <>
----
+

NOTE: SnapMirrorポリシールールから長期保存スナップショットを削除すると、SnapMirrorは指定されたラベルのスナップショットをソースボリュームから取得します。また、適切にラベル付けされたスナップショットを作成するには、ソースボリュームのスナップショットポリシーにスケジュールを追加または変更する必要がある場合もあります。

+
 `snapmirror policy add-rule`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-policy-add-rule.html["ONTAPコマンド リファレンス"^]をご覧ください。

. 必要に応じて、ソース ボリュームのSnapshotポリシーでスケジュールを変更（または作成）し、SnapMirrorラベルでSnapshotを作成できるようにします。
+
[listing]
----
Primary::> volume snapshot policy modify-schedule -vserver <> -policy <> -schedule <> -snapmirror-label <>
----
+
[listing]
----
Primary::> volume snapshot policy add-schedule -vserver <> -policy <> -schedule <> -snapmirror-label <> -count <>
----



NOTE: SnapMirrorカスケード構成内の最終的なSnapMirrorデスティネーション ボリュームでは、長期保存Snapshotを引き続き有効にすることができます。
