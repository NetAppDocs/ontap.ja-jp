---
permalink: upgrade/task_verify_cluster_after_upgrade.html 
sidebar: sidebar 
keywords: ontap, upgrade, upgrade, verify, status, health, post, after 
summary: アップグレード後にクラスタを確認する必要があります。 
---
= アップグレード後のクラスタ検証
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
アップグレード後に、クラスタのバージョン、クラスタの健全性、ストレージの健全性を確認する必要があります。

.作業を開始する前に

NOTE: MetroCluster FC 構成を使用している場合は、クラスタで自動計画外スイッチオーバーが有効になっていることも確認する必要があります。



== クラスタのバージョンを確認

すべての HA ペアをアップグレードしたら、 version コマンドを使用して、すべてのノードでターゲットリリースが実行されていることを確認する必要があります。

クラスタのバージョンは、クラスタ内のいずれかのノードで実行されている ONTAP の最下位のバージョンです。クラスタのバージョンがターゲットの ONTAP リリースになっていない場合は、クラスタをアップグレードできます。

. クラスタのバージョンがターゲットの ONTAP リリースになっていることを確認します。
+
「バージョン」

. クラスタのバージョンがターゲットの ONTAP リリースになっていない場合は、すべてのノードのアップグレードステータスを確認します。
+
system node upgrade-revert show





== クラスタの健常性を確認

[role="lead"]
クラスタをアップグレードしたら、ノードが正常に機能していてクラスタに追加するための条件を満たしていること、およびクラスタがクォーラムにあることを確認する必要があります。

. クラスタ内のノードがオンラインで、クラスタに追加するための条件を満たしていることを確認します。
+
「 cluster show 」を参照してください

+
[listing]
----
cluster1::> cluster show
Node                  Health  Eligibility
--------------------- ------- ------------
node0                 true    true
node1                 true    true
----
+
正常に機能していないノードや条件を満たしていないノードがある場合は、 EMS ログでエラーを確認して適切に修正します。

. 権限レベルを advanced に設定します。
+
「 advanced 」の権限が必要です

+
続行するには、「 y 」と入力します。

. 各 RDB プロセスの構成の詳細を確認します。
+
** リレーショナルデータベースのエポックとデータベースのエポックが各ノードで一致すること。
** リングごとのクォーラムマスターがすべてのノードで同じであることが必要です。
+
各リングのクォーラムマスターが異なる場合があることに注意してください。

+
|===


| 表示する RDB プロセス | 入力するコマンド 


 a| 
管理アプリケーション
 a| 
cluster ring show -unitname mgmt



 a| 
ボリュームロケーションデータベース
 a| 
cluster ring show -unitname vldb



 a| 
仮想インターフェイスマネージャ
 a| 
cluster ring show -unitname vifmgr



 a| 
SAN 管理デーモン
 a| 
cluster ring show -unitname bcomd

|===
+
次の例は、ボリュームロケーションデータベースのプロセスを示しています。



+
[listing]
----
cluster1::*> cluster ring show -unitname vldb
Node      UnitName Epoch    DB Epoch DB Trnxs Master    Online
--------- -------- -------- -------- -------- --------- ---------
node0     vldb     154      154      14847    node0     master
node1     vldb     154      154      14847    node0     secondary
node2     vldb     154      154      14847    node0     secondary
node3     vldb     154      154      14847    node0     secondary
4 entries were displayed.
----
. SAN環境を使用している場合は、各ノードがSANクォーラムにあることを確認します。「event log show -severity informational-message-name scsiblade.*」
+
各ノードの最新の scsiblade イベントメッセージに、 SCSI ブレードがクォーラムにあることが示されます。

+
[listing]
----
cluster1::*> event log show  -severity informational -message-name scsiblade.*
Time             Node       Severity       Event
---------------  ---------- -------------- ---------------------------
MM/DD/YYYY TIME  node0      INFORMATIONAL  scsiblade.in.quorum: The scsi-blade ...
MM/DD/YYYY TIME  node1      INFORMATIONAL  scsiblade.in.quorum: The scsi-blade ...
----


link:../system-admin/index.html["システム管理"]



== 自動計画外スイッチオーバーが有効になっていることを確認します

クラスタをアップグレードしたら、自動計画外スイッチオーバーが有効になっていることを確認する必要があります。

.このタスクについて

NOTE: この手順 は、 MetroCluster FC 構成に対してのみ実行されます。MetroCluster IP 構成を使用している場合は、この手順 を省略してください。

.手順
. 自動計画外スイッチオーバーが有効かどうかを確認します。
+
「 MetroCluster show 」

+
自動計画外スイッチオーバーが有効な場合、コマンド出力に次のステートメントが表示されます。

+
[listing]
----
AUSO Failure Domain  auso-on-cluster-disaster
----
. ステートメントが表示されない場合は、自動計画外スイッチオーバーを有効にします。
+
MetroCluster modify-auto-switchover-failure-domain auso-on-cluster-disaster

. 手順 1 を繰り返して、自動計画外スイッチオーバーが有効になっていることを確認します。




== ストレージの健常性を確認

クラスタをアップグレードしたら、ディスク、アグリゲート、およびボリュームのステータスを確認する必要があります。

. ディスクのステータスを確認します。
+
|===


| 確認する項目 | 手順 


 a| 
破損ディスク
 a| 
.. 破損ディスクを表示します。
+
「 storage disk show -state broken 」のように表示されます

.. 破損ディスクを取り外すか交換します。




 a| 
メンテナンス中または再構築中のディスク
 a| 
.. 保守、保留、または再構築の状態のディスクを表示します。
+
storage disk show -state maintenance|pending|reconstruct`

.. メンテナンスまたは再構築の処理が完了するまで待ってから次に進みます。


|===
. ストレージアグリゲートを含む物理ストレージと論理ストレージの状態を表示して、すべてのアグリゲートがオンラインであることを確認します。
+
「 storage aggregate show-state ！ online 」と入力します

+
このコマンドを実行すると、オンラインでないアグリゲートが表示されます。メジャーアップグレードまたはリバートの実行前と実行後には、すべてのアグリゲートがオンラインになっている必要があります。

+
[listing]
----
cluster1::> storage aggregate show -state !online
There are no entries matching your query.
----
. 次のコマンドを実行して、すべてのボリュームがオンラインであることを確認します。 _not_online
+
volume show -state ！ online

+
メジャーアップグレードまたはリバートの実行前と実行後には、すべてのボリュームがオンラインになっている必要があります。

+
[listing]
----
cluster1::> volume show -state !online
There are no entries matching your query.
----
. 整合性のないボリュームがないことを確認します。
+
volume show -is-inconsistent true

+
サポート技術情報の記事を参照してください link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Storage_Software/ONTAP_OS/Volume_Showing_WAFL_Inconsistent["「WAFL inconsistent」を示すボリューム"] を参照してください。



link:../disks-aggregates/index.html["ディスクおよびアグリゲートの管理"]
