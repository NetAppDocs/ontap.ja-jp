---
permalink: upgrade/task_verifying_the_lif_failover_configuration.html 
sidebar: sidebar 
keywords: ontap, upgrade, verifying, verify, lif, failover, configuration 
summary: アップグレードを実行する前に、フェールオーバーポリシーとフェールオーバーグループが正しく設定されていることを確認します。 
---
= アップグレード前にONTAPクラスタLIFフェイルオーバー設定を確認する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAPをアップグレードする前に、フェイルオーバー ポリシーとフェイルオーバー グループが適切に設定されていることを確認する必要があります。

アップグレード時、LIFはアップグレード方式に基づいて移行されます。アップグレード方式に応じて、LIFフェイルオーバー ポリシーが使用される場合と使用されない場合があります。

8ノード以上で構成されるクラスタでは、バッチ方式を使用して自動アップグレードが実行されます。バッチ アップグレード方式では、クラスタを複数のバッチに分割し、まず最初のバッチに含まれるノードをアップグレードし、次にそのハイアベイラビリティ（HA）パートナーをアップグレードしてから、残りのバッチに対して同じ処理が実行されます。ONTAP 9.7以前でバッチ方式が使用された場合、LIFはアップグレード中のノードのHAパートナーに移行されます。ONTAP 9.8以降でバッチ方式が使用された場合、LIFは他のバッチ グループに移行されます。

8ノード未満で構成されるクラスタでは、ローリング方式を使用して自動アップグレードが実行されます。ローリング アップグレード方式では、HAペアの各ノードでフェイルオーバー処理を開始し、フェイルオーバーされたノードを更新してからギブバックを開始します。この処理をクラスタ内のそれぞれのHAペアに対して繰り返します。ローリング方式が使用される場合、LIFはLIFフェイルオーバー ポリシーに定義されているフェイルオーバー ターゲット ノードに移行されます。

.手順
. 各データLIFのフェイルオーバー ポリシーを表示します。
+
[cols="2*"]
|===
| ONTAPのバージョン | このコマンドを使用する 


| 9.6以降  a| 
`network interface show -service-policy \*data* -failover`



| 9.5以前  a| 
`network interface show -role data -failover`

|===
+
次の例は、2つのデータLIFを含む2ノード クラスタのデフォルトのフェイルオーバー設定を示しています。

+
[listing]
----
cluster1::> network interface show -role data -failover
         Logical         Home                  Failover        Failover
Vserver  Interface       Node:Port             Policy          Group
-------- --------------- --------------------- --------------- ---------------
vs0
         lif0            node0:e0b             nextavail       system-defined
                         Failover Targets: node0:e0b, node0:e0c,
                                           node0:e0d, node0:e0e,
                                           node0:e0f, node1:e0b,
                                           node1:e0c, node1:e0d,
                                           node1:e0e, node1:e0f
vs1
         lif1            node1:e0b             nextavail       system-defined
                         Failover Targets: node1:e0b, node1:e0c,
                                           node1:e0d, node1:e0e,
                                           node1:e0f, node0:e0b,
                                           node0:e0c, node0:e0d,
                                           node0:e0e, node0:e0f
----
+
*フェイルオーバーターゲット*フィールドには、各LIFのフェイルオーバーターゲットの優先順位リストが表示されます。例えば、「lif0」がホームポート（node0のe0b）からフェイルオーバーする場合、まずnode0のポートe0cへのフェイルオーバーを試みます。lif0がe0cにフェイルオーバーできない場合は、次にnode0のポートe0dへのフェイルオーバーを試みます。以下同様に続きます。

+
 `network interface show`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-show.html["ONTAPコマンド リファレンス"^]を参照してください。

. SAN LIF 以外の LIF のフェイルオーバーポリシーが *disabled* に設定されている場合は、 `network interface modify`コマンドを使用してフェイルオーバーを有効にします。
+
 `network interface modify`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/network-interface-modify.html["ONTAPコマンド リファレンス"^]を参照してください。

. 各 LIF について、*Failover Targets* フィールドに、LIF のホーム ノードのアップグレード中に稼働し続ける別のノードからのデータ ポートが含まれていることを確認します。
+
 `network interface failover-groups modify`コマンドを使用して、フェイルオーバーグループにフェイルオーバーターゲットを追加できます。

+
.例
[listing]
----
network interface failover-groups modify -vserver vs0 -failover-group fg1 -targets sti8-vsim-ucs572q:e0d,sti8-vsim-ucs572r:e0d
----


.関連情報
* link:../networking/networking_reference.html["ネットワークおよびLIFの管理"]
* link:https://docs.netapp.com/us-en/ontap-cli/search.html?q=network+interface["ネットワーク インターフェイス"^]
* link:https://docs.netapp.com/us-en/ontap-cli/network-interface-failover-groups-modify.html["network interface failover-groups modify"^]

