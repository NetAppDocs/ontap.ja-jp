---
permalink: volumes/examples-quota-config-concept.html 
sidebar: sidebar 
keywords: examples, quota, configuration, volume quota policy 
summary: これらの例は、クォータを設定する方法とクォータ レポートを読む方法を理解するのに役立ちます。 
---
= クォータ設定の例
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
これらの例は、クォータを設定する方法とクォータ レポートを読む方法を理解するのに役立ちます。

.これらの例について
次の例では、1つのボリューム `vol1`を持つSVM `vs1`を含むストレージ システムがあると仮定します。

. クォータのセットアップを開始するには、SVMの新しいクォータ ポリシーを作成します。
+
[listing]
----
cluster1::>volume quota policy create -vserver vs1 -policy-name quota_policy_vs1_1
----
. このクォータ ポリシーは新規であるため、SVMに割り当てます。
+
[listing]
----
cluster1::>vserver modify -vserver vs1 -quota-policy quota_policy_vs1_1
----


.例1：デフォルトのユーザ クォータ
.  `vol1`内の各ユーザに50MBのハード リミットを課すことにしました：
+
[listing]
----
cluster1::>volume quota policy rule create -vserver vs1 -policy-name quota_policy_vs1_1 -volume vol1 -type user -target "" -disk-limit 50MB -qtree ""
----
. 新しいルールをアクティブ化するには、ボリュームのクォータを初期化します。
+
[listing]
----
cluster1::>volume quota on -vserver vs1 -volume vol1 -foreground
----
. クォータ レポートを表示します。
+
[listing]
----
cluster1::>volume quota report
----


次のようなクォータ レポートが表示されます。

[listing]
----
Vserver: vs1
                                    ----Disk----  ----Files-----   Quota
Volume   Tree      Type    ID        Used  Limit    Used   Limit   Specifier
-------  --------  ------  -------  -----  -----  ------  ------   ---------
vol1               user    *           0B   50MB       0       -   *
vol1               user    jsmith    49MB   50MB      37       -   *
vol1               user    root        0B      -       1       -
----
最初の行には、ディスク制限を含む、作成したデフォルトのユーザ クォータが表示されます。すべてのデフォルト クォータと同様に、このデフォルトのユーザ クォータでは、ディスクまたはファイルの使用状況に関する情報は表示されません。作成されたクォータに加えて、他の2つのクォータが表示されます。 `vol1`に現在ファイルを所有しているユーザごとに1つのクォータがあります。これらの追加クォータは、デフォルトのユーザ クォータから自動的に派生したユーザ クォータです。ユーザ `jsmith`の派生ユーザ クォータには、デフォルトのユーザ クォータと同じ50MBのディスク制限があります。rootユーザの派生ユーザ クォータは、追跡クォータ（制限なし）です。

システム上の任意のユーザー（ルート ユーザー以外）が `vol1`で50MBを超えるサイズを使用するアクション（エディターからファイルへの書き込みなど）を実行しようとすると、そのアクションは失敗します。

.例 2：明示的なユーザ クォータによるデフォルトのユーザ クォータの上書き
. ボリューム `vol1`内のユーザー `jsmith`にスペースをさらに提供する必要がある場合は、次のコマンドを入力します：
+
[listing]
----
cluster1::>volume quota policy rule create -vserver vs1 -policy-name quota_policy_vs1_1 -volume vol1 -type user -target jsmith -disk-limit 80MB -qtree ""
----
+
ユーザがクォータ ルールのターゲットとして明示的にリストされているため、これは明示的ユーザ クォータです。

+
これは既存のクォータ制限への変更です。ボリューム上のユーザ `jsmith`の派生ユーザ クォータのディスク制限が変更されるためです。したがって、変更を有効にするためにボリューム上のクォータを再初期化する必要はありません。

. クォータのサイズを変更するには、次のコマンドを実行します。
+
[listing]
----
cluster1::>volume quota resize -vserver vs1 -volume vol1 -foreground
----
+
クォータはサイズを変更しても有効なままで、サイズ変更プロセスは短時間で完了します。



次のようなクォータ レポートが表示されます。

[listing]
----
cluster1::> volume quota report
Vserver: vs1
                                    ----Disk----  ----Files-----   Quota
Volume   Tree      Type    ID        Used  Limit    Used   Limit   Specifier
-------  --------  ------  -------  -----  -----  ------  ------   ---------
vol1               user    *           0B   50MB       0       -   *
vol1               user    jsmith    50MB   80MB      37       -   jsmith
vol1               user    root        0B      -       1       -
3 entries were displayed.
----
2 行目には、ディスク制限 `80MB`とクォータ指定子 `jsmith`が表示されます。

したがって、 `jsmith`は、他のすべてのユーザーが50MBに制限されている場合でも、 `vol1`で最大80MBのスペースを使用できます。

.例3：しきい値
ユーザがディスク制限の5MB以内に達したときに通知を受け取るようにするとします。

. すべてのユーザーに対して 45 MB のしきい値を作成し、 `jsmith`に対して 75 MB のしきい値を作成するには、既存のクォータ ルールを変更します：
+
[listing]
----
cluster1::>volume quota policy rule modify -vserver vs1 -policy quota_policy_vs1_1 -volume vol1 -type user -target "" -qtree "" -threshold 45MB
cluster1::>volume quota policy rule modify -vserver vs1 -policy quota_policy_vs1_1 -volume vol1 -type user -target jsmith -qtree "" -threshold 75MB
----
+
既存のルールのサイズが変更されるため、変更をアクティブ化するには、ボリュームのクォータのサイズを変更します。サイズ変更プロセスが完了するまで待ちます。

. しきい値を含むクォータレポートを表示するには、 `-thresholds`パラメータを `volume quota report`コマンドに追加します：
+
[listing]
----
cluster1::>volume quota report -thresholds
Vserver: vs1
                                    ----Disk----  ----Files-----
Volume   Tree      Type    ID        Used  Limit   Used    Limit  Quota
                                          (Thold)                 Specifier
-------  --------  ------  -------  -----  -----  ------  ------  ---------
vol1               user    *           0B   50MB       0       -  *
                                           (45MB)
vol1               user    jsmith    59MB   80MB      55       -  jsmith
                                           (75MB)
vol1               user    root        0B      -       1       -
                                           ( -)
3 entries were displayed.
----
+
しきい値は、[Disk Limit]列のかっこ内に表示されます。

+
 `volume quota report`の詳細については、link:https://docs.netapp.com/us-en/ontap-cli/volume-quota-report.html["ONTAPコマンド リファレンス"^]を参照してください。



.例4：qtreeのクォータ
2つのプロジェクトのためにスペースをパーティション分割する必要があるとします。 `proj1`と `proj2`という名前の2つのqtreeを作成して、 `vol1`内にこれらのプロジェクトを収容することができます。

現在、ユーザは、ボリューム全体に割り当てられているスペースと同じだけqtree内のスペースを使用できます（ただし、ルートまたは別のqtree内のスペースを使用してボリュームの制限を超えていない場合）。さらに、ボリューム全体を使用するように各qtreeを拡張できます。

. どちらのqtreeも20GBを超えることがないようにするには、このボリュームにデフォルト ツリー クォータを作成します。
+
[listing]
----
cluster1:>>volume quota policy rule create -vserver vs1 -policy-name quota_policy_vs1_1 -volume vol1 -type tree -target "" -disk-limit 20GB
----
+

NOTE: 正しいタイプは_tree_であり、qtreeではありません。

. これは新しいクォータであるため、サイズ変更でアクティブ化することはできません。ボリュームのクォータを再初期化します。
+
[listing]
----
cluster1:>>volume quota off -vserver vs1 -volume vol1
cluster1:>>volume quota on -vserver vs1 -volume vol1 -foreground
----


[NOTE]
====
影響を受ける各ボリュームのクォータを再アクティブ化する前に、約5分間待つ必要があります。 `volume quota off`コマンド実行後すぐにクォータをアクティブ化しようとするとエラーが発生する可能性があります。または、特定のボリュームを含むノードから、ボリュームのクォータを再初期化するコマンドを実行することもできます。link:https://docs.netapp.com/us-en/ontap-cli/volume-quota-off.html["ONTAPコマンド リファレンス"^]の `volume quota off`の詳細をご覧ください。

====
クォータは、サイズ変更プロセスよりも時間がかかる再初期化プロセスでは適用されません。

クォータ レポートを表示すると、いくつかの新しい行が表示されます。一部の行はツリー クォータ用で、一部の行は派生ユーザ クォータ用です。

次の新しい行は、ツリー クォータ用です。

[listing]
----

                                    ----Disk----  ----Files-----   Quota
Volume   Tree      Type    ID        Used  Limit    Used   Limit   Specifier
-------  --------  ------  -------  -----  -----  ------  ------   ---------
...
vol1               tree    *           0B   20GB       0       -   *
vol1     proj1     tree    1           0B   20GB       1       -   proj1
vol1     proj2     tree    2           0B   20GB       1       -   proj2
...
----
作成したデフォルトのツリークォータは、最初の新しい行（ID列にアスタリスク（*）付き）に表示されます。ボリューム上のデフォルトのツリークォータに応じて、ONTAPはボリューム内の各qtreeに対して派生ツリークォータを自動的に作成します。これらは、 `Tree`列に `proj1`と `proj2`が表示されている行に示されます。

次の新しい行は派生ユーザ クォータ用です。

[listing]
----

                                    ----Disk----  ----Files-----   Quota
Volume   Tree      Type    ID        Used  Limit    Used   Limit   Specifier
-------  --------  ------  -------  -----  -----  ------  ------   ---------
...
vol1     proj1     user    *           0B   50MB       0       -
vol1     proj1     user    root        0B      -       1       -
vol1     proj2     user    *           0B   50MB       0       -
vol1     proj2     user    root        0B      -       1       -
...
----
ボリュームのデフォルト ユーザ クォータは、qtreeのクォータが有効になっている場合、そのボリュームに含まれるすべてのqtreeに自動的に継承されます。最初のqtreeクォータを追加すると、qtreeのクォータが有効になります。そのため、派生デフォルト ユーザ クォータが各qtreeに対して作成されました。これらは、IDがアスタリスク（*）の行に表示されます。

rootユーザはファイルの所有者であるため、それぞれのqtreeに対してデフォルト ユーザ クォータが作成されたときに、各qtreeのrootユーザに対して特別な追跡クォータも作成されました。これらは、IDがrootの行に示されています。

.例5：qtreeのユーザ クォータ
.  `proj1` qtree内でユーザに割り当てるスペースを、ボリューム全体で割り当てるスペースよりも少なく制限することにしました。 `proj1` qtree内で10MB以上使用できないようにします。そのため、qtreeのデフォルト ユーザ クォータを作成します：
+
[listing]
----
cluster1::>volume quota policy rule create -vserver vs1 -policy-name quota_policy_vs1_1 -volume vol1 -type user -target "" -disk-limit 10MB -qtree proj1
----
+
これは、ボリューム上のデフォルト ユーザ クォータから派生したproj1 qtreeのデフォルト ユーザ クォータを変更するため、既存のクォータに対する変更です。そのため、クォータのサイズを変更することで変更をアクティブ化します。サイズ変更プロセスが完了したら、クォータ レポートを表示できます。

+
qtreeの新しい明示的ユーザ クォータを示す次の新しい行がクォータ レポートに表示されます。

+
[listing]
----

                                    ----Disk----  ----Files-----   Quota
Volume   Tree      Type    ID        Used  Limit    Used   Limit   Specifier
-------  --------  ------  -------  -----  -----  ------  ------   ---------
vol1     proj1     user    *           0B   10MB       0       -   *
----
+
ただし、デフォルトのユーザ クォータを上書きするために作成したクォータ（より多くのスペースを提供するため）がボリューム上にあったため、ユーザ `jsmith`はproj1 qtreeへのデータの書き込みができなくなっています。 `proj1` qtreeにデフォルトのユーザ クォータを追加したため、そのクォータが適用され、 `jsmith`を含むそのqtree内のすべてのユーザのスペースが制限されています。

. ユーザにさらに多くのスペースを提供するには `jsmith`、qtreeのデフォルトの ユーザ クォータ ルールを上書きするために、80MBのディスク制限を持つqtreeの明示的な ユーザ クォータ ルールを追加します。
+
[listing]
----
cluster1::>volume quota policy rule create -vserver vs1 -policy-name quota_policy_vs1_1 -volume vol1 -type user -target jsmith -disk-limit 80MB -qtree proj1
----
+
これはデフォルト クォータがすでに存在する明示的クォータであるため、クォータのサイズを変更することで変更をアクティブ化できます。サイズ変更プロセスが完了したら、クォータ レポートを表示します。



クォータ レポートに次の新しい行が表示されます。

[listing]
----

                                    ----Disk----  ----Files-----   Quota
Volume   Tree      Type    ID        Used  Limit    Used   Limit   Specifier
-------  --------  ------  -------  -----  -----  ------  ------   ---------
vol1     proj1     user    jsmith    61MB   80MB      57       -   jsmith
----
最終的なクォータ レポートは次のようになります。

[listing]
----
cluster1::>volume quota report
Vserver: vs1
                                    ----Disk----  ----Files-----   Quota
Volume   Tree      Type    ID        Used  Limit    Used   Limit   Specifier
-------  --------  ------  -------  -----  -----  ------  ------   ---------
vol1               tree    *           0B   20GB       0       -   *
vol1               user    *           0B   50MB       0       -   *
vol1               user    jsmith    70MB   80MB      65       -   jsmith
vol1     proj1     tree    1           0B   20GB       1       -   proj1
vol1     proj1     user    *           0B   10MB       0       -   *
vol1     proj1     user    root        0B      -       1       -
vol1     proj2     tree    2           0B   20GB       1       -   proj2
vol1     proj2     user    *           0B   50MB       0       -
vol1     proj2     user    root        0B      -       1       -
vol1               user    root        0B      -       3       -
vol1     proj1     user    jsmith    61MB   80MB      57       -   jsmith
11 entries were displayed.
----
ユーザ `jsmith`が `proj1`内のファイルに書き込むには、次のクォータ制限を満たす必要があります：

.  `proj1` qtreeのツリー クォータ。
.  `proj1` qtreeのユーザ クォータ。
. ボリュームのユーザ クォータ。

