---
permalink: volumes/recommendations-moving-concept.html 
sidebar: sidebar 
keywords: considerations, recommendations, moving volumes, flexclone volume, metroCluster configuration 
summary: ボリュームを移動する際の考慮事項と推奨事項がいくつかあります。これらは、移動するボリュームおよびMetroClusterなどのシステム構成に基づいています。ボリュームを移動する前に、関連する問題をすべて理解しておく必要があります。 
---
= ボリュームを移動する際の考慮事項と推奨事項
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ボリュームを移動する際の考慮事項と推奨事項がいくつかあります。これらは、移動するボリュームおよびMetroClusterなどのシステム構成に基づいています。ボリュームを移動する前に、関連する問題をすべて理解しておく必要があります。



== 一般的な考慮事項と推奨事項

* クラスターのリリース ファミリをアップグレードする場合は、クラスター内のすべてのノードをアップグレードするまでボリュームを移動しないでください。
+
この推奨事項に従うことで、ボリュームを新しいリリース ファミリーから古いリリース ファミリーに誤って移動するのを防ぐことができます。

* ソース ボリュームには整合性が必要です。
* 関連Storage Virtual Machine（SVM）に1つ以上のアグリゲートを割り当てている場合は、デスティネーション アグリゲートが割り当てたアグリゲートのいずれかである必要があります。
* ボリュームは、新しいONTAPバージョンにのみ移動する必要があります。
* テイクオーバーされたCFOアグリゲートとの間でボリュームを移動することはできません。
* LUN を含むボリュームを移動する前に NVFAIL が有効になっていない場合は、移動後にそのボリュームで NVFAIL が有効になります。
* ボリュームをFlash Poolアグリゲートから別のFlash Poolアグリゲートに移動することができます。
+
** そのボリュームのキャッシュ ポリシーも移動されます。
** この移動はボリュームのパフォーマンスに影響する可能性があります。


* ボリュームをFlash PoolアグリゲートとFlash Poolアグリゲート以外のアグリゲートの間で移動することができます。
+
** ボリュームを Flash Pool アグリゲートから Flash Pool 以外のアグリゲートに移動すると、ONTAP は移動によってボリュームのパフォーマンスが影響を受ける可能性があることを警告するメッセージが表示され、続行するかどうかを尋ねられます。
** ボリュームを非Flash Poolアグリゲートから Flash Pool アグリゲートに移動すると、ONTAP によって `auto`キャッシュ ポリシーが割り当てられます。


* ボリュームには、そのボリュームが配置されているアグリゲートの保管データの保護機能が適用されます。NSEドライブで構成されるアグリゲートからそれ以外のドライブで構成されるアグリゲートにボリュームを移動した場合、NSEによる保管データの保護機能は適用されなくなります。
* FabricPool最適化されたボリュームをONTAP 9.13.1以前からONTAP 9.15.1以降に移動する場合は、link:https://kb.netapp.com/on-prem/ontap/Ontap_OS/FS_Issues/CONTAP-307878["NetAppナレッジベース：CONTAP-307878 - ソースONTAPが9.14.1未満で宛先が9.14.1より大きい場合、FabricPool最適化ボリューム移動中に予期しない再起動が発生する"^]を参照してください。
* ONTAP 9.15.1以降、A400システムからA70、A90、またはA1Kシステムにボリュームを移動すると、読み取りレイテンシが増加する可能性があります。詳細と推奨される対処方法については、link:https://kb.netapp.com/on-prem/ontap/Ontap_OS/FS_Issues/CONTAP-556247["NetAppナレッジベース：CONTAP-556247 - A400からA70、A90、A1Kに移動されたボリュームの圧縮/解凍が遅い"^]を参照してください。




== FlexCloneボリュームに関する考慮事項と推奨事項

* FlexCloneボリュームを移動中にオフラインにすることはできません。
* FlexClone volumeは、 `vol clone split start`コマンドを開始せずに、あるアグリゲートから同じノード上の別のアグリゲートへ、または同じSVM内の別のノードへ移動できます。
+
FlexCloneボリュームに対してボリューム移動処理を開始すると、クローン ボリュームがスプリットされて別のアグリゲートに移動されます。クローン ボリュームでボリューム移動が完了すると、移動したボリュームはクローンとしてではなく、それまでの親ボリュームとクローン関係のない独立したボリュームとして表示されます。

* クローンを移動してもFlexClone ボリューム スナップショットは失われません。
* FlexCloneの親ボリュームをアグリゲート間で移動することができます。
+
FlexCloneの親ボリュームを移動すると、元のアグリゲートに一時ボリュームが残り、すべてのFlexCloneボリュームの親ボリュームとして機能します。この一時ボリュームに対して実行できるのはオフラインにする処理と削除する処理だけで、それ以外の処理は実行できません。すべてのFlexCloneボリュームのスプリットまたは破棄が完了すると、一時ボリュームは自動的にクリーンアップされます。

* FlexCloneの子ボリュームは、移動後はFlexCloneボリュームではなくなります。
* FlexCloneの移動処理は、FlexCloneのコピー処理やスプリット処理と同時に実行することはできません。
* クローンスプリット処理が実行中の場合、ボリュームの移動が失敗することがあります。
+
クローンスプリット処理が完了するまで、ボリュームを移動しないようにしてください。





== MetroClusterに関する考慮事項と推奨事項

* MetroCluster構成内でボリュームを移動する際、ソース クラスタのデスティネーション アグリゲートに一時ボリュームが作成されると、ミラーされているが同期されていないアグリゲート内のボリュームに対応する一時ボリュームのレコードも稼働しているクラスタに作成されます。
* MetroClusterのスイッチオーバーがカットオーバー前に発生した場合、デスティネーション ボリュームは一時ボリューム（タイプがTMPのボリューム）として記録されます。
+
稼働している（ディザスタ リカバリ）クラスタで移動ジョブが再開され、障害を報告し、移動に関連する項目（一時ボリュームなど）をすべてクリーンアップします。クリーンアップを正しく実行できなかった場合は、必要なクリーンアップを実行するようシステム管理者に警告するEMSが生成されます。

* MetroClusterのスイッチオーバーが、カットオーバー フェーズは開始しているが移動ジョブは完了していない（つまり、デスティネーション アグリゲートを参照するようにクラスタを更新できるところまでは完了した）時点で発生した場合、移動ジョブは稼働している（ディザスタ リカバリ）クラスタで再開されて最後まで実行されます。
+
移動に関連する項目は、一時ボリューム（元のソース）を含めてすべてクリーンアップされます。クリーンアップを正しく実行できなかった場合は、必要なクリーンアップを実行するようシステム管理者に警告するEMSが生成されます。

* スイッチオーバーされたサイトに属するボリュームについて実行中のボリューム移動処理がある場合、MetroClusterのスイッチバックは強制的かどうかに関係なく実行できません。
+
存続サイトのローカル ボリュームに対してボリューム移動処理が進行中の場合、スイッチバックはブロックされません。

* 強制されていないMetroClusterスイッチオーバーはブロックされますが、ボリューム移動処理の実行中は、強制的なMetroClusterスイッチオーバーはブロックされません。

